# 原创Tongweb7049m4 遇到 “xxx打开的文件过多” 的处理思路（by lqw）

> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143214648

---

遇到一个案例，客户服务的cpu占用，内存占用都不高，看控制台的线程数也很低，但是会报这种错误：
看着像是mybatis刷新什么东西的时候，刷不到对应的信息导致的，于是细看了一下tongweb的server.log，发现了这种日志信息：
关键是查看unlimit -a，配了open files 65535了。
于是让客户先重启恢复服务，等下次遇到同样问题，执行lsof -p 进程号 > log.txt，再把日志发出来看看。
结果隔了大概一天的时间，客户又遇到这个问题，浏览器截图如下：
客户顺利打印出lsof的信息，我看了下，出现最多信息的是两个mapper文件，都跟业务有关，全是mapper文件（用nodepid++ 的统计功能统计的）
好家伙，两个mapper文件的打开文件数加起来都快达到openfile 配置的最大数了，难怪会报打开的文件过多的信息。
后续：
让应用去排查代码逻辑上哪里调用了这两个文件，看看是否是资源没有及时释放，或者是代码问题。