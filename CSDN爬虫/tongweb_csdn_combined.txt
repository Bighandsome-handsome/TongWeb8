问题编号: 001
问题: ClassNotFoundException_com.tongweb.geronimo.osgi.locator.ProviderLocator

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/121599209

---

问题:
在TongWeb7上部署应用报错：
ClassNotFoundException:com.tongweb.geronimo.osgi.locator.ProviderLocator
原因：
当-DWebModuleOnly=true后，不加载javamail_1.4_mail.jar，而com.tongweb.geronimo.osgi.locator.ProviderLocator则在这个jar中。
解决办法：
将javamail_1.4_mail.jar改名为不以javamail开头的jar即可，如:  aamail.jar。

关键字: ClassNotFoundException_com.tongweb.geronimo.osgi.locator.ProviderLocator
文档来源: 
--------------------------------------------------------------------------------

问题编号: 002
问题: Pinpoint2.3.3监控Tongweb7049m4（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/141637121

---

文章目录
声明
版本说明
参考帖子
为什么不选用低版本pinpoint
端口准备
pinpoint架构说明
所需安装包
jdk版本
补丁包使用说明（这个版本的需要打补丁）
hbase1.2.6安裝
启动pinpoint-collector
访问pinpoint-web页面
Tongweb配置pinpoint-agent
声明
本帖只是演示Tongweb7049m4层面如何配置才能让Pinpoint2.3.3监控到，Pinpoint2.3.3的安装部署仅供参考,如果需要給Tongweb7049m4打补丁，请联系东方通技术人员进行支持。
版本说明
目前Tongweb7049m4自带的pinpoint版本支持如下:
高于这些版本的pinpoint需要打补丁，补丁PDMP5088（这个找技术人员要）
参考帖子
https://zhuanlan.zhihu.com/p/472331114
pinpoint2.3.3安装和部署
为什么不选用低版本pinpoint
低版本pinpoint需要使用war包形式部署pinpoint-collector.war和pinpoint-web.war（部署后里面要配很多东西，很麻烦，容易出错），需要另外安装tomcat进行部署，本次演示使用的是2.3.3的jar包，直接java -jar 启动即可，不需要再额外安装tomcat。
端口准备
部署web和controller的服务器要将防火墙对外的接口开启，9991、9992、9993、8080、8081
pinpoint架构说明
所需安装包
下图是本次示范用到的所有文件：
jdk版本
jdk1.8。
补丁包使用说明（这个版本的需要打补丁）
1.上传补丁包到服务器上。
2.打补丁前，请备份好Tongweb7049m4的安装目录。
操作参考：
1.停止tongweb服務
cd
opt/TongWeb7.0.4.9_M4_Enterprise_Linux/bin
./forcestopserver.sh
2.备份
cp
-rf
TongWeb7.0.4.9_M4_Enterprise_Linux TongWeb7.0.4.9_M4_Enterprise_Linux_bak
3.将补丁包放入到Tongweb安装目录的tools/patch-7.0/cache_dir下，执行以下指令：
[
root@localhost cache_dir
]
# cd /opt/TongWeb7.0.4.9_M4_Enterprise_Linux/tools/patch-7.0
[
root@localhost patch-7.0
]
# ./patch.sh install /opt/TongWeb7.0.4.9_M4_Enterprise_Linux  p=PDMP-5088_patch_7049.zip
有上图的提示后，执行
#home=后面用Tongweb的安装目录
./patch.sh list
home
=
/opt/TongWeb7.0.4.9_M4_Enterprise_Linux
有以下提示说明成功打上对应补丁
查看目录已有pinpoint-plugins的新版本包
hbase1.2.6安裝
解压hbase1.2.6
tar-zvxf hbase-1.2.6-bin.tar.gz
编辑hbase-env.sh文件，添加JAVA_HOME配置（该文件在hbase安装目录的conf目录下）：
# javahome
export
JAVA_HOME
=
/opt/jdk1.8.0_391
# hbase运行要用到zooker，一般单机的话，用hbase自带的就好，这里设置为true就是为了启用自带的
export
HBASE_MANAGES_ZK
=
true
同时把这两行注释了（jdk1.8已经不支持了）
备注：可通过vim方式搜索JAVA_HOME、HBASE_MANAGES_ZK、HBASE_MASTER_OPTS、HBASE_REGIONSERVER_OPTS关键字来快速定位
编辑hbase-site.xml文件（也在hbase安装目录的conf目录下）
<
configuration
>
<
property
>
<
name
>
hbase.rootdir
<
/name
>
<
value
>
file:///xxx/hbase/data
<
/value
>
<
/property
>
<
/configuration
>
配置好后，启动hbase
cd
/opt/hbase-1.2.6/bin
./start-hbase.sh
启动后可以输入jps查看
启动成功后需要初始化数据库，将hbase-create.hbase放到任意目录（例如opt），然后在hbase的bin目录执行
#opt/hbase-create.hbase是脚本的位置
./hbase shell /opt/hbase-create.hbase


这个脚本可以自己上网搜，或者自己新建一个文件，把下面的内容复制进去：

```java
create
'AgentInfo'
,
{
NAME
=
>
'Info'
, TTL
=
>
31536000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'AgentStatV2'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x09
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x11
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x13
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x15
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x17
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x19
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x20
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x21
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x22
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x23
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x24
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x25
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x26
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x27
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x28
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x29
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x30
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x31
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x32
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x33
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x34
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x35
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x36
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x37
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x38
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x39
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationStatAggre'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x09
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x11
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x13
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x15
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x17
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x19
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x20
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x21
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x22
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x23
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x24
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x25
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x26
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x27
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x28
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x29
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x30
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x31
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x32
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x33
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x34
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x35
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x36
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x37
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x38
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x39
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationIndex'
,
{
NAME
=
>
'Agents'
, TTL
=
>
31536000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'AgentLifeCycle'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'AgentEvent'
,
{
NAME
=
>
'E'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'StringMetaData'
,
{
NAME
=
>
'Str'
, TTL
=
>
15552000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApiMetaData'
,
{
NAME
=
>
'Api'
, TTL
=
>
31536000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'SqlMetaData_Ver2'
,
{
NAME
=
>
'Sql'
, TTL
=
>
15552000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'TraceV2'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
NUMREGIONS
=
>
256
, SPLITALGO
=
>
'UniformSplit'
}
create
'ApplicationTraceIndex'
,
{
NAME
=
>
'I'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationMapStatisticsCaller_Ver2'
,
{
NAME
=
>
'C'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationMapStatisticsCallee_Ver2'
,
{
NAME
=
>
'C'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationMapStatisticsSelf_Ver2'
,
{
NAME
=
>
'C'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'HostApplicationMap_Ver2'
,
{
NAME
=
>
'M'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
list
exit
如下图说明初始化成功
访问服务器ip：16010
访问服务器ip:16010/tablesDetailed.jsp
启动pinpoint-collector
将pinpoint-collector-boot-2.3.3.jar放在任意目录，执行以下指令启动：
nohup
java
-jar
-Dpinpoint.zookeeper.address
=
127.0
.0.1 pinpoint-collector-boot-2.3.3.jar
>
console_ppc.log
2
>
&1
&
这里由于hbase用的是自嵌入zooker，且habse跟pinpoint-collector在同一台服务器，所以配的127.0.0.1。
启动后可以用jps查看进程：
ps
-ef
|
grep
pinpoint
如果要查看日志，一般在同一級目录会生成一个logs目录，里面就是日志文件：
访问pinpoint-web页面
将pinpoint-web-boot-2.3.3.jar放在任意目录，执行以下指令启动：
nohup
java
-jar
-Dpinpoint.zookeeper.address
=
127.0
.0.1 pinpoint-web-boot-2.3.3.jar
>
console_ppc.log
2
>
&1
&
这里由于hbase用的是自嵌入zooker，且habse跟pinpoint-collector在同一台服务器，所以配的127.0.0.1。
启动后可以用jps查看进程：
ps
-ef
|
grep
pinpoint
如果要查看日志，一般在同一級目录会生成一个logs目录，里面就是日志文件：
可以访问服务器ip:8080/测试是否运行成功。
Tongweb配置pinpoint-agent
pinpoint最終是通過agent来跟Tongweb交互的，所以我们需要做好相关配置。
首先找个目录，解压pinpoint-agent
tar
-zvxf
pinpoint-agent-2.3.3.tar.gz
解压完后，到Tongweb7049m4的tools下的目录找一下对应版本的pointplugins里的jar包，如下图所示：
將這個jar包cp到pinpoint-agent-2.3.3的plugin下：
弄好后找一找这个包的路径(pinpoint-bootstrap-xxxx.jar,一般就在agent的安装目录下)：
找一找/opt/pinpoint-agent-2.3.3/profiles目录，在这个目录下的local或者release目录下找到 pinpoint.config，配置如下信息：
profiler.tongweb.enable
=
true
profiler.tongweb.bootstrap.main
=
com.tongweb.main.TongWebMain
profiler.tongweb.hidepinpointheader
=
true
profiler.tongweb.excludeurl
=
profiler.tongweb.tracerequestparam
=
true
关闭Tongweb，备份好Tongweb目录
cp
-rf
/opt/TongWeb7.0.4.9_M4_Enterprise_Linux /opt/TongWeb7.0.4.9_M4_Enterprise_Linux
然后找到bin目录下的external.vmoptions，配置以下内容：
-javaagent:/opt/pinpoint-agent-2.3.3/pinpoint-bootstrap-2.3.3.jar
-Dpinpoint.agentId
=
1000001
-Dpinpoint.applicationName
=
tongweb_test
备注：
1.配置的时候不要用#，不要添加任何符号，会启动报错的
2./opt/pinpoint-agent-2.3.3/pinpoint-bootstrap-2.3.3.jar是pinpoint-bootstrap-2.3.3.jar的路径
3.tongweb_test是我自己配的，可根据自身需求配其他的name都可以。
配置后启动Tongweb，访问服务器ip:8080/，如下图所示，能刷出applicationName（本次配的是tongweb_test）,说明识别到了。

关键字: Pinpoint2.3.3监控Tongweb7049m4（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 003
问题: Pinpoint3.0.0监控Tongweb7049m4（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/141683707

---

文章目录
前言
端口准备
jdk版本要求
pinpoint架构说明
所需安装包
补丁包使用说明（这个版本的需要打补丁）
hbase2.6.0-安裝
安装和启动redis
启动pinpoint-collector
启动pinpoint-web
Tongweb配置pinpoint-agent
前言
由于Pinpoint3.0.0改版了一些东西，所以Pinpoint2.3.3版本的监控指引不适用于Pinpoint3.0.0，故重起一个帖子来详细说明。
声明：
本帖只是演示Tongweb7049m4层面如何配置才能让Pinpoint3.0.0监控到，Pinpoint3.0.0的安装部署仅供参考,如果需要給Tongweb7049m4打补丁，请联系东方通技术人员进行支持。
目前Tongweb7049m4自带的pinpoint版本支持如下:
高于这些版本的pinpoint需要打补丁，补丁PDMP5088（这个找技术人员要）
端口准备
部署web和controller的服务器要将防火墙对外的接口开启，9991、9992、9993、8080、8081
jdk版本要求
jdk17。（强调一下，一定要用jdk17，不然启动pinpoint的各个组件会报错并且闪退的）
pinpoint架构说明
备注：
部署过程中发现Pinpoint3.0.0的collector有报错说无法连接到localhost:6379，查gpt才知道3.0.0还需要部署redis，以下是gpt的原话：
Pinpoint 使用 Redis 来处理异步任务和缓存某些应用程序数据，特别是在 Pinpoint Collector 中，通过 Redis 实现消息的订阅和发布机制，这对于数据的聚合和处理至关重要。
所需安装包
补丁包使用说明（这个版本的需要打补丁）
1.上传补丁包到服务器上。
2.打补丁前，请备份好Tongweb7049m4的安装目录。
操作参考：
1.停止tongweb服務
cd
opt/TongWeb7.0.4.9_M4_Enterprise_Linux/bin
./forcestopserver.sh
2.备份
cp
-rf
TongWeb7.0.4.9_M4_Enterprise_Linux TongWeb7.0.4.9_M4_Enterprise_Linux_bak
3.将补丁包放入到Tongweb安装目录的tools/patch-7.0/cache_dir下，执行以下指令：
[
root@localhost cache_dir
]
# cd /opt/TongWeb7.0.4.9_M4_Enterprise_Linux/tools/patch-7.0
[
root@localhost patch-7.0
]
# ./patch.sh install /opt/TongWeb7.0.4.9_M4_Enterprise_Linux  p=PDMP-5088_patch_7049.zip
有上图的提示后，执行
#home=后面用Tongweb的安装目录
./patch.sh list
home
=
/opt/TongWeb7.0.4.9_M4_Enterprise_Linux
有以下提示说明成功打上对应补丁
查看目录已有pinpoint-plugins的新版本包
hbase2.6.0-安裝
查了下资料，Pinpoint3.0.0不支持hbase1.x版本（本地试验过会报错），找了下目前较新的版本是2.6.0，所以用2.6.0版本进行演示。
解压hbase2.6.0
tar-zvxf hbase-2.6.0-bin.tar.gz
解压后在安装目录的conf目录下找到hbase-env.sh，添加以下配置：
# javahome
export
JAVA_HOME
=
/opt/jdk-17.0.12
# hbase运行要用到zooker，一般单机的话，用hbase自带的就好，这里设置为true就是为了启用自带的
export
HBASE_MANAGES_ZK
=
true
配置好后，启动hbase
cd
/opt/hbase/hbase-2.6.0/bin
./start-hbase.sh
启动后可以输入jps查看
启动成功后需要初始化数据库，将hbase-create.hbase放到任意目录（例如opt），然后在hbase的bin目录执行
#opt/hbase-create.hbase是脚本的位置
./hbase shell /opt/hbase-create.hbase


这个脚本可以自己上网搜，或者自己新建一个文件，把下面的内容复制进去：

```java
create
'AgentInfo'
,
{
NAME
=
>
'Info'
, TTL
=
>
31536000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'AgentStatV2'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x09
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x11
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x13
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x15
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x17
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x19
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x20
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x21
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x22
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x23
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x24
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x25
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x26
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x27
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x28
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x29
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x30
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x31
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x32
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x33
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x34
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x35
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x36
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x37
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x38
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x39
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationStatAggre'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x09
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x11
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x13
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x15
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x17
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x19
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x20
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x21
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x22
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x23
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x24
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x25
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x26
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x27
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x28
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x29
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x2f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x30
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x31
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x32
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x33
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x34
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x35
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x36
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x37
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x38
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x39
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3b
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3d
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x3f
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationIndex'
,
{
NAME
=
>
'Agents'
, TTL
=
>
31536000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'AgentLifeCycle'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'AgentEvent'
,
{
NAME
=
>
'E'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
create
'StringMetaData'
,
{
NAME
=
>
'Str'
, TTL
=
>
15552000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApiMetaData'
,
{
NAME
=
>
'Api'
, TTL
=
>
31536000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'SqlMetaData_Ver2'
,
{
NAME
=
>
'Sql'
, TTL
=
>
15552000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'TraceV2'
,
{
NAME
=
>
'S'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
NUMREGIONS
=
>
256
, SPLITALGO
=
>
'UniformSplit'
}
create
'ApplicationTraceIndex'
,
{
NAME
=
>
'I'
, TTL
=
>
5184000
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationMapStatisticsCaller_Ver2'
,
{
NAME
=
>
'C'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationMapStatisticsCallee_Ver2'
,
{
NAME
=
>
'C'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x08
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x0e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x10
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x12
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x14
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x16
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x18
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1a
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1c
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x1e
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'ApplicationMapStatisticsSelf_Ver2'
,
{
NAME
=
>
'C'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x04
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x05
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x06
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x07
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
create
'HostApplicationMap_Ver2'
,
{
NAME
=
>
'M'
, TTL
=
>
5184000
, VERSIONS
=
>
1
, DATA_BLOCK_ENCODING
=
>
'PREFIX'
}
,
{
SPLITS
=
>
[
"
\x01
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x02
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
,
"
\x03
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
\x00
"
]
}
list
exit
如下图说明初始化成功
访问服务器ip：16010
安装和启动redis
redis安装
Linux下Redis 6.2.6安装和部署详细图文步骤
备注：
本次演示没有设置redis密码，且redis，habse，pinpoint，tongweb均在同一台服务器。
启动pinpoint-collector
将pinpoint-collector-starter-3.0.0-exec.jar放入到任意目录（自己起一个记得的名字），执行以下指令进行启动
nohup
java
--add-opens java.base/java.nio
=
ALL-UNNAMED
-jar
-Dpinpoint.zookeeper.address
=
127.0
.0.1 pinpoint-collector-starter-3.0.0-exec.jar
>
console_ppc.log
2
>
&1
&
备注：
这条指令添加了–add-opens java.base/java.nio=ALL-UNNAMED，原因在于本地试验的时候，不加的话，pinpoint-collector-starter-3.0.0-exec.jar启动的时候会有退出提示：
[
root@localhost pinpoint_collector
]
# cd /opt/pinpoint_web
[
1
]
+  退出
1
nohup
java
--add-opens java.base/java.nio
=
ALL-UNNAMED
-jar
-Dpinpoint.zookeeper.address
=
127.0
.0.1 pinpoint-collector-starter-3.0.0-exec.jar
>
console_ppc.log
2
>
&1
(
工作目录：/opt/pinpoint_collector
)
启动成功后可看日志，如果没有什么异常的话，继续下一步。
启动pinpoint-web
将pinpoint-web-starter-3.0.0-exec.jar 放入任意目录，执行以下指令进行启动
nohup
java
--add-opens java.base/java.nio
=
ALL-UNNAMED
-jar
-Dpinpoint.zookeeper.address
=
127.0
.0.1 pinpoint-web-starter-3.0.0-exec.jar
>
console_ppc.log
2
>
&1
&
启动成功后可看日志，如果没有什么异常的话，继续下一步。
Tongweb配置pinpoint-agent
pinpoint最終是通過agent来跟Tongweb交互的，所以我们需要做好相关配置。
首先找个目录，解压pinpoint-agent。
tar-zvxf pinpoint-agent-3.0.0.tar.gz
解压完后，到Tongweb7049m4的tools下的目录找一下对应版本的pointplugins里的jar包
將這個jar包cp到pinpoint-agent-3.0.0的plugin下：
弄好后找一找这个包的路径(pinpoint-bootstrap-xxxx.jar,一般就在agent的安装目录下)：
找一找/opt/pinpoint-agent-3.0.0/profiles目录（这是我本地的安装目录），在这个目录下的local或者release目录下找到 pinpoint.config，配置如下信息：
profiler.tongweb.enable
=
true
profiler.tongweb.bootstrap.main
=
com.tongweb.main.TongWebMain
profiler.tongweb.hidepinpointheader
=
true
profiler.tongweb.excludeurl
=
profiler.tongweb.tracerequestparam
=
true
关闭Tongweb，备份好Tongweb目录
cp
-rf
/opt/TongWeb7.0.4.9_M4_Enterprise_Linux /opt/TongWeb7.0.4.9_M4_Enterprise_Linux
然后找到bin目录下的external.vmoptions，配置以下内容：
-javaagent:/opt/pinpoint-agent-2.3.3/pinpoint-bootstrap-2.3.3.jar
-Dpinpoint.agentId
=
1000001
-Dpinpoint.applicationName
=
tongweb_test
备注：
1.配置的时候不要用#，不要添加任何符号，会启动报错的
2./opt/pinpoint-agent-2.3.3/pinpoint-bootstrap-2.3.3.jar是pinpoint-bootstrap-2.3.3.jar的路径
3.tongweb_test是我自己配的，可根据自身需求配其他的name都可以。
配置后启动Tongweb，访问服务器ip:8080/，如下图所示，能刷出applicationName（本次配的是tongweb_test）,说明识别到了。

关键字: Pinpoint3.0.0监控Tongweb7049m4（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 004
问题: Prometheus+Grafana 监控Tongweb7（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/136863845

---

文章目录
1.准备工作
2.Tongweb7部署
3.Prometheus部署
4.上传jar包并配置Tongweb7
5.Prometheus配置
6.安装和配置Grafana
1.准备工作
本次参考：
Prometheus监控Tongweb容器
1.使用虚拟机ip：192.168.10.51（tongweb），192.168.10.52（Prometheus），192.168.10.8(Grafana ),其中51服务器确保9060，39081端口没有被占用,52服务器确保9090端口没有被占用，8服务器确保3000端口没有被占用，三台虚拟机均关闭防火墙。
2.使用的jar包：jmx_prometheus_javaagent-0.19.0.jar:
jmx_prometheus_javaagent-0.19.0.jar下载链接
3.使用的jdk环境：jdk1.8(需配置jdk环境变量)
4.下载Grafana使用的仪表盘json文件：
TongWeb 面板，使用JMX Exporter采集数据
也可以新建一个json文件，复制粘贴以下内容：
{
"__inputs"
:
[
{
"name"
:
"DS_PROMETHEUS"
,
"label"
:
"Prometheus"
,
"description"
:
""
,
"type"
:
"datasource"
,
"pluginId"
:
"prometheus"
,
"pluginName"
:
"Prometheus"
}
]
,
"__elements"
:
{
}
,
"__requires"
:
[
{
"type"
:
"panel"
,
"id"
:
"gauge"
,
"name"
:
"Gauge"
,
"version"
:
""
}
,
{
"type"
:
"grafana"
,
"id"
:
"grafana"
,
"name"
:
"Grafana"
,
"version"
:
"10.0.1"
}
,
{
"type"
:
"datasource"
,
"id"
:
"prometheus"
,
"name"
:
"Prometheus"
,
"version"
:
"1.0.0"
}
,
{
"type"
:
"panel"
,
"id"
:
"stat"
,
"name"
:
"Stat"
,
"version"
:
""
}
,
{
"type"
:
"panel"
,
"id"
:
"table"
,
"name"
:
"Table"
,
"version"
:
""
}
,
{
"type"
:
"panel"
,
"id"
:
"timeseries"
,
"name"
:
"Time series"
,
"version"
:
""
}
]
,
"annotations"
:
{
"list"
:
[
{
"builtIn"
:
1
,
"datasource"
:
{
"type"
:
"datasource"
,
"uid"
:
"grafana"
}
,
"enable"
:
true,
"hide"
:
true,
"iconColor"
:
"rgba(0, 211, 255, 1)"
,
"name"
:
"Annotations & Alerts"
,
"target"
:
{
"limit"
:
100
,
"matchAny"
:
false,
"tags"
:
[
]
,
"type"
:
"dashboard"
}
,
"type"
:
"dashboard"
}
]
}
,
"description"
:
"TongWeb 面板，使用JMX Exporter采集数据"
,
"editable"
:
true,
"fiscalYearStartMonth"
:
0
,
"gnetId"
:
19156
,
"graphTooltip"
:
0
,
"id"
:
null,
"links"
:
[
{
"asDropdown"
:
false,
"icon"
:
"external link"
,
"includeVars"
:
false,
"keepTime"
:
false,
"tags"
:
[
]
,
"targetBlank"
:
true,
"title"
:
"更新面板"
,
"tooltip"
:
""
,
"type"
:
"link"
,
"url"
:
"https://grafana.com/grafana/dashboards/19156"
}
]
,
"liveNow"
:
false,
"panels"
:
[
{
"collapsed"
:
false,
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"fb65406e-39df-40f2-966c-9987082bdcfe"
}
,
"gridPos"
:
{
"h"
:
1
,
"w"
:
24
,
"x"
:
0
,
"y"
:
0
}
,
"id"
:
31
,
"panels"
:
[
]
,
"repeat"
:
"protocol"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"fb65406e-39df-40f2-966c-9987082bdcfe"
}
,
"refId"
:
"A"
}
]
,
"title"
:
"监控信息"
,
"type"
:
"row"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"description"
:
"被监控服务是否处于运行状态，即该服务是否可达。当UP指标的值为1时，表示该服务正在运行，并且可以被访问，当UP指标的值为0时，则表示该服务不可达或处于停止状态。"
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"0"
:
{
"color"
:
"red"
,
"index"
:
1
,
"text"
:
"未连通"
}
,
"1"
:
{
"color"
:
"green"
,
"index"
:
0
,
"text"
:
"连通"
}
}
,
"type"
:
"value"
}
,
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"color"
:
"red"
,
"index"
:
2
,
"text"
:
"未连通"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
4
,
"x"
:
0
,
"y"
:
1
}
,
"id"
:
33
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"area"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"auto"
,
"reduceOptions"
:
{
"calcs"
:
[
"lastNotNull"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"text"
:
{
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"up{instance=~
\"
$instance
\"
}"
,
"instant"
:
true,
"interval"
:
""
,
"legendFormat"
:
"状态"
,
"refId"
:
"A"
}
]
,
"title"
:
"运行状态"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"decimals"
:
2
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"orange"
,
"value"
:
80
}
]
}
,
"unit"
:
"percent"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
4
,
"y"
:
1
}
,
"id"
:
17
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"showThresholdLabels"
:
false,
"showThresholdMarkers"
:
true
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"jvm_memory_bytes_used{area='heap', instance=
\"
$instance
\"
}/jvm_memory_bytes_max{area='heap', instance=
\"
$instance
\"
}*100"
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"JVM内存使用率"
,
"type"
:
"gauge"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
9
,
"y"
:
1
}
,
"id"
:
20
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"none"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(tongweb_manager_sessioncounter{instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"会话总个数"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
14
,
"y"
:
1
}
,
"id"
:
21
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"none"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(tongweb_manager_expiredsessions{instance=
\"
$instance
\"
}) "
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"会话过期数"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
19
,
"y"
:
1
}
,
"id"
:
19
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"none"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(tongweb_manager_sessioncounter{ instance=
\"
$instance
\"
} - tongweb_manager_expiredsessions{instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"当前会话计数"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"custom"
:
{
"align"
:
"auto"
,
"cellOptions"
:
{
"type"
:
"auto"
}
,
"inspect"
:
false
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"min"
:
0
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"线程池使用率*"
}
,
"properties"
:
[
{
"id"
:
"color"
,
"value"
:
{
"mode"
:
"continuous-GrYlRd"
}
}
,
{
"id"
:
"custom.cellOptions"
,
"value"
:
{
"mode"
:
"gradient"
,
"type"
:
"gauge"
}
}
,
{
"id"
:
"unit"
,
"value"
:
"percent"
}
,
{
"id"
:
"decimals"
,
"value"
:
1
}
,
{
"id"
:
"min"
,
"value"
:
-1
}
,
{
"id"
:
"thresholds"
,
"value"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
{
"id"
:
"max"
,
"value"
:
100
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"http通道"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
200
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"最大线程数"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"初始线程数"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"线程优先级"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"等待队列"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
5
}
,
"id"
:
14
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"cellHeight"
:
"sm"
,
"footer"
:
{
"countRows"
:
false,
"fields"
:
""
,
"reducer"
:
[
"sum"
]
,
"show"
:
false
}
,
"showHeader"
:
true,
"sortBy"
:
[
{
"desc"
:
true,
"displayName"
:
"线程池使用率"
}
]
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_maxthreads{ instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{name}}-最大线程数"
,
"range"
:
false,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_minsparethreads{instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"legendFormat"
:
"{
{name}}-使用线程数"
,
"range"
:
false,
"refId"
:
"B"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_connectioncount{ instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"legendFormat"
:
"{
{name}}"
,
"range"
:
false,
"refId"
:
"C"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_connectioncount{ instance=
\"
$instance
\"
}/tongweb_threadpool_maxthreads{ instance=
\"
$instance
\"
}*100"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"range"
:
false,
"refId"
:
"D"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_threadpriority{instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"range"
:
false,
"refId"
:
"E"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_backlog{instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"range"
:
false,
"refId"
:
"F"
}
]
,
"title"
:
"线程池信息"
,
"transformations"
:
[
{
"id"
:
"filterFieldsByName"
,
"options"
:
{
"include"
:
{
"pattern"
:
"/^Value #[A-Z]|^name$/"
}
}
}
,
{
"id"
:
"merge"
,
"options"
:
{
}
}
,
{
"id"
:
"organize"
,
"options"
:
{
"excludeByName"
:
{
}
,
"indexByName"
:
{
}
,
"renameByName"
:
{
"Value #A"
:
"最大线程数"
,
"Value #B"
:
"初始线程数"
,
"Value #C"
:
"正在执行任务的线程数*"
,
"Value #D"
:
"线程池使用率*"
,
"Value #E"
:
"线程优先级"
,
"Value #F"
:
"等待队列"
,
"name"
:
"http通道"
}
}
}
,
{
"id"
:
"groupBy"
,
"options"
:
{
"fields"
:
{
"Value #E"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"http通道"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"初始线程数"
:
{
"aggregations"
:
[
"lastNotNull"
]
,
"operation"
:
"groupby"
}
,
"最大线程数"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"正在执行任务的线程数"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"正在执行任务的线程数*"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"等待队列"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"线程优先级"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"线程池使用率"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"线程池使用率*"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
}
}
}
]
,
"type"
:
"table"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
6
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"percent"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
5
}
,
"id"
:
40
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"tongweb_threadpool_connectioncount{ instance=
\"
$instance
\"
}/tongweb_threadpool_maxthreads{ instance=
\"
$instance
\"
}*100"
,
"instant"
:
false,
"legendFormat"
:
"{
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"线程池使用率"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"continuous-BlPu"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
14
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineStyle"
:
{
"fill"
:
"solid"
}
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
14
}
,
"id"
:
39
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"bottom"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"jvm_memory_bytes_used{area='heap', instance=
\"
$instance
\"
}/jvm_memory_bytes_max{area='heap', instance=
\"
$instance
\"
}*100"
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"内存使用率"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"JVM内存使用率"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
6
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
14
}
,
"id"
:
41
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"increase(tongweb_requestprocessor_errorcount{instance=
\"
$instance
\"
}[5m])"
,
"instant"
:
false,
"legendFormat"
:
"{
{worker}}-{
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"近5分钟错误增长数"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
8
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"ms"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
23
}
,
"id"
:
35
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(increase(tongweb_requestprocessor_processingtime{instance=
\"
$instance
\"
}[5m])) by (worker) / (count(tongweb_requestprocessor_processingtime{instance=
\"
$instance
\"
}) by (worker)+0.01) "
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{worker}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"平均响应时长"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
11
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
2
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"orange"
,
"value"
:
80
}
]
}
,
"unit"
:
"percent"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
23
}
,
"id"
:
37
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"bottom"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"jvm_memory_pool_bytes_used{ instance=
\"
$instance
\"
, pool!=
\"
Metaspace
\"
}/jvm_memory_pool_bytes_max{ instance=
\"
$instance
\"
, pool!=
\"
Metaspace
\"
}*100"
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{pool}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"JVM内存池使用率"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
{
"matcher"
:
{
"id"
:
"byValue"
,
"options"
:
{
"op"
:
"gte"
,
"reducer"
:
"allIsZero"
,
"value"
:
0
}
}
,
"properties"
:
[
{
"id"
:
"custom.hideFrom"
,
"value"
:
{
"legend"
:
true,
"tooltip"
:
true,
"viz"
:
false
}
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
32
}
,
"id"
:
23
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"topk(5, tongweb_globalrequestprocessor_requestcount{ instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{name}} "
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"请求计数TOP5"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"short"
}
,
"overrides"
:
[
{
"matcher"
:
{
"id"
:
"byValue"
,
"options"
:
{
"op"
:
"gte"
,
"reducer"
:
"allIsZero"
,
"value"
:
0
}
}
,
"properties"
:
[
{
"id"
:
"custom.hideFrom"
,
"value"
:
{
"legend"
:
true,
"tooltip"
:
true,
"viz"
:
false
}
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
32
}
,
"id"
:
24
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"topk(5,tongweb_requestprocessor_errorcount{ instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{worker}} "
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"错误计数TOP5"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"decbytes"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
41
}
,
"id"
:
2
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"repeatDirection"
:
"h"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_bytesreceived{ instance=
\"
$instance
\"
}[
$__interval
])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Received {
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_bytessent{ instance=
\"
$instance
\"
}[
$__interval
])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Sent {
{name}}"
,
"range"
:
true,
"refId"
:
"B"
}
]
,
"title"
:
"发送/接收流量"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
"tomcat_requestcount_total是Tomcat服务器的一个请求计数器，它记录了所有已处理的请求总数。 在Tomcat服务器中，每个客户端请求都会被处理为一个请求，在处理请求期间，服务器会从连接中读取数据、解析数据、执行应用逻辑，并返回响应。每当Tomcat服务器成功处理一个请求时，其tomcat_requestcount_total指标就会相应地增加。监控和分析该指标可以帮助管理员和开发人员更好地了解Tomcat服务器的整体负载情况和活动水平，对于性能优化和故障排除都具有一定的价值。此外，该指标也可以通过与其他指标如tomcat_bytesreceived_total和tomcat_bytessent_total等结合使用，来监测网络流量和请求响应时间等性能指标，以进一步优化Tomcat服务器的配置和性能。"
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"short"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
41
}
,
"id"
:
4
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
"lastNotNull"
,
"max"
,
"min"
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"repeatDirection"
:
"h"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_requestcount{ instance=
\"
$instance
\"
}[5m])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Request {
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_errorcount{ instance=
\"
$instance
\"
}[5m])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Error  {
{name}}"
,
"range"
:
true,
"refId"
:
"B"
}
]
,
"title"
:
"请求计数/错误计数"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
{
"__systemRef"
:
"hideSeriesFrom"
,
"matcher"
:
{
"id"
:
"byNames"
,
"options"
:
{
"mode"
:
"exclude"
,
"names"
:
[
"New"
]
,
"prefix"
:
"All except:"
,
"readOnly"
:
true
}
}
,
"properties"
:
[
{
"id"
:
"custom.hideFrom"
,
"value"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
true
}
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
8
,
"w"
:
24
,
"x"
:
0
,
"y"
:
50
}
,
"id"
:
5
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
"lastNotNull"
,
"max"
,
"min"
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"sum(increase(tongweb_manager_sessioncounter{ instance=
\"
$instance
\"
}[5m])) by (instance)"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"New"
,
"range"
:
true,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"sum(increase(tongweb_manager_expiredsessions{ instance=
\"
$instance
\"
}[5m])) by (instance)"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Expired"
,
"range"
:
true,
"refId"
:
"B"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"sum(increase(tongweb_manager_rejectedsessions{ instance=
\"
$instance
\"
}[5m])) by (instance)"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Rejected"
,
"range"
:
true,
"refId"
:
"C"
}
]
,
"title"
:
"会话计数统计"
,
"type"
:
"timeseries"
}
]
,
"refresh"
:
"5s"
,
"schemaVersion"
:
38
,
"style"
:
"dark"
,
"tags"
:
[
"Tomcat8"
]
,
"templating"
:
{
"list"
:
[
{
"current"
:
{
"selected"
:
false,
"text"
:
"Prometheus"
,
"value"
:
"Prometheus"
}
,
"hide"
:
0
,
"includeAll"
:
false,
"multi"
:
false,
"name"
:
"datasource"
,
"options"
:
[
]
,
"query"
:
"prometheus"
,
"queryValue"
:
""
,
"refresh"
:
1
,
"regex"
:
""
,
"skipUrlSync"
:
false,
"type"
:
"datasource"
}
,
{
"allValue"
:
".*"
,
"current"
:
{
}
,
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"definition"
:
"label_values(jvm_info{},instance)"
,
"hide"
:
0
,
"includeAll"
:
false,
"label"
:
"Instance"
,
"multi"
:
false,
"name"
:
"instance"
,
"options"
:
[
]
,
"query"
:
{
"query"
:
"label_values(jvm_info{},instance)"
,
"refId"
:
"PrometheusVariableQueryEditor-VariableQuery"
}
,
"refresh"
:
2
,
"regex"
:
""
,
"skipUrlSync"
:
false,
"sort"
:
1
,
"tagValuesQuery"
:
""
,
"tagsQuery"
:
""
,
"type"
:
"query"
,
"useTags"
:
false
}
]
}
,
"time"
:
{
"from"
:
"now-15m"
,
"to"
:
"now"
}
,
"timepicker"
:
{
"refresh_intervals"
:
[
"5s"
,
"10s"
,
"30s"
,
"1m"
,
"5m"
,
"15m"
]
,
"time_options"
:
[
"5m"
,
"15m"
,
"1h"
,
"6h"
,
"12h"
,
"24h"
,
"2d"
,
"7d"
,
"30d"
]
}
,
"timezone"
:
""
,
"title"
:
"TongWeb_dashboard"
,
"uid"
:
"tongweb"
,
"version"
:
71
,
"weekStart"
:
""
}
5.tw7的安装包和授权，其中tw7使用的安装包为TongWeb7.0.4.9_M3_Enterprise_Linux.tar.gz。
2.Tongweb7部署
参考：
TongWeb7-绿色版安装及启动停止和控制台访问
3.Prometheus部署
参考：
一篇文章搞定Prometheus普罗米修斯监控系统的部署
4.上传jar包并配置Tongweb7
把下载好的jar包放入到Tongweb7安装目录的bin目录下
新建一個config.yaml
vi 这个文件，复制粘贴以下内容（注意缩进）：
wercaseOutputLabelNames:
true
lowercaseOutputName:
true
whitelistObjectNames:
[
"java.lang:type=OperatingSystem"
,
"TONGWEB:*"
,
"config:*"
]
blacklistObjectNames:
[
]
rules:
  - pattern:
".*"
以下是配置内容的用途
TongWeb安装目录/bin目录下，修改external.vmoptions文件，在#jvm_options 后添加javaagent参数
參考配置：
-javaagent:/opt/TongWeb7.0.4.9_M3_Enterprise_Linux/bin/jmx_prometheus_javaagent-0.19.0.jar
=
39081
:/opt/TongWeb7.0.4.9_M3_Enterprise_Linux/bin/config.yaml
备注：
1.这里要使用jmx_prometheus_javaagent-0.19.0.jar和config.yaml所在目录，我的是在/opt/TongWeb7.0.4.9_M3_Enterprise_Linux/bin。
2.配置在#jvm_options下面，如果不熟悉可以直接用控制台配置，配置前请备份external.vmoptions这个文件，如下图所示：
备注：
配错了可能会有这个提示：
Error opening zip file or JAR manifest missing :
Error occurred during initialization of VM
agent library failed to init: instrument
3.除了这个配置，不能有#等其他多余字符串（#在这个配置文件里不是注释修饰符）。
4.如果改错了，会导致tongweb启动失败，所以万一启动失败了，请直接删了重新配。
配置后重启tongweb，然后访问服务器ip:39081/metrics，看看有没有数据
5.Prometheus配置
配置prometheus.yml：
配置参考（注意缩进，192.168.10.51和39081分别对应的是tongweb这边的端口和ip）：
static_configs:
      - targets:
[
"localhost:9090"
]
- job_name: tongweb
    static_configs:
      - targets:
[
'192.168.10.51:39081'
]
labels:
          instance:
192.168
.10.51
下面是我本地的配置文件，自行删除不需要的部分：
global:
  scrape_interval: 15s
# Set the scrape interval to every 15 seconds. Default is every 1 minute.
evaluation_interval: 15s
# Evaluate rules every 15 seconds. The default is every 1 minute.
# scrape_timeout is set to the global default (10s).
alerting:
  alertmanagers:
    - static_configs:
        - targets:
# - alertmanager:9093
rule_files:
# - "first_rules.yml"
# - "second_rules.yml"
scrape_configs:
  - job_name:
"prometheus"
# metrics_path defaults to '/metrics'
# scheme defaults to 'http'.
static_configs:
      - targets:
[
"localhost:9090"
]
- job_name:
'Prometheus19'
metrics_path: /metrics
    static_configs:
      - targets:
        - rds
    relabel_configs:
      - source_labels:
[
__address__
]
target_label: __param_target
      - source_labels:
[
__param_target
]
target_label: instance
      - target_label: __address__
        replacement:
192.168
.10.19:9098

  - job_name:
'Prometheus20'
metrics_path: /metrics
    static_configs:
      - targets:
        - rds
    relabel_configs:
      - source_labels:
[
__address__
]
target_label: __param_target
      - source_labels:
[
__param_target
]
target_label: instance
      - target_label: __address__
        replacement:
192.168
.10.20:9098

  - job_name:
"tongweb"
static_configs:
      - targets:
[
'192.168.10.51:39081'
]
labels:
          instance:
192.168
.10.51
修改完启动Prometheus
cd
/usr/local/promethues/

./prometheus
--config.file
=
"/usr/local/promethues/prometheus.yml"
&
ps
ef
|
grep
promethues
访问服务器ip:9090/targets?search=,点击status，target，就可以看到我们配置的信息：
6.安装和配置Grafana
Grafana下载地址
上图的话，安装后用 systemctl start grafana-server 启动，会方便一些。
或者用这个也行，这个的话后面启动要用脚本启动（本文使用这种方式）。
解压一下安装包
tar
-vxf
grafana-enterprise-10.3.1.linux-amd64.tar.gz
启动：
cd 到安装目录bin目录，执行./grafana-server,然后访问服务器ip:3000
注意：默认账号密码为：
账号：admin
密码：admin


如果你想卸载，可以关闭服务（直接pkill grafana-server也行），直接删除安装目录，然后删除对应配置

```xml
sudo
rm
-rf
/var/lib/grafana
sudo
rm
-rf
/var/log/grafana
sudo
rm
-rf
/etc/grafana
sudo
rm
-rf
/etc/grafana/grafana.ini
sudo
rm
-rf
/var/lib/grafana/grafana.db
通常情况下，Grafana 服务的配置文件位于 /etc/grafana/grafana.ini，日志通常存储在 /var/log/grafana，而数据库默认位于 /var/lib/grafana/grafana.db。您可能需要查看这些文件以进行故障排查或者进行配置更改。记得在修改配置文件之后重启 Grafana 服务使更改生效。
Grafana只用于展示数据，需要配置Prometheus数据源。
写你的prometheus的url，带上端口号9090：
点击下方的sava&test，有下图的提示说明成功：
然后回到home，找到Create your first dashboard：
点击import a dashboard：
上传之前下载的json文件
上传后选择一下prometheus：
然后点击import，仪表盘就出现了：

关键字: Prometheus+Grafana 监控Tongweb7（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 005
问题: Prometheus+Grafana 监控Tongweb嵌入式（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/136877081

---

文章目录
1.思路
2.部署准备
3.Grafana仪表盘json文件下载
4.tw嵌入式jar包本地引入依赖并测试运行
5.运行jmx_prometheus_javaagent-0.19.0.jar形式获取监控数据（方法一）
6.使用Actuator 获取监听数据（方法二）
7.Prometheus部署
8.Prometheus配置
9.安装和配置Grafana
1.思路
Tongweb嵌入式最终是把依赖打入到java应用（也就是jar包里），然后启动jar包进行测试，所以我们需要考虑的是，启动jar包的时候，怎么获取到监控数据。
根据
Prometheus+Grafana 监控Tongweb7
来看，监控数据是通过jmx_prometheus_javaagent-0.19.0.jar和config.yaml这两个关键文件来获取的，但是这里用的是企业版的部署方式（类似于部署了tomcat然后在tomcat的webapps里部署应用的方式一样）。
所以有两种方式，各位根据自己的需要进行选择：
1.我们可以通过启动参数的形式，启动应用jar包的同时，使用jmx_prometheus_javaagent来配置JMX指标的暴露端口为38061，并指定配置文件为config.yaml，也就是这样的指令来启动jar包，从而方便Prometheus拉取监控数据：
java
-javaagent:jmx_prometheus_javaagent-0.19.0.jar
=
39081
:config.yaml
-jar
spring-boot-accesslog-2.x-0.0.1.jar
其中config.yaml是相关配置文件，jmx_prometheus_javaagent-0.19.0.jar是拉取监控数据用的jar包，spring-boot-accesslog-2.x-0.0.1.jar是测试用的jar包（已经导入tongweb嵌入式的依赖并打包了），39081是绑定的监听端口（可以自己设置一个没有占用的端口）。
之后访问服务器ip:39081/metrics,如下图所示就说明获取成功了：
获取成功之后，再部署prometheus和grafana，修改对应配置，配置grafana的数据源和仪表盘即可。
2.参考
rometheus监控Spring Boot应用，自定义应用监控指标
使用springboot项目的话，可以引入监控相关的依赖和jar包，再部署prometheus和grafana进行监控。
2.部署准备
本次参考：
Prometheus监控Tongweb容器
1.使用虚拟机ip：192.168.10.51（tongweb），192.168.10.52（Prometheus），192.168.10.8(Grafana ),其中51服务器确保9060，39081端口没有被占用,52服务器确保9090端口没有被占用，8服务器确保3000端口没有被占用，三台虚拟机均关闭防火墙。
2.使用的jar包：jmx_prometheus_javaagent-0.19.0.jar:
jmx_prometheus_javaagent-0.19.0.jar下载链接
3.使用的jdk环境：jdk1.8(需配置jdk环境变量)
4.下载Grafana使用的仪表盘json文件：
TongWeb 面板，使用JMX Exporter采集数据
也可以自行下载跟tomcat8.5或者jvm相关的json文件仪表盘，这个自行百度。
5.tw7的安装包和授权，其中tw7使用的安装包为TongWeb7.0.4.9_M3_Enterprise_Linux.tar.gz。
3.Grafana仪表盘json文件下载
可以上这个网站下载：
grafana仪表盘官方下载地址
进去后，在这里输入关键字，例如jvm
点击自己想要的仪表盘
点击这里下载
下面提供两份json模版，自行复制进行测试：
{
"__inputs"
:
[
{
"name"
:
"DS_PROMETHEUS"
,
"label"
:
"Prometheus"
,
"description"
:
""
,
"type"
:
"datasource"
,
"pluginId"
:
"prometheus"
,
"pluginName"
:
"Prometheus"
}
]
,
"__elements"
:
{
}
,
"__requires"
:
[
{
"type"
:
"panel"
,
"id"
:
"gauge"
,
"name"
:
"Gauge"
,
"version"
:
""
}
,
{
"type"
:
"grafana"
,
"id"
:
"grafana"
,
"name"
:
"Grafana"
,
"version"
:
"10.0.1"
}
,
{
"type"
:
"datasource"
,
"id"
:
"prometheus"
,
"name"
:
"Prometheus"
,
"version"
:
"1.0.0"
}
,
{
"type"
:
"panel"
,
"id"
:
"stat"
,
"name"
:
"Stat"
,
"version"
:
""
}
,
{
"type"
:
"panel"
,
"id"
:
"table"
,
"name"
:
"Table"
,
"version"
:
""
}
,
{
"type"
:
"panel"
,
"id"
:
"timeseries"
,
"name"
:
"Time series"
,
"version"
:
""
}
]
,
"annotations"
:
{
"list"
:
[
{
"builtIn"
:
1
,
"datasource"
:
{
"type"
:
"datasource"
,
"uid"
:
"grafana"
}
,
"enable"
:
true,
"hide"
:
true,
"iconColor"
:
"rgba(0, 211, 255, 1)"
,
"name"
:
"Annotations & Alerts"
,
"target"
:
{
"limit"
:
100
,
"matchAny"
:
false,
"tags"
:
[
]
,
"type"
:
"dashboard"
}
,
"type"
:
"dashboard"
}
]
}
,
"description"
:
"TongWeb 面板，使用JMX Exporter采集数据"
,
"editable"
:
true,
"fiscalYearStartMonth"
:
0
,
"gnetId"
:
19156
,
"graphTooltip"
:
0
,
"id"
:
null,
"links"
:
[
{
"asDropdown"
:
false,
"icon"
:
"external link"
,
"includeVars"
:
false,
"keepTime"
:
false,
"tags"
:
[
]
,
"targetBlank"
:
true,
"title"
:
"更新面板"
,
"tooltip"
:
""
,
"type"
:
"link"
,
"url"
:
"https://grafana.com/grafana/dashboards/19156"
}
]
,
"liveNow"
:
false,
"panels"
:
[
{
"collapsed"
:
false,
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"fb65406e-39df-40f2-966c-9987082bdcfe"
}
,
"gridPos"
:
{
"h"
:
1
,
"w"
:
24
,
"x"
:
0
,
"y"
:
0
}
,
"id"
:
31
,
"panels"
:
[
]
,
"repeat"
:
"protocol"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"fb65406e-39df-40f2-966c-9987082bdcfe"
}
,
"refId"
:
"A"
}
]
,
"title"
:
"监控信息"
,
"type"
:
"row"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"description"
:
"被监控服务是否处于运行状态，即该服务是否可达。当UP指标的值为1时，表示该服务正在运行，并且可以被访问，当UP指标的值为0时，则表示该服务不可达或处于停止状态。"
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"0"
:
{
"color"
:
"red"
,
"index"
:
1
,
"text"
:
"未连通"
}
,
"1"
:
{
"color"
:
"green"
,
"index"
:
0
,
"text"
:
"连通"
}
}
,
"type"
:
"value"
}
,
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"color"
:
"red"
,
"index"
:
2
,
"text"
:
"未连通"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
4
,
"x"
:
0
,
"y"
:
1
}
,
"id"
:
33
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"area"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"auto"
,
"reduceOptions"
:
{
"calcs"
:
[
"lastNotNull"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"text"
:
{
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"up{instance=~
\"
$instance
\"
}"
,
"instant"
:
true,
"interval"
:
""
,
"legendFormat"
:
"状态"
,
"refId"
:
"A"
}
]
,
"title"
:
"运行状态"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"decimals"
:
2
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"orange"
,
"value"
:
80
}
]
}
,
"unit"
:
"percent"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
4
,
"y"
:
1
}
,
"id"
:
17
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"showThresholdLabels"
:
false,
"showThresholdMarkers"
:
true
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"jvm_memory_bytes_used{area='heap', instance=
\"
$instance
\"
}/jvm_memory_bytes_max{area='heap', instance=
\"
$instance
\"
}*100"
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"JVM内存使用率"
,
"type"
:
"gauge"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
9
,
"y"
:
1
}
,
"id"
:
20
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"none"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(tongweb_manager_sessioncounter{instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"会话总个数"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
14
,
"y"
:
1
}
,
"id"
:
21
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"none"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(tongweb_manager_expiredsessions{instance=
\"
$instance
\"
}) "
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"会话过期数"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
4
,
"w"
:
5
,
"x"
:
19
,
"y"
:
1
}
,
"id"
:
19
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"colorMode"
:
"value"
,
"graphMode"
:
"none"
,
"justifyMode"
:
"auto"
,
"orientation"
:
"horizontal"
,
"reduceOptions"
:
{
"calcs"
:
[
"mean"
]
,
"fields"
:
""
,
"values"
:
false
}
,
"textMode"
:
"auto"
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(tongweb_manager_sessioncounter{ instance=
\"
$instance
\"
} - tongweb_manager_expiredsessions{instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
""
,
"refId"
:
"A"
}
]
,
"title"
:
"当前会话计数"
,
"type"
:
"stat"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"thresholds"
}
,
"custom"
:
{
"align"
:
"auto"
,
"cellOptions"
:
{
"type"
:
"auto"
}
,
"inspect"
:
false
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"min"
:
0
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"线程池使用率*"
}
,
"properties"
:
[
{
"id"
:
"color"
,
"value"
:
{
"mode"
:
"continuous-GrYlRd"
}
}
,
{
"id"
:
"custom.cellOptions"
,
"value"
:
{
"mode"
:
"gradient"
,
"type"
:
"gauge"
}
}
,
{
"id"
:
"unit"
,
"value"
:
"percent"
}
,
{
"id"
:
"decimals"
,
"value"
:
1
}
,
{
"id"
:
"min"
,
"value"
:
-1
}
,
{
"id"
:
"thresholds"
,
"value"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
{
"id"
:
"max"
,
"value"
:
100
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"http通道"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
200
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"最大线程数"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"初始线程数"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"线程优先级"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
,
{
"matcher"
:
{
"id"
:
"byName"
,
"options"
:
"等待队列"
}
,
"properties"
:
[
{
"id"
:
"custom.width"
,
"value"
:
90
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
5
}
,
"id"
:
14
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"cellHeight"
:
"sm"
,
"footer"
:
{
"countRows"
:
false,
"fields"
:
""
,
"reducer"
:
[
"sum"
]
,
"show"
:
false
}
,
"showHeader"
:
true,
"sortBy"
:
[
{
"desc"
:
true,
"displayName"
:
"线程池使用率"
}
]
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_maxthreads{ instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{name}}-最大线程数"
,
"range"
:
false,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_minsparethreads{instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"legendFormat"
:
"{
{name}}-使用线程数"
,
"range"
:
false,
"refId"
:
"B"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_connectioncount{ instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"legendFormat"
:
"{
{name}}"
,
"range"
:
false,
"refId"
:
"C"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_connectioncount{ instance=
\"
$instance
\"
}/tongweb_threadpool_maxthreads{ instance=
\"
$instance
\"
}*100"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"range"
:
false,
"refId"
:
"D"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_threadpriority{instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"range"
:
false,
"refId"
:
"E"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"tongweb_threadpool_backlog{instance=
\"
$instance
\"
}"
,
"format"
:
"table"
,
"hide"
:
false,
"instant"
:
true,
"range"
:
false,
"refId"
:
"F"
}
]
,
"title"
:
"线程池信息"
,
"transformations"
:
[
{
"id"
:
"filterFieldsByName"
,
"options"
:
{
"include"
:
{
"pattern"
:
"/^Value #[A-Z]|^name$/"
}
}
}
,
{
"id"
:
"merge"
,
"options"
:
{
}
}
,
{
"id"
:
"organize"
,
"options"
:
{
"excludeByName"
:
{
}
,
"indexByName"
:
{
}
,
"renameByName"
:
{
"Value #A"
:
"最大线程数"
,
"Value #B"
:
"初始线程数"
,
"Value #C"
:
"正在执行任务的线程数*"
,
"Value #D"
:
"线程池使用率*"
,
"Value #E"
:
"线程优先级"
,
"Value #F"
:
"等待队列"
,
"name"
:
"http通道"
}
}
}
,
{
"id"
:
"groupBy"
,
"options"
:
{
"fields"
:
{
"Value #E"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"http通道"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"初始线程数"
:
{
"aggregations"
:
[
"lastNotNull"
]
,
"operation"
:
"groupby"
}
,
"最大线程数"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"正在执行任务的线程数"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"正在执行任务的线程数*"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"等待队列"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"线程优先级"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"线程池使用率"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
,
"线程池使用率*"
:
{
"aggregations"
:
[
]
,
"operation"
:
"groupby"
}
}
}
}
]
,
"type"
:
"table"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
6
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"percent"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
5
}
,
"id"
:
40
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"tongweb_threadpool_connectioncount{ instance=
\"
$instance
\"
}/tongweb_threadpool_maxthreads{ instance=
\"
$instance
\"
}*100"
,
"instant"
:
false,
"legendFormat"
:
"{
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"线程池使用率"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"continuous-BlPu"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
14
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineStyle"
:
{
"fill"
:
"solid"
}
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
14
}
,
"id"
:
39
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"bottom"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"jvm_memory_bytes_used{area='heap', instance=
\"
$instance
\"
}/jvm_memory_bytes_max{area='heap', instance=
\"
$instance
\"
}*100"
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"内存使用率"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"JVM内存使用率"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
6
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
14
}
,
"id"
:
41
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"increase(tongweb_requestprocessor_errorcount{instance=
\"
$instance
\"
}[5m])"
,
"instant"
:
false,
"legendFormat"
:
"{
{worker}}-{
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"近5分钟错误增长数"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
8
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"ms"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
23
}
,
"id"
:
35
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"sum(increase(tongweb_requestprocessor_processingtime{instance=
\"
$instance
\"
}[5m])) by (worker) / (count(tongweb_requestprocessor_processingtime{instance=
\"
$instance
\"
}) by (worker)+0.01) "
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{worker}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"平均响应时长"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
11
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
1
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"auto"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
2
,
"mappings"
:
[
{
"options"
:
{
"match"
:
"null"
,
"result"
:
{
"text"
:
"N/A"
}
}
,
"type"
:
"special"
}
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"orange"
,
"value"
:
80
}
]
}
,
"unit"
:
"percent"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
23
}
,
"id"
:
37
,
"links"
:
[
]
,
"maxDataPoints"
:
100
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"bottom"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"single"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"jvm_memory_pool_bytes_used{ instance=
\"
$instance
\"
, pool!=
\"
Metaspace
\"
}/jvm_memory_pool_bytes_max{ instance=
\"
$instance
\"
, pool!=
\"
Metaspace
\"
}*100"
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{pool}}"
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"JVM内存池使用率"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
{
"matcher"
:
{
"id"
:
"byValue"
,
"options"
:
{
"op"
:
"gte"
,
"reducer"
:
"allIsZero"
,
"value"
:
0
}
}
,
"properties"
:
[
{
"id"
:
"custom.hideFrom"
,
"value"
:
{
"legend"
:
true,
"tooltip"
:
true,
"viz"
:
false
}
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
32
}
,
"id"
:
23
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
false,
"expr"
:
"topk(5, tongweb_globalrequestprocessor_requestcount{ instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"instant"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{name}} "
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"请求计数TOP5"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"short"
}
,
"overrides"
:
[
{
"matcher"
:
{
"id"
:
"byValue"
,
"options"
:
{
"op"
:
"gte"
,
"reducer"
:
"allIsZero"
,
"value"
:
0
}
}
,
"properties"
:
[
{
"id"
:
"custom.hideFrom"
,
"value"
:
{
"legend"
:
true,
"tooltip"
:
true,
"viz"
:
false
}
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
32
}
,
"id"
:
24
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"topk(5,tongweb_requestprocessor_errorcount{ instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{worker}} "
,
"range"
:
true,
"refId"
:
"A"
}
]
,
"title"
:
"错误计数TOP5"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"decbytes"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
0
,
"y"
:
41
}
,
"id"
:
2
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
]
,
"displayMode"
:
"list"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"repeatDirection"
:
"h"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_bytesreceived{ instance=
\"
$instance
\"
}[
$__interval
])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Received {
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_bytessent{ instance=
\"
$instance
\"
}[
$__interval
])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Sent {
{name}}"
,
"range"
:
true,
"refId"
:
"B"
}
]
,
"title"
:
"发送/接收流量"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
"tomcat_requestcount_total是Tomcat服务器的一个请求计数器，它记录了所有已处理的请求总数。 在Tomcat服务器中，每个客户端请求都会被处理为一个请求，在处理请求期间，服务器会从连接中读取数据、解析数据、执行应用逻辑，并返回响应。每当Tomcat服务器成功处理一个请求时，其tomcat_requestcount_total指标就会相应地增加。监控和分析该指标可以帮助管理员和开发人员更好地了解Tomcat服务器的整体负载情况和活动水平，对于性能优化和故障排除都具有一定的价值。此外，该指标也可以通过与其他指标如tomcat_bytesreceived_total和tomcat_bytessent_total等结合使用，来监测网络流量和请求响应时间等性能指标，以进一步优化Tomcat服务器的配置和性能。"
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"short"
}
,
"overrides"
:
[
]
}
,
"gridPos"
:
{
"h"
:
9
,
"w"
:
12
,
"x"
:
12
,
"y"
:
41
}
,
"id"
:
4
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
"lastNotNull"
,
"max"
,
"min"
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"repeatDirection"
:
"h"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_requestcount{ instance=
\"
$instance
\"
}[5m])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Request {
{name}}"
,
"range"
:
true,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"increase(tongweb_globalrequestprocessor_errorcount{ instance=
\"
$instance
\"
}[5m])"
,
"format"
:
"time_series"
,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Error  {
{name}}"
,
"range"
:
true,
"refId"
:
"B"
}
]
,
"title"
:
"请求计数/错误计数"
,
"type"
:
"timeseries"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
$datasource
"
}
,
"description"
:
""
,
"fieldConfig"
:
{
"defaults"
:
{
"color"
:
{
"mode"
:
"palette-classic"
}
,
"custom"
:
{
"axisCenteredZero"
:
false,
"axisColorMode"
:
"text"
,
"axisLabel"
:
""
,
"axisPlacement"
:
"auto"
,
"barAlignment"
:
0
,
"drawStyle"
:
"line"
,
"fillOpacity"
:
10
,
"gradientMode"
:
"none"
,
"hideFrom"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
false
}
,
"lineInterpolation"
:
"linear"
,
"lineWidth"
:
1
,
"pointSize"
:
5
,
"scaleDistribution"
:
{
"type"
:
"linear"
}
,
"showPoints"
:
"never"
,
"spanNulls"
:
false,
"stacking"
:
{
"group"
:
"A"
,
"mode"
:
"none"
}
,
"thresholdsStyle"
:
{
"mode"
:
"off"
}
}
,
"decimals"
:
0
,
"mappings"
:
[
]
,
"thresholds"
:
{
"mode"
:
"absolute"
,
"steps"
:
[
{
"color"
:
"green"
,
"value"
:
null
}
,
{
"color"
:
"red"
,
"value"
:
80
}
]
}
,
"unit"
:
"none"
}
,
"overrides"
:
[
{
"__systemRef"
:
"hideSeriesFrom"
,
"matcher"
:
{
"id"
:
"byNames"
,
"options"
:
{
"mode"
:
"exclude"
,
"names"
:
[
"New"
]
,
"prefix"
:
"All except:"
,
"readOnly"
:
true
}
}
,
"properties"
:
[
{
"id"
:
"custom.hideFrom"
,
"value"
:
{
"legend"
:
false,
"tooltip"
:
false,
"viz"
:
true
}
}
]
}
]
}
,
"gridPos"
:
{
"h"
:
8
,
"w"
:
24
,
"x"
:
0
,
"y"
:
50
}
,
"id"
:
5
,
"links"
:
[
]
,
"options"
:
{
"legend"
:
{
"calcs"
:
[
"lastNotNull"
,
"max"
,
"min"
]
,
"displayMode"
:
"table"
,
"placement"
:
"right"
,
"showLegend"
:
true
}
,
"tooltip"
:
{
"mode"
:
"multi"
,
"sort"
:
"none"
}
}
,
"pluginVersion"
:
"10.0.1"
,
"targets"
:
[
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"exemplar"
:
true,
"expr"
:
"sum(increase(tongweb_manager_sessioncounter{ instance=
\"
$instance
\"
}[5m])) by (instance)"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"New"
,
"range"
:
true,
"refId"
:
"A"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"sum(increase(tongweb_manager_expiredsessions{ instance=
\"
$instance
\"
}[5m])) by (instance)"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Expired"
,
"range"
:
true,
"refId"
:
"B"
}
,
{
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"editorMode"
:
"code"
,
"expr"
:
"sum(increase(tongweb_manager_rejectedsessions{ instance=
\"
$instance
\"
}[5m])) by (instance)"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
"60s"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"Rejected"
,
"range"
:
true,
"refId"
:
"C"
}
]
,
"title"
:
"会话计数统计"
,
"type"
:
"timeseries"
}
]
,
"refresh"
:
"5s"
,
"schemaVersion"
:
38
,
"style"
:
"dark"
,
"tags"
:
[
"Tomcat8"
]
,
"templating"
:
{
"list"
:
[
{
"current"
:
{
"selected"
:
false,
"text"
:
"Prometheus"
,
"value"
:
"Prometheus"
}
,
"hide"
:
0
,
"includeAll"
:
false,
"multi"
:
false,
"name"
:
"datasource"
,
"options"
:
[
]
,
"query"
:
"prometheus"
,
"queryValue"
:
""
,
"refresh"
:
1
,
"regex"
:
""
,
"skipUrlSync"
:
false,
"type"
:
"datasource"
}
,
{
"allValue"
:
".*"
,
"current"
:
{
}
,
"datasource"
:
{
"type"
:
"prometheus"
,
"uid"
:
"
${DS_PROMETHEUS}
"
}
,
"definition"
:
"label_values(jvm_info{},instance)"
,
"hide"
:
0
,
"includeAll"
:
false,
"label"
:
"Instance"
,
"multi"
:
false,
"name"
:
"instance"
,
"options"
:
[
]
,
"query"
:
{
"query"
:
"label_values(jvm_info{},instance)"
,
"refId"
:
"PrometheusVariableQueryEditor-VariableQuery"
}
,
"refresh"
:
2
,
"regex"
:
""
,
"skipUrlSync"
:
false,
"sort"
:
1
,
"tagValuesQuery"
:
""
,
"tagsQuery"
:
""
,
"type"
:
"query"
,
"useTags"
:
false
}
]
}
,
"time"
:
{
"from"
:
"now-15m"
,
"to"
:
"now"
}
,
"timepicker"
:
{
"refresh_intervals"
:
[
"5s"
,
"10s"
,
"30s"
,
"1m"
,
"5m"
,
"15m"
]
,
"time_options"
:
[
"5m"
,
"15m"
,
"1h"
,
"6h"
,
"12h"
,
"24h"
,
"2d"
,
"7d"
,
"30d"
]
}
,
"timezone"
:
""
,
"title"
:
"TongWeb_dashboard"
,
"uid"
:
"tongweb"
,
"version"
:
71
,
"weekStart"
:
""
}
{
"__inputs"
:
[
{
"name"
:
"DS_PROMETHEUS"
,
"label"
:
"Prometheus"
,
"description"
:
""
,
"type"
:
"datasource"
,
"pluginId"
:
"prometheus"
,
"pluginName"
:
"Prometheus"
}
]
,
"__requires"
:
[
{
"type"
:
"grafana"
,
"id"
:
"grafana"
,
"name"
:
"Grafana"
,
"version"
:
"4.6.5"
}
,
{
"type"
:
"panel"
,
"id"
:
"graph"
,
"name"
:
"Graph"
,
"version"
:
""
}
,
{
"type"
:
"datasource"
,
"id"
:
"prometheus"
,
"name"
:
"Prometheus"
,
"version"
:
"1.0.0"
}
,
{
"type"
:
"panel"
,
"id"
:
"singlestat"
,
"name"
:
"Singlestat"
,
"version"
:
""
}
]
,
"annotations"
:
{
"list"
:
[
{
"builtIn"
:
1
,
"datasource"
:
"-- Grafana --"
,
"enable"
:
true,
"hide"
:
true,
"iconColor"
:
"rgba(0, 211, 255, 1)"
,
"limit"
:
100
,
"name"
:
"Annotations & Alerts"
,
"showIn"
:
0
,
"type"
:
"dashboard"
}
,
{
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"enable"
:
true,
"expr"
:
"resets(process_uptime_seconds{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m]) > 0"
,
"iconColor"
:
"rgba(255, 96, 96, 1)"
,
"name"
:
"Restart Detection"
,
"showIn"
:
0
,
"step"
:
"1m"
,
"tagKeys"
:
"restart-tag"
,
"textFormat"
:
"uptime reset"
,
"titleFormat"
:
"Restart"
}
]
}
,
"description"
:
"Dashboard for Micrometer instrumented applications (Java, Spring Boot, Micronaut)"
,
"editable"
:
true,
"gnetId"
:
4701
,
"graphTooltip"
:
1
,
"hideControls"
:
false,
"id"
:
null,
"links"
:
[
]
,
"refresh"
:
"30s"
,
"rows"
:
[
{
"collapse"
:
false,
"height"
:
"100px"
,
"panels"
:
[
{
"cacheTimeout"
:
null,
"colorBackground"
:
false,
"colorValue"
:
true,
"colors"
:
[
"rgba(245, 54, 54, 0.9)"
,
"rgba(237, 129, 40, 0.89)"
,
"rgba(50, 172, 45, 0.97)"
]
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"decimals"
:
1
,
"editable"
:
true,
"error"
:
false,
"format"
:
"s"
,
"gauge"
:
{
"maxValue"
:
100
,
"minValue"
:
0
,
"show"
:
false,
"thresholdLabels"
:
false,
"thresholdMarkers"
:
true
}
,
"height"
:
""
,
"id"
:
63
,
"interval"
:
null,
"links"
:
[
]
,
"mappingType"
:
1
,
"mappingTypes"
:
[
{
"name"
:
"value to text"
,
"value"
:
1
}
,
{
"name"
:
"range to text"
,
"value"
:
2
}
]
,
"maxDataPoints"
:
100
,
"nullPointMode"
:
"connected"
,
"nullText"
:
null,
"postfix"
:
""
,
"postfixFontSize"
:
"50%"
,
"prefix"
:
""
,
"prefixFontSize"
:
"70%"
,
"rangeMaps"
:
[
{
"from"
:
"null"
,
"text"
:
"N/A"
,
"to"
:
"null"
}
]
,
"span"
:
3
,
"sparkline"
:
{
"fillColor"
:
"rgba(31, 118, 189, 0.18)"
,
"full"
:
false,
"lineColor"
:
"rgb(31, 120, 193)"
,
"show"
:
false
}
,
"tableColumn"
:
""
,
"targets"
:
[
{
"expr"
:
"process_uptime_seconds{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
""
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
14400
}
]
,
"thresholds"
:
""
,
"title"
:
"Uptime"
,
"transparent"
:
false,
"type"
:
"singlestat"
,
"valueFontSize"
:
"80%"
,
"valueMaps"
:
[
{
"op"
:
"="
,
"text"
:
"N/A"
,
"value"
:
"null"
}
]
,
"valueName"
:
"current"
}
,
{
"cacheTimeout"
:
null,
"colorBackground"
:
false,
"colorValue"
:
true,
"colors"
:
[
"rgba(245, 54, 54, 0.9)"
,
"rgba(237, 129, 40, 0.89)"
,
"rgba(50, 172, 45, 0.97)"
]
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"decimals"
:
null,
"editable"
:
true,
"error"
:
false,
"format"
:
"dateTimeAsIso"
,
"gauge"
:
{
"maxValue"
:
100
,
"minValue"
:
0
,
"show"
:
false,
"thresholdLabels"
:
false,
"thresholdMarkers"
:
true
}
,
"height"
:
""
,
"id"
:
92
,
"interval"
:
null,
"links"
:
[
]
,
"mappingType"
:
1
,
"mappingTypes"
:
[
{
"name"
:
"value to text"
,
"value"
:
1
}
,
{
"name"
:
"range to text"
,
"value"
:
2
}
]
,
"maxDataPoints"
:
100
,
"nullPointMode"
:
"connected"
,
"nullText"
:
null,
"postfix"
:
""
,
"postfixFontSize"
:
"50%"
,
"prefix"
:
""
,
"prefixFontSize"
:
"70%"
,
"rangeMaps"
:
[
{
"from"
:
"null"
,
"text"
:
"N/A"
,
"to"
:
"null"
}
]
,
"span"
:
3
,
"sparkline"
:
{
"fillColor"
:
"rgba(31, 118, 189, 0.18)"
,
"full"
:
false,
"lineColor"
:
"rgb(31, 120, 193)"
,
"show"
:
false
}
,
"tableColumn"
:
""
,
"targets"
:
[
{
"expr"
:
"process_start_time_seconds{application=
\"
$application
\"
, instance=
\"
$instance
\"
}*1000"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
""
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
14400
}
]
,
"thresholds"
:
""
,
"title"
:
"Start time"
,
"transparent"
:
false,
"type"
:
"singlestat"
,
"valueFontSize"
:
"70%"
,
"valueMaps"
:
[
{
"op"
:
"="
,
"text"
:
"N/A"
,
"value"
:
"null"
}
]
,
"valueName"
:
"current"
}
,
{
"cacheTimeout"
:
null,
"colorBackground"
:
false,
"colorValue"
:
true,
"colors"
:
[
"rgba(50, 172, 45, 0.97)"
,
"rgba(237, 129, 40, 0.89)"
,
"rgba(245, 54, 54, 0.9)"
]
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"decimals"
:
2
,
"editable"
:
true,
"error"
:
false,
"format"
:
"percent"
,
"gauge"
:
{
"maxValue"
:
100
,
"minValue"
:
0
,
"show"
:
false,
"thresholdLabels"
:
false,
"thresholdMarkers"
:
true
}
,
"id"
:
65
,
"interval"
:
null,
"links"
:
[
]
,
"mappingType"
:
1
,
"mappingTypes"
:
[
{
"name"
:
"value to text"
,
"value"
:
1
}
,
{
"name"
:
"range to text"
,
"value"
:
2
}
]
,
"maxDataPoints"
:
100
,
"nullPointMode"
:
"connected"
,
"nullText"
:
null,
"postfix"
:
""
,
"postfixFontSize"
:
"50%"
,
"prefix"
:
""
,
"prefixFontSize"
:
"70%"
,
"rangeMaps"
:
[
{
"from"
:
"null"
,
"text"
:
"N/A"
,
"to"
:
"null"
}
]
,
"span"
:
3
,
"sparkline"
:
{
"fillColor"
:
"rgba(31, 118, 189, 0.18)"
,
"full"
:
false,
"lineColor"
:
"rgb(31, 120, 193)"
,
"show"
:
false
}
,
"tableColumn"
:
""
,
"targets"
:
[
{
"expr"
:
"sum(jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
heap
\"
})*100/sum(jvm_memory_max_bytes{application=
\"
$application
\"
,instance=
\"
$instance
\"
, area=
\"
heap
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
""
,
"refId"
:
"A"
,
"step"
:
14400
}
]
,
"thresholds"
:
"70,90"
,
"title"
:
"Heap used"
,
"type"
:
"singlestat"
,
"valueFontSize"
:
"80%"
,
"valueMaps"
:
[
{
"op"
:
"="
,
"text"
:
"N/A"
,
"value"
:
"null"
}
]
,
"valueName"
:
"current"
}
,
{
"cacheTimeout"
:
null,
"colorBackground"
:
false,
"colorValue"
:
true,
"colors"
:
[
"rgba(50, 172, 45, 0.97)"
,
"rgba(237, 129, 40, 0.89)"
,
"rgba(245, 54, 54, 0.9)"
]
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"decimals"
:
2
,
"editable"
:
true,
"error"
:
false,
"format"
:
"percent"
,
"gauge"
:
{
"maxValue"
:
100
,
"minValue"
:
0
,
"show"
:
false,
"thresholdLabels"
:
false,
"thresholdMarkers"
:
true
}
,
"id"
:
75
,
"interval"
:
null,
"links"
:
[
]
,
"mappingType"
:
2
,
"mappingTypes"
:
[
{
"name"
:
"value to text"
,
"value"
:
1
}
,
{
"name"
:
"range to text"
,
"value"
:
2
}
]
,
"maxDataPoints"
:
100
,
"nullPointMode"
:
"connected"
,
"nullText"
:
null,
"postfix"
:
""
,
"postfixFontSize"
:
"50%"
,
"prefix"
:
""
,
"prefixFontSize"
:
"70%"
,
"rangeMaps"
:
[
{
"from"
:
"null"
,
"text"
:
"N/A"
,
"to"
:
"null"
}
,
{
"from"
:
"-99999999999999999999999999999999"
,
"text"
:
"N/A"
,
"to"
:
"0"
}
]
,
"span"
:
3
,
"sparkline"
:
{
"fillColor"
:
"rgba(31, 118, 189, 0.18)"
,
"full"
:
false,
"lineColor"
:
"rgb(31, 120, 193)"
,
"show"
:
false
}
,
"tableColumn"
:
""
,
"targets"
:
[
{
"expr"
:
"sum(jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
nonheap
\"
})*100/sum(jvm_memory_max_bytes{application=
\"
$application
\"
,instance=
\"
$instance
\"
, area=
\"
nonheap
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
""
,
"refId"
:
"A"
,
"step"
:
14400
}
]
,
"thresholds"
:
"70,90"
,
"title"
:
"Non-Heap used"
,
"type"
:
"singlestat"
,
"valueFontSize"
:
"80%"
,
"valueMaps"
:
[
{
"op"
:
"="
,
"text"
:
"N/A"
,
"value"
:
"null"
}
,
{
"op"
:
"="
,
"text"
:
"x"
,
"value"
:
""
}
]
,
"valueName"
:
"current"
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"Quick Facts"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
250
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
111
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"sum(rate(http_server_requests_seconds_count{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m]))"
,
"format"
:
"time_series"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"HTTP"
,
"refId"
:
"A"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Rate"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"decimals"
:
null,
"format"
:
"ops"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
"HTTP"
:
"#890f02"
,
"HTTP - 5xx"
:
"#bf1b00"
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
112
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"sum(rate(http_server_requests_seconds_count{application=
\"
$application
\"
, instance=
\"
$instance
\"
, status=~
\"
5..
\"
}[1m]))"
,
"format"
:
"time_series"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"HTTP - 5xx"
,
"refId"
:
"A"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Errors"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"decimals"
:
null,
"format"
:
"ops"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
113
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"sum(rate(http_server_requests_seconds_sum{application=
\"
$application
\"
, instance=
\"
$instance
\"
, status!~
\"
5..
\"
}[1m]))/sum(rate(http_server_requests_seconds_count{application=
\"
$application
\"
, instance=
\"
$instance
\"
, status!~
\"
5..
\"
}[1m]))"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"HTTP - AVG"
,
"refId"
:
"A"
}
,
{
"expr"
:
"max(http_server_requests_seconds_max{application=
\"
$application
\"
, instance=
\"
$instance
\"
, status!~
\"
5..
\"
})"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"HTTP - MAX"
,
"refId"
:
"B"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Duration"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"format"
:
"s"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"description"
:
""
,
"fill"
:
1
,
"id"
:
119
,
"legend"
:
{
"alignAsTable"
:
false,
"avg"
:
false,
"current"
:
true,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"tomcat_threads_busy_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"TOMCAT - BSY"
,
"refId"
:
"A"
}
,
{
"expr"
:
"tomcat_threads_current_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"TOMCAT - CUR"
,
"refId"
:
"B"
}
,
{
"expr"
:
"tomcat_threads_config_max_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"TOMCAT - MAX"
,
"refId"
:
"C"
}
,
{
"expr"
:
"jetty_threads_busy{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"JETTY - BSY"
,
"refId"
:
"D"
}
,
{
"expr"
:
"jetty_threads_current{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"JETTY - CUR"
,
"refId"
:
"E"
}
,
{
"expr"
:
"jetty_threads_config_max{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"JETTY - MAX"
,
"refId"
:
"F"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Utilisation"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"I/O Overview"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
"250px"
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
24
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"sum(jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
heap
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"used"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"sum(jvm_memory_committed_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
heap
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"committed"
,
"refId"
:
"B"
,
"step"
:
2400
}
,
{
"expr"
:
"sum(jvm_memory_max_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
heap
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"max"
,
"refId"
:
"C"
,
"step"
:
2400
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"JVM Heap"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"mbytes"
,
"short"
]
,
"yaxes"
:
[
{
"format"
:
"bytes"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
25
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"sum(jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
nonheap
\"
})"
,
"format"
:
"time_series"
,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"used"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"sum(jvm_memory_committed_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
nonheap
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"committed"
,
"refId"
:
"B"
,
"step"
:
2400
}
,
{
"expr"
:
"sum(jvm_memory_max_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
nonheap
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"max"
,
"refId"
:
"C"
,
"step"
:
2400
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"JVM Non-Heap"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"mbytes"
,
"short"
]
,
"yaxes"
:
[
{
"format"
:
"bytes"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
26
,
"legend"
:
{
"alignAsTable"
:
false,
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"sum(jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"used"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"sum(jvm_memory_committed_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"committed"
,
"refId"
:
"B"
,
"step"
:
2400
}
,
{
"expr"
:
"sum(jvm_memory_max_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
})"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"max"
,
"refId"
:
"C"
,
"step"
:
2400
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"JVM Total"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"mbytes"
,
"short"
]
,
"yaxes"
:
[
{
"format"
:
"bytes"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
86
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"process_memory_vss_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
true,
"intervalFactor"
:
2
,
"legendFormat"
:
"vss"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"process_memory_rss_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"rss"
,
"refId"
:
"B"
}
,
{
"expr"
:
"process_memory_swap_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"swap"
,
"refId"
:
"C"
}
,
{
"expr"
:
"process_memory_rss_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
} + process_memory_swap_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"total"
,
"refId"
:
"D"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"JVM Process Memory"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"mbytes"
,
"short"
]
,
"yaxes"
:
[
{
"format"
:
"bytes"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"JVM Memory"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
250
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
106
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"system_cpu_usage{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"system"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"process_cpu_usage{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"process"
,
"refId"
:
"B"
}
,
{
"expr"
:
"avg_over_time(process_cpu_usage{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[15m])"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"process-15m"
,
"refId"
:
"C"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"CPU Usage"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"short"
,
"short"
]
,
"yaxes"
:
[
{
"decimals"
:
1
,
"format"
:
"percentunit"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
"1"
,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
93
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"system_load_average_1m{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"system-1m"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"system_cpu_count{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"cpus"
,
"refId"
:
"B"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Load"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"short"
,
"short"
]
,
"yaxes"
:
[
{
"decimals"
:
1
,
"format"
:
"short"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
32
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"jvm_threads_live_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"live"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"jvm_threads_daemon_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"daemon"
,
"metric"
:
""
,
"refId"
:
"B"
,
"step"
:
2400
}
,
{
"expr"
:
"jvm_threads_peak_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"peak"
,
"refId"
:
"C"
,
"step"
:
2400
}
,
{
"expr"
:
"process_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"process"
,
"refId"
:
"D"
,
"step"
:
2400
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Threads"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"short"
,
"short"
]
,
"yaxes"
:
[
{
"decimals"
:
0
,
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
"blocked"
:
"#bf1b00"
,
"new"
:
"#fce2de"
,
"runnable"
:
"#7eb26d"
,
"terminated"
:
"#511749"
,
"timed-waiting"
:
"#c15c17"
,
"waiting"
:
"#eab839"
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
124
,
"legend"
:
{
"alignAsTable"
:
false,
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"rightSide"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"jvm_threads_states_threads{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"{
{state}}"
,
"refId"
:
"A"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Thread States"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"description"
:
"The percent of time spent on Garbage Collection over all CPUs assigned to the JVM process."
,
"fill"
:
1
,
"id"
:
138
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"sum(rate(jvm_gc_pause_seconds_sum{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m])) by (application, instance) / on(application, instance) system_cpu_count"
,
"format"
:
"time_series"
,
"intervalFactor"
:
1
,
"legendFormat"
:
"CPU time spent on GC"
,
"refId"
:
"A"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"GC Pressure"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"decimals"
:
1
,
"format"
:
"percentunit"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
"1"
,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
"debug"
:
"#1F78C1"
,
"error"
:
"#BF1B00"
,
"info"
:
"#508642"
,
"trace"
:
"#6ED0E0"
,
"warn"
:
"#EAB839"
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"height"
:
""
,
"id"
:
91
,
"legend"
:
{
"alignAsTable"
:
false,
"avg"
:
false,
"current"
:
true,
"hideEmpty"
:
false,
"hideZero"
:
false,
"max"
:
true,
"min"
:
false,
"rightSide"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
true,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
{
"alias"
:
"error"
,
"yaxis"
:
1
}
,
{
"alias"
:
"warn"
,
"yaxis"
:
1
}
]
,
"spaceLength"
:
10
,
"span"
:
6
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"increase(logback_events_total{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m])"
,
"format"
:
"time_series"
,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"{
{level}}"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
1200
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Log Events"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"transparent"
:
false,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"short"
,
"short"
]
,
"yaxes"
:
[
{
"decimals"
:
0
,
"format"
:
"opm"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
61
,
"legend"
:
{
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
3
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"process_files_open_files{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"open"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
2400
}
,
{
"expr"
:
"process_files_max_files{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"max"
,
"metric"
:
""
,
"refId"
:
"B"
,
"step"
:
2400
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"File Descriptors"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"short"
,
"short"
]
,
"yaxes"
:
[
{
"decimals"
:
0
,
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
10
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"JVM Misc"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
"250px"
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
3
,
"legend"
:
{
"alignAsTable"
:
false,
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"rightSide"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"minSpan"
:
4
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"repeat"
:
"jvm_memory_pool_heap"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
4
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_memory_pool_heap
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"used"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
1800
}
,
{
"expr"
:
"jvm_memory_committed_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_memory_pool_heap
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"commited"
,
"metric"
:
""
,
"refId"
:
"B"
,
"step"
:
1800
}
,
{
"expr"
:
"jvm_memory_max_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_memory_pool_heap
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"max"
,
"metric"
:
""
,
"refId"
:
"C"
,
"step"
:
1800
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"
$jvm_memory_pool_heap
"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"mbytes"
,
"short"
]
,
"yaxes"
:
[
{
"format"
:
"bytes"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
]
,
"repeat"
:
"persistence_counts"
,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"JVM Memory Pools (Heap)"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
250
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
78
,
"legend"
:
{
"alignAsTable"
:
false,
"avg"
:
false,
"current"
:
true,
"max"
:
true,
"min"
:
false,
"rightSide"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
true
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"minSpan"
:
4
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"repeat"
:
"jvm_memory_pool_nonheap"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
4
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_memory_pool_nonheap
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"used"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
1800
}
,
{
"expr"
:
"jvm_memory_committed_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_memory_pool_nonheap
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"commited"
,
"metric"
:
""
,
"refId"
:
"B"
,
"step"
:
1800
}
,
{
"expr"
:
"jvm_memory_max_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_memory_pool_nonheap
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
""
,
"intervalFactor"
:
2
,
"legendFormat"
:
"max"
,
"metric"
:
""
,
"refId"
:
"C"
,
"step"
:
1800
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"
$jvm_memory_pool_nonheap
"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"mbytes"
,
"short"
]
,
"yaxes"
:
[
{
"format"
:
"bytes"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"JVM Memory Pools (Non-Heap)"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
250
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
98
,
"legend"
:
{
"avg"
:
false,
"current"
:
false,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
false
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
4
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"rate(jvm_gc_pause_seconds_count{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m])"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"{
{action}} ({
{cause}})"
,
"refId"
:
"A"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Collections"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"format"
:
"ops"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
101
,
"legend"
:
{
"avg"
:
false,
"current"
:
false,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
false
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
4
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"rate(jvm_gc_pause_seconds_sum{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m])/rate(jvm_gc_pause_seconds_count{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m])"
,
"format"
:
"time_series"
,
"hide"
:
false,
"instant"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"avg {
{action}} ({
{cause}})"
,
"refId"
:
"A"
}
,
{
"expr"
:
"jvm_gc_pause_seconds_max{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"instant"
:
false,
"intervalFactor"
:
1
,
"legendFormat"
:
"max {
{action}} ({
{cause}})"
,
"refId"
:
"B"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Pause Durations"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"format"
:
"s"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
99
,
"legend"
:
{
"avg"
:
false,
"current"
:
false,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
false
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
4
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"rate(jvm_gc_memory_allocated_bytes_total{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m])"
,
"format"
:
"time_series"
,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"allocated"
,
"refId"
:
"A"
}
,
{
"expr"
:
"rate(jvm_gc_memory_promoted_bytes_total{application=
\"
$application
\"
, instance=
\"
$instance
\"
}[1m])"
,
"format"
:
"time_series"
,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"promoted"
,
"refId"
:
"B"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Allocated/Promoted"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"format"
:
"Bps"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"Garbage Collection"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
"250px"
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
37
,
"legend"
:
{
"avg"
:
false,
"current"
:
false,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
false
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
6
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"jvm_classes_loaded_classes{application=
\"
$application
\"
, instance=
\"
$instance
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"loaded"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
1200
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Classes loaded"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"short"
,
"short"
]
,
"yaxes"
:
[
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
0
,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
,
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"editable"
:
true,
"error"
:
false,
"fill"
:
1
,
"grid"
:
{
"leftLogBase"
:
1
,
"leftMax"
:
null,
"leftMin"
:
null,
"rightLogBase"
:
1
,
"rightMax"
:
null,
"rightMin"
:
null
}
,
"id"
:
38
,
"legend"
:
{
"avg"
:
false,
"current"
:
false,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
false
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"seriesOverrides"
:
[
]
,
"spaceLength"
:
10
,
"span"
:
6
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"delta(jvm_classes_loaded_classes{application=
\"
$application
\"
,instance=
\"
$instance
\"
}[1m])"
,
"format"
:
"time_series"
,
"hide"
:
false,
"interval"
:
""
,
"intervalFactor"
:
1
,
"legendFormat"
:
"delta-1m"
,
"metric"
:
""
,
"refId"
:
"A"
,
"step"
:
1200
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"Class delta"
,
"tooltip"
:
{
"msResolution"
:
false,
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"cumulative"
}
,
"type"
:
"graph"
,
"x-axis"
:
true,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"y-axis"
:
true,
"y_formats"
:
[
"ops"
,
"short"
]
,
"yaxes"
:
[
{
"decimals"
:
null,
"format"
:
"short"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
,
{
"format"
:
"short"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
null,
"show"
:
true
}
]
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"Classloading"
,
"titleSize"
:
"h6"
}
,
{
"collapse"
:
false,
"height"
:
"250px"
,
"panels"
:
[
{
"aliasColors"
:
{
}
,
"bars"
:
false,
"dashLength"
:
10
,
"dashes"
:
false,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"fill"
:
1
,
"id"
:
131
,
"legend"
:
{
"avg"
:
false,
"current"
:
false,
"max"
:
false,
"min"
:
false,
"show"
:
true,
"total"
:
false,
"values"
:
false
}
,
"lines"
:
true,
"linewidth"
:
1
,
"links"
:
[
]
,
"minSpan"
:
4
,
"nullPointMode"
:
"null"
,
"percentage"
:
false,
"pointradius"
:
5
,
"points"
:
false,
"renderer"
:
"flot"
,
"repeat"
:
"jvm_buffer_pool"
,
"seriesOverrides"
:
[
{
"alias"
:
"count"
,
"yaxis"
:
2
}
,
{
"alias"
:
"buffers"
,
"yaxis"
:
2
}
]
,
"spaceLength"
:
10
,
"span"
:
4
,
"stack"
:
false,
"steppedLine"
:
false,
"targets"
:
[
{
"expr"
:
"jvm_buffer_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_buffer_pool
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"used"
,
"refId"
:
"A"
}
,
{
"expr"
:
"jvm_buffer_total_capacity_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_buffer_pool
\"
}"
,
"format"
:
"time_series"
,
"intervalFactor"
:
2
,
"legendFormat"
:
"capacity"
,
"refId"
:
"B"
}
,
{
"expr"
:
"jvm_buffer_count_buffers{application=
\"
$application
\"
, instance=
\"
$instance
\"
, id=~
\"
$jvm_buffer_pool
\"
}"
,
"format"
:
"time_series"
,
"hide"
:
false,
"intervalFactor"
:
2
,
"legendFormat"
:
"buffers"
,
"refId"
:
"C"
}
]
,
"thresholds"
:
[
]
,
"timeFrom"
:
null,
"timeShift"
:
null,
"title"
:
"
$jvm_buffer_pool
"
,
"tooltip"
:
{
"shared"
:
true,
"sort"
:
0
,
"value_type"
:
"individual"
}
,
"type"
:
"graph"
,
"xaxis"
:
{
"buckets"
:
null,
"mode"
:
"time"
,
"name"
:
null,
"show"
:
true,
"values"
:
[
]
}
,
"yaxes"
:
[
{
"format"
:
"decbytes"
,
"label"
:
null,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
,
{
"decimals"
:
0
,
"format"
:
"short"
,
"label"
:
""
,
"logBase"
:
1
,
"max"
:
null,
"min"
:
"0"
,
"show"
:
true
}
]
}
]
,
"repeat"
:
null,
"repeatIteration"
:
null,
"repeatRowId"
:
null,
"showTitle"
:
true,
"title"
:
"Buffer Pools"
,
"titleSize"
:
"h6"
}
]
,
"schemaVersion"
:
14
,
"style"
:
"dark"
,
"tags"
:
[
]
,
"templating"
:
{
"list"
:
[
{
"allValue"
:
null,
"current"
:
{
}
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"hide"
:
0
,
"includeAll"
:
false,
"label"
:
"Application"
,
"multi"
:
false,
"name"
:
"application"
,
"options"
:
[
]
,
"query"
:
"label_values(application)"
,
"refresh"
:
2
,
"regex"
:
""
,
"sort"
:
0
,
"tagValuesQuery"
:
""
,
"tags"
:
[
]
,
"tagsQuery"
:
""
,
"type"
:
"query"
,
"useTags"
:
false
}
,
{
"allFormat"
:
"glob"
,
"allValue"
:
null,
"current"
:
{
}
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"hide"
:
0
,
"includeAll"
:
false,
"label"
:
"Instance"
,
"multi"
:
false,
"multiFormat"
:
"glob"
,
"name"
:
"instance"
,
"options"
:
[
]
,
"query"
:
"label_values(jvm_memory_used_bytes{application=
\"
$application
\"
}, instance)"
,
"refresh"
:
2
,
"regex"
:
""
,
"sort"
:
0
,
"tagValuesQuery"
:
""
,
"tags"
:
[
]
,
"tagsQuery"
:
""
,
"type"
:
"query"
,
"useTags"
:
false
}
,
{
"allFormat"
:
"glob"
,
"allValue"
:
null,
"current"
:
{
}
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"hide"
:
2
,
"includeAll"
:
true,
"label"
:
"JVM Memory Pools Heap"
,
"multi"
:
false,
"multiFormat"
:
"glob"
,
"name"
:
"jvm_memory_pool_heap"
,
"options"
:
[
]
,
"query"
:
"label_values(jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
heap
\"
},id)"
,
"refresh"
:
1
,
"regex"
:
""
,
"sort"
:
1
,
"tagValuesQuery"
:
""
,
"tags"
:
[
]
,
"tagsQuery"
:
""
,
"type"
:
"query"
,
"useTags"
:
false
}
,
{
"allFormat"
:
"glob"
,
"allValue"
:
null,
"current"
:
{
}
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"hide"
:
2
,
"includeAll"
:
true,
"label"
:
"JVM Memory Pools Non-Heap"
,
"multi"
:
false,
"multiFormat"
:
"glob"
,
"name"
:
"jvm_memory_pool_nonheap"
,
"options"
:
[
]
,
"query"
:
"label_values(jvm_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
, area=
\"
nonheap
\"
},id)"
,
"refresh"
:
1
,
"regex"
:
""
,
"sort"
:
2
,
"tagValuesQuery"
:
""
,
"tags"
:
[
]
,
"tagsQuery"
:
""
,
"type"
:
"query"
,
"useTags"
:
false
}
,
{
"allFormat"
:
"glob"
,
"allValue"
:
null,
"current"
:
{
}
,
"datasource"
:
"
${DS_PROMETHEUS}
"
,
"hide"
:
2
,
"includeAll"
:
true,
"label"
:
"JVM Buffer Pools"
,
"multi"
:
false,
"multiFormat"
:
"glob"
,
"name"
:
"jvm_buffer_pool"
,
"options"
:
[
]
,
"query"
:
"label_values(jvm_buffer_memory_used_bytes{application=
\"
$application
\"
, instance=
\"
$instance
\"
},id)"
,
"refresh"
:
1
,
"regex"
:
""
,
"sort"
:
1
,
"tagValuesQuery"
:
""
,
"tags"
:
[
]
,
"tagsQuery"
:
""
,
"type"
:
"query"
,
"useTags"
:
false
}
]
}
,
"time"
:
{
"from"
:
"now-24h"
,
"to"
:
"now"
}
,
"timepicker"
:
{
"now"
:
true,
"refresh_intervals"
:
[
"5s"
,
"10s"
,
"30s"
,
"1m"
,
"5m"
,
"15m"
,
"30m"
,
"1h"
,
"2h"
,
"1d"
]
,
"time_options"
:
[
"5m"
,
"15m"
,
"1h"
,
"6h"
,
"12h"
,
"24h"
,
"2d"
,
"7d"
,
"30d"
]
}
,
"timezone"
:
"browser"
,
"title"
:
"JVM (Micrometer)"
,
"version"
:
33
}
4.tw嵌入式jar包本地引入依赖并测试运行
本次示范用的是TongWeb7.0.E.6_P5下的spring-boot-accesslog-2.x：
请在本地开发环境配置好mavernhome，配置教程如下：
maven环境变量配置（超详细！）
配置后，window下，使用 installAll-{n} 脚本，解压 TongWeb 嵌入式版资源包，将 lib 目录中的 jar 包安装到本地 maven 仓库。
配置以下依赖到pom文件里（这一步可以参考手册：TongWeb V7.0 嵌入式版_JavaEE标准容器用户指南，记得去掉tomcat的依赖）：
<
!
--TongWeb 嵌入式版提供的与springboot集成的starter。 --
>
<
dependency
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-websocket
<
/artifactId
>
<
/dependency
>
<
dependency
>
<
groupId
>
com.tongweb.springboot
<
/groupId
>
<
artifactId
>
tongweb-spring-boot-websocket-2.x
<
/artifactId
>
<
version
>
7.0
.E.6_P
5
<
/version
>
<
/dependency
>
<
dependency
>
<
groupId
>
com.tongweb.springboot
<
/groupId
>
<
artifactId
>
tongweb-spring-boot-starter-2.x
<
/artifactId
>
<
version
>
7.0
.E.6_P
5
<
/version
>
<
/dependency
>
<
dependency
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-web
<
/artifactId
>
<
exclusions
>
<
exclusion
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-tomcat
<
/artifactId
>
<
/exclusion
>
<
/exclusions
>
<
/dependency
>
<
!
-- jsp支持--
>
<
dependency
>
<
groupId
>
com.tongweb
<
/groupId
>
<
artifactId
>
tongweb-jsp
<
/artifactId
>
<
version
>
7.0
.E.6_P
5
<
/version
>
<
/dependency
>
刷新maven，然后看看tongweb的依赖是否已经导入到项目里
授权文件放入到resource目录下，propeities配置文件配置：
server.tongweb.license.path
=
classpath:license.dat
如果用的不是propeities文件，配置参考如下：
server:
  tongweb:
    license:
      path: classpath:license.dat
之后进行打包，打包看看有没有报错，有的话看看报错信息，如果是依赖冲突，可以使用mavenhelp，参考：
maven解决包冲突简单方式(插件maven helper | maven指令)
打包后最好在本地跑一次看看有没有问题。
5.运行jmx_prometheus_javaagent-0.19.0.jar形式获取监控数据（方法一）
方法一和方法二任选其一即可。
将打包好的应用jar包和已经下载好的jmx.xxxjar放入到服务器，下面是我放入服务器的目录截图：
自己新建一个config.yaml,最好喝上传的jmx的jar包放一起，以下是配置内容：
wercaseOutputLabelNames:
true
lowercaseOutputName:
true
whitelistObjectNames:
[
"java.lang:type=OperatingSystem"
,
"TONGWEB:*"
,
"config:*"
]
blacklistObjectNames:
[
]
rules:
  - pattern:
".*"
执行指令启动应用
java
-javaagent:jmx_prometheus_javaagent-0.19.0.jar
=
39081
:config.yaml
-jar
spring-boot-accesslog-2.x-0.0.1.jar
访问服务器ip:39081/metrics
6.使用Actuator 获取监听数据（方法二）
方法一和方法二任选其一即可。选择了方法二的可以跳过这一步。
请在项目的pom.xml文件中添加以下两个依赖坐标：
<
!
--整合prometheus--
>
<
dependency
>
<
groupId
>
io.micrometer
<
/groupId
>
<
artifactId
>
micrometer-registry-prometheus
<
/artifactId
>
<
/dependency
>
<
dependency
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-actuator
<
/artifactId
>
<
/dependency
>
添加后下载好依赖，然后在application.properties配置文件里添加这一段：
server.tongweb.license.path
=
classpath:license.dat
management.server.port
=
9099
management.endpoints.web.base-path
=
/actuator
management.endpoints.web.exposure.include
=
*
添加打包成jar吧，上传到服务器，或者在本地执行java -jar 应用jar包名，测试访问ip:9099/actuator/prometheus：
如上图所示即为成功。
7.Prometheus部署
参考：
一篇文章搞定Prometheus普罗米修斯监控系统的部署
8.Prometheus配置
配置prometheus.yml：
方法一的配置参考（注意缩进，192.168.10.51和39081分别对应的是tongweb这边的端口和ip）：
static_configs:
      - targets:
[
"localhost:9090"
]
- job_name: tongweb
    static_configs:
      - targets:
[
'192.168.10.51:39081'
]
labels:
          instance:
192.168
.10.51
下面是我本地方法一的配置文件，自行删除不需要的部分：
global:
  scrape_interval: 15s
# Set the scrape interval to every 15 seconds. Default is every 1 minute.
evaluation_interval: 15s
# Evaluate rules every 15 seconds. The default is every 1 minute.
# scrape_timeout is set to the global default (10s).
alerting:
  alertmanagers:
    - static_configs:
        - targets:
# - alertmanager:9093
rule_files:
# - "first_rules.yml"
# - "second_rules.yml"
scrape_configs:
  - job_name:
"prometheus"
# metrics_path defaults to '/metrics'
# scheme defaults to 'http'.
static_configs:
      - targets:
[
"localhost:9090"
]
- job_name:
'Prometheus19'
metrics_path: /metrics
    static_configs:
      - targets:
        - rds
    relabel_configs:
      - source_labels:
[
__address__
]
target_label: __param_target
      - source_labels:
[
__param_target
]
target_label: instance
      - target_label: __address__
        replacement:
192.168
.10.19:9098

  - job_name:
'Prometheus20'
metrics_path: /metrics
    static_configs:
      - targets:
        - rds
    relabel_configs:
      - source_labels:
[
__address__
]
target_label: __param_target
      - source_labels:
[
__param_target
]
target_label: instance
      - target_label: __address__
        replacement:
192.168
.10.20:9098

  - job_name:
"tongweb"
static_configs:
      - targets:
[
'192.168.10.51:39081'
]
labels:
          instance:
192.168
.10.51
方法二的配置：
- job_name:
'tongweb'
static_configs:
      - targets:
[
'10.2.1.231:9527'
]
- job_name:
'prometheusapp'
metrics_path:
'/actuator/prometheus'
static_configs:
      - targets:
[
'10.2.1.159:8080'
]
以下是我在本地使用的方法二的配置文件，自行删除不需要的部分
global:
  scrape_interval: 15s
# Set the scrape interval to every 15 seconds. Default is every 1 minute.
evaluation_interval: 15s
# Evaluate rules every 15 seconds. The default is every 1 minute.
# scrape_timeout is set to the global default (10s).
alerting:
  alertmanagers:
    - static_configs:
        - targets:
# - alertmanager:9093
rule_files:
# - "first_rules.yml"
# - "second_rules.yml"
scrape_configs:
  - job_name:
"prometheus"
# metrics_path defaults to '/metrics'
# scheme defaults to 'http'.
static_configs:
      - targets:
[
"localhost:9090"
]
- job_name:
'Prometheus19'
metrics_path: /metrics
    static_configs:
      - targets:
        - rds
    relabel_configs:
      - source_labels:
[
__address__
]
target_label: __param_target
      - source_labels:
[
__param_target
]
target_label: instance
      - target_label: __address__
        replacement:
192.168
.10.19:9098

  - job_name:
'Prometheus20'
metrics_path: /metrics
    static_configs:
      - targets:
        - rds
    relabel_configs:
      - source_labels:
[
__address__
]
target_label: __param_target
      - source_labels:
[
__param_target
]
target_label: instance
      - target_label: __address__
        replacement:
192.168
.10.20:9098

  - job_name:
"tongweb"
static_configs:
      - targets:
[
'192.168.10.51:39081'
]
labels:
          instance:
192.168
.10.51

  - job_name:
'spring-actuator-tw'
metrics_path:
'/actuator/prometheus'
static_configs:
      - targets:
[
'192.168.10.51:9099'
]
# 这里填写你的Spring Boot应用的地址和端口
修改完启动Prometheus
cd
/usr/local/promethues/

./prometheus
--config.file
=
"/usr/local/promethues/prometheus.yml"
&
ps
ef
|
grep
promethues
访问服务器ip:9090/targets?search=,点击status，target，就可以看到我们配置的信息：
方法一的：
方法二的：
9.安装和配置Grafana
Grafana下载地址
上图的话，安装后用 systemctl start grafana-server 启动，会方便一些。
或者用这个也行，这个的话后面启动要用脚本启动（本文使用这种方式）。
解压一下安装包
tar
-vxf
grafana-enterprise-10.3.1.linux-amd64.tar.gz
启动：
cd 到安装目录bin目录，执行./grafana-server,然后访问服务器ip:3000
注意：默认账号密码为：
账号：admin
密码：admin


如果你想卸载，可以关闭服务（直接pkill grafana-server也行），直接删除安装目录，然后删除对应配置

```xml
sudo
rm
-rf
/var/lib/grafana
sudo
rm
-rf
/var/log/grafana
sudo
rm
-rf
/etc/grafana
sudo
rm
-rf
/etc/grafana/grafana.ini
sudo
rm
-rf
/var/lib/grafana/grafana.db
通常情况下，Grafana 服务的配置文件位于 /etc/grafana/grafana.ini，日志通常存储在 /var/log/grafana，而数据库默认位于 /var/lib/grafana/grafana.db。您可能需要查看这些文件以进行故障排查或者进行配置更改。记得在修改配置文件之后重启 Grafana 服务使更改生效。
Grafana只用于展示数据，需要配置Prometheus数据源。
写你的prometheus的url，带上端口号9090：
点击下方的sava&test，有下图的提示说明成功：
然后回到home，找到Create your first dashboard：
点击import a dashboard：
上传之前下载的json文件
上传后选择一下prometheus：
然后点击import，仪表盘就出现了：

关键字: Prometheus+Grafana 监控Tongweb嵌入式（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 006
问题: TongWeb SSL安全相关配置

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109527473

---

SSL相关漏洞如下：
CVE-2015-2808 SSL/TLS 受诫礼(BAR-MITZVAH)攻击漏洞。
CVE-2014-3566 SSLv3在降级的旧版加密漏洞（POODLE）。
CVE-2011-1473 服务器支持 TLS Client-initiated 重协商攻击。
CVE-2016-0800 SSL DROWN攻击漏洞。
SSL证书非正式可信证书。
等等
解决以上漏洞问题的办法：
第一步：制作证书由用户方提供
用户需购买正式证书，TongWeb自带测试证书非正式证书，
需购买制作正式证书配SSL。如：
数字认证官网 | 电子认证、电子签名、电子合同知名厂商
制作证书时需使用OpenSSL最新版本，老版本OpenSSL有安全漏洞。
制作的证书密码位数要符合安全要求。
如果是Apache,nginx集群，则在其上配SSL解决漏洞。
Java类证书要求JKS格式，查看证书命令：keytool -list  -v -keystore server.keystore
第二步：在TongWeb
上配置SSL
证书
。
1. https通道改用NIO/NIO2模式，解决漏洞 CVE-2011-1473。
2. 不勾选SSLv3协议，只勾选TLS协议。
3. 在Ciphers中配置安全的算法，通常如下，注意有些JDK算动法不支持可以适当修改。
TLS_ECDHE_RSA_WITAES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA
4. 在TongWeb使用的JDK中jre\lib\security\java.security配置禁用不安全的SSL协议和算法，如下：
#JDK8默认配置如下：
jdk.tls.disabledAlgorithms=SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, \
DH keySize < 1024, EC keySize < 224, 3DES_EDE_CBC, anon, NULL, \
include jdk.disabled.namedCurves
另外：很多项目中有人问，为什么东方通不提供SSL正式证书？ 答复：正式证书不是任意一个公司可以发布的， 见：
数字证书原理_zxh2075的专栏-CSDN博客_github数字证书的实验原理 、实验所涉及知识
cer、crt与JKS格式证书互转格式转化，具体参数含义 -help
第一步，从key和crt/cer生成pkcs12格式的keystore
openssl pkcs12 -export -in
server.crt
-inkey server.key  -out
mycert.p12
-name tongweb
第二步 生成TongWeb需要的keystore, 两个密码123456要一样
keytool -importkeystore -alias tongweb -v  -srckeystore
mycert.p12
-srcstoretype pkcs12 -srcstorepass
123456
-destkeystore
tw.keystore
-deststoretype
jks
-deststorepass
123456

关键字: TongWeb SSL安全相关配置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 007
问题: TongWeb The temporary upload location [tmp tongweb.xxx] is not valid-yjm

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/135170817

---

应用使用Multipart（form-data）的方式上传文件时会在/tmp下生成临时文件，但是临时文件会被系统定时删除，因此访问应用时会报如下错误：
/tmp目录的清理规则主要取决于/usr/lib/tmpfiles.d/tmp.conf文件的设定，默认的配置如下：
解决方法：
1、修改tmp.conf配置文件，排除清除tongweb开头的配置文件。
x /tmp/tongweb.*
2、如果使用的是TongWeb嵌入版，可以修改如下参数：
#配置TongWeb运行日志和临时文件的目录。 若不配置，则默认使用系统的临时目录
server.tongweb.basedir=
3、在SpringBoot的配置之中设定Profile信息
#指定上传文件临时目录
spring.http.multipart.location=/opt/data/upload
4、应用在代码中指定自有上传文件目录

关键字: TongWeb The temporary upload location [tmp tongweb.xxx] is not valid-yjm
文档来源: 
--------------------------------------------------------------------------------

问题编号: 008
问题: TongWeb+TongDataGrid+TongHttpServer实现Session复制

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/156774484

---

TongWeb+TongDataGrid+TongHttpServer实现Session复制
一、环境准备：
1、服务器两台192.168.43.8和192.168.43.10
2、分别安装TongWeb7049M5和TongHttpServer6013
二、搭建TongWeb7049M5集群，集群部署应用。
1、修改两台服务器TongWeb7049M5/Agent/config/agent.xml
2、启动192.168.43.8的TongWeb7049M5,并登录集中管理台。分别启动两台服务器的Agent管理器（TongWeb7049M5/Agent/bin sh startbg.sh）。启动成功后集中管理台-节点管理-节点代理可以查看到带上的节点信息。
3、创建集群，选择开启session复制。
4、负载均衡器，可选项。我这里直接选择添加了负载均衡器，在192.168.43.8：/opt/THS6013/THS
5、静态服务器跳过，直接到服务器设置。添加所需要的节点。
6、集群创建成功，TongWeb和会话服务器会创建至/opt/TongWeb7049M5/Agent/nodes/tongweb-1和/opt/TongWeb7049M5/Agent/nodes/tongdatagrid-1
7、分别启动集群下的TongWeb和会话服务器
会话服务器打印出此日志为正常
8、集中管理台应用管理-部署应用至集群下面。
三、配置TongHttpServer6013,负载模式选择sticky。
1、启动192.168.43.8下面的TongHttpServer管理台，并登录，文本编辑菜单修改THS配置并启动THS。
2、通过负载访问集群部署的应用。通过查看日志，确定应用被分发到192.168.43.8节点上。
可以通过浏览器F12查看请求头的JSESSIONID和响应头中的一样。
3、通过集中管理台强制停止集群内192.168.43.8上面的TongWeb-1。
4、再次刷新浏览器上面应用请求，此时192.168.43.10上面tongweb-1已经接管，且session未发生改变。

关键字: TongWeb+TongDataGrid+TongHttpServer实现Session复制
文档来源: 
--------------------------------------------------------------------------------

问题编号: 009
问题: TongWeb-k8s部署运行TongWeb嵌入版应用

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134268114

---

基础环境要求：
K8s至少两台服务器，一台作为master一台作为node，以及需要私有仓库用于节点镜像拉取
创建一个Dockerfile，用于构建Docker镜像，与应用jar同级
这个Dockerfile使用了openjdk:8作为基础镜像，并将Url.jar复制到镜像中，并设置了启动命令
构建Docker镜像。在命令行中，进入项目根目录，执行命令构建镜像
docker build -t url:v1 .
查看构建好的镜像  docker images
为构建好的镜像打上标签
docker tag url:v1 192.168.18.105:5000/url:v1
上传到私有仓库
docker push 192.168.18.105:5000/url:v1
列出私有仓库的所有镜像
curl http://192.168.18.105:5000/v2/_catalog
创建一个Kubernetes的Deployment文件。在项目根目录下创建一个名为deployment.yaml的文件
这个Deployment文件定义了一个名为" url-deployment"的Deployment，使用镜像仓库中的镜像，并暴露了容器的8088端口
创建一个Kubernetes的Service文件。在项目根目录下创建一个名为service.yaml的文件
这个Service文件定义了一个名为"url-service"的Service，将流量转发到之前创建的Deployment中的Pod
使用kubectl命令部署应用程序。在命令行中，进入到项目根目录，并执行以下命令来部署应用程序
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
验证部署是否成功。使用kubectl命令检查Pod和Service的状态：
kubectl get pods
kubectl get services
查看运行pod日志，是否启动成功
kubectl logs url-deployment-5fd7db7d45-4xl2p
用k8s生成的ip和对外端口80测试访问
curl http://192.130.150.7:80
附件：

关键字: TongWeb-k8s部署运行TongWeb嵌入版应用
文档来源: 
--------------------------------------------------------------------------------

问题编号: 010
问题: TongWeb6、7开启WebDAV的支持

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109697304

---

在应用的web.xml里加如下内容：
<servlet>
    <servlet-name>webdav</servlet-name>
    <!-- TongWeb 6的类 -->
    <servlet-class>com.tongweb.web.thor.servlets.WebdavServlet</servlet-class>
    <!-- TongWeb 7的类, 二选一 -->
    <servlet-class>com.tongweb.catalina.servlets.WebdavServlet</servlet-class>
      <init-param>
         <param-name>debug</param-name>
         <param-value>0</param-value>
      </init-param>
      <init-param>
          <param-name>listings</param-name>
          <param-value>true</param-value>
      </init-param>
      <!-- Read-Write Access Settings -->
      <init-param>
          <param-name>readonly</param-name>
          <param-value>false</param-value>
      </init-param>
</servlet>
<!-- URL Mapping -->
<servlet-mapping>
      <servlet-name>webdav</servlet-name>
      <url-pattern>/*</url-pattern>
</servlet-mapping>

关键字: TongWeb6、7开启WebDAV的支持
文档来源: 
--------------------------------------------------------------------------------

问题编号: 011
问题: TongWeb7-Rest接口示例

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134295162

---

1. 获取通道信息：
curl  --user thanos:thanos123.com http://192.168.178.131:9062/console/rest/api/listener_detail?operatorName=count:tong-http-listener,stat:tong-http-listener
2.获取应用资源缓存信息
curl --user thanos:@Karthus195819  “http://192.168.150.128:9060/console/rest/api/application_resource_cache?pathValue=TC_examples&vhost=server&attrName=size,maxSize,hitCount,lookupCount,ttl”

关键字: TongWeb7-Rest接口示例
文档来源: 
--------------------------------------------------------------------------------

问题编号: 012
问题: TongWeb7-commandtool命令行使用步骤

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/133808044

---

重置密码并重新设置命令行密码，使用TongWeb自带的password.sh对新密码进行加密后写入密码文件即可，步骤如下：
a.升级后, TongWeb目录/bin配置文件external.vmoptions中追加参数-Dnever.expire=on，如下截图：
b.重置TongWeb密码：将TongWeb目录/domain_template/conf/security目录覆盖tongweb目录/conf/security目录后，重启TongWeb。
c.通过命令行修改cli用户密码,执行以下命令
注：	9060为当前TongWeb的控制台访问端口。
passwordfil文件位于TongWeb目录/bin下，也可自行放置，但命令中需要写全路径。
passwordfil文件内容为: AS_ADMIN_password=AjLAlFlxbAed3VLKrpDZ4g==
AjLAlFlxbAed3VLKrpDZ4g==为cli用户默认密码cli123.com，通过TongWeb目录/bin
下的password.sh加密而来，如下图：
d.修改cli密码成功后，使用password.sh对新密码进行加密处理,并将加密串复制到passwordfil文件中，如下图：
e.通过命令行部署测试应用测试成功，如下图：

关键字: TongWeb7-commandtool命令行使用步骤
文档来源: 
--------------------------------------------------------------------------------

问题编号: 013
问题: TongWeb7-commandtool部分命令示例

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/133808904

---

commandtool部分命令示例，具体参数相关解释，请查看TongWeb7手册
非交互模式
替换授权：
./commandstool.sh update-license --user=cli --passwordfile=passwordfil --host=localhost --port=9060 --interactive=false
修改cli用户密码：
./commandstool.sh change-admin-password --user=cli --passwordfile=passwordfil --host=localhost --port=8099
输入以下新旧密码(老版本)
Please enter the old admin password>cli123.com
Please enter the new admin password>Cli456.com
Please enter the new admin password again>Cli456.com
Command change-admin-password executed successfully.
或者(新版本，当前测试跑在7049M2)
Please enter the new admin password>cl45@EN.com
Please enter the new admin password again>cl45@EN.com
修改TongWeb控制台密码：
./commandstool.sh config-password --adminuser=thanos --adminoldpassword=thanos123.com --adminnewpassword=Thanos123.com --user=cli --passwordfile=passwordfil --host=localhost --port=9060 --interactive=true
Command config-password executed successfully.
修改jvm参数：
./commandstool.sh set-jvm-arg --user=cli --passwordfile=passwordfile --host=localhost --port=9060 --interactive=true --arg=-Xmx1024m --arg=-Xms1024m
Command set-jvm-arg executed successfully.
应用部署：
./commandstool.sh deploy --user=cli --passwordfile=passwordfile --host=localhost --port=9060 --interactive=true --contextroot=/beanValida --defaultvs=server --applocation=…/samples/bean-validation/beanValidate.war beanValida
Command app executed successfully.
应用解部署：
./commandstool.sh undeploy --user=cli --passwordfile=passwordfile --host=localhost --port=9060 --interactive=true beanValida
Command undeploy executed successfully.
重部署应用：
./commandstool.sh redeploy --user=cli --passwordfile=passwordfile --port=9061  --interactive=false  --applocation=/home/vmjoec/samples/bean-validation/beanValidate.war beanValidate
交互：
./commandstool.sh redeploy --user=cli --passwordfile=passwordfile --port=9061   --applocation=/home/vmjoec/samples/bean-validation/beanValidate.war beanValidate
更新http通道：
./commandstool.sh update-http-listener --interactive=true --listeneraddress=localhost --securitabled=false --listenerport=9061 --user=cli --passwordfile=./passwordfil --defaultvs=server tong-http-listener
停止应用：
./commandstool.sh disable-app --user=cli --passwordfile=passwordfile --port=9060 --interactive=true beanValidate
Command disable-app executed successfully.
启动应用：
./commandstool.sh enable-app --user=cli --passwordfile=passwordfile --port=9060 --interactive=true beanValidate
Command enable-app executed successfully.
获取应用状态：
./commandstool.sh list-apps --user=cli --passwordfile=passwordfile --port=9060 --interactive=true
name=block type=war context-root=/block vNames=server status=started
name=beanValidate type=war context-root=/beanValidate vNames=server status=started
Command list-apps executed successfully.
设置启动脚本参数：
./commandstool.sh set-server-arg --user=cli --passwordfile=passwordfile --port=9060 --interactive=true  --arg=-DWebModuleOnly=true
Command set-server-arg executed successfully.
删除启动脚本参数：
./commandstool.sh delete-server-arg --user=cli --passwordfile=passwordfile --port=9060 --interactive=true  WebModuleOnly
Command delete-server-arg executed successfully.
查看TongWeb版本号：
./commandstool.sh version --user=cli --passwordfile=passwordfile --port=9060 --interactive=true
TongWeb7.0.4.7
Command version executed successfully.
passwordfile文件内容：
AS_ADMIN_password=AjLAlFlxbAed3VLKrpDZ4g==   注：AjLAlFlxbAed3VLKrpDZ4g==为调用 tongweb目录/bin/password.sh  cli123.com 后加密得来。

关键字: TongWeb7-commandtool部分命令示例
文档来源: 
--------------------------------------------------------------------------------

问题编号: 014
问题: TongWeb7-java.lang.NoSucMethodError_ Ljava_lang_reflect_Constructor

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/133807897

---

应用适配tongweb7报如下错误
java.lang.NoSucMethodError: org.springframework.util.Reflectionutils.accessibleconstructor(Ljava/lang/Class; [Ljava/lang/class;)Ljava/lang/reflect/Constructor报错类为spring相关的包冲突导致，应用导报时排除一下依赖即可

关键字: TongWeb7-java.lang.NoSucMethodError_ Ljava_lang_reflect_Constructor
文档来源: 
--------------------------------------------------------------------------------

问题编号: 015
问题: TongWeb7-refused to display http___xxx in a fream because it set X-Fream-Options to sameorigin

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/133808867

---

应用适配如遇到页面frame相关报错
删除TongWeb目录/bin/external.vmopitons中删除
-Dtongweb.X_Frame_Options=SAMEORIGIN，或者设置为NONE，后重启tongweb即可

关键字: TongWeb7-refused to display http___xxx in a fream because it set X-Fream-Options to sameorigin
文档来源: 
--------------------------------------------------------------------------------

问题编号: 016
问题: TongWeb7-应用访问报com.tongweb.jasper.JasperException

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134502207

---

问题报错如下：
com.tongweb.jasper.JasperException: /WEB-INF/tags/doLogin.tag (line: 136, column: 15) Attribute value  (domain != null && domain.length() > 0)  is quoted with > which must be escaped when used within the value
解决办法：
TongWeb目录/bin/external.vmoptions中追加以下参数：
-Dcom.tongweb.web.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false
-Dcom.tongweb.web.jasper.compiler.Parser.STRICT_WHITSPACE=false
tongweb目录/conf/default-web.xml中com. tongweb.web.jasper.servlet.ThanosJspServlet位置下面追加如下配置：

关键字: TongWeb7-应用访问报com.tongweb.jasper.JasperException
文档来源: 
--------------------------------------------------------------------------------

问题编号: 017
问题: TongWeb7-控制台和应用配置https

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134146249

---

首先需要购买 https 证书，中间件默认证书格式为 JKS
TongWeb 控制台配置 https

关键字: TongWeb7-控制台和应用配置https
文档来源: 
--------------------------------------------------------------------------------

问题编号: 018
问题: TongWeb7-漏洞相关

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134465331

---

1.  东方通应用服务器请求走私漏洞(Tomcat CVE-2021-33037)
该漏洞在 HTTP1.0 协议下，TongWeb 未对
Transfer-Encoding: chunked 头进行解析，而是以 Content-Length 作
为请求体内容划分。
已确认受影响版本：
TongWeb7.x <=TongWeb 7.0.4.9_M1
TongWeb7.0.C.3 至 7.0.C.5 版本
TongWeb6.1.7.x <=TongWeb6.1.8.6
未受影响版本：TongWeb6.1.5.x 系列、TongWeb8.0 系列、
TongWeb7.0.E 系列
根据该描述应为之前已解决的远程代码执行问题，该
问题已在最新版本 TongWeb7.0.4.9_M2、
TongWeb7.0.C.6 解决，或打
TongWeb7049M1_ITAIT5745 补丁。
链接：https://pan.baidu.com/s/1CnJxebOXaC1STrQwIyPmCw
提取码：7t8v

关键字: TongWeb7-漏洞相关
文档来源: https://pan.baidu.com/s/1CnJxebOXaC1STrQwIyPmCw
--------------------------------------------------------------------------------

问题编号: 019
问题: TongWeb7-版本升级说明及常见问题

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/133807677

---

涉及版本：
TongWeb 嵌入版==》不涉及
TongWeb 容器云==》不涉及
TongWeb 轻量版==》不涉及
TongWeb 企业版==》TongWeb5.0.X/6.0.X 涉及(只能关闭 TongWeb 控制台和 jmx 端口或联系东方通  销售升级 TongWeb 版本)
TongWeb7.0.4.1 涉及
TongWeb7.0.4.2–P1 涉及
TongWeb7.0.4.3 涉及
TongWeb7.0.4.4–P1–P3 涉及
TongWeb7.0.4.5–M1–M3 涉及
TongWeb7.0.4.6–M3–M4 涉及
TongWeb7.0.4.7 涉及
TongWeb7.0.4.8–M1 涉及
TongWeb7.0.4.9 涉及
TongWeb7.0.4.9M1 不涉及
**注意事项：
升级前需要需要手动备份当前正在使用的 TongWeb 整个目录。
升级前需要将整个 TongWeb 目录赋 root 用户和组，升级完成后切回原用户和组。**
补丁获取：
链接：https://pan.baidu.com/s/1WxCtEqrd80zI2roU0v9dHw 提取码：ammk
补丁包含两部分：
patchtool.zip=======>补丁升级脚本
tongweb-patchs.zip===>待升级补丁
注意：该补丁为一个复合补丁包，可升级到比当前待升级版本高的任意一个版本。
升级步骤：
譬如：TongWeb 安装路径为/opt/weaver/TongWeb7046
上传 patchtool.zip 到/opt/weaver/TongWeb7046
unzip patchtool.zip 解压升级脚本压缩包
上传 tongweb-patchs.zip 到/opt/weaver
unzip tongweb-patchs.zip 解压升级补丁压缩包
chown -R root:root /opt/weaver/TongWeb7046 对整个 TongWeb 目录赋 root 用户和组
chmod -R 777 /opt/weaver/TongWeb7046/patchtool
cd /opt/weaver/TongWeb7046/patchtool
./install.sh /opt/weaver/tongweb-patchs 7049_M1
出现以下截图标注的提示，说明 TongWeb 升级成功
mv /opt/weaver/TongWeb7046 /opt/weaver/TongWeb7049M1 修改升级之后文件名11. chown -R tongweb:tongweb /opt/weaver/TongWeb7046 切回 TongWeb 原用户和组
cd /opt/weaver/TongWeb7049M1/bin
./forcestopserver 停止 tongweb 服务
./startservernohup.sh 后台启动 tongweb 服务
临时解决方案(不推荐):
如因特殊原因暂时无法升级, 那么采用临时关闭 TongWeb 控制台的方法，
使用限制：关闭 TongWeb 控制台期间无法使用 TongWeb 控制台。
TongWeb6/7 关闭控制台，修改如下完毕后重启 tongweb 生效
a. 关闭 TongWeb 控制台将 TongWeb.xml 中的 system-http-listener 通道的对应端口状态设置为 stopped，如下:
b. 将 TongWeb.xml 中的 jmx 端口 7200 暂时关闭或仅允许可信的 IP 地址访问 jmx。
具体标签中增加 enable=“false”，如下：
TongWeb5 关闭控制台，将 config/twns.xml 中的 twns、gm 两个控制台 access-enabled值设为 false，重启生效：
<web-app access-enabled=“false” context-root=“twns” … <web-app access-enabled=“false” context-root=“gm” …
常见问题：
问题 1：升级过程中如发现 TongWeb 目录/bin 下有应用程序相关的文件夹导致报错。
解决 1：请先将应用文件夹从 TongWeb 目录/bin 下移出，待升级完毕后再移回。
问题 2：使用了 open jdk11 缺少 jdk 相关依赖报错,如下。
解决 2：JAVA_HOME 和 PATH 环境变量修改为 JDK1.8，升级完成后，再切回 JDK11。
问题 3：会话复制功能 tongdatagrid-group-password 密码解码失败，截图如下
解决 3：将如下截图中,tongdatagrid-group-password 的 value 修改为密文
QABvp6bmC/a9zfqW2XJvSg==后保存，继续升级即可，如果未使用
tongweb 的会话复制功能，也可删除该文件后继续升级。
问题 4：成功升级后遇到页面 frame 相关报错，如下截图。
解决 4：删除 TongWeb 目录/bin/external.vmopitons 中删除
-Dtongweb.X_Frame_Options=SAMEORIGIN 后重启 tongweb 即可。
问题 5：如果 TongWeb 自动部署目录 autodeploy 和控制台部署目录 deployment 含有应用中文
命名的目录或文件，导致报错。
解决 5：请在执行升级脚本前，先移出 TongWeb 目录，升级完成后再移回。
问题 6：如果升级后 TongWeb 控制台和集中管理控制台报账号密码错误，无法登录。
解决 6：
a. 升级后, TongWeb 目录/bin 配置文件 external.vmoptions 中追加参数-Dnever.expire=on，如下截图：
b. 重置 TongWeb 密码：
将 tongweb 目录/domain_template/conf/security 目录覆盖 tongweb 目录
/conf/security 目录后，重启 tongweb
c. 可使用默认账号密码登录 tongweb 控制台(thanos/thanos123.com)
可使用默认账号密码登录 tongweb 集中管理控制台(rig/rig123.com)
d. 进入 TongWeb 控制台修改密码，步骤如下截图：
问题 7：通过命令行部署应用报 com.tongweb.tongejb.OpenEJBRuntimeException:
javax.crypto.IllegalBlockSizeException: last block incomplete in decryption。
解决 7：该问题为命令行部署指定的密码文件中密码为明文导致，升级版本后需要需要重置
密码并重新设置命令行密码，使用 TongWeb 自带的 password.sh 对新密码进行加密
后写入密码文件即可，步骤如下：
a. 升级后, TongWeb 目录/bin 配置文件 external.vmoptions 中追加参数-Dnever.expire=on，
如下截图：
b. 重置 TongWeb 密码：将 TongWeb 目录/domain_template/conf/security 目录覆盖 tongweb
目录/conf/security 目录后，重启 TongWeb。
c. 通过命令行修改 cli 用户密码,执行以下命令
注： 9060 为当前 TongWeb 的控制台访问端口。passwordfil 文件位于 TongWeb 目录/bin 下，也可自行放置，但命令中需要写全路径。
passwordfil 文件内容为: AS_ADMIN_password=AjLAlFlxbAed3VLKrpDZ4g==
AjLAlFlxbAed3VLKrpDZ4g==为 cli 用户默认密码 cli123.com，通过 TongWeb 目录/bin
下的 password.sh 加密而来，如下图：
d. 修改 cli 密码成功后，使用 password.sh 对新密码进行加密处理,并将加密串复制到
passwordfil 文件中，如下图：
e. 通过命令行部署测试应用测试成功，如下图：
f. tongweb7047升级到7048，7049，7049M1,7049M2，7049M3任意版本，如果tongweb.xml配置了 <web-app seesion-manager=“” …/>中会报错如下图：错误原是因为7048，7049，7049M1,7049M2，7049M3任意版本中tongweb.xml需要配置了 <web-app session-manager=“” …/>  解决方案 ，把seesion-manager 改为session-manager即可。

关键字: TongWeb7-版本升级说明及常见问题
文档来源: https://pan.baidu.com/s/1WxCtEqrd80zI2roU0v9dHw
--------------------------------------------------------------------------------

问题编号: 020
问题: TongWeb7-绿色版安装及启动停止和控制台访问

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134146320

---

比如安装tongweb到/opt/tongtech目录，操作如下
新建/opt/tongtech目录
拷贝tongweb绿色版安装包到/opt/tongtech目录
执行tar -xvf TongWeb7.0.4.9_M1_Enterprise_Linux.tar.gz 解压
执行 mv  TongWeb7.0.4.9_M1_Enterprise_Linux.tar.gz  tongweb7049m1  修改tongweb根目录的名称
拷贝授权文件license.dat到/opt/tongtech/tongweb7049m1目录
安装jdk并配置统环境变量JAVA_HOME和PATH到/etc/profile,譬如jdk的目录为/opt/tongtech/jdk1.8.0.144
export JAVA_HOME=/opt/tongtech/jdk1.8.0.144
export PATH=
JAVAHOME/bin:JAVA_HOME/bin:
J
A
V
A
H
​
OME
/
bin
:
PATH
配置完保存后，执行source /etc/profile生效。
如果已经安装并配置过，这一步可以忽略。
配置TongWeb自启动
cd /opt/tongtech/tongweb7049m1/bin
./installservice.sh
启动tongweb
cd /opt/tongtech/tongweb7049m1/bin
sh startservernohup.sh
查看启动日志
cd /opt/tongtech/tongweb7049m1/logs
tail -f server.log
出现如下截图日志，说明tongweb已经启动成功：
停止tongweb
cd /opt/tongtech/tongweb7049m1/bin
./stopserver.sh quick
或
./forcestopserver.sh
访问tongweb控制台
链接：http://tongweb所在服务器ip:9060/console
账号：thanos
密码: thanos123.com
初次登录需要修改密码

关键字: TongWeb7-绿色版安装及启动停止和控制台访问
文档来源: http://tongweb所在服务器ip:9060/console
--------------------------------------------------------------------------------

问题编号: 021
问题: TongWeb7-设置控制台口令过期更换时间

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/133808110

---

TongWeb控制台口令过期时间可自行设置，控制台最大允许设置90天。

关键字: TongWeb7-设置控制台口令过期更换时间
文档来源: 
--------------------------------------------------------------------------------

问题编号: 022
问题: TongWeb7-重置TongWeb账号密码

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134267860

---

TongWeb 目录/bin 配置文件 external.vmoptions 中追加参数-Dnever.expire=on，如下截图：
删除tongweb 目录/conf/security 目录
将 tongweb 目录/domain_template/conf/security拷贝至tongweb 目录
/conf下，并重启TongWeb。
可使用默认账号密码登录 tongweb 控制台(thanos/thanos123.com)
可使用默认账号密码登录 tongweb 集中管理控制台(rig/rig123.com)
进入 TongWeb 控制台修改密码，步骤如下截图：

关键字: TongWeb7-重置TongWeb账号密码
文档来源: 
--------------------------------------------------------------------------------

问题编号: 023
问题: TongWeb7.0-8.0Java代码使用JMX获取应用通道端口

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/137153861

---

以下通过java代码实现获取TongWeb7.0/8.0应用通道端口使用到的JMX均为TongWeb自带的JMX功能。
一、TongWeb7.0
1、使用本地JMX获取应用通道端口
public
String getTw7PortByLocalJmx() {
try
{
MBeanServer
beanServer
= ManagementFactory.
getPlatformMBeanServer
();
Set<ObjectName>
objectNames
=
beanServer
.queryNames(
new
ObjectName(
"*:type=Connector,*"
),
Query.
match
(Query.
attr
(
"name"
), Query.
value
(
"tong-http-listener"
)));
String
port
=((ObjectName)
objectNames
.iterator().next()).getKeyProperty(
"port"
);
return
"getTw7PortByLocalJmx channel tong-http-listener port = "
+
port
;
}
catch
(Exception
e
) {
e
.printStackTrace();
return
"error : "
+
e
.getMessage();
}
}
2、使用远程JMX获取应用通道端口
public
String getTw7PortByRemoteJmx() {
try
{
String
ipAndPort
=
"192.168.5.26:7200"
;
String
serviceUrl
= String.
format
(
"service:jmx:rmi://%s/jndi/rmi://%s/jmxrmi"
,
ipAndPort
,
ipAndPort
);
JMXServiceURL
jmxUrl
=
new
JMXServiceURL(
serviceUrl
);
Map<String, String[]>
env
=
new
HashMap<String, String[]>();
env
.put(JMXConnector.
CREDENTIALS
,
new
String[] {
"thanos"
,
"thanos123.com"
});
JMXConnector
jmxConnector
= JMXConnectorFactory.
connect
(
jmxUrl
,
env
);
MBeanServerConnection
mbsc
=
jmxConnector
.getMBeanServerConnection();
Set<ObjectName>
objectNames
=
mbsc
.queryNames(
new
ObjectName(
"*:type=Connector,*"
),
Query.
match
(Query.
attr
(
"name"
), Query.
value
(
"tong-http-listener"
)));
String
port
=((ObjectName)
objectNames
.iterator().next()).getKeyProperty(
"port"
);
return
"getTw7PortByRemoteJmx channel tong-http-listener port = "
+
port
;
}
catch
(Exception
e
) {
e
.printStackTrace();
return
"error : "
+
e
.getMessage();
}
}
二、TongWeb8.0
1、使用本地JMX获取应用通道端口
（1）使用本地JMX时需要先在对应的tongweb实例中开启注册本地Mbean的功能。入口：对应tongweb实例==》基础配置==》全局配置==》JMX
（2）相关代码
public
String getTw8PortByLocalJmx() {
try
{
MBeanServer
beanServer
= ManagementFactory.
getPlatformMBeanServer
();
Object[]
params
= {
"Connector"
,
"server"
};
String[]
signature
= { String.
class
.getName(), String.
class
.getName() };
Object
result
=
beanServer
.invoke(
new
ObjectName(
"TongWeb:name=server"
),
"show"
,
params
,
signature
);
ObjectMapper
mapper
=
new
ObjectMapper();
String
jsonString
=
mapper
.writeValueAsString(
result
);
JSONObject
jsonObject
= JSONObject.
parseObject
(
jsonString
);
String
port
=
jsonObject
.getString(
"port"
);
return
"getTw8PortByLocalJmx channel server port = "
+
port
;
}
catch
(Exception
e
) {
e
.printStackTrace();
return
"error : "
+
e
.getMessage();
}
}
2、使用远程JMX获取应用通道端口
（1）使用远程JMX时需要先在对应的tongweb实例中开启JMX接口功能。入口：集中管理==》系统管理==》JMX接口==》启用
（2）创建新的系统管理员用户专门用于远程JMX连接。
原因：为了保证用户的登录安全，当使用某用户通过浏览器登录控制台后，若再使用相同的用户通过 REST\JMX\命令行等接口接入，该用户在浏览器上的会话会被强制终止（即被踢出，需要重新登录）。
入口：集中管理==》安全配置==》管理员==》创建
（3）使用新用户登录并修改新用户的初始密码
（4）使用security用户登录tongweb给新用户赋予管理员角色
（5）相关代码
public
String getTw8PortByRemoteJmx() {
try
{
String
ipAndPort
=
"192.168.5.28:7200"
;
String
serviceUrl
= String.
format
(
"service:jmx:rmi://%s/jndi/rmi://%s/server"
,
ipAndPort
,
ipAndPort
);
JMXServiceURL
jmxUrl
=
new
JMXServiceURL(
serviceUrl
);
Map<String, Object>
environment
=
new
HashMap<>();
environment
.put(JMXConnector.
CREDENTIALS
,
new
String[] {
"jmxuser"
,
"Tongweb135.."
,
null
,
"true"
});
JMXConnector
connector
= JMXConnectorFactory.
connect
(
jmxUrl
,
environment
);
connector
.connect();
MBeanServerConnection
connection
=
connector
.getMBeanServerConnection();
Object[]
params
= {
"Connector"
,
"server"
};
String[]
signature
= { String.
class
.getName(), String.
class
.getName() };
Object
result
=
connection
.invoke(
new
ObjectName(
"TongWeb:name=server"
),
"show"
,
params
,
signature
);
ObjectMapper
mapper
=
new
ObjectMapper();
String
jsonString
=
mapper
.writeValueAsString(
result
);
JSONObject
jsonObject
= JSONObject.
parseObject
(
jsonString
);
String
port
=
jsonObject
.getString(
"port"
);
return
"getTw8PortByRemoteJmx channel server port = "
+
port
;
}
catch
(Exception
e
) {
e
.printStackTrace();
return
"error : "
+
e
.getMessage();
}
}
建议使用上面的代码方式，下面的方式需要删除字符串首尾的“[]”，代码写死，如果服务器返回数据结构发生变化会报错。
public
String getTw8PortByRemoteJmx() {
try
{
String
ipAndPort
=
"192.168.5.28:7200"
;
String
serviceUrl
= String.
format
(
"service:jmx:rmi://%s/jndi/rmi://%s/server"
,
ipAndPort
,
ipAndPort
);
JMXServiceURL
jmxUrl
=
new
JMXServiceURL(
serviceUrl
);
Map<String, Object>
environment
=
new
HashMap<>();
environment
.put(JMXConnector.
CREDENTIALS
,
new
String[] {
"jmxuser"
,
"Tongweb135.."
,
null
,
"true"
});
JMXConnector
connector
= JMXConnectorFactory.
connect
(
jmxUrl
,
environment
);
connector
.connect();
MBeanServerConnection
connection
=
connector
.getMBeanServerConnection();
Properties
properties
=
new
Properties();
properties
.setProperty(
"name"
,
"server"
);
Object
result
=
connection
.invoke(
new
ObjectName(
"TongWeb:name=console"
),
"callServerMethod"
,
// modelName action
参数
new
Object[] {
"connector"
,
"show"
,
properties
},
new
String[] { String.
class
.getName(), String.
class
.getName(), Properties.
class
.getName() });
JSONObject
jsonObject
= JSONObject.
parseObject
(String.
valueOf
(
result
));
String
models
=
jsonObject
.getString(
"models"
);
models
=
models
.substring(1,
models
.length() - 1);
jsonObject
= JSONObject.
parseObject
(
models
);
String
port
=
jsonObject
.getString(
"port"
);
return
"getTw8PortByRemoteJmx channel server port = "
+
port
;
}
catch
(Exception
e
) {
e
.printStackTrace();
return
"error : "
+
e
.getMessage();
}
}

关键字: TongWeb7.0-8.0Java代码使用JMX获取应用通道端口
文档来源: 
--------------------------------------------------------------------------------

问题编号: 024
问题: TongWeb7.0.E.6_P11嵌入式版本使用指引（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143385263

---

文章目录
声明
相关概念
手册的使用
示范工程
安装工程介质
安装前准备
示范工程参考（spring-boot-helloWorld-2.x）
示范参考
声明
1.本文参考001_TongWeb_V7.0嵌入式版_JavaEE标准容器用户指南_70E6_P11A01.pdf，实际以最新更新的手册为准。
2.本文仅说明在本地开发环境如何操作，转换工具以及其他方面内容请看用户手册与配置示例。
3.本文会同时示范安装包里的示范工程spring-boot-helloWorld-2.x。
4.本文仅示范如何用本地maven引入相关依赖，如果要将依赖引入到远程仓库，请自行阅读手册。
5.针对于应用打包方式为jar包，使用springboot的项目（使用war包部署，之前用tomcat部署的，请考虑使用Tongweb企业版）
相关概念
手册的使用
一般用JavaEE标准，参考安装包里的用户手册里的001_TongWeb_V7.0嵌入式版_JavaEE标准容器用户指南_70E6_P11A01.pdf。
使用JakartaEE标准，参考002_TongWeb_V7.0嵌入式版_JakartaEE标准容器用户指南_70E6_P11A01.pdf（springboot版本要求3.x）。
使用springcloud，尤其使用springgetaway的，参考003_TongWeb_V7.0嵌入式版_响应式编程容器用户指南_70E6_P11A01.pdf。
已打包成应用jar包的，可参考004_TongWeb_V7.0嵌入式版_转换工具指南_70E6_P11A01.pdf。(如果本身没有开发环境的，再考虑这一步)
相关手册均在安装包的用户手册与配置示例。
示范工程
示范工程也在安装包里（可根据自身需求进行参考）：
安装工程介质
通俗点说，就是tongweb的相关依赖jar包，如下图所示：
tongweb-embed-7.0.E.6_P11.zip 为java_EE和JakartaEE使用的安装介质，使用前需解压。
tongweb-gmssl-1.0.0.zip 为国密使用的安装介质，使用前需解压。
tongweb-spring-boot-reactor-7.0.E.6_P11.zip 为微服务相关的安装介质，使用前需解压。
tongweb-transform-7.0.E6_P11.zip,为转换工具，使用前需解压。
安装前准备
1.本地window已配置jdk环境变量。
参考：
Windows配置JDK环境变量
2.本地window已配置maven环境变量，并在maven的setting文件里配置好本地仓库目录。
参考：
maven环境变量配置（超详细！）
3.确保本地项目代码能正常运行和打包。
4.联系东方通的销售人员获取安装包和授权文件。
示范工程参考（spring-boot-helloWorld-2.x）
spring-boot-helloWorld-2.x在安装包的路径如下：
里面一般有个使用说明：
使用idea引入该项目，并配置好maven（包括maven的setting文件里的本地仓库目录）
引入后先在这里加个mavenplus的版本，避免之后爆红：
配置后解压安装包里的tongweb-embed-7.0.E.6_P11.zip：
解压后双击installMavenJar.bat
执行成功后，到idea里，刷新maven。
刷新maven后，在项目的resource目录下放入license.dat（也就是授权文件），然后配置license.dat路径：
server.tongweb.license.path
=
classpath:license.dat
编码项目看看有没有报错：
没有报错的话，直接运行：
一般会输出授权信息，包括到期时间
由于我本地设置的是8089，所以访问8089进行测试：
示范参考
示范工程里由于已经引入了tongweb的依赖坐标，所以并不是所有的示范工程都使用于自己的项目，这个时候，可以参考一下手册。
以001_TongWeb_V7.0嵌入式版_JavaEE标准容器用户指南_70E6_P11A01.pdf为例，引入pom.xml的依赖坐标参考这一章节：
springboot1.x:
<
!
-- 排除springboot自带的tomcat依赖 --
>
<
dependency
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-web
<
/artifactId
>
<
exclusions
>
<
exclusion
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-tomcat
<
/artifactId
>
<
/exclusion
>
<
/exclusions
>
<
/dependency
>
<
!
-- 添加tongweb-spring-boot-starter依赖 --
>
<
dependency
>
<
groupId
>
com.tongweb.springboot
<
/groupId
>
<
artifactId
>
tongweb-spring-boot-starter-1.x
<
/artifactId
>
<
version
>
7.0
.E.6_P1
1
<
/version
>
<
/dependency
>
springboot2.x:
<
!
-- 排除springboot自带的tomcat依赖 --
>
<
dependency
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-web
<
/artifactId
>
<
exclusions
>
<
exclusion
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-tomcat
<
/artifactId
>
<
/exclusion
>
<
/exclusions
>
<
/dependency
>
<
!
-- 添加tongweb-spring-boot-starter依赖 --
>
<
dependency
>
<
groupId
>
com.tongweb.springboot
<
/groupId
>
<
artifactId
>
tongweb-spring-boot-starter-2.x
<
/artifactId
>
<
version
>
7.0
.E.6_P1
1
<
/version
>
<
/dependency
>
jsp:
<
dependency
>
<
groupId
>
com.tongweb
<
/groupId
>
<
artifactId
>
tongweb-jsp
<
/artifactId
>
<
version
>
7.0
.E.6_P1
1
<
/version
>
<
/dependency
WebSocket(springboot1.x):
<
dependency
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-websocket
<
/artifactId
>
<
/dependency
>
<
dependency
>
<
groupId
>
com.tongweb.springboot
<
/groupId
>
<
artifactId
>
tongweb-spring-boot-websocket-1.x
<
/artifactId
>
<
version
>
7.0
.E.6_P1
1
<
/version
>
<
/dependency
>
<
dependency
>
<
groupId
>
com.tongweb.springboot
<
/groupId
>
<
artifactId
>
tongweb-spring-boot-starter-1.x
<
/artifactId
>
<
version
>
7.0
.E.6_P1
1
<
/version
>
<
/dependency
>
<
dependency
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-web
<
/artifactId
>
<
exclusions
>
<
exclusion
>
<
groupId
>
org.springframework.boot
<
/groupId
>
<
artifactId
>
spring-boot-starter-tomcat
<
/artifactId
>
<
/exclusion
>
<
/exclusions
>
<
/dependency
>
配置后解压安装包里的tongweb-embed-7.0.E.6_P11.zip：
解压后双击installMavenJar.bat
执行成功后，到idea里，刷新maven，看看有没有报错，有没有引入tongweb的依赖。
在项目的resource目录下放入license.dat（也就是授权文件），然后配置license.dat路径(一般在application.properties里)，下面是参考格式
配置后看看是否有报错，有报错再根据报错，参考常见问题手册进行处理

关键字: TongWeb7.0.E.6_P11嵌入式版本使用指引（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 025
问题: TongWeb7.0动态密钥说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/148496600

---

为解决TongWeb密码硬编码问题，TongWeb7.0.4.9_M5及之后版本采用动态密钥，在使用过程或升级过程中可能会遇到密码加密异常问题。对其做一个说明：
在TongWeb单节点
情况下
，根节点和通过domain命令建的域，数据源用户名和密码、SSL证书密码、JCA适配器密码等的密钥是采用
动态密钥的。禁止不同TongWeb间的密码复制粘贴
。例如：
场景一：
A机 /opt/tongweb/conf/tongweb.xml  中的密码复制到   B机不同目录 /root/tongweb/conf/tongweb.xml
密码不可用
场景二：
A机 /opt/tongweb/conf/tongweb.xml  中的密码复制到  A机域下 /opt/tongweb/domains/node1/conf/tongweb.xml
密码不可用
TongDataGrid
组名也是根据TongWeb做为动态密钥的，
密码则根据组名做为动态密钥的
，组名不同，密码相同时生成的加密串不同。手工配置session复制时，步骤如下：
在控制台配置session管理器，如：组名tongdev, 密码tongtech
将tongweb.xml中生成的tdg-group-name="
_TSM_0oaTdXXU8MK/L/dJtwOsTQ==
" tdg-group-password="
_TSM_ADU772qVqjc33QGYPqdKpw==
" 复制到TDG的tongdatagrid.xml中。
<group>
     <name>tongdev</name>
     <password>_TSM_ADU772qVqjc33QGYPqdKpw==</password>
 </group>
若无法通过控制台配置密码，则可以通过命令生成密码串复制到tongweb.xml中。
数据源用户名和密码、SSL证书密码、JCA适配器密码、tdg-group-name则通过password命令生成加密串。
TDG的tdg-group-password则通过
commandstool generate-tdg-token --tongdatagrid_group_name=tongdev --tongdatagrid_group_password=tongtech  命令，将生成的加密串复制到tongweb.xml和tongdatagrid.xml中。
在采用TongWeb heimdall情况下，通过集中管理添加节点，新建集群和域，会在TongWeb conf\security目录下生成tsmtoken.txt文件动态密码，则相关域数据源用户名和密码、SSL证书密码、JCA适配器密码、tdg-group-name生成的加密串相同。 将该文件复制到其它TW域则得到相同加密串。
注意：TongWeb7.0.4.9_M5兼容旧密码，正常补丁升级后，在控制台保存密码，可以更新为新的加密方式。但注意更换TongWeb目录后要更新密码。

关键字: TongWeb7.0动态密钥说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 026
问题: TongWeb78处理应用自身JAR包冲突思路

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/144137972

---

通常应用运行时报错如果出现java.lang.NoClassDefFoundError，那么首先需要看报错日志下方的Caused by内容是什么，如果是ClassNotFoundException，那么原因就是缺少某个类。如果仍然是NoClassDefFoundError，那么很大可能是类冲突导致的。此时就需要继续排查是哪些jar包冲突。
第二种类冲突的报错不是那么明显，需要反编译jar包查看源码，比如下面两张图中的报错。
图一中显示的是NoSuchMethodError，说javax.mail.internet.ParameterList类中没有combineSegments方法。如果已知这个类在哪个jar包中，只需要查看源码就行。如果发现该类有这个方法，那么基本可以判断是类冲突，在其他jar包中会有一个相同的类但是没有这个方法。
如果查看的jar包中的类没有这个方法，往往会造成误判，认为是应用使用的jar包问题，因为事实情况与报错信息一致。但是不能忽略一种可能，在其他jar包中有一个相同的类，并且这个类有这个方法，只是应用启动时加载的类不是它而已。此时就需要去搜索是否有这个相同类存在。
可以通过这个命令查询：find ./ | xargs grep "类名" > 11.txt
图一
图二的情况与图一类似，也不是很明显的能判断出是类冲突造成的问题。从报错信息看是说子类没有实现抽象父类的方法。实际通过jar包查看源码也确实如报错信息所述一致。但是通过搜索子类和父类后发现，父类UriBuilder分别在两个jar包中出现，由此可以判断是类冲突导致的问题。
图二
其他方式检测类冲突：
如果使用TongWeb7.0产品，可以通过控制台==》类加载分析工具==》类资源分析/类冲突检测
如何处理冲突的jar包：
1、最直接的方法是将冲突的jar包删除
2、修改TongWeb配置
TongWeb7.0：在应用WEB-INF里面加入tongweb-web.xml文件。内容如下：需要优先加载的jar包放在前面。
<?xml version="1.0" encoding="UTF-8"?>
<tongweb-web-app>
<jar-orders>
<jar-order jar-name="a.jar" />
<jar-order jar-name="b.jar" />
</jar-orders>
</tongweb-web-app>
TongWeb8.0：部署应用的时候，在资源加载界面中设置加载顺序。

关键字: TongWeb78处理应用自身JAR包冲突思路
文档来源: 
--------------------------------------------------------------------------------

问题编号: 027
问题: TongWeb7中conf_tongweb.properties的作用

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109490040

---

TongWeb在加载类应用类时，会做一些没有必要的annontation扫描导致异常，可以在TongWeb的conf目录下tongweb.properties中过滤相应的jar。
TongWeb7的tongweb.properties中找到如下
Tongweb.util.scan.StandardJarScanFilter.jarsToSkip
键值增加jar名:
tongweb.util.scan.StandardJarScanFilter.jarsToSkip
=\
byte-buddy-1.9.5.jar,
bootstrap.jar,classmate-1.5.1.jar,commons-daemon.jar,\
annotations-api.jar,el-api.jar,jsp-api.jar,servlet-api.jar,websocket-api.jar,\
jaspic-api.jar,\
TongWeb6的tongweb.properties中找到如下增加jar名:
tongweb.util.scan.DefaultJarScanner.jarsToSkip
=
byte-buddy-1.9.5.jar,
bootstrap.jar,commons-daemon.jar,annotations-api.jar,el-api.jar
常见异常如下，把相应的jar名写入tongweb.properties中即可，
但尽量不要配*.jar，这样会导致正常使用的annontation失效。
1. 应用中带了JDK9的类，需将该jar加在StandardJarScanFilter.jarsToSkip中。
[Unable to process Jar entry [META-INF/versions/9/module-info.class] from Jar [file:/D:/a/WEB-INF/lib/byte-buddy-1.9.3.jar] for annotations]
com.tongweb.web.util.bcel.classfile.
ClassFormatException: Invalid byte tag in constant pool: 19
at com.tongweb.web.util.bcel.classfile.Constant.readConstant(Constant.java:97)
at com.tongweb.web.util.bcel.classfile.ConstantPool.<init>(ConstantPool.java:54)
at com.tongweb.web.util.bcel.classfile.ClassParser.readConstantPool(ClassParser.java:174)
at com.tongweb.web.util.bcel.classfile.ClassParser.parse(ClassParser.java:83)
2. org.bouncycastle.asn1.ASN1EncodableVector，org.bouncycastle.asn1.DEREncodableVector两个类互为父子，需将该jar加在StandardJarScanFilter.jarsToSkip中，否则TongWeb判断可能导致异常报如下：
Caused by: java.lang.IllegalStateException: Unable to complete the scan for annotations for web application [ecology] due to a StackOverflowError. Possible root causes include a too low setting for -Xss and illegal cyclic inheritance dependencies. The class hierarchy being processed was
[org.bouncycastle.asn1.ASN1EncodableVector->org.bouncycastle.asn1.DEREncodableVector->org.bouncycastle.asn1.ASN1EncodableVector]
at com.tongweb.catalina.startup.ContextConfig.checkHandlesTypes(ContextConfig.java:2118)
at com.tongweb.catalina.startup.OpenEJBContextConfig.checkHandlesTypesSuper(OpenEJBContextConfig.java:759)
at com.tongweb.catalina.startup.ThanosOpenEJBContextConfig.checkHandlesTypes(ThanosOpenEJBContextConfig.java:53)
at com.tongweb.catalina.startup.ContextConfig.processAnnotationsStream(ContextConfig.java:2062)
at com.tongweb.catalina.startup.OpenEJBContextConfig.processAnnotationsStreamSuper(OpenEJBContextConfig.java:753)
at com.tongweb.catalina.startup.ThanosOpenEJBContextConfig.processAnnotationsStream(ThanosOpenEJBContextConfig.java:40)
at com.tongweb.catalina.startup.ContextConfig.processAnnotationsJar(ContextConfig.java:2008)
at com.tongweb.catalina.startup.ContextConfig.processAnnotationsUrl(ContextConfig.java:1978)
at com.tongweb.catalina.startup.OpenEJBContextConfig.processAnnotationsUrlSuper(OpenEJBContextConfig.java:772)
3. 实际上应用没用这个类, hadoop-hdfs*.jar中有引用这个类导致，需将该jar加在StandardJarScanFilter.jarsToSkip中。否则报错：
Caused by: java.lang.
ClassNotFoundException: com.sun.jersey.spi.inject.InjectableProvider
4. db2jcc.jar引起的异常。
[2015-09-24 10:37:09] [SEVERE] [core] [Unable to process Jar entry [COM/ibm/db2os390/sqlj/custom/DB2SQLJEntryInfo.class] from Jar [jar:file:/home/tongweb/TongWeb/deployment/bbsp/WEB-INF/lib/
db2jcc-0.0.1.jar
!/] for annotations]
com.tongweb.web.webutil.util.bcel.classfile.
ClassFormatException: null is not a Java .class file
at com.tongweb.web.webutil.util.bcel.classfile.ClassParser.readID(ClassParser.java:238)
at com.tongweb.web.webutil.util.bcel.classfile.ClassParser.parse(ClassParser.java:114)
5. 像这种情况不报jar或class文件名，只能通过*.jar或 * 全部过滤掉。
Caused by: java.lang.ArrayIndexOutOfBoundsException: 56
at com.tongweb.xbean.
asm5.ClassReader.readClass
(ClassReader.java:2462)
at com.tongweb.xbean.asm5.ClassReader.accept(ClassReader.java:543)
at com.tongweb.xbean.asm5.ClassReader.accept(ClassReader.java:507)
at com.tongweb.xbean.finder.AnnotationFinder.readClassDef(AnnotationFinder.java:1171)
at com.tongweb.xbean.finder.AnnotationFinder.<init>(AnnotationFinder.java:148)
at com.tongweb.xbean.finder.AnnotationFinder.<init>(AnnotationFinder.java:161)
at com.tongweb.tongejb.config.FinderFactory$OpenEJBAnnotationFinder.<init>(FinderFactory.java:546)
等价：
tomcat配置：tomcat.util.scan. StandardJarScanFilter.jarsToSkip
说明：
A list of comma-separated file name patters that is used as the default value for pluggabilitySkip and tldSkip attributes of the standard JarScanFilter implementation.
The coded default is empty, however the system property is set in a default Tomcat installation via the $CATALINA_BASE/conf/catalina.properties file.

关键字: TongWeb7中conf_tongweb.properties的作用
文档来源: 
--------------------------------------------------------------------------------

问题编号: 028
问题: TongWeb7企业版巡检脚本

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134830242

---

#!/bin/bash
# 设置输出编码为 UTF-8
export LANG=en_US
.
UTF-8
export LC_ALL=en_US
.
UTF-8
# 检查是否已安装 sysstat 包
if
!
command
-
v pidstat &>
/
dev/null
;
then
echo
"sysstat 包未安装，正在安装..."
# 检查操作系统类型并执行相应的安装命令
if
[
-
f
/
etc/redhat-release
]
;
then
# CentOS/RHEL/Fedora
sudo yum install
-
y sysstat
  elif
[
-
f
/
etc/debian_version
]
;
then
# Debian/Ubuntu
sudo apt-get update
    sudo apt-get install
-
y sysstat
  elif
[
-
f
/
etc/kylin-release
]
;
then
# Kylin
sudo apt-get update
    sudo apt-get install
-
y sysstat
else
echo
"未知的操作系统类型，无法安装 sysstat 包！"
exit
1
  fi
# 检查安装是否成功
if
!
command
-
v pidstat &>
/
dev/null
;
then
echo
"sysstat 包安装失败，请手动安装后再运行脚本！"
exit
1
  fi
echo
"sysstat 包安装成功！"
fi
if
[
-
z
"
$1
"
]
;
then
echo
"请指定输出文件名！"
exit
1
fi
# 检查是否指定输出文件名和安装目录
if
[
-
z
"
$1
"
]
|
|
[
-
z
"
$2
"
]
;
then
echo
"请指定输出文件名和TongWeb安装目录"
exit
1
fi

output_file=
$1
tongweb_dir=
$2
#PROCESS_NAME="$TONGWEB/tongweb"  # 进程名
pid=$
(
cat
$tongweb_dir
/
tongweb
.
pid
)
# 获取进程ID
if
[
-
z
"
$pid
"
]
;
then
echo
"进程未启动"
exit
0
fi
echo
"检测到进程：
$pid
"
>>
$1
echo
"=========================================================================="
>>
$1
echo
"查看进程状态："
>>
$1
if
ps
-
p
$pid
>
/
dev/null
then
ps
-
fp
$pid
>>
$1
else
echo
"进程
$pid
不存在"
>>
$1
fi
echo
"=========================================================================="
>>
$1
echo
"查看授权信息版本号："
>>
$1
$tongweb_dir
/
bin/version
.
sh >>
$1
echo
"=========================================================================="
>>
$1
echo
"查看jvm配置："
>>
$1
cat
$tongweb_dir
/
bin/external
.
vmoptions >>
$1
echo
"=========================================================================="
>>
$1
echo
"根据进程号查看CPU使用率："
>>
$1
pidstat
-
p
$pid
>>
$1
echo
"=========================================================================="
>>
$1
echo
"查看内存使用情况："
>>
$1
free
-
h >>
$1
echo
"=========================================================================="
>>
$1
echo
"查看磁盘空间使用情况："
>>
$1
df
-
h >>
$1
echo
"=========================================================================="
>>
$1
echo
"系统核心参数设置情况："
>>
$1
sysctl
-
a
|
grep shm >>
$1
sysctl
-
a
|
grep sem >>
$1
echo
"=========================================================================="
>>
$1
echo
"查看JDK版本："
>>
$1
java
-
version 2>&1
echo
"=========================================================================="
|
tee
-
a
$1
java
-
version 2>&1
|
tee
-
a
$1
echo
"=========================================================================="
|
tee
-
a
$1
使用说明：
如脚本名为inspection.sh，赋执行权限
chmod +x inspection.sh
执行脚本需指定输出文件名和TongWeb安装目录
./inspection.sh test.log /test/TongWeb7.0.4.9_M1_Enterprise_Linux
查看生成的输出文件-巡检内容

关键字: TongWeb7企业版巡检脚本
文档来源: 
--------------------------------------------------------------------------------

问题编号: 029
问题: TongWeb7的-DuseLegacyCookieProcessor=true

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109568910

---

问题描述
：应用报异常如下：
java.lang.IllegalArgumentException: An invalid path [/;httponly] was specified for this cookie 。
at com.tongweb.web.util.http.
Rfc6265CookieProcessor
.validatePath(Rfc6265CookieProcessor.java:207)
at com.tongweb.web.util.http.Rfc6265CookieProcessor.generateHeader(Rfc6265CookieProcessor.java:132)
原因：
对cookie 新版本标准而言，不能直接使用逗号这种特殊符号作为cookie的内容， 例如：空格，方括号，圆括号，等于号（=），逗号，双引号，斜杠，问号，@符号，冒号，分号都不能作为Cookie的内容。
解决办法：
TongWeb7带了两个实现类，com.tongweb.web.util.http.Rfc6265CookieProcessor、   com.tongweb.web.util.http.LegacyCookieProcessor。
前者是基于 RFC6265 ，而后者基于 RFC6265 、 RFC2109 、 RFC2616 。
TongWeb7启动脚本中设置
-DuseLegacyCookieProcessor=true
则支持老的方式,解决该问题。

关键字: TongWeb7的-DuseLegacyCookieProcessor=true
文档来源: 
--------------------------------------------------------------------------------

问题编号: 030
问题: TongWeb7的JMX监控

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109506744

---

通过JMX监控TongWeb7有rmi和jmxmp两种方式
方式一：rmi方式
1. 先看TongWeb的server.log中JMX日志url，可通过该URL使用jconsole连接。
[2020-11-05 10:12:54 025] [INFO][URL for the Standard JMXConnectorServer : (
service:jmx:rmi:///jndi/rmi://192.168.163.1:7200/jmxrmi
)]
用户名：thanos 密码：thanos123.com  (不同版本还可能不同，具体请参考手册)
2. rmi协议只能绑定本机一个IP地址， 若TongWeb所在机器有多个IP，而server.log中绑定的不是需要的IP地址则连不上，同时若远程访问有防火墙，需要再增加以下配置：
(1) tongweb.xml中 127.0.0.1改为要绑定的本机实际IP地址 <jmx-service port="7200" address="127.0.0.1" protocol="rmi"/>
(2) 在startserver或external.vmoptions中增加 JMX绑定IP参数：
-Djava.rmi.server.hostname=要绑定本机实际IP
(3) TongWeb还会起两个随机端口，若有防火墙则增加两个参数固定端口，开放防火墙。
-Dtongweb.jconsole.cbport=5555
-Dtongweb.rmijmx.cbport=7777
(4) 配置完以上后，依旧用原URL格式连接： service:jmx:rmi:///jndi/rmi://192.168.163.1:7200/jmxrmi
3. 这样rmi其本质是固定住了7777端口，但客户端的连接不用指明7777端口，依旧用如上连接。 因为rmi的工作方式:客户端连接到rmiregistry上得到真实服务器的stub（如:rmi://192.168.163.1:7200），然后客户端再根据该stub连接到真实的服务器上（如:rmi://192.168.163.1:7777）。如果jmx服务端省略了rmi://192.168.163.1:7777部分，默认的通信端口是随机产生的。
[systemout] [tuserport:7777;jcport:5555]
[admin] [URL for the Standard JMXConnectorServer : (service:jmx:rmi://
192.168.163.1:7777
/jndi/rmi://192.168.163.1:7200/jmxrmi)]
老TongWeb6版本还隐藏了另 一个JMX连接： service:jmx:rmi://
192.168.163.1:5555
/jndi/rmi://192.168.163.1:7200/internal,   不再多做介绍，所以-Dtongweb.jconsole.cbport在最新版本上是无用的。
4. 为了减少端口占用，还可以相同全为7200。
-Dtongweb.jconsole.cbport=7200
-Dtongweb.rmijmx.cbport=7200
service:jmx:rmi://
192.168.163.1:7200
/jndi/rmi://192.168.163.1:7200/jmxrmi
TongWeb7.0.4.6及之后版本只有7200端口。
方式二：jmxmp方式
若有网络映射，通过远程连接JMX的地址不是TongWeb的地址，则rmi方式中-Djava.rmi.server.hostname要绑定的不是TongWeb本机实际IP，而是客户端要远程连接的IP。说起来绕口，配起来麻烦。一种简单的方式就是改用jmxmp方式：
1.  tongweb.xml中 rmi改为 mp <jmx-service port="7200" address="127.0.0.1" protocol="
mp
"/>
日志中JMX地址为：
service:jmx:jmxmp://192.168.163.1:7200
jmxmp协议TongWeb本机所有IP均可访问，不需-Djava.rmi.server.hostname固定IP，没有随机端口。DXP即采用的这种。
2. 客户端JMX 代码连接依赖   jmxremote_optional-*.jar，把该jar放在JDK的类路径 \jre\lib\ext上才能用jconsole连接，放在应用的CLASSPATH上才能用代码访问。
3. TongWeb增加参数 -Djmxmp.authenticator=false 关验证。
参考：
jmx rmi 穿越防火墙问题及jmxmp的替代方案_yangyan19870319的专栏-CSDN博客
最后若想关闭TongWeb的JMX怎么办?
tongweb.xml中enabled设为false   <jmx-service port="7200" address="127.0.0.1" protocol="rmi"
enabled="false"
/>

关键字: TongWeb7的JMX监控
文档来源: 
--------------------------------------------------------------------------------

问题编号: 031
问题: TongWeb7的JNDI配置

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/122539481

---

Java命名和目录接口（Java Naming and Directory Interface，JNDI）是用于从Java应用中访问名称 和目录服务的一组API。
从其它应用服务器移植涉及到JNDI资源的配置的变更，这些配置常在spring中配置。常用到JNDI的地方：数据源、事务、EJB。
场景一：数据源的JNDI配置
#jndi.properties, weblogic的JNDI配置为例

jndiName=jdbc/testdb
jndiUrl=t3://192.168.1.10:7001
jndiInitial=weblogic.jndi.WLInitialContextFactory
#spring applicationContext.xml

<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
   <property name="jndiName">
		<value>${jndiName}</value>
   </property>
   <property name="jndiEnviroment">
	 <props>
		 <prop key="java.naming.provider.url">${jndiUrl}</prop>
		 <prop key="java.naming.factory.initial">${jndiInitial}</prop>
	 </props>
	</property>
</bean>
如上为weblogic上的数据源配置,若迁移到TongWeb上有两种解决方式
方式一：直接去掉jndiEnviroment 采用TongWeb默认JNDI, applicationContext.xml改为如下
<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
   <property name="jndiName">
		<value>${jndiName}</value>
   </property>
</bean>
注意：通常在同一JVM进程内调用数据源不需要写JNDI上下文。
方式二：若某些配置情况下无法删除jndiEnviroment, 则写明TongWeb的JNDI。如下：
#jndi.properties

jndiName=jdbc/testdb
jndiUrl=http://192.168.1.10:5100/ejbserver/ejb
jndiInitial=com.tongweb.naming.java.javaURLContextFactory

applicationContext.xml配置不变
场景二：事务的JNDI配置
#weblogic配置
<bean id="txManager" class="org.springframework.transaction.jta.WebLogicJtaTransactionManager">
   <property name="userTransactionName"  value="weblogic/transaction/UserTransaction">
   </property>
</bean>
#spring没有针对TongWeb的事务bean类，所以用JtaTransactionManager
<bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager">
  <property name="userTransactionName" value="java:comp/UserTransaction" />
  <property name="transactionManagerName" value="tongweb:/TransactionManager"/>
</bean>
注意：TongWeb不同版本的事务JNDI名可能不同，具体看对应版本的手册。
场景三：EJB远程调用
EJB本地调用也不需要指明JNDI上下文，只有EJB服务端与EJB客户端不在同一JVM中，需要远程调用时指明JNDI，其EJB客户端代码如下：
Properties props = new Properties();
props.setProperty("java.naming.factory.initial","com.tongweb.tongejb.client.RemoteInitialContextFactory");
props.setProperty("java.naming.provider.url", "http://192.168.0.11:5100/ejbserver/ejb");
Context jndiContext = new InitialContext(props);
HelloHome home = (HelloHome)jndiContext.lookup("myHello");

#还可以以EJB服务端集群方式使用
Properties props = new Properties();
props.setProperty("java.naming.factory.initial","com.tongweb.tongejb.client.RemoteInitialContextFactory");
props.setProperty("java.naming.provider.url", "http://192.168.0.11:5100/ejbserver/ejb?readTimeout=60000,http://192.168.0.12:5100/ejbserver/ejb?readTimeout=60000");
props.setProperty("remote.loadbalance", "random");
Context jndiContext = new InitialContext(props);
HelloHome home = (HelloHome)jndiContext.lookup("myHello");
说明：
#访问本地资源的初始化上下文环境属性
java.naming.factory.initial=com.tongweb.naming.java.javaURLContextFactory

#远程的InitialContext所需的环境属性配置如下。其中，<IP>需要修改为TongWeb所在的IP, <port>为EJB远程调用端口，默认是5100。
java.naming.factory.initial=com.tongweb.tongejb.client.RemoteInitialContextFactory
java.naming.provider.url=http://<ip>:<port>/ejbserver/ejb

关键字: TongWeb7的JNDI配置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 032
问题: TongWeb7的JPA、validation异常

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109503498

---

TongWeb7的JPA、validation异常：
(1)
javax.validation
.spi.ConfigurationState.getValueExtractors()Ljava/util/Set;
(2) [FAIL ... : Missing required
persistence.xml
for @PersistenceContext ref "em" to unit ""]
(3) 找不到javax.persistence.或 javax.validation里的类或方法
原因
通常是TongWeb自带validation，JPA与应用冲突。
只要看到如上异常, 解决办法：
方法一：TongWeb7.0.2.5及之前版本，需要将TongWeb的lib下
validation-api.jar、persistence-api.jar里的javax.persistence.*目录删除，把应用的validation jar ，JPA jar放在TongWeb的lib下
.
方法二：TongWeb7.0.3.0及之后版本,将bin目录下external.vmoptions中的
-DWebModuleOnly=false
设为true则屏蔽TongWeb自带validation 、JPA、CDI、EJB、mail。

关键字: TongWeb7的JPA、validation异常
文档来源: 
--------------------------------------------------------------------------------

问题编号: 033
问题: TongWeb7防SDOS攻击和HOST头攻击

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109553849

---

一、防SDOS攻击
所谓的慢攻击就是相对于DDOS的快而言的，并不是只有量大速度快才能把服务器搞挂，使用慢攻击有时候也能到达同一效果。比如：在POST提交方式中，允许在HTTP的头中声明content-length，也就是POST内容的长度。 在提交了头以后，将后面的body部分卡住不发送，这时服务器在接受了POST长度以后，就会等待客户端发送POST的内容，攻击者保持连接并且以10S-100S一个字节的速度去发送，就达到了消耗资源的效果，因此不断地增加这样的链接，就会使得服务器的资源被消耗。
TongWeb7版本配置防SDOS攻击方式如下，
注意配置参数合理，若配置过小，则可能拦截正常请求。若配置过大，则可能无法起到防攻击效果。
属性名称
对应tongweb.xml 配置属性
属性说明
完整请求时间
complete.message.timeout.seconds
完整请求时间，通过配置完整请求时间来判断是否为慢攻击,时间单位为秒,如果配置值大于 0，则认为开启慢攻击检测，默认值为 0，关闭慢攻击检测。
慢攻击容忍次数
max.attack.times
慢攻击容忍次数，为防止处理掉正常请求，支持配置容忍次数，同一个 IP 地址超过配置数，则加入黑名单，默认配置为 3
黑名单移除时间
blacklist.expired.hours
黑名单移除时间，通过配置时间来清除已经加入到黑名单中的 IP 地址，时间单位为小时，默认配置为 12 小时
中断当前连接
interrupt.current.connect
中断当前连接，布尔类型，配置为 true 表示如果当前发送消息的连接处于黑名单中，则中断，默认配置为 true
早期TongWeb的版本是通过四个-D参数来配置的，加在启动参数中如下：
参数名称
参数说明
-DcontentLength.limit
设置 POST 请求中的 content length 限制(单位：字节)，避免一直占住这个连接不断开，一般针对 POST 请求的攻击，默认值为Integer 的 最 大 值 ， 例 如-DcontentLength.limit=10000。
-Dread.http.header.timeout
读一个字节耗费的毫秒数(单位：毫秒/字节)，超过或等于这个速率算超时，默认值为 Long 的 最 大 值 ， 例 如 : -Dread.http.header.timeout=500。与-DcontentLength.limit参数配合使用。
-Dread.http.header.timeout.limit
请求头读取超时次数，超过次数将其列入黑名单，开始拒绝请求(连接)，默认值为 Integer 的 最 大 值 ， 例 如 ：
-Dread.http.header.timeout.limit=3。与-Dread.http.header.timeout 配合使用。
-Dblacklist.expired
对清理黑名单解锁时间进行设置，默认值为 12 （单 位： 小时 ），例 如 ：-Dblacklist.expired=1。与-Dread.http.header.timeout.limit 配合使用。
不适用的场景：对于前端有负载设备的场景，该配置不适合配置在TongWeb上，因为拦截的是负载设备的IP。
二、防HOST头攻击
HTTP规范中在增加了HOST头信息，用于存储服务端与客户端的路由信息。
如果前端或者后台正好用到这个值，比如jsp的String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort();那么黑客就可以通过修改HOST里域名值以达到攻击的目的。比如request.getServerName()改成：www.abc.com，这样页面内引用后请求就会被转接了。
防 Host 头攻击：开启或关闭防 Host 头攻击，开启时，需要配置正确的主机名白名单，若HOST头与配置中的值不对应则请求会被拦截。

关键字: TongWeb7防SDOS攻击和HOST头攻击
文档来源: 
--------------------------------------------------------------------------------

问题编号: 034
问题: TongWeb8 专用机使用指导

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/133122117

---

前言
专用机要求软件以deb、rpm安装包形式提供，通过三合一安全管理工具进行安装，否则软件的可执行程序无法运行，所以TongWeb6、7版本的专用机版本遵循此原则。
TongWeb8安装使用方式
TongWeb8除可以提供deb、rpm安装包形式外，还支持以解压安装方式运行，因为TongWeb8可以不依赖启动脚本运行。步骤如下：
1. 直接通过ftp上传TongWeb8安装包，
tar -zxvf TongWeb.x.x.x.x.tar.gz 解压在某一用户目录下，并放入license.dat文件。
2. bin下启、停命令脚本是无权限运行的，这时可以通过java命令运行TongWeb。
#TongWeb8.0.6.2及之前版本需要先执行下环境变量, 之后版本不再需要
export tongweb_home=/opt/tongweb
#TongWeb启动
java -jar /opt/tongweb/bin/tongweb-launcher.jar server start domain1
#TongWeb停止
java -jar /opt/tongweb/bin/tongweb-launcher.jar server stop domain1
3. 若每次输入命令过长，可将该启、停命令写入shell脚本，该shell脚本无可执行权限，但可以以source命令运行。如：
source ./starttw.sh
starttw.sh 文件内容如：
#需要的环境变量，启动命令
export tongweb_home=/opt/tongweb
ulimit -n 65536 >/dev/null 2>&1
nohup  java -jar /opt/tongweb/bin/tongweb-launcher.jar server start domain1  &

关键字: TongWeb8 专用机使用指导
文档来源: 
--------------------------------------------------------------------------------

问题编号: 035
问题: TongWeb8 应用慢线程检测

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/129027674

---

应用场景：
在应用运行过程中，难免会有一些线程因等待锁、阻塞导致执行时间慢。这时可以开启TongWeb8的"慢线程检测"功能来排查问题。
当http线程超过"阻塞阈值"时，则日志输出相应线程堆栈。 通过大量收集该日志样本，以判断线程慢的原因。
注：仅收集一、两个该日志，不能说明线程慢在该处。
2023-02-14 15:29:53 [WARN] - Thread [TW-0.0.0.0-8088-1] (id=[61])
has been active for [20,131] milliseconds
(since [2/14/23 3:29 PM]) to serve the same request for [
http://192.168.55.159:8088/webtest01/TestServlet]
and may be stuck (
configured threshold for this StuckThreadDetectionValve is [20] seconds
). There is/are [1] thread(s) in total that are monitored by this Valve and may be stuck. java.lang.Throwable
at java.lang.Thread.sleep(Native Method)
at com.tong.TestServlet.doGet(TestServlet.java:41)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:503)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:590)
at com.tongweb.server.core.ApplicationFilterChain.enterApp(ApplicationFilterChain.java:365)
"中断阈值" 通常不建议开启，因为实际应用场景中线程有业务相关逻辑，中断线程可能造成业务的不完整。 若能确保中断线程无问题，则可开启。相关日志如下：
2023-02-14 15:29:59 [WARN] - Thread [TW-0.0.0.0-8088-1] (id=[61])
has been interrupted because it was active for [26,177] milliseconds
(since [2/14/23 3:29 PM]) to serve the same request for [
http://192.168.55.159:8088/webtest01/TestServlet]
and was probably stuck (configured interruption threshold for this StuckThreadDetectionValve is [25] seconds). java.lang.Throwable
at java.lang.Thread.sleep(Native Method)
at com.tong.TestServlet.doGet(TestServlet.java:41)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:503)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:590)
at com.tongweb.server.core.ApplicationFilterChain.enterApp(ApplicationFilterChain.java:365)
。。。。。。。
2023-02-14 15:30:01 [WARN] - Thread [TW-0.0.0.0-8088-1] (id=[61])
was previously reported to be stuck but has completed. It was active for approximately [26,177] milliseconds.
"中断阈值"只中断TongWeb的http线程，若应用自建线程出现阻塞，可通过"监视管理"->"阻塞线程"查看，该功能为监控的JVM所有线程。"强停"功能同样谨慎使用。
重点说明：当遇到线程阻塞类问题时，主要通过TongWeb提供的线程堆栈来分析问题，从应用侧来解决。对于"中断阈值", "阻塞线程"的"强停"功能需谨慎使用。
若http通道的线程和队列占满则报错如下：
2023-02-24 13:58:57.963 [WARN] [TW-0.0.0.0-8088-ClientPoller] [com.tongweb.web.util.threads] - Executor rejected socket [
com.tongweb.web.util.net
.NioEndpoint$NioSocketWrapper@fa310e2:
com.tongweb.web.util.net
2023-02-24 13:58:57.963 [WARN] [TW-0.0.0.0-8088-ClientPoller] [com.tongweb.web.util.threads] - Executor rejected socket [com.tongweb.web.util.net.NioEndpoint$NioSocketWrapper@fa310e2:com.tongweb.web.util.net.NioChannel@12bd59a6:java.nio.channels.SocketChannel[connected local=/127.0.0.1:8088 remote=/127.0.0.1:64068]] for
processing java.util.concurrent.RejectedExecutionException: Queue capacity is full
at com.tongweb.web.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:138)
at com.tongweb.web.util.threads.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:109)
at
com.tongweb.web.util.net
at com.tongweb.web.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:938)
at
com.tongweb.web.util.net
at com.tongweb.web.util.net.NioEndpoint$Poller.processKey(NioEndpoint.java:1366)
at
com.tongweb.web.util.net
.NioEndpoint$Poller.run(NioEndpoint.java:1338)
at java.lang.Thread.run(Thread.java:750)

关键字: TongWeb8 应用慢线程检测
文档来源: 
--------------------------------------------------------------------------------

问题编号: 036
问题: TongWeb8 脚本录制功能

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/138854414

---

内容抓取失败：521 Server Error:  for url: https://blog.csdn.net/realwangpu/article/details/138854414

关键字: TongWeb8 脚本录制功能
文档来源: 
--------------------------------------------------------------------------------

问题编号: 037
问题: TongWeb8 错误码查询方法及说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/144113497

---

TongWeb8可通
过
./admin.[bat|sh] error-code [Error Code]
命令查
找错误码
说
明。
如：./admin.sh error-code  显示所有错误码说明。
./admin.sh error-code  008  显示008错误码的说明。
Execute the command: error-code
****** TongWeb ErrorCode Info ******
000:
%s
%s
%s
001:
部署应用的名称或ID冲突，例如EJB应用的名字已被其它应用占用
部署應用的名稱或ID沖突，例如EJB應用的名字已被其它應用占用
The name or ID of the deployed application conflicts, for example, the name of the EJB application is already occupied by another application
002:
请检查实例或集群状态
請檢查實例或集群狀態
Please check instance or cluster status
003:
未找到所需要的文件或文件访问权限受限：%s
未找到所需要的文件或文件訪問權限受限：%s
The required file not found or file access restricted: %s
004:
启用JTA支持，要求驱动类型为XA类型，您也可以配置JTA事务允许非XA事务分支
啟用JTA支持，要求驅動類型為XA類型，您也可以配置JTA事務允許非XA事務分支
To enable JTA support, the driver type is required to be XA type, you can also configure JTA transactions to allow non-XA transaction branches
005:
使用指定的驱动和URL无法连接到数据库
使用指定的驅動和URL無法連接到數據庫
Cannot connect to the database using the specified driver and URL
006:
指定的目录或文件没有创建成功
指定的目錄或文件沒有創建成功
The specified directory or file was not created successfully
007:
PersistenceUnit需要JTA支持，但没有定义支持JTA的数据源
PersistenceUnit需要JTA支持，但沒有定義支持JTA的數據源
PersistenceUnit requires JTA support, but no data source is defined to support JTA
008:
数据库驱动类加载失败，请确保已经正确配置了数据库 JDBC 驱动包
數據庫驅動類加載失敗，請確保已經正確配置了數據庫 JDBC 驅動包
The database driver class failed to load, please ensure that the database JDBC driver package has been configured correctly
009:
文件须是 *.zip 类型的
文件須是 *.zip 類型的
The file must be *.zip type
010:
服务器正在启动中或相关服务尚未就绪，请稍后重试
服務器正在啟動中或相關服務尚未就緒，請稍後重試
The server is starting or related services are not ready, please try again later
011:
无法加载 servlet 类：%s
無法加載 servlet 類：%s
Unable to load servlet class:%s
012:
没有这样的方法，类型：%s，操作：%s
沒有這樣的方法，類型：%s，操作：%s
No such method, type: %s , operation: %s
013:
数据源资源 (%s) 未找到且未成功自动创建
數據源資源 (%s) 未找到且未成功自動創建
DataSource Resource(%s) not found and not automatically created successfully
014:
请检查端口 [%s] 是否正确
請檢查端口 [%s] 是否正確
Please check if the port [%s] is correct
015:
远程服务器[%s:%s]请求错误：%s。 请查看日志以获取详细信息
遠程服務器[%s:%s]請求錯誤：%s。 請查看日誌以獲取詳細信息
Remote server [%s:%s] request error: %s. Please check the logs for details
016:
配置文件[%s]没有找到
配置文件[%s]沒有找到
Configuration file [%s] not found
017:
尝试指定应用程序附带的 JSF 实现的使用
嘗試指定應用程序附帶的 JSF 實現的使用
Try to specify the use of the JSF implementation that comes with the application
018:
无法正常识别应用类型，请检查要部署的应用文件是否合法
無法正常識別應用類型，請檢查要部署的應用文件是否合法
The app type cannot be recognized properly, so check whether the app file to be deployed is legitimate
019:
部署的应用程序名称不支持包含特殊字符，例如#: %s
部署的應用程序名稱不支持包含特殊字符，例如#: %s
The name of the deployed application cannot contain special characters such as #: %s
020:
找不到应用备份
找不到應用備份
App backup not found
021:
应用程序增量更新文件必须是 *.zip 类型
應用程序增量更新文件必須是 *.zip 類型
The application incremental update file must be of the *.zip type
022:
不支持删除系统预置的通道：%s
不支持刪除系統預置的通道：%s
Cannot delete a system managed connector: %s
023:
不支持停止系统预置的通道：%s
不支持停止系統預置的通道：%s
You cannot stop the system managed connector: %s
024:
不支持删除系统预置的虚拟主机
不支持刪除系統預置的虛擬主機
Deleting a system managed virtual host is not supported
025:
该实例已加入集群[%s]，不支持此操作
該實例已加入集群[%s]，不支持此操作
The instance is already joined to a cluster [%s] and does not support this operation
026:
SSH身份验证失败，请检查用户名、密码或密钥是否正确
SSH身份驗證失敗，請檢查用戶名、密碼或密鑰是否正確
SSH authentication failed, please check if the username, password or secret key is correct
027:
SSH获取执行结果超时，请检查执行状态或重试
SSH獲取執行結果超時，請檢查執行狀態或重試
SSH timed out to get the execution result, please check the execution status or try again
028:
SSH获取执行发生未知异常，请查看日志详情
SSH獲取執行發生未知異常，請查看日誌詳情
An unknown exception occurred during SSH fetch execution, please check the log details
029:
安全域连接异常，请检查连接信息
安全域連接異常，請檢查連接信息
Realm connection is abnormal, please check the connection information
030:
当前服务器正在运行中，不支持此操作，请停止后重试
當前服務器正在運行中，不支持此操作，請停止後重試
The current server is running, this operation is not supported, please stop and try again
031:
不支持构建的版本类型[ %s ]
不支持構建的版本類型[ %s ]
Version types [ %s ] not supported for builds
032:
证书密码不正确
證書密碼不正確
KeyStore password was incorrect
033:
不是一个有效的升级文件
不是一個有效的升級文件
Not a valid upgrade file
034:
该版本正在被域 [ %s ] 使用，不可进行更新、删除等操作
該版本正在被域 [ %s ] 使用，不可進行更新、刪除等操作
This version is being used by domain [ %s ] and cannot be updated, deleted, etc
035:
实例[%s]获取remotekey失败，请检查remotekey配置
實例[%s]獲取remotekey失敗，請檢查remotekey配置
Instance [%s] failed to obtain the remotekey, please check the remote configuration
036:
名称[%s]已被使用，如列表中没有，请检查节点的domains目录下是否已存在同名文件夹
名稱[%s]已被使用，如列表中沒有，請檢查節點的domains目錄下是否已存在同名文件夾
The name [%s] has already been used, if not in the list, please check whether a folder with the same name already exists in the domains directory of the node
037:
应用端口[%s]已被使用
應用端口[%s]已被使用
App port [%s] is used
038:
管理端口[%s]已被使用
管理端口[%s]已被使用
Manage port [%s] is used
039:
不支持
不支持
Not supported
040:
请检查节点[%s]是否启动或管理端口[%s]是否配置正确
請檢查節點[%s]是否啟動或管理端口[%s]是否配置正確
Please check if node [%s] is started or if management port [%s] are configured correctly
041:
未找到节点[%s]
未找到節點[%s]
Node [%s] not found
042:
轻量模式下不支持部署 *.jar(ejb) *.ear *.rar 类型的应用，请选择 *.war 类型的应用文件
輕量模式下不支持部署 *.jar(ejb) *.ear *.rar 類型的應用，請選擇 *.war 類型的應用文件
Deploying *.jar(ejb) *.ear *.rar type apps is not supported in lightweight mode, please select an application file of *.war type
043:
文件权限不足:%s
文件權限不足:%s
File permission denied:%s
044:
端口[%s]已被使用
端口[%s]已被使用
Port [%s] is used
045:
须是一个合法的目录
須是一個合法的目錄
Must be a legal directory
046:
无法创建符号链接，可能是因为缺少必要的权限
無法創建符號鏈接，可能是因為缺少必要的權限
Failed to create symbolic link, possibly because the necessary permissions are missing
047:
该类型的版本已存在，无需再次生成
該類型的版本已存在，無需再次生成
A version of the type already exists and does not need to be built again
048:
已经存在相同名称的应用
已經存在相同名稱的應用
A application with the same name already exists
049:
转换为TongWeb应用时发生异常，应用部署失败
轉換為TongWeb應用時發生異常，應用部署失敗
An exception occurred while converting to TongWeb app. The app deployment failed
050:
类 %s 未找到
類 %s 未找到
Class %s not found
051:
公钥参数错误
公鑰參數錯誤
The public key parameter is incorrect
052:
admin 通道重启中，请稍后再试
admin 通道重啟中，請稍後再試
The admin connector is restarting, please try again later
053:
Redis身份验证失败，请检查用户名、密码是否正确
Redis身份驗證失敗，請檢查用戶名、密碼是否正確
Redis authentication failed, please check if the username, password  is correct
054:
Redis连接异常，请检查redis服务是否启动或者网络是否能够连接
Redis連接異常，請檢查redis服務是否啟動或者網路是否能夠連接
If the Redis connection is abnormal, check whether the Redis service is enabled or whether the network can be connected
055:
OSGi 服务异常
OSGi 服務異常
The OSGi service is abnormal
056:
OSGi 服务未启动
OSGi 服務未啟動
The OSGi service did not start
057:
文件须是 *.jar 类型的
文件須是 *.jar 類型的
The file must be *.jar type
058:
服务器未安装docker环境，版本生成失败
服務器未安裝docker環境，版本生成失敗
The server does not have the docker environment installed, and the version generation fails
059:
构建docker镜像超时或出错，详情请查看日志
構建docker鏡像超時或出錯，詳情請查看日誌
If the Docker image is built with a timeout or error, see the log for details
060:
不被信任的文件：%s
不被信任的文件：%s
Untrusted file: %s
061:
连接注册中心失败，原因：%s
連接注冊中心失敗，原因：%s
Failed to connect to the registry for reason: %s

关键字: TongWeb8 错误码查询方法及说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 038
问题: TongWeb8-TongWeb密码重置

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/147063630

---

将TongWeb目录/domains/domain1/conf/console.xml中以下标签删除
TongWeb目录/domains/domain1/conf/console.xml中,重新添加以下标签
重新启动TongWeb8
执行以下命令重新对密码进行修改即可。
./commandstool.sh --model=password --action=update --username=thanos --password=thanos123.com --acceptAgreement=true originalPassword=thanos123.com newPassword=wang135.COM confirmPassword=wang135.COM

关键字: TongWeb8-TongWeb密码重置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 039
问题: TongWeb8.0 版本及license更新提醒

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/143872626

---

一、TongWeb8.0安装包
1. TongWeb8.0提供通用安装包，并通过license来控制版本为企业版、标准版、教学版、轻量版、容器云版。不同版本功能不同，详见手册。
2. 默认TongWeb8.0支持javax命令空间应用，若需要支持Jakarta EE9及以上规范的应用，或需要安装体积更小的轻量版，则可以利用版本生成功能生成相应安装包。
3. 关于版本说明：
(1) TongWeb8.0与TongWeb7.0.8均为TongWeb8.0版本，因为有名录要求所以同步发布TongWeb7.0.8版本。
(2) TongWeb8.0与TongWeb7.0.8均需要TongWeb8.0的license， TongWeb7.0.4版本的license无法用于TongWeb8.0与TongWeb7.0.8上。
(3) 版本号命名对应规则：TongWeb8.0.a.b等于TongWeb7.0.8.ab，如:TongWeb8.0.7.2对应的版本是TongWeb7.0.8.72。
二、关于license更新
对于大规模使用的场景，有通过license server方式统一授权更新，有通过注册中心批量更新，见：
TongWeb8.0注册中心的使用示例-批量更新license_tongweb license-CSDN博客
这里我们说明下常用的license更新方式。
方式一：
将license.dat文件放入TongWeb8.0安装根目录下，重启TongWeb完成更新。
方式二：
通过控制台更新license。
三、license到期提醒
临时license在到期前提供多种提醒方式，
若在到期后仍不更新license，则TongWeb默认会在早上6点自动停止。
提醒方式一：东方通公司在用户license到期15天前，会通过预留给东方通的手机号和邮箱向用户发送提醒短信和邮件。
提醒方式二：TongWeb日志和控制台会有license到期提醒。
============================================================
^^^^^^^^^^^^^^^ TongWeb License Expiration Notice ^^^^^^^^^^^^^^^
The license will expire in 6 days. TongWeb will stop on 2024-12-06.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
============================================================
提醒方式三：用户自行在TongWeb上配置邮箱和短信提醒， 但需要确保TongWeb可以发邮件和短信。

关键字: TongWeb8.0 版本及license更新提醒
文档来源: 
--------------------------------------------------------------------------------

问题编号: 040
问题: TongWeb8.0.9.0.3部署后端应用，前端访问后端报405（by sy+lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/149194217

---

问题描述：
客户前端部署在nginx上，后端部署在tongweb8上（相当于前后端分离），登录的时候报错，f12看network，状态码405，如下所示：
看console，如下所示：
解决方案
Web容器 > 通道 > 目标通道 > HTTP属性，把需要支持的全选，点击 更新，配置立即生效（无需重启）。

关键字: TongWeb8.0.9.0.3部署后端应用，前端访问后端报405（by sy+lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 041
问题: TongWeb8.0注册中心的使用示例-批量更新license

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/136316638

---

简介：
TongWeb8.0
注册中
心
可用于注册和发
现
TongWeb
实例
服务，
也
可用于
存储
和
共
享 TongWeb 实例配置。
应用场景：
项目上安装多套TongWeb经常更改配置，传统方式下需要逐套更改配置，而通过注册中心管理变更其中任何一个实例，都将自动同步到其它实例。
以批量更新license为例进行说明:
1.  搭建注册中心环境如: TongNCS、Nacos、Etcd、 Zookeeper其一，本文以Nacos为例。
2.  安装TongWeb8.0, 并将Nacos的jar放入TongWeb的lib目录下。如下以Nacos 2.2.3 版本 jar 包清单为例说明：
• commons-codec-1.15.jar
• commons-logging-1.2.jar
• httpasyncclient-4.1.3.jar
• httpclient-4.5.3.jar
• httpcore-4.4.6.jar
• httpcore-nio-4.4.6.jar
• jackson-annotations-2.12.7.jar
• jackson-core-2.12.6.jar
• jackson-databind-2.12.7.1.jar
• nacos-auth-plugin-2.2.3.jar
• nacos-client-2.2.3.jar
• nacos-encryption-plugin-2.2.3.jar
• simpleclient_tracer_common-0.12.0.jar
• simpleclient_tracer_otel_agent-0.12.0.jar
• simpleclient_tracer_otel-0.12.0.jar
• simpleclient-0.12.0.jar
• slf4j-api-2.0.7.jar
• snakeyaml-2.jar
3. 每个TongWeb8.0配置注册中心地址、用户名、密码、标识符。
4. 每个TongWeb开启授权中心。
5. 以上配置完成后，测试更新效果。
(1) 准备新的license.dat文件。
(2) 进入某一 TongWeb 的 “集中管理” > “系统管理” > “产品授权” > “更新”，进入更新页面，在更新license时，开启“推送到授权中心”。
（3）检查其它TongWeb 节点license已更新。

关键字: TongWeb8.0注册中心的使用示例-批量更新license
文档来源: 
--------------------------------------------------------------------------------

问题编号: 042
问题: TongWeb8下应用忙碌线程监控

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/133127843

---

问题 ：
在系统运行过程中发现TongWeb进程占用CPU过高，需要分析是应用哪里引起的问题。
分析过程(仅限Linux环境)：
1.  通过top命令查看TongWeb的java进程占用的CPU情况。
查看误区：不要以为java进程CPU占到398%就是高，若服务器为8核，则CPU占用满显示为800%。
[root@localhost bin]# top
top - 10:45:58 up  1:19,  1 user,  load average: 3.65, 1.56, 0.68
Tasks: 171 total,   2 running, 169 sleeping,   0 stopped,   0 zombie
%Cpu(s): 38.7 us,  1.0 sy,  0.0 ni,  60.0 id,  0.0 wa,  0.0 hi,  0.3 si,  0.0 st
KiB Mem :  1863220 total,    73452 free,  1352208 used,   437560 buff/cache
KiB Swap:  2097148 total,  2095604 free,     1544 used.   214164 avail Mem

   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
 13382 root      20   0 4235564 834012  17716 S 398.0 44.8   2:52.53 java
 14871 root      39  19  108036   1032    744 R  1.3  0.1   0:00.92 updatedb
  7153 root      20   0  483536  34056   7660 S  0.3  1.8   0:12.50 containerd
 14491 root      20   0  162036   2356   1604 R  0.3  0.1   0:00.11 top
     1 root      20   0  133892   3892   2344 S  0.0  0.2   0:01.70 systemd
     2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd
     3 root      20   0       0      0      0 S  0.0  0.0   0:00.15 ksoftirqd/0
     5 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:0H
     7 root      rt   0       0      0      0 S  0.0  0.0   0:00.00 migration/0
2. 进入TongWeb8控制台查看忙碌线程，查看占用CPU高的线程栈所执行的操作。
3. 若服务器CPU很忙，已经无法打开TongWeb控制台，则可以用./admin.sh busy-thread  [pid]  [线程数]  命令查看。
[root@localhost bin]# ./admin.sh busy-thread  13382  200
Execute the command: busy-thread
[1] Busy(48.3%) thread(14214/0x3786) stack of java process(13382):
"TW-0.0.0.0-8088-16" #200 daemon prio=5 os_prio=0 tid=0x00007ff508459800 nid=0x3786 runnable [0x00007ff5148e6000]
   java.lang.Thread.State: RUNNABLE
        at com.tong.TestServlet.doGet(TestServlet.java:52)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:503)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:590)
        at com.tongweb.server.core.ApplicationFilterChain.enterApp(ApplicationFilterChain.java:366)
        at com.tongweb.server.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:236)
        at com.tongweb.server.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)
        at com.tongweb.web.websocket.server.WsFilter.doFilter(WsFilter.java:32)
        at com.tongweb.server.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:197)
        at com.tongweb.server.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)
        at com.tongweb.server.core.StandardWrapperValve.invoke(StandardWrapperValve.java:146)
        at com.tongweb.server.core.StandardContextValve.invoke(StandardContextValve.java:78)
        at com.tongweb.ee.server.OpenEJBValve.invoke(OpenEJBValve.java:29)

关键字: TongWeb8下应用忙碌线程监控
文档来源: 
--------------------------------------------------------------------------------

问题编号: 043
问题: TongWeb8中应用常见异常

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/129199953

---

问题一：cookie异常字符报错如下
2022-06-14 11:07:31 [WARN] - java.lang.IllegalArgumentException:
An invalid domain [.test.com] was specified for this cookie
2022-06-14 11:07:31 [WARN] -    at com.tongweb.web.util.http.Rfc6265CookieProcessor.validateDomain(Rfc6265CookieProcessor.java:202)
2022-06-14 11:07:31 [WARN] -    at com.tongweb.web.util.http.Rfc6265CookieProcessor.generateHeader(Rfc6265CookieProcessor.java:137)
2022-06-14 11:07:31 [WARN] -    at com.tongweb.server.connector.Response.generateCookieString(Response.java:960)
解决办法：
应用配置中开启 "使用老版 Cookie 处理器"
问题二：url中有非法字符报错如下
2022-06-14 10:16:24 [INFO] - Error parsing HTTP request header
Note: further occurrences of HTTP request parsing errors will be logged at DEBUG level. java.lang.IllegalArgumentException:
Invalid character found in the request target
[/dbpool/?aa=|ddd]].
The valid characters are defined in RFC 7230 and RFC 3986
at com.tongweb.coyote.http11.Http11InputBuffer.parseRequestLine(Http11InputBuffer.java:470)
at com.tongweb.coyote.http11.Http11Processor.service(Http11Processor.java:212)
解决办法：
http
通道中 “路径中允许使用的未编码字符” “参数中允许使用的未编码字符” 配
" < > [ \ ] ^ ` { | }
问题三：JSP编译报错如下
2022-06-14 11:24:55 [WARN] - com.tongweb.jasper.JasperException: /index2.jsp (line: [11], column: [45]) Attribute value [String.valueOf("aa")] is
quoted with ["] which must be escaped when used within the value
2022-06-14 11:24:55 [WARN] -    at com.tongweb.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:26)
2022-06-14 11:24:55 [WARN] -    at com.tongweb.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:276)
解决办法：
应用部署的“Strict Quote Escaping ” 关闭即可。
问题四：应用部署缓存不足警告
2022-06-14 12:16:39 [WARN] - Unable to add the resource at [/WEB-INF/classes/org/oasis_open/docs/wsrf/rp_2/jaxb.properties] to the cache for web application [cxf]
because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache
2022-06-14 12:16:39 [WARN] - Unable to add the resource at [/WEB-INF/classes/org/oasis_open/docs/wsrf/rp_2/jaxb.properties] to the cache for web application [cxf] because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache
解决办法：
应用部署增大 “
最大缓存大小”， 通常大于应用所有jar的大小，通过应用监控缓存使用情况。
够不够用，看资源缓存量。
典型的毛病：99999999, 拼命调大
。
问题五：
WebService处理异常
Caused by: org.xml.sax.SAXParseException: 文件提前结束。
at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:262)
at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:339)
at
com.tongweb.ws.commons.schema
.XmlSchemaCollection$2.run(XmlSchemaCollection.java:651)
at com.tongweb.ws.commons.schema.XmlSchemaCollection$2.run(XmlSchemaCollection.java:649)
at java.security.AccessController.doPrivileged(Native Method)
at com.tongweb.ws.commons.schema.XmlSchemaCollection.parseDoPriv(XmlSchemaCollection.java:649)
at com.tongweb.ws.commons.schema.XmlSchemaCollection.read(XmlSchemaCollection.java:618)
... 64 more
解决办法：
从异常看TongWeb的WebService参与了应用的xml处理，在部署应用时勾选加载应用的“webservice” 或"web兼容"即可。
问题六：与应用类冲突
Caused by: java.lang.AbstractMethodError: javax.ws.rs.core.UriBuilder.uri(Ljava/lang/String;)Ljavax/ws/rs/core/UriBuilder;
at javax.ws.rs.core.UriBuilder.fromUri(UriBuilder.java:96)
at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:669)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:590)
解决办法：
在开启”web兼容模式“的情况下依旧加载tongweb-jee-api.jar中的类，可以设置”强制从应用加载的类“来解决。
问题七：通过request.getServletContext().getContext("/app")获取另一应用上下文为空
解决办法：
开启"跨应用支持"
问题八：JSP编译报错如下：
JasperException: /index.jsp (line: [1], column: [84]) The JSP specification requires that an attribute name is preceded by whitespace
解决办法：
增加-D参数：-Dcom.tongweb.jasper.compiler.Parser.STRICT_WHITESPACE=false
TongWeb8.0.8.0上增加了界面配置

关键字: TongWeb8中应用常见异常
文档来源: 
--------------------------------------------------------------------------------

问题编号: 044
问题: TongWeb8交流常见问答集

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/135836755

---

问题1：
今后用到你们TongWeb产品该联系谁？
答复：
1. 商务问题，如：报价、license授权、合同等请联系销售。
2. TongWeb技术问题，未签项目联系售前，已签项目联系售后。有指定项目经理的项目，联系项目经理再安排。TongWeb作为主力产品，基本问题的解答售前和售后都能掌握。
3. 公司客服:400-650-7088，商务和未签项目转1、已签项目技术支持转2，当微信联系无回应时，记得拨打手机。
最错误的方式：
1.让销售给用户提供产品安装包，有的技术人员都分不清安装包，销售当然也分不清。
2.找销售问技术问题。
3.找支持问商务、报价事情。
问题2：
用户问TongWeb是否支持xx技术，xx框架？转头就问其他技术人员。
答复：
1. 首先要问清xx的全称是什么，指的是哪个具体技术或框架。
2. 查询相关官网，查看其具体技术指标。
3. 判断其与TongWeb相关性，如：是否是Java开发？是否提供Java接口？是否与Java EE技术相关？
问题3：
我们的应用是采用Sping Boot框架开发的，是要用的你们TongWeb的嵌入版做替换么?
答复：
Spring Boot有jar与war两种部署运行方式， jar包部署方式需要TongWeb嵌入版；war包方式可以使用企业版、容器版运行，特殊情况war包也可以用TongWeb嵌入版。具体还要看用户的运维、监控TongWeb方式。
问题4：
你们TongWeb的产品性能如何，能支持多少并发?
答复：
整个应用系统的性能取决于软/硬件的配置，硬件如：CPU、内存、网络带宽。软件如：操作系统、中间件、数据库、 应用系统 。评估一个应用系统的性能指标取决于软/硬件的综合能力，并不能在无任何前置条件的情况下，评估出TongWeb的并发能力。
另外TongWeb可以提供一些内部和项目上性能报告供参考。
问题5：
我们的程序是PHP开发的，可以部署在TongWeb上吗?
答复：
虽然TongWeb也可以通过CGI方式支持PHP ，但建议采用东方通TongHttpServer(简称THS)产品。
问题6:
TongWeb是否能支持.NET Core?
答复：
.NET Core是微软的开发框架，与Java是两种不同开发语言。其运行不需要JavaEE应用服务器。
问题7：
TongWeb可以与短信、邮件、企业微信进行对接吗？
答复：
可以，但通常TongWeb部署在内网环境下，需要网络连通的情况下才可以。
问题8：
TongWeb8产品版本是否向下兼容？
答复：
1. Jakarta EE8及以前规范大部分是可以向下兼容的，不存在规范对应唯一版本的说法。
2. 到了Jakarta EE9规范，由于开发API由javax.servlet变为jakarta.servlet，所以从这个规范开始与之前不兼容。
3. TongWeb8.0提供了对应用 javax.*与jakarta.*  API互转的功能 与 javax/jakarta命名空间转化功能，可以兼容新老规范。
问题9：
TongWeb是否支持集群？
答复：
支持，TongWeb企业版、容器版、嵌入版等都可以通过THS、Apache、nginx、F5等软/硬件负载产品实现集群。TongWeb企业版可以实现集群的管理，TongWeb容器版通常由容器云平台来管理。
问题10：
TongWeb集群模式是本身就支持还是单独使用THS支持的？
答复：
TongWeb集群模式依赖THS实现，同类产品均如此。
问题11:
一个TongWeb可以部署多少个应用？
答复：
一台服务器上能装几套TongWeb，一个TongWeb能跑几个应用
问题12:
TongWeb的数据源集群功能有用吗？
答复：
当前数据库本身就支持集群功能，只有个别老项目老版本数据库在不支持集群的情况下，才采用TongWeb数据源集群这种方式。当前的主流方式是通过数据库自身集群功能来实现高可用。
问题13:
TongWeb容器云版本做好应用,数据源配置后，如果重启之前创建好的配置会销毁或丢失吗？
答复：
先配置好打包到镜像里面的或者通过起其他手段将tongweb.xml 挂载出来就可以、或者持久化到本地的都不会丢失或者销毁。
问题14:
在容器云平台上目前支持哪些监控工具进行监控？具体监控的配置项有哪些？
答复：
通常通过普罗米修斯工具进行监控，常监控的值为应用访问量、JVM内存、数据源、线程池。具体的监控配置项可以参考TongWeb手册。
问题15:
TongWeb  license控制使用套数方式？
答复：
1. 通过IP地址绑定。
2. 通过 license server 集中授权。
3. TongWeb8企业版集中管理节点数。
问题16:
TongWeb与THS搭配使用，需要一个license，还是两个license文件？
答复：
推荐使用方式是将TongWeb与THS做成一个license文件提供给用户。
问题17:
用户采购了嵌入版，嵌入版是否需要现场安装？
答复：
TongWeb嵌入版是不需要安装的版本，嵌入版是在应用开发阶段打入应用包的，无需安装。
问题18：
TongWeb部署应用包有没有大小的限制?
答复：
通过TongWeb控制台上传应用有大小限制，控制台允许最大上传应用包为1G，自动部署和目录部署无大小限制。在实际环境中，如果应用包较大，建议通过目录方式部署。
问题19:
两种芯片架构的服务器例如x86和arm架构混合用TongWeb，这种场景能不能正常运行？
答复：
可以混用，TongWeb为java跨平台的，可以在不同平台组成集群使用。
问题20：
用户需要配https，用户只有cer、key类型的证书，需要TongWeb提供JKS证书吗？
答复：
1. 正式证书是需要向证书颁发机构购买的。
2. cer、JKS只是证书格式的不同，可以互相转化。
3. 通常集群情况下证书配在THS上，单TongWeb实例情况下证书配在TongWeb上。
问题21：
TongWeb的license检查周期是多久？
答复：
1.TongWeb每天早上6点检查许可是否过期。
2. 在许可过期10天后，TongWeb会自动停止。
3. 在许可到期15天前，TongWeb控制台和日志会有提示，东方通的管理系统会给用户和销售发短信和邮件提醒。
问题22
：TongWeb8控制台默认安全域在哪里可以配置？
答复：
TongWeb8的管理控制台不再绑定安全域实现，所以不再有默认的安全域配置了。
问题23:
TongWeb需要做数据备份吗？
答复：
TongWeb本身不产生数据，主要是应用配置，所以只需要备份TongWeb主配置文件和日志即可。
问题24：
TongWeb是否支持支持 OSGI 框架？
答复：
TongWeb7不支持，TongWeb8支持。
问题25:
TongWeb能否提供最优配置参数？
答复：
最优配置参数与软、硬件环境、应用、并发量相关，无法一次提供准确的最优参数，但可以提供调优的方案、方法、经验。
问题26：
TongWeb嵌入版是否有控制台？
答复：
有，相当于spring boot admin控制台。
问题27：
TongWeb8如何更好的兼容tomcat?
答复：
在“全局配置”里打开“轻量模式”，仅启动web容器。
问题28:
支持与异构应用服务器tomcat混合集群，支持混合集群下的Session会话共享?
答复：
可以通过spring session等实现，但实际用处不大。
问题29:
THS专为TongWeb服务吗？
答复：
THS 支持tcp，http协议，理论上同类产品都可以支持。 不仅能为TongWeb做负载，其他的tomcat，weblogic，websphere也可以，同时也可以支持PHP应用。
问题30：
THS的高可用是怎么实现的?
答复：
使用类似keepalive的机制，通过虚拟IP对外提供服务，当主节点出现故障时，将虚拟IP切换到备机。
问题31:
THS是通过什么方式检测后台TongWeb是否正常的？
答复：
THS可以通过TCP和HTTP两种方式进行主动健康检查。
问题32:
THS同一端口同时支持http和https协议？
答复：
可以，THS可以同一端口同时支持http、https、国密https。
问题33:
THS支持TongWeb有状态的EJB集群吗？
答复：
支持。
问题34:
Java EE8与Jakarta EE8有什么区别？
答复：
两者规范相同，可以认为没区别。 只是Maven的GAV变了：javax.servlet:javax.servlet-api:4.0.1 -> jakarta.servlet:jakarta.servlet-api:4.0.2，但命名空间没变依旧还是javax.* 。到了Jakarta EE9  命名空间才从javax.*迁移到jakarta.*。
问题35：
为什么通用机TongWeb不带THS，而专用机TongWeb带THS？ 是卖还是送的？
答复：
1. 只有TongWeb有q7文件，THS无q7文件，独立安装THS会显示非可信软件。
2. 这样安装方便一次安装完两个软件，且设置为了开机自启动。
3. TongWeb为java开发本可以跨平台运行，而TongWeb专用机rpm/deb安装包不能跨平台，THS为C开发也不能跨平台，所以TongWeb专用机安装包分别为每个平台对应一个安装包。而通用机TongWeb安装压缩包所有平台通用，若带THS, 则需要把所有平台THS版本都带上。
4. THS单卖，不取决于TongWeb安装包里是否带THS，是一个安装包，还是两个安装包。通过license控制即可，就像APP里某些功能需要购买VIP才可开启。
5. 个别情况下专用机用TongWeb嵌入版，这时若需要THS，则需要THS单独的专用机安装包。
问题36：
TongWeb有没有实施部署，移植方面的经验分享？
答复：
按实施方案文档、移植方案文档介绍即可。
问题37：
TongWeb是否支持IPv6?
答复：
支持。
TongWeb对IPv4、IPv6的支持
问题38：
可以从TongWeb7升级到TongWeb8吗？
答复：
由于是大版本升级，产品差异较大，不提供从TongWeb7到TongWeb8的升级补丁。需要安装TongWeb8，将应用重新部署、测试。
问题39：
APM装上去后会不会对系统性能有一些下降？
答复：
因为是对系统使用探针的方式去做，会有一些性能影响，控制在5%以内。建议可以在出现了一些性能故障的时候，做故障诊断再开启，平时停掉就可以了。
问题40：
TongWeb8支持从nacos同步配置吗，需要做特殊配置和操作吗？
答复：
支持，TongWeb8支持通过nacos、zookeeper、etcd等统一更新配置。具体见TongWeb8手册。
问题41:
TongWeb8说明是支持Jakarta EE8，那支持Jakarta EE9吗？
答复：
支持，Jakarta EE8到9没有加入多少新功能，只是命名空间从javax.*迁移到jakarta.*。所以TongWeb8能支持Spring Framework6.x 和 Spring Boot3.x 。
问题42:
license server为什么要占用两台机器，能不能减少资源占用？
答复：
1. 两台机器是为了保证高可靠性，当一台license server机器出现故障时，还有一台提供服务。
2. 需要数据库是为了存储中间件历史使用量。
3. 不与TongWeb等中间件安装在一起，以避免互相干扰。
问题43:
使用license server的作用？
答复：
1.控制产品的授权规模，解决了license文件授权方式无法约束客户使用产品规模的问题。
2.动态扩展产品授权，当用户需要更多的授权时，只需要在License Server上进行授权扩展。
3.统计授权使用数量，通过License Server统计产品的历史使用量。
问题44：
TongWeb支持xx操作系统、xx数据库吗？
答复：
1. 判断是否支持某操作系统，主要看该操作系统是否提供JDK, 若提供JDK则基本可支持。
2. 判断是否支持某数据库，主要看该数据库是否提供JDBC驱动, 若提供JDBC驱动则基本可支持。
问题45：
TongWeb8为什么只有一个安装包？
答复：
因为该安装包提供window/linux启、停等命令脚本， 企业版、标准版、轻量版等仅需要license即可控制，所以只有一个安装包，方便发版。
更重要的一点是为了避免安装包过多，导致给用户发错安装包。
问题46：
TongWeb、THS安装需要root用户吗？
答复：
为了系统安全通常建议用非root用户。 若TongWeb、THS需要使用80, 443等特定端口，则需要以root用户启动；若需要开启THS  HA功能，切换虚拟IP，也需要root用户。
问题47：
为什么新安装的TongWeb8每次都要改限制IP、改密码、打开上传文件这些配置？
答复：
一切为了安全。
问题48：
国密的相关知识？
答复：
GMSSL - 国密SSL实验室
问题49：
将TongWeb的license授权拷贝到其它项目上使用是否可以？
答复：
不可以，license含有用户信息、项目信息，若用于它处，会怀疑盗版。
问题50：
嵌入版可以部署几个服务器、几个应用？
答复：
嵌入版与企业版、容器版可以部署多个应用不同，通常是一个应用启动一个嵌入版实例。一台服务器可以启动多个实例。
问题51：
TongWeb能否实现自动批量的产品安装、升级？
答复：
1. “自动”一词先确认边界，产品的安装机器IP、用户、目录等这些基本信息肯定是需要人工录入的，安装过程可以自动化。
2. “批量” 若开通SSH服务，则可以实现多台机器的批量安装。
3. TongWeb8提供无缝升级补丁。
问题52：
TongWeb升级是否需要更新license？
答复：
1.大版本升级需要更新license，如：TongWeb7.0.4.X升级到TongWeb8.0， TongWeb7.0.4.X升级到TongWeb7.0.8.X。
2.TongWeb7.0.4.X小版本升级不需要更新license,如:TongWeb7.0.4.2升级到TongWeb7.0.4.9。

关键字: TongWeb8交流常见问答集
文档来源: 
--------------------------------------------------------------------------------

问题编号: 045
问题: TongWeb8关于内存泄露提示： To prevent a memory leak

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/131570604

---

原因：
该问题与
https://blog.csdn.net/realwangpu/article/details/109510297
相同，TongWeb7, TongWeb8在卸载应用时，会尝试回收可能存在的内存泄露， 本质应该从应用方面解决。
解决办法：
若无法修改应用，只是不想看到这些警告信息，则TongWeb8提供关闭功能项。这样仅仅是屏蔽了警告日志输出，无法从根本上解决可能存在的内存泄露。
场景模拟用例：
import com.mysql.cj.jdbc.AbandonedConnectionCleanupThread;

@WebListener
public class DBListener implements ServletContextListener {

	 private Driver driver = null;

	 public void contextInitialized(ServletContextEvent sce) {
		 //模拟常见的数据源驱动加载
		 try {
			 Class.forName("com.mysql.cj.jdbc.Driver");
			 String url = "jdbc:mysql://localhost:3306/test?user=root&password=111";
			 driver = DriverManager.getDriver(url);
			 DriverManager.registerDriver(driver);
		} catch (Exception e) {
			e.printStackTrace();
		}

	 }

	 public void contextDestroyed(ServletContextEvent sce) {
         //卸载应用，若当应用卸载时没有驱动卸载操作则报警告：To prevent a memory leak, the JDBC Driver has been forcibly unregistered.
	      try {
			DriverManager.deregisterDriver(driver);
			//不同数据库处理不同，注册mysql还会起一个名为[mysql-cj-abandoned-connection-cleanup]的线程, 需要如下方式停止下来。
			AbandonedConnectionCleanupThread.uncheckedShutdown();
		} catch (Exception e) {
			e.printStackTrace();
		}

	 }
}
#完整日志如下：
2023-05-04 09:26:04 [WARN] - The web application [testdb] registered the JDBC driver [com.tong.DBDriver] but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.

关键字: TongWeb8关于内存泄露提示： To prevent a memory leak
文档来源: 
--------------------------------------------------------------------------------

问题编号: 046
问题: TongWeb8如何更好的兼容web应用

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/128494577

---

当web应用向TongWeb8移植时，为了更好的兼容可以开启“轻量模式” 或“web兼容模式”。
方式一：开启“轻量模式”对整个TongWeb生效。
此模式会关闭EJB、JCA等服务，并尝试从应用自身加载 JSF、JavaMail、WebSocket、WebService、Xml 等技术实现。如果应用是基于 Tomcat 或其它 Servlet 容器开发的，则通常可以获得更好的兼容性。
方式二：部署应用时开启“web兼容模式”
以 Web 兼容模式加载该应用，如果该应用是基于 Tomcat 等 Web 容器开发，则可以尝试打开此开关以获得更好的兼容性。开启此模式后，EJB 等企业级技术实现将不再支持，同时尝试从应用自身加载JSF、JavaMail、WebSocket、WebService、Xml 等企业级技术实现。

关键字: TongWeb8如何更好的兼容web应用
文档来源: 
--------------------------------------------------------------------------------

问题编号: 047
问题: TongWeb8应用部署时间长或卡住

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/128788930

---

现象：
TongWeb8应用部署时间长或卡住不动，如下图。
解决办法：
这往往是应用启动执行到某一初始化操作时间长引起的。在应用部署过程中出现这种情况时，可以重新刷新控制台，再打开“监控管理”->"阻塞线程"页面，找到"TW-0.0.0.0-9060-*"的部署线程，查看其原因。通常是数据源阻塞，线程阻塞等问题。

关键字: TongWeb8应用部署时间长或卡住
文档来源: 
--------------------------------------------------------------------------------

问题编号: 048
问题: TongWeb8开启JMX服务

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/128494370

---

默认TongWeb8的JMX服务是关闭的，若需要开启JMX服务通过控制台如下完成。
通过JMX,Rest接口采集监控值具体可参考《TongWeb_V8.0REST接口参考.pdf》
采用TongWeb8的 JMX取监控值可参考examples.war中的示例，代码方式如下：
import javax.management.MBeanServerConnection;
import javax.management.ObjectName;
import javax.management.remote.JMXConnector;
import javax.management.remote.JMXConnectorFactory;
import javax.management.remote.JMXServiceURL;
import java.util.HashMap;
import java.util.Map;
import java.util.Properties;

public class JmxClient {

	public static void main(String[] args) throws Exception {
		String ip = "127.0.0.1";
		String port = "7200";
		String username = "monitor";
		String password = "monitor135.COM";
		String password2fa = "null";
		String model = "connector";
		String action = "monitor";
		String name = "server";
        //集中配置加密公钥
		String transferKey = "30819F300D06092A864886F70D010101050003818D0030818902818100BE0F308AF29D14ACBF20686278CA9279BD91F8584F979D03B4CDB49387831DF719864E456E802A4EB4ABEFC554DAB46C5A8E3647C43FC5F477CF520EAC695C402C1CC3BCBEB194BF87F1B26B21794CB745791BE118E8F6327F0DEC60BD1CEC8C1486A85D0C6AFF0F4E7344F9D856E41568B0A6472FDE35444BE2BFA298F92CC90203010001";

		Properties properties = new Properties();
		properties.setProperty("lang", "zh");
        //请求参数
		properties.setProperty("name", name);
		properties.setProperty("targetType", "instance");
		properties.setProperty("targetName", "domain1");

		String ipAndPort = ip + ":" + port;
		String serviceUrl = "service:jmx:rmi://" + ipAndPort + "/jndi/rmi://" + ipAndPort + "/server";
		JMXServiceURL url = new JMXServiceURL(serviceUrl);

		Map<String, Object> environment = new HashMap<>();
		if (!transferKey.isEmpty()) {
            //加密工具包：${tongweb.home}/version*/sysapp/console/WEB-INF/lib/tongweb-web-console-framework.jar
			password = com.tongweb.sdk.util.TongWebUtils.encryptWithPubKey(password, transferKey);
		}
		environment.put(JMXConnector.CREDENTIALS, new String[] { username, password, password2fa, "true" });
		JMXConnector connector = JMXConnectorFactory.connect(url, environment);
		connector.connect();
		MBeanServerConnection connection = connector.getMBeanServerConnection();

		Object result = connection.invoke(new ObjectName("TongWeb:name=console"), "callServerMethod",
				new Object[] { model, action, properties },
				new String[] { String.class.getName(), String.class.getName(), Properties.class.getName() });
		System.out.println(result);
	}
}
推荐通过rest接口采集监控值，代码如下：
import javax.net.ssl.*;
import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.security.SecureRandom;
import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;
import java.util.Properties;

public class RESTClient {

    public static final X509TrustManager X_509_TRUST_MANAGER = new X509TrustManager() {
        @Override
        public void checkClientTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException {
        }

        @Override
        public void checkServerTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException {
        }

        @Override
        public X509Certificate[] getAcceptedIssuers() {
            return new X509Certificate[0];
        }
    };

    public static void main(String[] args) throws Exception {
        String ip = "127.0.0.1";
        String port = "9060";
        String username = "monitor";
        String password = "wang135.COM";
        String password2fa = "null";
        String model = "connector";
        String action = "monitor";
        String name = "server";
        String transferKey = "30819F300D06092A864886F70D010101050003818D0030818902818100BE0F308AF29D14ACBF20686278CA9279BD91F8584F979D03B4CDB49387831DF719864E456E802A4EB4ABEFC554DAB46C5A8E3647C43FC5F477CF520EAC695C402C1CC3BCBEB194BF87F1B26B21794CB745791BE118E8F6327F0DEC60BD1CEC8C1486A85D0C6AFF0F4E7344F9D856E41568B0A6472FDE35444BE2BFA298F92CC90203010001";
        Properties properties = new Properties();
        properties.setProperty("name", name);
		properties.setProperty("targetType", "instance");
		properties.setProperty("targetName", "domain1");

        StringBuilder params = new StringBuilder();
        params.append("j_username=").append(username);
        if (!transferKey.isEmpty()) {
            password = com.tongweb.sdk.util.TongWebUtils.encryptWithPubKey(password, transferKey);
            password = java.net.URLEncoder.encode(password, "UTF-8");
        }
        params.append("&j_password=").append(password); // 需要调用 tongwebutils 工具类
        if (password2fa != null && password2fa.trim().length() != 0) {
            params.append("&password2fa=").append(password2fa);
        }
        params.append("&acceptAgreement=true");
        params.append("&lang=zh");

        for (String key : properties.stringPropertyNames()) {
            params.append("&").append(key).append("=").append(properties.getProperty(key));
        }

        SSLContext sslContext = SSLContext.getInstance("TLS");
        sslContext.init(new KeyManager[0], new TrustManager[]{X_509_TRUST_MANAGER}, new SecureRandom());

        String spec = "https://" + ip + ":" + port + "/console/rest/json/" + model + "/" + action + "/" + name;
        URL http = new URL(spec);
        HttpsURLConnection connection = (HttpsURLConnection) http.openConnection();
        connection.setSSLSocketFactory(sslContext.getSocketFactory());
        connection.setHostnameVerifier((hostname, session) -> true);
        setConnectionProperties(connection);
        String res = sendPost(connection, params.toString());
        System.out.println(res);
    }

    public static void setConnectionProperties(HttpURLConnection conn) throws Exception {
        conn.setRequestMethod("POST");
        conn.setDoInput(true);
        conn.setDoOutput(true);
        conn.setUseCaches(false);
        conn.setConnectTimeout(60000);
        conn.setRequestProperty("Connection", "close");
        conn.setRequestProperty("Charset", "UTF-8");
        conn.setRequestProperty("Content-Type", "application/x-www-form-urlencoded");
        conn.setRequestProperty("accept", "*/*");
        conn.setInstanceFollowRedirects(false);
    }

    public static String sendPost(HttpURLConnection con, String body) throws IOException {
        try (OutputStream outStream = con.getOutputStream()) {
            byte[] data = body.getBytes(StandardCharsets.UTF_8);
            outStream.write(data);
        }

        try (InputStream inputStream = con.getInputStream()) {
            if (con.getHeaderField("Content-disposition") != null && con.getHeaderField("Content-disposition").contains("filename=")) {
                String filePath = System.getProperty("user.dir") + File.separator + con.getHeaderField("Content-disposition").split("filename=")[1];
                FileOutputStream out = new FileOutputStream(filePath);
                final byte[] buffer = new byte[1024 * 1024 * 10];
                int length;
                while ((length = inputStream.read(buffer)) != -1) {
                    out.write(buffer, 0, length);
                }
                out.flush();
                out.close();
                return "Download to: " + filePath;
            } else {
                StringBuilder msg = new StringBuilder();
                String readLine;
                BufferedReader responseReader = new BufferedReader(new InputStreamReader(inputStream, StandardCharsets.UTF_8));
                while ((readLine = responseReader.readLine()) != null) {
                    msg.append(readLine).append("\n");
                }
                return msg.toString();
            }
        }
    }
}

关键字: TongWeb8开启JMX服务
文档来源: 
--------------------------------------------------------------------------------

问题编号: 049
问题: TongWeb8数据源相关问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/129022754

---

问题一：数据源连接不足
当TongWeb数据源连接用完时，除了监控中看到连接占用高以外，日志中会有如下提示信息。
2023-02-14 10:24:43 [WARN] - com.tongweb.web.jdbc.pool.PoolExhaustedException: [TW-0.0.0.0-8088-3]
Timeout: Pool empty. Unable to fetch a connection in 30 seconds, none available[size:10; busy:10; idle:0; lastwait:786
].
2023-02-14 10:24:43 [WARN] - at com.tongweb.web.jdbc.pool.ConnectionPool.borrowConnection(ConnectionPool.java:660)
2023-02-14 10:24:43 [WARN] - at com.tongweb.web.jdbc.pool.ConnectionPool.getConnection(ConnectionPool.java:171)
2023-02-14 10:24:43 [WARN] - at com.tongweb.web.jdbc.pool.DataSourceProxy.getConnection(DataSourceProxy.java:117)
2023-02-14 10:24:43 [WARN] - at com.tong.TestServlet.testDB(TestServlet.java:61)
2023-02-14 10:24:43 [WARN] - at com.tong.TestServlet.doGet(TestServlet.java:38)
2023-02-14 10:24:43 [WARN] - at javax.servlet.http.HttpServlet.service(HttpServlet.java:503)
2023-02-14 10:24:43 [WARN] - at javax.servlet.http.HttpServlet.service(HttpServlet.java:590)
造成这一问题的原因有两个：
数据源的"最大连接数" 设置过小，无法满足并发需求，适当调大"最大连接数"即可。但不可超过：
数据库可用的连接数=数据库设置的最大连接数-其它系统已用的连接数。
应用存在连接泄露或SQL执行时间过长，导致连接耗光。在接下来的说明中介绍分析方法。
问题二：应用存在连接泄露的情况
针对应用存在连接泄露的情况，可以开启TongWeb的"连接泄漏检查"，“泄漏时记录日志”。可以从堆栈检查出应用哪里打开Connection，而没有close()。
2023-02-14 10:53:27 [WARN] -
Connection leak detected,
PooledConnection[com.mysql.cj.jdbc.ConnectionImpl@4c9438e4]:java.lang.Exception
at com.tongweb.web.jdbc.pool.ConnectionPool.getThreadDump(ConnectionPool.java:102)
at com.tongweb.web.jdbc.pool.ConnectionPool.borrowConnection(ConnectionPool.java:747)
at com.tongweb.web.jdbc.pool.ConnectionPool.borrowConnection(ConnectionPool.java:610)
at com.tongweb.web.jdbc.pool.ConnectionPool.getConnection(ConnectionPool.java:171)
at com.tongweb.web.jdbc.pool.DataSourceProxy.getConnection(DataSourceProxy.java:117)
at com.tong.TestServlet.testDB(TestServlet.java:61)  #检查这部分代码并修改
at com.tong.TestServlet.doGet(TestServlet.java:38)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:503)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:590)
若应用不能修改代码，则可以再开启"泄漏时关闭连接", 将在达到“泄漏判定时间”,"泄露判定比例"后，强制回收连接。
注意“泄漏判定时间”要大于正常的SQL执行时间。针对个别后台长时间SQL任务占用几个连接，若达不到泄露判定比例则不会强制回收连接。
问题三：应用存在未关闭的statement,导致数据库游标不足的情况
针对应用存在未关闭的statement,导致数据库游标不足的情况，可开启"跟踪语句"。这样在connection.close()时会关闭相应的statement。
若想修改应用代码关闭statement，可开启"跟踪未关闭堆栈",从中可看到哪里没有关闭。如下：
2023-02-14 11:09:30 [WARN] -
Statement created, but was not closed
at: java.lang.Throwable: Statement created at stack
at com.tongweb.web.jdbc.pool.interceptor.StatementFinalizer$StatementEntry.<init>(StatementFinalizer.java:92)
at com.tongweb.web.jdbc.pool.interceptor.StatementFinalizer.createStatement(StatementFinalizer.java:31)
at com.tongweb.web.jdbc.pool.interceptor.AbstractCreateStatementInterceptor.invoke(AbstractCreateStatementInterceptor.java:57)
at com.tongweb.web.jdbc.pool.JdbcInterceptor.invoke(JdbcInterceptor.java:90)
at com.tongweb.web.jdbc.pool.interceptor.AbstractCreateStatementInterceptor.invoke(AbstractCreateStatementInterceptor.java:55)
at com.tongweb.web.jdbc.pool.JdbcInterceptor.invoke(JdbcInterceptor.java:90)
at com.tongweb.web.jdbc.pool.DisposableConnectionFacade.invoke(DisposableConnectionFacade.java:60)
at com.sun.proxy.$Proxy38.prepareStatement(Unknown Source)
at com.tong.TestServlet.testDB(TestServlet.java:66)
at com.tong.TestServlet.doGet(TestServlet.java:38)
问题四：连接有效性验证无SQL配置
TongWeb8数据源会看到没有配SQL语句， 连接验证不再配SQL语句，而是通过connection.isValid(timeout)  API来验证(TongWeb7也是有这功能的)，开启验证日志后，若验证失败会有如下日志输出。
2022-06-07 13:55:45 [ERROR] - isValid() returned false.
2022-06-07 13:55:45 [ERROR] - isValid() returned false.
2022-06-07 13:55:45 [ERROR] - isValid() returned false.
connection.isValid(timeout) 为JDK1.6后增加的方法，有些老的JDBC驱动没有实现这个方法会报错：
2023-06-12 15:06:46 [WARN] -
java.lang.AbstractMethodError
com.tongweb.web.jdbc.pool.
ConnectionPool.isValid(
ConnectionPool.java:83)
com.tongweb.console.server.DataSource.validateDS(DataSource.java:68)
com.tongweb.console.server.DataSource.listInternal(DataSource.java:220)
com.tongweb.ext.manager.ListProcessor.list(ListProcessor.java:28)
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
或
Exception in thread "TW-Pool Cleaner[1179381257:1689644291207]"
java.lang.AbstractMethodError: org.hsqldb.jdbc.jdbcConnection.isValid(I)Z
at com.tongweb.web.jdbc.pool.PooledConnection.validate(PooledConnection.java:436)
at com.tongweb.web.jdbc.pool.PooledConnection.validate(PooledConnection.java:383)
at com.tongweb.web.jdbc.pool.ConnectionPool.testAllIdle(ConnectionPool.java:1043)
at com.tongweb.web.jdbc.pool.ConnectionPool$PoolCleaner.run(ConnectionPool.java:1138)
at java.util.TimerThread.mainLoop(Timer.java:555)
at java.util.TimerThread.run(Timer.java:505)
问题五：慢SQL的检查
若怀疑有慢SQL可以开启"慢SQL监视"。
可以在监控和日志中看到慢的SQL。
2023-02-14 14:16:57 [WARN] -
Slow Query Report SQL
=select  * from test01,testd  where  test01.test01=testd.test01 and test01.test01 like "%b6%";
time=9075 ms
;
获取慢SQL后可进行优化，或进行SQL超时设置，这取决于JDBC驱动支持API Statement.setQueryTimeout(int timeout)
Failed Query Report SQL
=select  * from test01,testd  where  test01.test01=testd.test01 and test01.test01 like "%b6%"; time=5024 ms;
com.mysql.cj.jdbc.exceptions.
MySQLTimeoutException: Statement cancelled due to timeout or client request
at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:113)
at com.mysql.cj.jdbc.StatementImpl.checkCancelTimeout(StatementImpl.java:2189)
at com.mysql.cj.protocol.a.NativeProtocol.sendQueryPacket(NativeProtocol.java:1033)
at com.mysql.cj.protocol.a.NativeProtocol.sendQueryString(NativeProtocol.java:897)
at com.mysql.cj.NativeSession.execSQL(NativeSession.java:1073)
at com.mysql.cj.jdbc.StatementImpl.executeQuery(StatementImpl.java:1166)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at com.tongweb.web.jdbc.pool.interceptor.AbstractQueryReport$StatementProxy.invoke(AbstractQueryReport.java:219)
at com.sun.proxy.$Proxy41.executeQuery(Unknown Source)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at com.tongweb.web.jdbc.pool.StatementFacade$StatementProxy.invoke(StatementFacade.java:97)
at com.sun.proxy.$Proxy41.executeQuery(Unknown Source)
at com.tong.TestServlet.testDB(TestServlet.java:67)
at com.tong.TestServlet.doGet(TestServlet.java:38)
问题六：采用 java:comp/env/jdbc/testdb方式引用数据源
(1)   配置数据源jdbc/testdb
（2）代码 dataSource = (DataSource) initialContext.lookup("java:comp/env/jdbc/testdb");
（3）应用web.xml中配如下内容
<resource-ref>
    <description>jdbc/testdb</description>
    <res-ref-name>jdbc/testdb</res-ref-name>
    <res-type>javax.sql.DataSource</res-type>
    <res-auth>Container</res-auth>
</resource-ref>
问题七：监控开源数据源
TongWeb8可以监控应用采用的开源数据源
开启监视应用数据源。
在监控管理里“应用数据源”
问题八：JTA事务支持
若需要支持JTA事务、EJB容器事务，需要在配置数据源时开启JTA。同时规则如下：
(1) JTA事务中有两个及以上数据源，必须配置为XA数据源，否则不能保证事务完整性。
(2) JTA事务默认只允许有一个非XA数据源，这样在事务处理上没有问题。若有两个非XA数据源报错如下：
java.lang.IllegalStateException:
Local transaction already has 1 non-XA Resource: cannot add more resources.
at com.tongweb.tongejb.resource.jdbc.managed.local.ManagedConnection.checkNonXA(ManagedConnection.java:107)
at com.tongweb.tongejb.resource.jdbc.managed.local.ManagedConnection.invoke(ManagedConnection.java:190)
at com.sun.proxy.$Proxy75.prepareStatement(Unknown Source)
at com.tong.TestEJB.testdb(TestEJB.java:53)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
(3) JTA事务严格情况应配置为0， 不建议为解决(2)中的异常设置为2。

关键字: TongWeb8数据源相关问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 050
问题: TongWeb8的启、停功能场景说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/133789201

---

前言：
TongWeb8除了正常的startserver.sh、stopserver.sh启停功能外，还有开机自启、宕机重启、定时重启、内存溢出重启、禁止非法退出等功能，以适应不同场景，保证应用系统的可靠性。
场景一：开机自启
前提条件：1. Linux系统提供
systemd服务。 2.  TongWeb启动用户有root权限建立该服务。
如图，开启该服务是将自启动脚本写入/etc/systemd/system 或 /usr/lib/systemd/system目录中。若需要在自启动中设定其它环境变量、指定其他用户，可直接编辑该自启动脚本。
场景二：宕机重启
为解决JVM进程崩溃问题而设置，开启该功能，当TongWeb的JVM进程崩溃时，自动启动TongWeb。
还有一种情况是因为OutOfMemoryError异常导致JVM进程假死，这时可以增加如下两个参数其一，配合“宕机重启”功能实现内存溢出重启。
-XX:+ExitOnOutOfMemoryError      发生oom立即退出，无任何信息文件生成，不建议使用
-XX:+CrashOnOutOfMemoryError    发生oom后立即退出，JVM还会生成文本和二进制崩溃文件
场景三：定时重启
针对存在内存泄露、连接泄露等问题，而又无法从应用层面彻底解决问题的情况，可以设置定时重启功能，通常晚上或凌晨自动重启TongWeb。
场景四：禁止应用代码System.exit()导致的TongWeb停止
场景五：TongWeb启动用户限制
为防止操作人员在root与普通用户之间启、停TongWeb，可限制启动TongWeb的用户及umask值。
场景六：安全停止功能
为防止操作人员误停TongWeb，开启该功能后，停止时TongWeb需要输入管理员密码。
前提：操作系统也禁用kill命令。
场景七：license到期提期，TongWeb自动停止功能
默认情况下东方通会根据用户申请产品时预留的手机和邮箱，在license到期15天前发送到期提醒短信，并在控制台示TongWeb停止日期。
同时设置license每天检查的时间点。在有条件的情况下，还可以自行设置发送邮件和短信。

关键字: TongWeb8的启、停功能场景说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 051
问题: TongWeb8编码设置说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/129057522

---

应用场景：
在遇到中文问题时，常需要通过设置编码格式来解决问题。下面介绍TongWeb8的编码设置及优先级。
一、web.xml中请求、响应编码的配置优先级最高
在JavaEE8规范中web.xml增加了request, response编码配置，该配置优先级最高。
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    id="WebApp_ID" version="4.0">
    <display-name>charset</display-name>
    <default-context-path>/testde</default-context-path>
    <request-character-encoding>GBK</request-character-encoding>
    <response-character-encoding>GBK</response-character-encoding>
以往项目中request, response编码通常通过filter来设置，如：
<filter-name>EncodingFilter</filter-name>
    <filter-class>
        org.springframework.web.filter.CharacterEncodingFilter
    </filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
        <param-name>forceEncoding</param-name>
        <param-value>true</param-value>
    </init-param>
二、TongWeb8控制台编码设置
在部署应用时通过配置"编码"来完成。
参数
参数说明
应用请求编码
应用程序的默认 HTTP 请求编码，优先级低于web.xml。
应用响应编码
应用程序的默认HTTP响应体编码，优先级低于web.xml。
JSP 文件编码
指定 JSP 文件编码, 相当于javaEncoding。
静态文件编码
使用指定的编码解析应用的文件资源，如 *.html 等静态资源，可用于解决文件编码和 JVM 默认编码不一致引起的乱码问题。相当于fileEncoding
三、URL编码设置
为兼容tomcat编码，http通道中"其它" 中的"URI 编码" 相当于tomcat的URIEncoding  ；“URI 使用 Content-Type 解码" 相当于tomcat的useBodyEncodingForURI。
若tomcat下不乱码，而在TongWeb下乱码，则可参考tomcat配置来配置TongWeb。
URIEncoding  : This specifies the character encoding used to decode the URI bytes, after %xx decoding the URL. The default value is UTF-8.
useBodyEncodingForURI :
This specifies if the encoding specified in contentType should be used for URI query parameters, instead of using the URIEncoding. This setting is present for compatibility with Tomcat 4.1.x, where the encoding specified in the contentType, or explicitly set using Request.setCharacterEncoding method was also used for the parameters from the URL. The default value is false.
Notes:
1) This setting is applied only to the query string of a request. Unlike URIEncoding it does not affect the path portion of a request URI. 2) If request character encoding is not known (is not provided by a browser and is not set by SetCharacterEncodingFilter or a similar filter using Request.setCharacterEncoding method), the default encoding is always "ISO-8859-1". The URIEncoding setting has no effect on this default.

关键字: TongWeb8编码设置说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 052
问题: TongWeb8适配JakartaEE应用

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/131045862

---

历史：
2017年 Oracle将Java EE（Java SE还自己保留）交给开源组织，Eclipse基金会接手。但Oracle不允许开源组织使用Java名号，所以Jakarta EE名称于2018.02.26应运而生。
版本
发布日期
焦点说明
Java EE 8
2017.08
增加了JSON绑定和安全相关。Servlet 4.0、Bean Validation 2.0、CDI 2.0、JPA 2.2
Jakarta EE 8
2019.09
规范与Java EE 8完全相同。Maven的GAV变了：javax.servlet:javax.servlet-api:4.0.1 -> jakarta.servlet:jakarta.servlet-api:4.0.2，但
命名空间没变依旧还是javax.*
，算是个小过度吧
Jakarta EE 9
2020.11
没有加入新功能，Eclipse基金会的首个正式版本。
命名空间从javax.*迁移到jakarta.*
，前者从此成为历史。所有模块大版本号+1，如Servlet 4.0.2 -> Servlet 5以表示其断层式升级
Jakarta EE 9.1
2021.06
相较于9 没有 加入新API。主要提供对Java SE 11的运行支持
Jakarta EE10
2022.09
这个版本旨在交付一组规范，用于跨 Jakarta EE 技术（如 Jakarta EE Platform、Web 和新的 Core Profile）构建现代化、简化和轻量级的云原生 Java 应用程序。
这也就导致了从JakartaEE9与之前JavaEE应用的不兼容。
解决办法：
针对JakartaEE应用必须采用TongWeb8 版本，默认TongWeb8采用“
javax
”命名空间以兼容JavaEE规范应用。
支持JakartaEE应用，则生成JakartaEE版本。
生成后启动TongWeb，进入控制台查看其命名空间为"
jakarta
"。
TongWeb8.0.9.0及之后的版本增加了"切换命名空间"的功能，可以在javax与jakarta之间自由切换。同时集中管理支持同时管理 javax 和 jakarta 命名空间的实例。
如何快速判断应用是否为JakartaEE应用?
1. 检查其应用是否引入jakarta相关代码，如：
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
2. 应用是否引用开源组件Spring Framework 6.x、Spring Boot3.x版本？
Spring Framework6.x 和 Spring Boot3.x 则需要JDK17+，jakarta命名空间的应用服务器支持。通常情况下因为应用采用新的Spring版本，而需要升级JDK与JakartaEE应用服务器。
As of
Spring Framework 6.0
, Spring has been upgraded to the
Jakarta EE 9
level (e.g. Servlet 5.0+, JPA 3.0+), based on the
jakarta
namespace instead of the traditional
javax
packages. With EE 9 as the minimum and EE 10 supported already, Spring is prepared to provide out-of-the-box support for the further evolution of the Jakarta EE APIs. Spring Framework 6.0 is fully compatible with Tomcat 10.1, Jetty 11 and Undertow 2.3 as web servers, and also with Hibernate ORM 6.1.
Spring Boot 3.x System Requirements
Spring Boot 3.1.2 requires
Java 17
and is compatible up to and including Java 20.
Spring Framework 6.0.11
or above is also required.
Explicit build support is provided for the following build tools:
Build Tool
Version
Maven
3.6.3 or later
Gradle
7.x (7.5 or later) and 8.x
Servlet Containers
Spring Boot supports the following embedded servlet containers:
Name
Servlet Version
Tomcat 10.1
6.0
Jetty 11.0
5.0
Undertow 2.3
6.0
You can also deploy Spring Boot applications to any servlet 5.0+ compatible container.
3. 应用是否运行在tomcat10.x版本上？
若运行在该版本上，则说明肯定用的是JakartaEE应用。
基于以上规律可判断应用的JakartaEE规范。
典型的错误日志：
Caused by: java.lang.ClassNotFoundException:
jakarta
.servlet.ServletContextListener
说明：
1. TongWeb8.0/7.0.8支持Jakarta EE应用并通过认证，见：
Jakarta EE Compatible Products | Enterprise Java Application and Web Servers | Jakarta EE | The Eclipse Foundation
2. TongWeb7.0.4及以下版本不支持Jakarta EE应用，需要升级版本。

关键字: TongWeb8适配JakartaEE应用
文档来源: 
--------------------------------------------------------------------------------

问题编号: 053
问题: TongWeb8防止System.exit代码导致的进程停止

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/129021619

---

现象：
当应用中存在System.exit 、Runtime.exit代码执行时，会导致TongWeb进程停止，从而产生如下日志：
2023-02-14 09:47:36 [WARN] -
The web application [webtest01] is still processing a request that has yet to finish. This is very likely to create a memory leak. You can control the time allowed for requests to finish by using the unloadDelay attribute of the standard Context implementation. Stack trace of request processing thread:
[
java.lang.Object.wait(Native Method)
java.lang.Thread.join(Thread.java:1257)
java.lang.Thread.join(Thread.java:1331)
java.lang.ApplicationShutdownHooks.runHooks(ApplicationShutdownHooks.java:107)
java.lang.ApplicationShutdownHooks$1.run(ApplicationShutdownHooks.java:46)
java.lang.Shutdown.runHooks(Shutdown.java:123)
java.lang.Shutdown.sequence(Shutdown.java:170)
java.lang.Shutdown.exit(Shutdown.java:216)
java.lang.Runtime.exit(Runtime.java:109)
java.lang.System.exit(System.java:971)
com.tong.TestServlet.doGet(TestServlet.java:41)
javax.servlet.http.HttpServlet.service(HttpServlet.java:503)
javax.servlet.http.HttpServlet.service(HttpServlet.java:590)
com.tongweb.server.core.ApplicationFilterChain.enterApp(ApplicationFilterChain.java:365)
解决方式：
方式一：修改应用代码，将System.exit 、Runtime.exit代码删除。
方式二：开启TongWeb的安全策略功能，禁止System.exit退出。
开启后拦截日志有如下输出：
System exit request has been denied.
java.lang.Thread.getStackTrace(Thread.java:1564)
java.lang.Shutdown.exit(Shutdown.java)
java.lang.Runtime.exit(Runtime.java:109)
java.lang.System.exit(System.java:971)
com.tong.TestServlet.doGet(TestServlet.java:41)
javax.servlet.http.HttpServlet.service(HttpServlet.java:503)
javax.servlet.http.HttpServlet.service(HttpServlet.java:590)

关键字: TongWeb8防止System.exit代码导致的进程停止
文档来源: 
--------------------------------------------------------------------------------

问题编号: 054
问题: TongWeb8首次安装控制台限制

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/128493633

---

限制一：
TongWeb8安装后，默认只能本机登录控制台并在本机强制修改默认密码后方可使用，远程登录控制台无法进行任何修改操作。后台日志提示：
Client IP ( 192.168.55.94 ) was rejected because the trust mode is not satisfied: (  )
The client IP [ 192.168.55.94 ] has been intercepted, and the currently configured trusted IP policy is: [ ]
所以在完成TongWeb安装后，想通过远程访问TongWeb控制台进行修改操作，需要在TongWeb本机通过控制台或命令行修改默认密码、设置信任IP。 修改方式有两种：
方式一：通过本机登录控制台修改
强调：必须是在安装TongWeb的本机上打开浏览器，通过127.0.0.1或localhost地址登录修改。
错误方式：TongWeb装在A机，却在B机上打开浏览器输入：https://127.0.0.1:9060/console，然后说访问不了。
这种方式缺点：在IT机房服务器上安装的TongWeb，进入机房登录服务器本机是不方便的。
方式二：SSH远程登录linux服务器，通过命令修改(推荐方式)
进入TongWeb的bin目录，执行如下两条命令：
#修改密码，将红色部分改为需要的密码即可
sh commandstool.sh --model=password --action=update --username=thanos --password=thanos123.com --acceptAgreement=true originalPassword=thanos123.com newPassword=
wang135.COM
confirmPassword=
wang135.COM
#设置信任客户端IP， 将红色部分改为浏览器所在机器的IP, 或模糊匹配192.168.55.*
sh commandstool.sh --username=thanos --password=wang135.COM --acceptAgreement=true --model=consolesecurity --action=update trustedIP=
192.168.55.159
IP地址也可以直接修改默认域domain1下的domains\domain1\conf\console.xml文件中的trustedIP属性值。
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- ================================== 注意事项 ====================================== -->
<!-- 在 TongWeb 运行期间，主配置文件 tongweb.xml 和 console.xml 具有防篡改限制，禁止对其进行修改 -->
<!-- 当主配置文件遭到意外篡改时，系统会自动恢复，所做的修改将不会生效 -->
<!-- 若需要修改主配置文件并使其生效，请先停止 TongWeb 服务器，然后再进行修改 -->
<!-- ================================================================================= -->
<console disableUpload="false" failureCount="5"	lockOutTime="300" trustedIP="192.168.55.*">
	<auth verCodeEnabled="true">
限制二：
TongWeb8默认禁用了应用包远程上传功能，若需要远程上传应用包功能，请在“集中管理”->"安全配置"->"控制台安全"中关闭“禁用文件上传”。
限制三：
TongWeb8默认禁用了自动部署功能，若需要自动部署目录，则在“全局配置”中开启。
限制四：
TongWeb8默认不开启JSP自动更新功能，若需要动态更新JSP，在部署应用时，开启JSP开发模式。注：只要JSP与生成的class文件时间不相等，则会触发更新。
限制五：
TongWeb8默认不开启JMX功能，若需要JMX监控，可在“集中管理”->“系统管理”->“JMX接口”中开启。

关键字: TongWeb8首次安装控制台限制
文档来源: 
--------------------------------------------------------------------------------

问题编号: 055
问题: TongWeb上jCacheCacheManager异常

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109530774

---

TongWeb报 jcache 相关的错，是因为TongWeb企业版的lib下的hazelcast-3.10.5.jar或tongdatagrid-1.2.jar中含有\META-INF\services\ javax.cache.spi.CachingProvider这个文件。
解决办法：
方式一：将hazelcast-3.10.5.jar或tongdatagrid-1.2.jar中META-INF\services\ javax.cache.spi.CachingProvider这个文件删除。
方式二：直接删除hazelcast-3.10.5.jar或tongdatagrid-1.2.jar ，但不能用session复制了。
方式三：改用TongWeb标准版，不带hazelcast-3.10.5.jar或tongdatagrid-1.2.jar。
日志通常如下：
```bash
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [javax.cache.CacheManager]: Factory method 'jCacheCacheManager' threw exception; nested exception is javax.cache.CacheException: Error opening URI [hazelcast]
Caused by: javax.cache.CacheException: Error opening URI [hazelcast]
Caused by: java.lang.IllegalStateException: Unable to connect to any address! The following addresses were tried: [[127.0.0.1]:5703, [127.0.0.1]:5702, [127.0.0.1]:5701]

关键字: TongWeb上jCacheCacheManager异常
文档来源: 
--------------------------------------------------------------------------------

问题编号: 056
问题: TongWeb上不同应用使用不同域名或不同端口的的办法

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/111944937

---

场景一：TongWeb上不同应用使用不同端口:
如果有app1、app2、app3三个应用，需要分别使用8081，8082，8083三个HTTP端口访问，可以这样配。
方式一：
1. 通过domain create命令建三个域，默认端口自动+1。
2. 通过startdomain 域名分别启动三个域，进入三个域控制台分别部署一个应用。
这种方式最大的好处是:：每个域为独立java进程，各自部署一个应用互不影响。
方式二：
1. 一个TongWeb实例上分别建8081，8082，8083三个HTTP端口。
2. 在TongWeb分别再建三个虚拟主机server1,server2, server3。
注意：其中虚拟主机别名为TongWeb本机要访问的IP地址。每个虚拟主机分别只绑定其中一个端口。
3.  将app1、app2、app3三个应用分别部在server1,server2,server3上即可。
场景二：TongWeb上不同应用使用不同域名:
如果有app1、app2、app3三个应用，分别使用www.abc.com,test01.abc.com,test02.abc.com三个域名访问，可以这样配。
1. 建HTTP 80端口。
2. 在TongWeb上分别再建三个虚拟主机server1,server2, server3. 其中虚拟主机别名分别为三个域名，同时绑定80端口。应用要通过此域名访问，不能是IP。
3.  将app1、app2、app3三个应用分别部在server1,server2,server3上即可。
注意： “应用前缀” 为/。

关键字: TongWeb上不同应用使用不同域名或不同端口的的办法
文档来源: 
--------------------------------------------------------------------------------

问题编号: 057
问题: TongWeb上传文件功能介绍

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/129797831

---

Servlet3.0之前通常借助commons-fileupload-x.jar和commons-io-x.jar等开源jar包实现文件上传。而在Servlet3.0时可以通过@MultipartConfig注解以及相关的方法比较方便的进行文件上传。
@MultipartConfig的常用属性
| 属性名 | 类型 | 是否可选 | 描述 |
|--------|------|----------|------|
| fileSizeThreshold | int | 是 | 当数据量大于该值时，内容将被写入文件。 |
| location | String | 是 | 存放生成的文件地址。 |
| maxFileSize | long | 是 | 允许上传的文件最大值。默认值为 -1，表示没有限制。 |
| maxRequestSize | long | 是 | 针对该 multipart/form-data 请求的最大数量，默认值为 -1，表示没有限制。 |

示例如下：
```java
import javax.servlet.annotation.MultipartConfig;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.Part;

// form 设置ectype属性为multipart/form-data才可上传文件
// 使用MultipartConfig注解标注改servlet能够接受文件上传的请求
@WebServlet("/UploadServlet")
@MultipartConfig(location = "/tmp", fileSizeThreshold = 1024 * 1024, maxFileSize = 1024 * 1024
		* 5, maxRequestSize = 1024 * 1024 * 5 * 5)
public class UploadServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	public UploadServlet() {
		super();
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		//获取用户选择的长传文件
		Part part = request.getPart("myfile");
		String disposition = part.getHeader("Content-Disposition");
		String suffix = disposition.substring(disposition.lastIndexOf("."), disposition.length() - 1);
        // 随机的生存一个32的字符串
		String filename = UUID.randomUUID() + suffix;
         // 获取上传的文件名
		InputStream is = part.getInputStream();
        // 动态获取服务器的路径
		String serverpath = request.getServletContext().getRealPath("upload");
		FileOutputStream fos = new FileOutputStream(serverpath + "/" + filename);
		byte[] bty = new byte[1024];
		int length = 0;
		while ((length = is.read(bty)) != -1) {
			fos.write(bty, 0, length);
		}
		fos.close();
		is.close();
	}
}
```
常见问题一：
若maxFileSize, maxRequestSize 设置过小，则会报异常如下：
```bash
Caused by: com.tongweb.web.util.http.fileupload.impl.SizeLimitExceededException:
the request was rejected because its size (1722) exceeds the configured maximum (25)at com.tongweb.web.util.http.fileupload.impl.FileItemIteratorImpl.init(FileItemIteratorImpl.java:116)
at com.tongweb.web.util.http.fileupload.impl.FileItemIteratorImpl.getMultiPartStream(FileItemIteratorImpl.java:160)
at com.tongweb.web.util.http.fileupload.impl.FileItemIteratorImpl.findNextItem(FileItemIteratorImpl.java:179)
at com.tongweb.web.util.http.fileupload.impl.FileItemIteratorImpl.<init>(FileItemIteratorImpl.java:77)
at com.tongweb.web.util.http.fileupload.FileUploadBase.getItemIterator(FileUploadBase.java:218)
at com.tongweb.web.util.http.fileupload.FileUploadBase.parseRequest(FileUploadBase.java:240)
at com.tongweb.server.connector.Request.parseParts(Request.java:2738)
... 31 more
```
从堆栈看往往误以为是TongWeb对上传文件大小有限制，默认TongWeb不限制大小。除annotation外，还可以在web.xml中设置。
<multipart-config>
	<location>/tmp</location>
	<max-file-size>20848820</max-file-size>
	<max-request-size>418018841</max-request-size>
	<file-size-threshold>1048576</file-size-threshold>
</multipart-config>
若是spring boot应用，则可进行如下配置，参数说明及默认值如下。
Spring Boot 1.3.x或者之前
multipart.maxFileSize=100Mb
multipart.maxRequestSize=1000Mb
Spring Boot 1.4.x:
spring.http.multipart.maxFileSize=100Mb
spring.http.multipart.maxRequestSize=1000Mb
Spring Boot 2.0之后:
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=1000MB
Name
Description
Default Value
spring.servlet.multipart.enabled
Whether to enable support of multipart uploads.
true
spring.servlet.multipart.file-size-threshold
Threshold after which files are written to disk.
0
spring.servlet.multipart.location
Intermediate location of uploaded files.
spring.servlet.multipart.max-file-size
Max file size.
1MB
spring.servlet.multipart.max-request-size
Max request size.
10MB
spring.servlet.multipart.resolve-lazily
Whether to resolve the multipart request lazily at the time of file or parameter access.
false
常见问题二：
上传路径
默认 @MultipartConfig 上传路径与commons-fileupload-x.jar默认上传路径相同，均为： \domains\domain1\temp\cache\work\server\localhost\webapp下 。
因为两者都是通过getServletContext().getAttribute("javax.servlet.context.tempdir") 设置的临时目录，所以有时分不清应用是@MultipartConfig 上传的，还是开源commons-fileupload-x.jar上传的。若想修改上传路径：
1. @MultipartConfig方式是通过指定location的值或 spring.servlet.multipart.location。
2. commons-fileupload通过如下方式，不同版本可能不同。
DiskFileItemFactory factory = new DiskFileItemFactory();
factory.setSizeThreshold(1024 * 1024);// 缓冲区大小为1M
factory.setRepository(file);// 临时目录的保存目录,需要一个file

关键字: TongWeb上传文件功能介绍
文档来源: 
--------------------------------------------------------------------------------

问题编号: 058
问题: TongWeb上反复重部署应用后异常：application instance has been stopped already 或OutOfMemoryError：Metaspace

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109510297

---

问题现象：
在不重启TongWeb的情况下，在TongWeb控制台反复部署应用。会导致TongWeb日志报错如下：
java.lang.IllegalStateException: Illegal access:
this web application instance has been stopped already
. Could not load [redis.clients.util.Pool]. The following stack trace is thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access.
或：
OutOfMemoryError
：Metaspace,
OutOfMemoryError:PermGen space
或：The web application [testdb] registered the JDBC driver [com.mysql.cj.jdbc.Driver] but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.
问题原因：
应用经常会启动一些端口或线程，在应用服务器上卸载、反复部应用时，若应用代码写的不规范，就不能正常停止应用建的线程，导致应用卸载不干净。 老应用未停止线程加载类报此异常:this web application instance has been stopped already。  同时会导致不能卸载class，反复加载class导致元数据区不足报
OutOfMemoryError
：Metaspace。
正确的解决方法：
TongWeb的重部署reload实际操作就是对应用重新stop又start了一下，而这个过程除了class的重新加载以外，对于web.xml中定义的一些资源，如listener，filter，servlet等也重新stop又start了。 所以这时需要在listener或servlet的destory中停止应用启动的端口或线程，这样应用服务器在stop应用时，会调用
listener
或
servlet
的
destory
方法，从而可以销毁应用创建的资源。而很多应用却忽略了这一点。
如：重写
listener   contextDestroyed
方法，该卸载的卸载。实际应用常用spring初始化，注意将spring资源关闭。
#重写listener contextDestroyed()方法
public void contextDestroyed(ServletContextEvent arg0) {
   // 停止应用的端口
   //停止应用的线程
}
#重写servlet destroy()方法
public void destroy() {
   // 停止应用的端口
   //停止应用的线程
}
#典型的场景就是启动了quartz线程池。无关闭quartz线程池步骤，则重部署一次应用，线程池就多增加一份。
<bean id="SpringQtzJobMethod"  class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">


#通过annotation关闭实例
import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;
import org.springframework.stereotype.Component;

@Component
public class Test{
	public Test(){
		System.out.println("test constructor...");
	}

	//对象创建并赋值之后调用
	@PostConstruct
	public void init(){
		System.out.println("test....@PostConstruct...");
	}

	//容器移除对象之前
	@PreDestroy
	public void detory(){
		System.out.println("test....@PreDestroy...");
	}

}
临时解决办法：
在修改不了应用的前提下，只要重部署了应用，就需要重启TongWeb释放无用的线程和Metaspace区内存，否则多次重部署后还会报该异常。 增大-XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m参数只能缓解 OutOfMemoryError
：
Metaspace出现的频率。
同时引申出另外一个问题：在不重启TongWeb的情况下，能否动态更新应用、在线升级应用版本？
答：实际场景下往往不能这样用，原因同上，很多应用不在卸载时执行应用资源关闭操作。这样导致TongWeb的热部署功能、应用版本在线更新功能基本不可用。
若重部署应用不重启TongWeb通常会引发以下三类问题：
(1)
容易导致内存溢出，报错如下：
#JDK7及以下
OutOfMemoryError:PermGen space
#JDK8及以上
OutOfMemoryError
：
Metaspace
(2) 应用启动的
端口占用报错：
address has been used。
(3) 线程不断增加，而不释放报错：this web application instance has been stopped already。
(4)  反复加载动态库，报错：UnsatisfiedLinkError Native Library xxx.so already loaded。
https://blog.csdn.net/realwangpu/article/details/109554060

关键字: TongWeb上反复重部署应用后异常：application instance has been stopped already 或OutOfMemoryError：Metaspace
文档来源: 
--------------------------------------------------------------------------------

问题编号: 059
问题: TongWeb上应用filter报AbstractMethodError

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109810207

---

问题描述：
TongWeb上应用filter报AbstractMethodError， 日志如下：
```bash
java.lang.AbstractMethodError at com.tongweb.catalina.core.ApplicationFilterConfig.initFilter(ApplicationFilterConfig.java:279)
at com.tongweb.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:260)
java.lang.AbstractMethodError: filter.TestFilter.destroy()
at com.tongweb.catalina.core.ApplicationFilterConfig.release(ApplicationFilterConfig.java:311)
at com.tongweb.catalina.core.StandardContext.filterStop(StandardContext.java:4682)
at com.tongweb.catalina.core.StandardContext.stopInternal(StandardContext.java:5498)
```
问题原因：
这是采用JavaEE8 servlet4.0规范开发的filter无init 和 destory方法。 见JavaEE8 API说明两个方法为default。 extension methods—虚拟扩展方法，是指在接口内部包含了一些默认的方法实现。而在TongWeb上还需要调用这两个方法。

解决办法：
1. 在filer中增加init、destory两个方法。
2. 将来升级到TongWeb最新版本。

关键字: TongWeb上应用filter报AbstractMethodError
文档来源: 
--------------------------------------------------------------------------------

问题编号: 060
问题: TongWeb上应用移植常见问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/99542654

---

本文章适用TongWeb6， TongWeb7版本
一、JPA引起的问题
TongWeb自带JPA实现，但实际应用中多采用hibernate的JPA，这样就导致TongWeb的JPA与应用自带JPA冲突，处理方法：
1.应用使用JPA，则TongWeb增加参数：-DenableJPA=false，不启动TongWeb的JPA，否则会报一些OpenJPA异常。
2.出现如下类似异常，缺少javax.persistence中的类或方法，说明应用带的JPA版本比TongWeb新。则把应用的javax.persistence.*包放在TongWeb的lib下，同时将TongWeb6或TongWeb7的lib下javaee-api-*.jar中 javax\persistence目录删除。
Caused by: java.lang.ClassNotFoundException: javax.persistence.Converter
java.lang.NoSuchMethodError: javax.persistence.JoinColumn.foreignKey
二、validation引起的问题
因为tomcat不带javax.validation，而TongWeb带javax.validation,但不带具体实现，所以tomcat上应用移植到TongWeb上后，常会遇到validation相关问题。
1. 出现如下类似异常，说明应用带的validation版本比TongWeb新。则把应用里的validation-XXXX.jar 放在TongWeb的lib\endorsed下，并把TongWeb的lib\endorsed 里validation-api.jar 删除（这里优先级最高）
java.lang.NoSuchMethodError:javax.validation.spi.ConfigurationState.getValueExtractors()Ljava/util/Set;
Caused by: java.lang.ClassNotFoundException: javax.validation.ParameterNameProvider
2.出现如下类似异常，应用里要放javax.validation的实现类，通常为hibernate-validator 实现类，主要有classmate-*.jar、 hibernate-validator-*l.jar 、jboss-logging-*.jar要根据hibernate版本来放
Caused by: javax.validation.ValidationException: Unable to create a Configuration, because no Bean Validation provider could be found. Add a provider like Hibernate Validator
(RI) to your classpath.
三、annotation引起的问题
JavaEE CDI等规范经常性的对应用jar包的annotation进行扫描，导致的一些异常。例如：
[COM/ibm/db2os390/sqlj/custom/DB2SQLJEntryInfo.class] from Jar [jar:file:/home/tongweb/TongWeb6.0/deployment/bbsp/WEB-INF/lib/db2jcc-0.0.1.jar!/] for annotations]
com.tongweb.web.webutil.util.bcel.classfile.ClassFormatException: null is not a Java .class file
[2016-11-13 15:29:21] [WARNING] [System.out] [Caused by: java.lang.StackOverflowError]
[2016-11-13 15:29:21] [WARNING] [System.out] [ at com.tongweb.web.thor.startup.ContextConfig.populateSCIsForCacheEntry(ContextConfig.java:2265)]
[2016-11-13 15:29:21] [WARNING] [System.out] [ at com.tongweb.web.thor.startup.ContextConfig.populateSCIsForCacheEntry(ContextConfig.java:2278)]
所以当看到一些annotation相关的异常时，可先试着把出错的jar加在conf/tongweb.properties中，对指定的jar不进行annotation。
#TongWeb6, 也可以用通配符common*.jar过滤大部分jar
tongweb.util.scan.DefaultJarScanner.jarsToSkip=db2jcc-0.0.1.jar,.....
四、支持jersey1.X版本的问题
部署带有jersey1.X版本的应用包，报错如下：
java.lang.RuntimeException: javax.naming.NameNotFoundException: Name "com" not found.
at com.sun.jersey.server.impl.cdi.CDIExtension.getInitializedExtension(CDIExtension.java:182)
at com.sun.jersey.server.impl.cdi.CDIComponentProviderFactory.<init>(CDIComponentProviderFactory.java:95)
jersey CDI提供一个使用外部BeanManager的办法，在TongWeb启动脚本中加上-Dcom.sun.jersey.server.impl.cdi.lookupExtensionInBeanManager=true  参数即可

关键字: TongWeb上应用移植常见问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 061
问题: TongWeb上应用虚拟目录静态资源配置

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/121599397

---

配置虚拟目录，静态资源最主要的是理清相对路径问题，如下为例。
静态资源目录如下：
在应用WEB-INF目录下建tongweb-web.xml格式示例：
<?xml version="1.0" encoding="UTF-8"?>
<tongweb-web-app>
<property name="aliases"  value="/
static01
=
/home/webappstatic01
" />
</tongweb-web-app>
#static01为访问路径
#/home/webappstatic01为静态资源绝对路径

关键字: TongWeb上应用虚拟目录静态资源配置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 062
问题: TongWeb上应用部署方式

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110230970

---

TongWeb上可部署的web应用结构可分为两种：
1. 打成war包形式的文件。2. 以文件夹目录方式的web应用。 这两种方式必须要有WEB-INF目录才是一个合法web应用结构，方可部署。
特殊情况：某些应用是在apache 、nginx上跑的静态文件，如:vue。只需在其目录下建一个WEB-INF目录，便可当应用部署在TongWeb上。
TongWeb上应用部署方式可分为单节点部署和集中管理部署两种：
单节点部署适用于不需要集群的单机环境，或在单机应用测试阶段使用。
集中管理部署适用于集群环境，把应用批量部署到各个TongWeb节点上。
单机部署有三种常用方式：
将应用包直接放入TongWeb的autodeploy目录下，自动解压在deployment目录下完成部署。
通过bin下commandstool命令行进行部署。
通过console控制台部署，
推荐以目录方式部署
。先将应用通过FTP上传到TongWeb所在机器以目录方式展开，再通过控制台指向该目录。优点是避免因应用包过大通过控制台上传解压占用TongWeb本身资源，且应用更新文件，只需要更新该目录即可。
注意：以war/ear包部署的应用会解压在deployment目录下，当卸载应用时会将deployment目录下应用删除，所以建议目录方式部署。
企业版通过集中管理
heimdall
控制台部署方式：
通过
heimdall
控制台
最佳部署方式
是先将应用目录上传到每台
TongWeb
机器相同目录下，然后再通过
heimdall
控制台选“
节点已有应用目录
”部署。
以Web应用为例，说明应用包注意事项：
Web应用包/目录下必须要有WEB-INF目录才是一个合法应用结构。
若打成war包，必须是zip格式。
常见的奇葩错误打包方式：(1). 用winrar工具打包成rar格式的包，注意用
jar xvf webapp.war
命令校验war包是否能正常解压。（2）多打了一层目录，war包下的某个目录中才有WEB-INF目录。
如果不能保证打包的正确性，就乖乖的用目录方式部署。
不合法的应用包报错：java.lang.IllegalArgumentException: The main resource set specified [/root/TongWeb7.0/deployment/daq]
is not valid
若部署应用想通过域名或IP直接访问，而不用输入端口和应用前缀，则配置http通道为80或https通道为443， 应用前缀为/即可。
若因应用问题导致TongWeb无法启动，进入不了控制台卸载应用，则可以直接将conf/tongweb.xml文件中的应用配置删除再启动TongWeb即可。
<web-app name="ROOT" original-location="/usr/hcit/ROOT" location="/usr/hcit/ROOT" context-root="/ROOT" vs-names="server" is-directory="true" enabled="true" deploy-order="100" object-type="user" jsp-compile="false" dtd-validate="false" is-autodeploy="false" version="" ......./>

关键字: TongWeb上应用部署方式
文档来源: 
--------------------------------------------------------------------------------

问题编号: 063
问题: TongWeb上的应用系统慢是怎么个慢，死是怎么个死？

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109442393

---

一：问题现象
常见的反馈问题说法：现在TongWeb上的应用好慢呀，好像死了，宕了，挂了。这种问题描述不够清晰，慢有多种慢的现象，“死”也不是一个专业的说法。下面我们将对这类问题进行分类说明，不同的“死”法，慢法有不同的分析方式。
土语：TongWeb“死”、“宕”、“挂”的描述，这通常是对TongWeb进程没了的表述。实际是指进程不存在或变为僵尸进程这两类情况。“慢”的问题，是指TongWeb进程还在，应用系统虽慢但还能访问，这是应用系统性能问题。 所以在描述问题时，要把“死、宕、挂”与“慢”区分开，在第一步做出准确的现象描述。
基本要求：熟悉Linux基本操作、Java/JavaEE编程、JDK基本命令、TongWeb使用，后面我们会用到。其实还有很多专业的分析工具，如：JProfiler、APM等，但由于项目实际情况没有安装这些软件，且运维人员不一定会使用，所以我们后面的讲解主要以Linux和JDK自带的分析命令为主。
此文较长，请耐心看完。
二：“死”、“宕”、“挂”的问题
情况1. 最低级的“死”法
(1) 有人偷偷停了TongWeb或kill  -9杀掉了TongWeb，别的运维人员不知道。通过history命令或TongWeb生成的nohup.out文件，可以看看到执行过kill -9 命令。
[2021-12-23 13:40:52 793] [INFO] [main] [systemout] [tuserport:0;jcport:0]
./startserver.sh: 行 129: 20496 已杀死 /home/jdk8/bin/java -classpath
/home/jdk8/lib/tools.jar:"/home/TW_7041_Enter_Liunx"/lib/bootstrap.jar:"/home/TW_7041_Enter_Liunx"/lib/jdk-api.jar -Xms2048m -X
(2) 把系统慢当成了“死”，TongWeb还在运行，只是慢的跟"死"一样，其实还没死，误报。
(3) TongWeb不是以nohup ./startserver.sh & 或 startservernohup.sh后台方式启动，造成ssh或telnet断开后，TongWeb进程停止。
(4) 应用代码里有System.exit(0)代码，危险代码。这是退进程的，会导致整个TongWeb进程退出。从TongWeb日志中可以明显看到明显的stop日志：这种问题有两种解决办法：
方法一： 找出应用代码用System.exit的地方并删掉，需要人员能处理应用代码。
方法二：在TongWeb启动脚本external.vmoptions中加如下参数：
```bash
#按conf/tongweb.policy规则，禁止执行System.exit代码。
-Djava.security.manager
#TongWeb7.0.4.1及之后可增加如下参数只拦截exit方法。
-Djava.security.manager=com.tongweb.checkcode.CheckSystemExitSecurityManager
```
说明：
1. -Djava.security.manager参数表示使用
-Djava.security.policy=${TongWeb_Base}/conf/tongweb.policy文件的安全策略。
2. -Djava.security.manager=com.tongweb.checkcode.CheckSystemExitSecurityManager参数则拦截System.exit。
注意：在使用该参数时改为nio线程池，若使用nio2线程池则有：  Exception in thread "InnocuousThread-1516" java.lang.SecurityException: setContextClassLoader 异常，导致端口不可访问。
3. 可以将TongWeb7.0.4.1  lib下bootstrap.jar\com\tongweb\checkcode中的CheckSystemExitSecurityManager.class和ExitException.class拷贝到老TongWeb7版本的bootstrap.jar中使用。
日志可以看到如下异常，拦截了System.exit代码。
```bash
[com.tongweb.checkcode.ExitException: found System.exit(0) !]
[    at com.tongweb.checkcode.CheckSystemExitSecurityManager.checkExit(CheckSystemExitSecurityManager.java:25)]
[    at java.lang.Runtime.exit(Runtime.java:107)]
[    at java.lang.System.exit(System.java:971)]
```
情况2. 进程崩溃问题
排除以上低级死法，发现TongWeb的Java进程确实崩溃了，通常是由于JVM本身不稳定造成的，这时在TongWeb的进程起始目录（通常是TongWeb的bin目录）会生成hs开头的文本文件，收集这个hs文件分析。
情况3. 僵尸进程
进程会变成僵尸进程(defunct)，ps可看到进程被标识为defunct，具体说明可百度。解决办法：A.找到其父进程并杀掉。B. 若杀不掉，只能重启机器。
三：慢的问题
TongWeb上的应用系统慢也分多种情况，需要根据不同的现象进行不同的分析处理，重点是先要理清慢的现象，在慢时抓取相应日志，一旦盲目重启则无法分析。同时，某些人员还会反馈成：应用系统慢，重启TongWeb就好了，所以是TongWeb的问题。
请切记：TongWeb与应用同在一个JVM进程中共享资源，所以出问题重启TongWeb后，TongWeb与应用的资源都会清理掉并重建。 这种方式可以恢复应用，但并不表明为TongWeb问题。 正如当电脑、手机不好用时，可重启机器来解决问题，但并不能确定是哪方软、硬件造成的。
情况1. 最低级的慢是因为没做基本优化
(1)TongWeb没有做基本的优化，三大影响性能的参数:
参数一：没有改启动脚本JVM内存，至少先设2G（-Xms2048m -Xmx2048m) ，但是JVM内存并非越大越好。
参数二：linux 系统没有改open files值(默认1024)，通常改法是修改/etc/security/limits.conf,在文件中加上两行：
*  soft  nofile 65535
*  hard  nofile 65535
修改完后通过linux系统命令ulimit -a查看open files值生效后重启 TongWeb。
另外TongWeb启动脚本也默认增加了ulimit -n 65535， 以防忘记修改open files。
参数三：TongWeb默认快照阈值设置不合理，在未产生性能问题的情况下执行快照功能。无性能问题时关闭快照功能，有性能问题配置合适的阈值。
(2) 数据库没有做基本优化。
(3) 应用没有做基本优化，如：数据源连接池配置过小、日志还是DEBUG级别输出大量日志。
(4) 网速不够。通过网络测试软件，带宽太小，或是在TongWeb本机上访问(linux也可以用firefox)看慢不慢？ 若本机快，能过其它网段访问慢，则基本可以判断是网络问题。
(5) 基本的性能测试都不做，直接上线，肯定出问题。

情况2. CPU占用高引起的慢
现象：通过top命令查看到TongWeb的java进程占用CPU很高。
这时可以通过阿里的分析脚本show-busy-java-threads.sh来分析， 该脚本可用于快速排查Java的CPU性能问题(top us值过高)，自动查出运行的Java进程中消耗CPU多的线程，并打印出其线程栈，从而确定导致性能问题的方法调用。 用法：
`show-busy-java-threads.sh -p <Java进程Id> -c <要显示的线程栈数> -a <输出记录到的文件>TongWeb bin目录下自带命令thread-profiler.sh等同于show-busy-java-threads.sh`
如：`/thread-profiler.sh -p <Java进程ID> -c 500 -a cpulog.txt`
要点：正确查看CPU是否高，有些Linux   CPU若为64核，则CPU为6400%表示满，别以为800%就认为CPU高了。要在出现CPU高的问题时打该命令，学会看线程栈。

情况3. 线程阻塞引起的慢
这种现象通常表现为CPU使用不高，TongWeb控制台访问正常，但应用所有页面访问都慢或不能访问应用端口，这种情况通常是应用的http线程池大部分出现阻塞导致的。出现这种问题时可使用JDK的jstack命令打出线程栈来分析。 如：jstack <java进程id> > log.txt，输出到指定文件。 重点看是不是BLOCKED线程很多，这些线程是不是lock在同一地址上， 偶尔几个BLOCKED线程对系统不影响。
要点：会用jstack命令，要在出现慢的问题时执行该命令，并学会看线程栈，
重点查看这种"http-nio-0.0.0.0-8080-exec-XX" 以通道类型、绑定IP、端口号为命名规则的线程池堆栈。

情况4. 数据源引起的慢
这种现象通常表现为CPU使用不高，TongWeb控制台访问正常，但应用跟数据库无关的页面访问正常，跟数据库有关的页面访问慢。
这种分种情况：
(1). 数据源连接池占满，TongWeb的server.log中可以看到数据源占满的日志(开源和TongWeb数据源都会有)，通过jstack可以看到线程阻塞在数据源上。可能是连接数过小引起的，若加大后还出现就有可能是存在连接泄露问题了，开启"泄露日志"找到应用代码泄露的地方改掉。 改不了应用代码就把“泄漏超时”“泄漏回收”或”即时回收“设置上，这样到达超时时间后，强制回收数据库连接。开源连接池也有这参数。当超时后，以WARNING级别将该堆栈信息输出到日志。从日志中可以分析到哪里存在未关闭的连接。日志示例如下：
（2). 若部分数据库业务慢，TongWeb数据源可记录下执行时间长的SQL，针对SQL进行优化。通常情况下采用hibernate、mybatis框架不会有连接泄露问题，更多问题的是获取一个连接后SQL执行时间长引起的。
(3). 采用开源连接池c3p0、DBCP、Druid等也有类似配置，请注意应用中的开源数据源配置。如druid连接池满导致的异常。
Caused by: com.alibaba.druid.pool.GetConnectionTimeoutException: wait millis 60000, active 100, maxActive 100, creating 0, createErrorCount 24
要点：熟悉TongWeb数据源和开源数据源的配置，并会从数据库端分析。
情况5. 内存引起的慢
这种现象通常是TongWeb控制台和应用访部都很慢，日志中有“OutOfMemoryError”，就跟前面说的“死”一样，但进程还在。
通过GC日志或jstat命令，查看内存是否占满，Full GC是否频繁。
#gc.log中有Full GC过于频繁的日志如下：
```bash
1004277.657: [Full GC 7442688K->7326004K(7909312K), 14.7484964 secs]
1004292.491: [Full GC 7442688K->7234814K(7909312K), 17.6059770 secs]
1004310.273: [Full GC 7442687K->7327296K(7909312K), 14.6444008 secs]
1004325.036: [Full GC 7442687K->7328115K(7909312K), 14.6859322 secs]
```
jstat：用于输出java程序内存使用情况，包括新生代、老年代、元数据区容量、垃圾回收情况。
例：`jstat -gcutil 进程号 2000 20`
上述命令输出进程ID为3618的内存使用情况（每2000毫秒输出一次，一共输出20次）
S0：幸存1区当前使用比例 S1：幸存2区当前使用比例
E：伊甸园区使用比例 O：老年代使用比例
M：元数据区使用比例 CCS：压缩使用比例
YGC：年轻代垃圾回收次数 FGC：老年代垃圾回收次数
FGCT：老年代垃圾回收消耗时间 GCT：垃圾回收消耗总时间
当确认内存满了，执行以下操作：
(1)  要求出现OutOfMemoryError：Java heap space时不要重启Java进程，保留进程继续执行如下操作。
(2) 利用JDK的jps –v命令查出Java的进程号。
(3) 通过
jmap –histo <PID>  >  mem.txt
打出文本日志，生成过程很快，文件很小。
(4) 采用jmap生成完整的内存镜像文件 :
jmap -dump:live,format=b,file=heap.hprof  <PID>
在当前执行命令目录下生成，如果内存设为2G，则生成的内存镜像文件也有2G。
若生成文件比-Xmx值小很多，则没有分析的必要。
(5) 若出现问题来不及或不会用jmap生成参数，可在TongWeb启动脚本external.vmoptions中增加如下参数，在内存溢出时自动生成内存镜像文件。
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=../logs/heap`date +%Y%m%d%H%M`.hprof
-XX:+PrintGCDateStamps
-XX:+PrintGCDetails
-Xloggc:../logs/gc`date +%Y%m%d%H%M`.log
(6) 生成的mem.txt文件可以用文本工具打开直接看，内存镜像文件可以用MemoryAnalyzer内存分析工具分析。下载地址如：
Eclipse Memory Analyzer Open Source Project | The Eclipse Foundation
。 分析这些文件需要用大内存机器才行，建议用64位windows机器，安装64位MemoryAnalyzer软件，物理内存至少为内存镜像文件的3倍。
误区：JVM内存够不够用主要看GC(垃圾回收)情况，JVM内存并非设越大越好、JVM内存并非设越大越好、JVM内存并非设越大越好。
要点：熟悉JVM的GC机制、会用jstat、jmap、MemoryAnalyzer分析JVM内存。
情况6. "大部分业务正常，只有个别业务慢"， 这是应用该部分业务的问题，与中间件无关。推荐TongAPM、阿里开源的 java 诊断工具-Arthas，可做源码级性能分析。
通过arthas的monitor命令查看方法调用次数和时间。
通过arthas的trace命令分析方法耗时。
四: 如何一次收集全性能分析日志
最糟糕的情况是说不清以上慢的情况，出问题时着急重启TongWeb解决没有收集日志。这种情况下，只能将TongWeb该开启的日志全开启，企盼在出现问题时能尽量抓取的日志全些。对TongWeb进行以下配置：
1.  在bin/external.vmoptions文件中打开GC日志和生成内存溢出镜像的参数。
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=../logs/heap`date +%Y%m%d%H%M`.hprof
-XX:+PrintGCDateStamps
-XX:+PrintGCDetails
-Xloggc:../logs/gc`date +%Y%m%d%H%M`.log
2. 修改快照生成默认值，只生成jstack日志。若http最大线程数设300,  则可在快照的通道设置中将该http通道“最大线程数”设为250。 在线程使用量高时打出jstack。
3. 开启超时线程日志，在server.log中记录该线程栈信息。
```bash
[2021-03-29 14:13:16 977] [INFO]
[ThanosStandardService hung thread check
[1174290147:1616998336906]] [core] [Request Info: Url=http://127.0.0.1/dbpool/ Parameters
Thread Info: "http-nio2-0.0.0.0-80-exec-2" id=223 state=TIMED_WAITING
- waiting on <0x067b630c> (a java.util.concurrent.SynchronousQueue$TransferQueue)
- locked <0x067b630c> (a java.util.concurrent.SynchronousQueue$TransferQueue)
at sun.misc.Unsafe.park(Native Method)
at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
at java.util.concurrent.SynchronousQueue$TransferQueue.awaitFulfill(SynchronousQueue.java:764)
at java.util.concurrent.SynchronousQueue$TransferQueue.transfer(SynchronousQueue.java:695)
at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
at com.tongweb.hulk.util.ConcurrentBag.borrow(ConcurrentBag.java:137)
at com.tongweb.hulk.pool.HulkPool.getConnection0(HulkPool.java:148)
at com.tongweb.hulk.pool.HulkPool.getConnection(HulkPool.java:118)
at com.tongweb.hulk.pool.HulkPool.getConnection(HulkPool.java:113)
```
4. 若采用TongWeb数据源，则开启“泄露日志”，“SQL日志”。开源连接池也可以开启泄露。
5. 如果还会操作些命令，在TongWeb机器上通过`netstat -an|grep  http端口`，在数据库机器上通过`netstat -an|grep  数据库端口`查看端口状态。
6. 如果还会操作些命令， 执行bin下 `./thread-profiler.sh -p <Java进程ID> -c 500 -a cpulog.txt` 。最后提供收集日志给相关人员，并说明出现问题的时间点，提供logs下所有日志，以及1-6步产生的日志。千万别只会说一句：重启就没事了。

五：总结
通过以上说明，主要是让各位了解一下出现系统问题时，该如何描述问题，针对不同的问题现象该如何处理。处理这些问题的最基本要求是：
1. 理清问题现象。
2. 会通过Linux基本命令、jstack、jstat、jmap、show-busy-java-threads.sh、jpsArthas、MemoryAnalyzer等工具和命令收集日志。具体使用方法可百度 。
3. 会查看GC日志、线程日志、内存镜像日志，并熟悉JVM、TongWeb参数的调优、应用代码的优化。

关键字: TongWeb上的应用系统慢是怎么个慢，死是怎么个死？
文档来源: 
--------------------------------------------------------------------------------

问题编号: 064
问题: TongWeb上设置应用 cookie 属性

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109711846

---

功能需求：
需要更改应用默认的 cookie 中 JSESSIONID 名称、域名、路径等配置。
解决办法：
在 JavaEE6 规范中对 web.xml 的 schema 定义中增加了 cookie 属性设置，应用的web.xml中可配置如下：
<session-config>
   <session-timeout>30</session-timeout>
   <cookie-config>
     <name>MYJSESSIONID</name>
     <domain>tong.com</domain>
     <path>/tong</path>
     <comment>no zuo no die</comment>
     <http-only>true</http-only>
     <secure>false</secure>
     <max-age>1800</max-age>
   </cookie-config>
</session-config>
说明：
<name>可以自定义会话 cookie 的名字。
<domain>和<path>对应着 cookie 的 Domain 和 Path 特性。
<comment>通常用于解释 cookie 的目的。
<http-only>和<secure>对应着 cookie 的 HttpOnly 和 Secure 特性。
<max-age>指定了 cookie 的 Max-Age 特性。
HTTP 头响应结果如下：
Set-Cookie: MYJSESSIONID=97973D55AEE06399BAC16C890F121649;Version=1; Comment="no zuo no die"; Domain=tong.com; Max-Age=1800;Path=/tong/; HttpOnly
注：虽然TongWeb中有说明可在tongweb-web.xml配置如上信息，但多数用户对tongweb-web.xml写法不熟悉，翻手册又困难，所以用标准的web.xml比较方便。

关键字: TongWeb上设置应用 cookie 属性
文档来源: 
--------------------------------------------------------------------------------

问题编号: 065
问题: TongWeb下 javax.management.InstanceAlreadyExistsException异常

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109542378

---

当在TongWeb上部署多个应用时会报 javax.management.InstanceAlreadyExistsException异常，多见于两个以上SpringBoot应用。
```bash
Caused by:javax.management.InstanceAlreadyExistsException: com.alibaba.druid.filter.stat:name=statFilter,type=StatFilter
Caused by:javax.management.InstanceAlreadyExistsException: org.springframework.cloud.context.environment:name=environmentManager,type=EnvironmentManager
```

原因：
SpringBoot项目默认开启了自身的JMX服务用于监控管理。此时如果两个SpringBoot部署在同一个TongWeb上时会报MBean实例已经存在的错误。
解决办法：
1. 修改注册的MBean名称。
2. SpringBoot应用可以修改domain名或关闭JMX。
spring.jmx.default-domain指定JMX domain name。
spring.jmx.enabled是否开启jmx，默认为true。

关键字: TongWeb下 javax.management.InstanceAlreadyExistsException异常
文档来源: 
--------------------------------------------------------------------------------

问题编号: 066
问题: TongWeb下乱码问题解决思路

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109540781

---

解决乱码问题主要看以下几项配置，重点要了解这些编码设置所起的作用。
注：乱码问题看TongWeb的server.log日志基本没用，重点是看应用采用的编码以及操作系统、TongWeb的编码设置。
1. Linux下先通过local -a查看操作系统是否有相应的中文字符集。
2. Linux下再看环境变量LANG值，通常为zh_CN.GBK或zh_CN.UTF-8。通过echo $LANG查看，通过
export LANG=zh_CN.GBK
来设置。
3. JDK参数-Dfile.encoding=GBK，加在TongWeb启动脚本中。
以上两项是JDK的默认编码，-Dfile.encoding优先于LANG环境变量。
file.encoding 这个属性的英文解释：
This property is used for the default encoding in Java， all readers and writers would default to use this property. “file.encoding” is set to the default locale of Windows operationg system since Java 1.4.2. System.getProperty(“file.encoding”) can be used to access this property. Code such as System.setProperty(“file.encoding”， “UTF-8”) can be used to change this property. However， the default encoding can not be changed dynamically even this property can be changed. So the conclusion is that the default encoding can’t be changed after JVM starts. “java -Dfile.encoding=UTF-8” can be used to set the default encoding when starting a JVM. I havesearched for this option Java official documentation. But I can’t find it.
同时还有一参数
-Dsun.jnu.encoding=UTF-8
,
sun.jnu.encoding 影响文件名的创建，而 file.encoding 则影响到文件内容。在我们使用 Java 处理中文文件的时候，如果发现文件的中文内容没有乱码，而文件的中文名发生乱码，就应当多考虑一下 sun.jnu.encoding。
4. TongWeb 的Web容器 request 、response
默认编码GBK。
5.  对于URL的编码，在TongWeb的 http通道中设置，默认GBK。
“URL编码格式”相当于tomcat的URIEncoding。“ uri处理”相当于tomcat的useBodyEncodingForURI。
若tomcat下不乱码，而在TongWeb下乱码，则可参考tomcat配置来配置TongWeb。
URIEncoding：This specifies the character encoding used to decode the URI bytes, after %xx decoding the URL. If not specified, GBK will be used.
useBodyEncodingForURI：This specifies if the encoding specified in contentType should be used for URI query parameters, instead of using the URIEncoding. This setting is present for compatibility with Tomcat 4.1.x, where the encoding specified in the contentType, or explicitly set using Request.setCharacterEncoding method was also used for the parameters from the URL. The default value is false.
6. 数据库存入数据乱码，还要看数据本身的编码设置。另外不同数据的JDBC  url也有编码设置，如:MySQL的jdbc:mysql://localhost:3306/test?
useUnicode=true&characterEncoding=utf-8   。
7.重点查看应用编码规则，一定要了解应用的编码用法。
主要看应用filter中设置的编码：request.setCharacterEncoding("UTF-8")
应用代码中有没有做转码，如： new String(test.getBytes("iso-8859-1"),"utf-8");
8.日志乱码主要原因:
(1)telnet终端编码与日志输出的编码不一致导致，把日志下载到windows下用Notepad++等工具查看，并进行UTF-8与GBK转码试试。
(2) log4j编码设置不对，注意参数中的log4j.appender.file.encoding=UTF-8。

关键字: TongWeb下乱码问题解决思路
文档来源: 
--------------------------------------------------------------------------------

问题编号: 067
问题: TongWeb下多个应用区分session与共享session的问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/122528815

---

应用场景：
同一个TongWeb下部署了多个应用系统(如:应用A与应用B)，多个应用系统之间需要互相跳转。

需求一：需要互相访问应用上下文
解决办法:
跨上下文的访问，需要在启动脚本中配置参数
```bash
-Dopenejb.crosscontext=true
```
相当于tomcat的<Context path="/A" debug="0" reloadable="true"crossContext="true"/>
这样B应用的代码可用：req.getSession().getServletContext().getContext("/A") 获取A的上下文。

需求二：多个应用要区分开http头的jsessionid，以免混淆
解决办法：在应用的web.xml中自定义会话cookie的名字
```bash
<session-config>
<session-timeout>30</session-timeout>
<cookie-config>
<name>MYJSESSIONID</name>
</cookie-config>
</session-config>
```
需求三：
多个应用要共享一个jsessionid，但session中存的属性值不同
解决办法：在启动脚本中配置参数:`-DSharedSessionContext=true`这是复用http
请求里基于Cookie附带的jsessionid，不再生成新的ID，适用跨应用跳转和SSO应用。ID虽然相同，但session中的属性值是不同的。

需求四：
多个应用要共享一个jsessionid，session中存的属性值也相同
解决办法：在启动脚本中配置参数:`-DSharedSessionContext=true -DSharedSessionEnable=true`两个参数为true，表示多个应用共享session。

关键字: TongWeb下多个应用区分session与共享session的问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 068
问题: TongWeb下如何获取数据源的物理连接_

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/152126080

---

在某些场景下需要获取数据源的物理连接，以针对特定数据库进行处理，如下：

```java
import oracle.sql.BLOB;
import oracle.jdbc.OracleConnection;

......

(OracleConnection)con
......
oracle.sql.BLOB  blob=(oracle.sql.BLOB)rs.getBlob(1).;
// 像DBCP数据源可以通过如下方式获取
Connection conn = ds.getConnection();
Connection dconn = ((DelegatingConnection) conn).getInnermostDelegate();
...
conn.close()
```
在TongWeb下获取数据源物理连接的方法如下：
1. 将数据源驱动包放在TongWeb的lib目录下，不在应用的lib下放驱动包，也不在配置数据源时指定驱动包路径，否则多份类加载会引起类冲突。类似如下：
```java
java.lang.ClassCastException: oracle.sql.BLOB cannot be cast to oracle.sql.BLOB]
  at com.tong.Test.testDB(Test.java:81)]
  at com.tong.Test.doGet(Test.java:45)]
  at javax.servlet.http.HttpServlet.service(HttpServlet.java:622)]
  at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)]
  at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)]
```
2. TongWeb7,8 获取数据源物理连接代码如下. 该类TongWeb7.0在tongweb.jar中，TongWeb8.0在
modules/ejb/tongweb-ejb.jar中。
```java
import com.tongweb.tongejb.resource.jdbc.managed.util.NativeJdbcExtractor

try {
 DataSource dataSource = (DataSource) new InitialContext().lookup("jdbc/test");
 Connection con = dataSource.getConnection();
 System.out.println("逻辑连接：" + con);
 Connection physicalconnection =
 NativeJdbcExtractor.extractNativeConnection(con);
 System.out.println("物理连接：" + physicalconnection);
 con.close();
} catch (Exception e) {
 e.printStackTrace();
}
```

关键字: TongWeb下如何获取数据源的物理连接_
文档来源: 
--------------------------------------------------------------------------------

问题编号: 069
问题: TongWeb主配置文件tongweb.xml概要说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109510066

---

TongWeb主配置文件tongweb.xml概要说明， 大部分控制台配置参数是保存在该文件中，必要时可直接修改，重启生效。
常用配置：
1. 修改默认的8005,9060,8088,8443,7200,5100等端口。
2. 删除应用配置。
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<tongweb>
<!-- 热部署，自动部署 -->
<auto-deploy enabled="true" jsp-compile="false" dir="${tongweb.root}/autodeploy" check-interval="3000"/>
<hot-deploy enabled="false" watched-resource="WEB-INF/web.xml,MATA-INF/application.xml"/>
<!-- 应用部署信息,  将对应的应用<web-app删除，即卸载应用。 -->
<apps>
<web-app name="console" original-location="${tongweb.upload}/console" location="${tongweb.sysapp}/console" context-root="/console" vs-names="admin" is-directory="true" enabled="true" description="console" deploy-order="1" object-type="sys" jsp-compile="false" dtd-validate="false" is-autodeploy="false" delegate="false"/>
<web-app name="heimdall" original-location="${tongweb.upload}/heimdall" location="${tongweb.sysapp}/heimdall" context-root="/heimdall" vs-names="admin" is-directory="true" enabled="true" description="heimdall" deploy-order="1" object-type="sys" jsp-compile="false" dtd-validate="false" is-autodeploy="false" delegate="false"/>
<web-app name="sysweb" original-location="${tongweb.upload}/sysweb" location="${tongweb.sysapp}/sysweb" context-root="/sysweb" vs-names="admin" is-directory="true" enabled="true" description="sysweb" deploy-order="1" object-type="sys" jsp-compile="false" dtd-validate="false" is-autodeploy="false" delegate="false"/>
<web-app name="dbpool" original-location="D:/dbpool" location="D:/dbpool" context-root="/dbpool" vs-names="server" is-directory="true" enabled="true" deploy-order="100" object-type="user" jsp-compile="false" dtd-validate="false" is-autodeploy="false" version="" retire-state="none" retire-strategy="nature" retire-timeout="0" version-serial-number="1" delegate="false" cache-max-size="10240"/>
<connector-app name="genericra" original-location="D:/TongWeb7041/tw7e/bin/../temp/upload/genericra" location="D:/TongWeb7041/tw7e/bin/../applications/genericra" is-directory="true" enabled="true" thread-pool="default-thread-pool" deploy-order="1" object-type="user" dtd-validate="false" is-autodeploy="false" version="" retire-state="none" retire-strategy="nature" retire-timeout="0" version-serial-number="1">
<property name="JndiProperties" value="java.naming.factory.initial=com.sun.jndi.fscontext.RefFSContextFactory,java.naming.provider.url=file:${tongweb.root}/apache-activemq/conf"/>
<property name="LogLevel" value="INFO"/>
<property name="SupportsXA" value="true"/>
<property name="ProviderIntegrationMode" value="jndi"/>
<property name="RMPolicy" value="OnePerPhysicalConnection"/>
</connector-app>
</apps>
<!-- 停止端口8005，若无此配置默认8005.   -->
<server
shutdown-port="8005"
jsf="false">
<!--  web容器编码配置 -->
<web-container jsp-development="true" parameter-encoding="GBK" response-encoding="GBK" hung-thread-threshold="0" hostnameVerifier="NullHostnameVerifier">
<!--  访问日志 -->
<access-log pattern="%{yyyyMMddHHmmssSSS}t %U %m %a %D" suffix=".txt" log-extend="false" file-date-format="yy.MM.dd.HH"/>
<!--  虚拟主机配置 -->
<virtual-host name="admin" listeners="system-http-listener" accesslog-enabled="false" accesslog-dir="logs/access" sso-enabled="false" remote-filter-enabled="false">
<sso/>
<remote-filter/>
</virtual-host>
<virtual-host name="server" listeners="tong-http-listener" accesslog-enabled="false" accesslog-dir="logs/access" sso-enabled="false" remote-filter-enabled="false">
<sso/>
<remote-filter/>
</virtual-host>
<!--  http端口配置 -->
<http-listener name="system-http-listener"
port="9060"
io-mode="nio2" redirect-port="8443" uri-encoding="GBK" parse-body-methods="POST,DELETE,PUT" default-virtual-host="admin" create-time="2019-10-29 10:54:11">
<ssl/>
<protocol max-threads="5" min-spare-threads="1"/>
<http-options/>
<advance/>
</http-listener>
<http-listener name="tong-http-listener"
port="8088"
status="started" address="0.0.0.0" io-mode="nio2" http2-enabled="false" ssl-enabled="false" redirect-port="8443" uri-encoding="GBK" use-body-encoding-for-uri="false" max-parameter-count="10000" max-post-size="3097152" parse-body-methods="POST" default-virtual-host="server" create-time="2019-10-29 10:54:11">
<ssl/>
<protocol not-allow-HTTP-methods="TRACE,OPTIONS,HEAD,CONNECT,DELETE" async-timeout="10000" enable-lookups="false" max-header-count="100" use-ipv-hosts="false" xpowered-by="false" backlog="100" accept-thread-count="1" connection-timeout="60000" keep-alive-timeout="60000" max-threads="5" min-spare-threads="1" processor-cache="200" tcp-no-delay="true" max-connections="10000" self-tuned="false">
<property name="threadPriority" value="5"/>
</protocol>
<http-options compression="on" compressable-mime-type="text/html,text/plain,text/xml" compression-min-size="2048" no-compression-user-agents="" disable-upload-timeout="true" max-http-header-size="8192" max-keep-alive-requests="100"/>
<advance disable-keep-alive-percentage="75" selector-timeout="1000" usecomet="true" use-sendfile="true" oom-parachute="1048576"/>
<property name="server" value="webserver"/>
</http-listener>
<http-listener name="ejb-server-listener"
port="5100"
uri-encoding="GBK" parse-body-methods="POST" default-virtual-host="server" create-time="2019-10-29 10:54:12">
<ssl/>
<protocol max-threads="5" min-spare-threads="1"/>
<http-options/>
<advance/>
</http-listener>
<!--  防SDOS攻击配置 -->
<property name="complete.message.timeout.seconds" value="0"/>
<property name="max.attack.times" value="3"/>
<property name="blacklist.expired.hours" value="12"/>
<property name="interrupt.current.connect" value="true"/>
</web-container>
<ejb-container>
<stateful/>
<singleton/>
<stateless/>
<mdb/>
</ejb-container>
<!-- 安全域配置 -->
<security-service>
<auth-realm name="defaultRealm" type="File">
<property name="UsersFile" value="twusers.properties"/>
<property name="GroupsFile" value="twgroups.properties"/>
</auth-realm>
</security-service>
<!-- 事务配置 -->
<transaction-service transaction-timeout-in-seconds="3600"/>
<!-- 数据源配置 -->
<jdbc-connection-pool name="testdb" is-multi="false" is-xa="false" dataSourceCreator="lite" jdbc-driver="com.mysql.jdbc.Driver" jdbc-url="jdbc:mysql://localhost:3316/platform?serverTimezone=UTC&amp;useSSL=false" user-name="platform" password="XdIDxiNaOk8nCiArVqmuZw==" jta-managed="true" default-auto-commit="true" commit-on-return="true" rollback-on-return="false" initial-size="10" max-active="20" min-idle="10" max-wait-time="30000" validation-query="SELECT 1" validation-query-timeout="5" test-on-borrow="true" test-on-connect="true" test-on-return="false" test-while-idle="false" time-between-eviction-runs="60000" min-evictable-idle-time="60000" remove-abandoned="false" propagate-interrupt-state="false" ignore-exception-on-pre-load="true" remove-abandoned-timeout="2" abandon-when-percentage-full="0" log-abandoned="false" jdbc-interceptors="StatusMonitor;QueryTimeoutInterceptor(queryTimeout=0)" validation-interval="30000" max-age="1800000" log-validation-errors="false" fair-queue="false" assoc-with-thread="false" leakCheck="false"/>
<monitor-service monitoring-enabled="false" flush-interval="60" flush-time-threshold="1800" persist-enabled="false" rotation-limit-val="10" rotation-limit-unit="MB">
<monitor-config name="Memory" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="JVMMemoryPool" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="GarbageCollector" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="JVMThread" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="Compilation" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="ClassLoading" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="Runtime" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="OperatingSystem" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="TWServer" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="ConnectorAndThreadPool" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="DataSource" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="DataSourceLite" monitoring-enabled="true" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="TransactionManager" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="JCA" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="WebModule" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="SessionManager" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="Loader" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
<monitor-config name="ResourceCache" monitoring-enabled="false" produce-interval="10" persistent-enabled="false"/>
</monitor-service>
<!-- JMX配置 -->
<jmx-service
port="7200"
address="127.0.0.1"
protocol="rmi"/>
<jms-service>
</jms-service>
<!-- 日志配置 -->
<log-service file="${tongweb.root}\logs\server.log" rotation-limit="50 MB" rotation-timelimit="0" rotation-file-count="20" rotation-by-day="false" log-format="[%d{yyyy-MM-dd HH:mm:ss SSS}] [%p] [%t] [%c] [%m]%n" rotation="true" verbose="true">
<module-log-levels ejb-container="INFO" web-container="INFO" cdi="INFO" jpa="INFO" jsf-impl="INFO" jsf-api="INFO" jta="INFO" jca="INFO" data-source="INFO" jms-resource="INFO" beanvalidation="INFO" naming="INFO" admin="INFO" configuration="INFO" deployment="INFO" monitor-service="INFO" core="INFO" security="FINEST" rmi-service="INFO" systemout="INFO" other="INFO" javamail="INFO"/>
<async-logger-config asynclogger-waitstrategy="Sleep" asynclogger-ringbuffersize="1024"/>
</log-service>
<log-save-path sql-log-path="logs" audit-log-path="logs/audit-log" persistence-log-path="persistence"/>
<compress-log-service compress-enabled="false,false,false" log-dir="${tongweb.root}/logs,${tongweb.root}/logs/access,${tongweb.root}/persistence" compress-obj="1,2,3" rotation-time="1,1,1" execution-time="1,1,1"/>
<snmp-service enabled="false" port="161" address="0.0.0.0" version="3" transportType="udp" engineID="62:a0:c1:81:11:c3:17:33" securityName="public" authKey="nmsAuthKey" privKey="myDesPriviateKey"/>
<jca-thread-pool name="default-thread-pool" min-threads="10" max-threads="200" queue="100" keep-alive-time="3600"/>
</server>
<!-- 快照配置 -->
<snapshot>
<auto-snapshot interval-second="5" relation="or">
<contents jstack="true" jmap="true" config="true" monitor="true" system-log="true" access-log="true" gc-log="true"/>
<cpu-condition times="10" times-unit="time" judgment="above" judgmentvalue="90%"/>
<memory-condition times="10" times-unit="time" judgment="above" judgmentvalue="90%"/>
<gc-condition judgment="above" judgmentvalue="60"/>
<halthttp-condition httpname="tong-http-listener" judgment="above" judgmentvalue="10"/>
</auto-snapshot>
<size-clear disk-remain-percent="20%" clear-percent="60%"/>
<time-clear timeout-day="30"/>
</snapshot>
</tongweb>

关键字: TongWeb主配置文件tongweb.xml概要说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 070
问题: TongWeb以非root用户启动使用80,443端口配置方法

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/113111709

---

需求：
想用http://IP或https://IP访问访问应用，而不用输入80,443端口，但基于安全考虑又不能用root用户启动TongWeb。注：Linux下只有root用户能使用80,433端口。
解决办法：
假如TongWeb只能以tongweb用户启停而不能用root用户，但需要使用80、443端口。
将JDK的bin下java命令文件属主改成root用户（通过chown命令）。
给JDK的bin下java命令文件加上s权限`chmod  +s  java`，这一步很重要。
s权限：设置使文件在执行阶段具有文件所有者的权限，相当于临时拥有文件所有者的身份。
以tongweb用户启动TongWeb，配置80、443端口就可以了。
这时通过ps –ef|grep java看到的java进程是root用户的，生成的相关文件(例如：tongweb日志)也是root用户的。
注意：只有对权限熟悉的运维人员才可以这样搞，否则会搞乱TongWeb和应用的文件权限，出现各种权限问题。
可能遇到的问题：启动tongweb时如果报错缺少so的库文件，这时需要从操作系统中找出到相应so文件加到LD_LIBRARY_PATH库的环境变量上即可，不同系统可能不同。

关键字: TongWeb以非root用户启动使用80,443端口配置方法
文档来源: 
--------------------------------------------------------------------------------

问题编号: 071
问题: TongWeb企业版与嵌入版引起的类冲突问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/123157657

---

问题现象 :
TongWeb企业版部署web应用，报错如下：
[2022-02-26 22:25:42 816] [SEVERE] [http-nio2-0.0.0.0-9060-exec-1] [core] [Parse error in application web.xml file at file:/D:/TongWeb /conf/default-web.xml]
org.xml.sax.SAXParseException; systemId: file:/D:/TongWeb /conf/
default-web.xml; lineNumber: 90; columnNumber: 15; Error at (90, 15) :
com.tongweb.catalina.startup.OpenEJBContextConfig$OpenEJBWebXml addServlet
at com.tongweb.web.util.digester.Digester.createSAXException(Digester.java:1911)
at com.tongweb.web.util.digester.Digester.createSAXException(Digester.java:1943)
at com.tongweb.web.util.digester.Digester.endElement(Digester.java:976)
at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:610)
at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1784)
at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2969)
at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:605)
at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:507)
at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:867)
at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:796)
at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:142)
at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1216)
at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:644)
at com.tongweb.web.util.digester.Digester.parse(Digester.java:1462)
at com.tongweb.web.util.descriptor.web.WebXmlParser.parseWebXml(WebXmlParser.java:119)
at com.tongweb.catalina.startup.ContextConfig.getDefaultWebXmlFragment(ContextConfig.java:1548)
at com.tongweb.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1112)
at com.tongweb.catalina.startup.OpenEJBContextConfig.webConfig(OpenEJBContextConfig.java:402)
at com.tongweb.catalina.startup.ContextConfig.configureStart(ContextConfig.java:775)
at com.tongweb.catalina.startup.OpenEJBContextConfig.configureStart(OpenEJBContextConfig.java:123)
at com.tongweb.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:299)
at com.tongweb.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:94)
at com.tongweb.catalina.core.StandardContext.startInternal(StandardContext.java:5172)
at com.tongweb.catalina.core.ThanosStandardContext.startInternal(ThanosStandardContext.java:250)
at com.tongweb.catalina.util.LifecycleBase.start(LifecycleBase.java:150)
at com.tongweb.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:734)
at com.tongweb.catalina.core.ContainerBase.addChild(ContainerBase.java:710)
at com.tongweb.catalina.core.StandardHost.addChild(StandardHost.java:725)
at com.tongweb.catalina.core.ThanosStandardHost.addChild(ThanosStandardHost.java:645)
at com.tongweb.web.thanos.startup.ThanosHostConfig.deployWar(ThanosHostConfig.java:230)
at com.tongweb.tw.thanos.ThanosWebtierWebAppBuilder.fireWebtierProcess(ThanosWebtierWebAppBuilder.java:448)
at com.tongweb.tw.thanos.ThanosWebtierWebAppBuilder.deployApplication(ThanosWebtierWebAppBuilder.java:360)
at com.tongweb.deploy.TongWebDeployer.deploy0(TongWebDeployer.java:337)
at com.tongweb.deploy.TongWebDeployer.deploy(TongWebDeployer.java:297)
at com.tongweb.deploy.commands.DeployCommand.deploy(DeployCommand.java:270)
at com.tongweb.console.deployer.service.DeployerService.deploy(DeployerService.java:764)
at com.tongweb.console.deployer.controller.DeployerController.deploy(DeployerController.java:391)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at org.jboss.resteasy.core.MethodInjectorImpl.invoke(MethodInjectorImpl.java:137)
at org.jboss.resteasy.core.ResourceMethodInvoker.invokeOnTarget(ResourceMethodInvoker.java:296)
at org.jboss.resteasy.core.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:250)
at org.jboss.resteasy.core.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:237)
at org.jboss.resteasy.springmvc.ResteasyHandlerAdapter.createModelAndView(ResteasyHandlerAdapter.java:96)
at org.jboss.resteasy.springmvc.ResteasyHandlerAdapter.handle(ResteasyHandlerAdapter.java:82)
at org.jboss.resteasy.springmvc.ResteasyHandlerAdapter.handle(ResteasyHandlerAdapter.java:26)
at org.jboss.resteasy.springmvc.ResteasyWebHandlerTemplate.handle(ResteasyWebHandlerTemplate.java:39)
at org.jboss.resteasy.springmvc.ResteasyHandlerAdapter.handle(ResteasyHandlerAdapter.java:47)
at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:967)
at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:901)
at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)
at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:872)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:648)
at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.web.websocket.server.WsFilter.doFilter(WsFilter.java:53)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.console.util.SpringI18nFilter.doFilter(SpringI18nFilter.java:46)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.console.commons.LoginFilter.doFilter(LoginFilter.java:50)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.console.commons.ConsoleFilter.doFilter(ConsoleFilter.java:68)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.tw.AuthorityFilter.doFilter(AuthorityFilter.java:47)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.console.commons.NoCacheFilter.doFilter(NoCacheFilter.java:18)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.console.audit.AuditFilter.doFilter(AuditFilter.java:112)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)
at com.tongweb.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)
at com.tongweb.catalina.core.ThanosStandardContextValve.invoke(ThanosStandardContextValve.java:107)
at com.tongweb.tomee.catalina.OpenEJBValve.invoke(OpenEJBValve.java:44)
at com.tongweb.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:570)
at com.tongweb.catalina.core.StandardHostValve.invoke(StandardHostValve.java:344)
at com.tongweb.tomee.catalina.OpenEJBSecurityListener$RequestCapturer.invoke(OpenEJBSecurityListener.java:97)
at com.tongweb.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
at com.tongweb.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)
at com.tongweb.catalina.core.ThanosStandardEngineValve.invoke(ThanosStandardEngineValve.java:43)
at com.tongweb.catalina.realm.RealmValve.invoke(RealmValve.java:21)
at com.tongweb.catalina.connector.ThanosCoyoteAdaptor.service(ThanosCoyoteAdaptor.java:469)
at com.tongweb.coyote.http11.Http11Processor.service(Http11Processor.java:867)
at com.tongweb.coyote.http11.ThanosHttp11Processor.service(ThanosHttp11Processor.java:19)
at com.tongweb.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
at com.tongweb.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:921)
at com.tongweb.web.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1625)
at com.tongweb.web.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
at com.tongweb.web.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:857)
at com.tongweb.web.util.net.Nio2Endpoint$Nio2SocketWrapper$2.completed(Nio2Endpoint.java:522)
at com.tongweb.web.util.net.Nio2Endpoint$Nio2SocketWrapper$2.completed(Nio2Endpoint.java:514)
at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)
at sun.nio.ch.Invoker$2.run(Invoker.java:218)
at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)
at com.tongweb.web.util.threads.TWThreadPoolExecutor.runWorker(TWThreadPoolExecutor.java:1172)
at com.tongweb.web.util.threads.TWThreadPoolExecutor$Worker.run(TWThreadPoolExecutor.java:628)
at com.tongweb.web.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.NoSuchMethodException: com.tongweb.catalina.startup.OpenEJBContextConfig$OpenEJBWebXml addServlet
at com.tongweb.web.util.IntrospectionUtils.callMethod1(IntrospectionUtils.java:374)
at com.tongweb.web.util.digester.SetNextRule.end(SetNextRule.java:145)
at com.tongweb.web.util.digester.Digester.endElement(Digester.java:973)
... 109 more
原因：
war应用包里的WEB-INF/lib目录下有tongweb-embed-7.0.E.*.jar，这样导致TongWeb企业版的类调用TongWeb嵌入版的类来解析TongWeb企业版的conf/default-web.xml文件。
#通过日志可看，如下为嵌入版的类at
com.tongweb.web.util.descriptor.web.WebXmlParser.parseWebXml(WebXmlParser.java:119)
#如下为企业版的类
at com.tongweb.catalina.startup.ContextConfig.getDefaultWebXmlFragment(ContextConfig.java:1548)
#最后嵌入版的类调用企业版的类，找不到方法
Caused by: java.lang.NoSuchMethodException: com.tongweb.catalina.startup.OpenEJBContextConfig$OpenEJBWebXml addServlet
at com.tongweb.web.util.IntrospectionUtils.callMethod1(IntrospectionUtils.java:374)
解决办法：
删掉web应用里 tongweb-embed-7.0.E.*.jar及相关的jar。 这些jar在war应用运行时不需要，只有在以spring boot jar方式时需要。

关键字: TongWeb企业版与嵌入版引起的类冲突问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 072
问题: TongWeb使用中容易混淆的JDBC数据源连接池

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/115036184

---

问题：
在应用开发、运维过程中，开发、运维人员常分不清采用的哪种JDBC数据源，有的直接答复是用的hibernate、MyBatis，这是上层的持久化框架。JDBC数据源常用的有：应用服务器自身的JNDI数据源、开源数据源 DBCP、 C3P0、Druid、hikari等。接下来我们介绍如何使用和配置。
数据源使用说明：
第一种：采用TongWeb的JNDI数据源，可自学下关于JNDI的知识。
1. 先将数据库驱动包放在TongWeb的lib目录下，并在控制台配置JDBC连接池。
注意：数据库JDBC驱动包由数据库厂家提供。
2. 通常代码调用方式
```java
//与控制台数据源名对应
Context initialContext=new InitialContext();
DataSource dataSource=(DataSource)initialContext.lookup("jdbc/testdb");
Connection con=dataSource.getConnection();
```
3. 采用类似tomcat调用数据源方式
```java
//通过java:comp/env方式调用， 可自学下关于JNDI的知识。
Context initialContext=new InitialContext();
DataSource dataSource=(DataSource)initialContext.lookup("java:comp/env/jdbc/testdb");
Connection con=dataSource.getConnection();
```
应用的web.xml中需增加如下配置
```xml
<resource-ref>
    <description>jdbc/testdb</description>
    <res-ref-name>jdbc/testdb</res-ref-name>
    <res-type>javax.sql.DataSource</res-type>
    <res-auth>Container</res-auth>
</resource-ref>
```
如果只是在lookup前加上java:comp/env可以不用像手册说明一样加tongweb-web.xml， 若需要改变lookup名再增加tongweb-web.xml。如：
```xml
//注意一下JNDI名对应关系
(DataSource)initialContext.lookup("java:comp/env/jdbc/testdb2");
//将tongweb-web.xml放在应用的WEB-INF目录
<?xml version="1.0" encoding="UTF-8"?>
<tongweb-web-app>
     <resource-links>
     <resource-link name="jdbc/testdb2" type="javax.sql.DataSource" global="jdbc/testdb" />
   </resource-links>
</tongweb-web-app>

//web.xml增加如下：
<resource-ref>
    <description>jdbc/testdb</description>
    <res-ref-name>jdbc/testdb</res-ref-name>
    <res-type>javax.sql.DataSource</res-type>
    <res-auth>Container</res-auth>
</resource-ref>
```
4. 切记：特殊的TongWeb7.0.C容器版跟tomcat一样，通过java:comp/env方式。
如果要问为什么跟TongWeb企业版、标准版不一样？ 答：思想意见不统一。
```java
Context initialContext=new InitialContext();
DataSource dataSource=(DataSource)initialContext.lookup("java:comp/env/jdbc/testdb");
Connection con=dataSource.getConnection();
```
```xml
//对应tongweb.xml配置文件中link-name
 <jdbc-connection-pool link-name="jdbc/testdb" name="jdbc/testdb2"
jdbc-driver="com.mysql.jdbc.Driver"
jdbc-url="jdbc:mysql://localhost:3316/platform?serverTimezone=UTC&amp;useSSL=false"  ......./>
```
第二种：采用开源数据源
应用采用开源数据源 DBCP、 C3P0、Druid、hikari等无需在TongWeb上进行配置，直接参考官网说明进行开发配置即可。如：DBCP官网`DBCP – Overview`；C3P0官网`https://www.mchange.com/projects/c3p0/`

Spring配置数据源
在实际项目中通常采用spring方式配置数据源，
这种方式的优势是可以在任一开源数据源、JNDI数据源之间切换。
//在jdbc.properties属性文件中定义属性值：
  jdbc.driverClassName= com.mysql.jdbc.Driver
  jdbc.url= jdbc:mysql://localhost:3309/sampledb
  jdbc.username=root
  jdbc.password=1234
  jdbc.initialSize=10
  jdbc.maxActive=50
......

//在spring中配置，读取jdbc.properties属性值，或是将值直接设置在spring xml中。
<bean id="propertyConfigurer"  class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="location" value="/WEB-INF/jdbc.properties"/>
</bean>
<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
        destroy-method="close">
    <property name="driverClassName" value="${jdbc.driverClassName}" />
    <property name="url" value="${jdbc.url}" />
    <property name="username" value="${jdbc.username}" />
    <property name="password" value="${jdbc.password}" />
    <property name="initialSize" value="${jdbc.initialSize}" />
    <property name="maxActive" value="${jdbc.maxActive}" />
......
</bean>
//采用TongWeb数据源，spring其本质还是通过(DataSource)initialContext.lookup("jdbc/testdb");
<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
     <property name="jndiName">
       <!-- TongWeb企业版、标准版方式 -->
       <value>jdbc/testdb</value>
    </property>
</bean>
或
<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
    <property name="jndiName">
      <!-- tomcat与TongWeb7.0.C容器版方式 -->
       <value>java:comp/env/jdbc/testdb</value>
    </property>
</bean>

数据源优化参数必选项：
最后说明一点：无论采用哪种数据源，在使用过程中一定要配置最小连接数、最大连接数、连接验证、测试SQL、连接超时这几项:
最大连接数：一定要先检查数据库剩余的可用连接数，不能超过数据库可用的连接数。
常见问题：不查数据库还允许多少个连接，直接配一个比数据库允许连接数还大的值。
测试SQL:用于验证所取连接是否有效，一定要配置最简单、执行效率最快的SQL。
连接验证：用于获取连接时发送“测试SQL”，以验证连接是否有效， 通常配合TongWeb的 “获取连接时验证”、DBCP的“testOnBorrow ”使用。若不配置，会导致当该连接池与数据库断开时，无法恢复有效的连接。
连接超时：必须配置一个时间。TongWeb默认30秒， DBCP的maxWait、C3P0的checkoutTimeout默认为无限。若不配置，会导致当无法从连接池获取连接时一直等待，造成线程阻塞。

```java
//典型的TongWeb无敌浩克hulk数据源满
java.sql.SQLTransientConnectionException: testdb - Numbers of connections  reached pool maxsize: {testdb}stats (total=10}, active={10} idle={0} waiting={0}) ,so request timed out after 30000ms.]
	at com.tongweb.hulk.pool.HulkPool.createTimeoutException(HulkPool.java:581)]
	at com.tongweb.hulk.pool.HulkPool.getConnection0(HulkPool.java:185)]
	at com.tongweb.hulk.pool.HulkPool.getConnection(HulkPool.java:118)]
	at com.tongweb.hulk.pool.HulkPool.getConnection(HulkPool.java:113)]
	at com.tongweb.hulk.HulkDataSource.getConnection(HulkDataSource.java:66)]
// 典型的DBCP取连接阻塞
"httpWorkerThread-9060-63" #104 daemon prio=10 os_prio=0 tid=0x0000007ec007c800 nid=0x700e waiting for monitor entry [0x0000007deebfb000]
   java.lang.Thread.State: BLOCKED (on object monitor)
         at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:294)
         - waiting to lock <0x00000006830e72c8> (a org.apache.commons.dbcp.PoolableConnectionFactory)
         at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1148)
         at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:96)
         at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:882)
//典型的C3P0死锁，注意看后面的APPARENT DEADLOCK!!!
[2021-03-27 09:56:43 938] [INFO] [Timer-1] [systemout] [2021-03-27 09:56:43,938 WARN [com.mchange.v2.async.ThreadPoolAsynchronousRunner] - com.mchange.v2.async.ThreadPoolAsynchronousRunner$DeadlockDetector@1798288e -- APPARENT DEADLOCK!!! Complete Status:
	Managed Threads: 3
	Active Threads: 3
	Active Tasks:
		com.mchange.v2.resourcepool.BasicResourcePool$AsyncTestIdleResourceTask@3ae1c4e (com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread-#1)
		com.mchange.v2.resourcepool.BasicResourcePool$AsyncTestIdleResourceTask@55a498ed (com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread-#2)
		com.mchange.v2.resourcepool.BasicResourcePool$AsyncTestIdleResourceTask@40aa8f31 (com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread-#0)
	Pending Tasks:
```

关键字: TongWeb使用中容易混淆的JDBC数据源连接池
文档来源: 
--------------------------------------------------------------------------------

问题编号: 073
问题: TongWeb使用端口及防火墙开通策略

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/116693658

---

前言
项目部署过程中需要规划TongWeb的使用端口及防火墙策略，否则会因端口不通导致各类问题。
一、TongWeb所使用端口说明
# TongWeb 系列产品端口与配置文件汇总表

| 服务程序 | 功能描述 | 默认端口/协议 | 端口作用 | 所在配置文件 |
| :--- | :--- | :--- | :--- | :--- |
| **TongWeb** | 提供服务的核心进程 | **8088** | 默认应用访问端口 | `conf/tongweb.xml` |
| | | **9060** | 默认控制台端口 | |
| | | **7200** | JMX 端口（另随机启动两个） | |
| | | **5100** | EJB 远程调用端口 | |
| | | **8005** | 默认服务停止端口 | |
| **Agent** | 节点代理，用于集中管理通信 | **7070** | 与 Master 通信端口 | `Agent/config/agent.xml` |
| | | **19090** | 与 Master 默认文件传输端口 | |
| **TongDataGrid** | 内存会话服务器 | **5701** | 默认 Session 复制端口 | `bin/tongdatagrid.xml` |
| **TongHttpServer**| 负载均衡器 | **443** | 默认负载对外访问端口 | `bin/https.conf` |
| | | **vrrp 协议** | 配 HA（高可用）时使用 | `conf/httpserverHA.conf` |

二、端口开启访问规则
基本原则：对外用户访问只暴露应用访问端口，其它端口为内部进程通信端口，只需对内放开，不需对外暴露。
场景1. TongWeb单机情况下
1. 对外用户访问需要开启8088应用端口或自定义的应用端口。
2. 内部局域网访问的情况下要开通9060控制台端口，要能访问控制台。
场景2：JMX监控的情况下
需要开启7200及固定两个相关端口，开启防火墙，具体见：https://blog.csdn.net/realwangpu/article/details/109506744
场景3：THS集群场景下
1. 对外用户访问需要开启THS默认443应用端口或自定义的应用端口。
2.对内要开启TongWeb的http 8088应用端口，使THS能够访问TongWeb。
3. THS开启HA的情况下，THS服务器要开启vrrp协议。
场景4：集群+session复制场景下
1. 对外用户访问需要开启负载的应用端口。
2.对内要开启TongWeb的http 8088应用端口，使负载能够访问TongWeb。
3.TongDataGrid的5701端口内部开放，使TongWeb能够访问，各个TongDataGrid节点之间也需要通过该端口互备数据。
场景5：heimdall集中管理场景下
1.heimdall节点要开放9060端口，使各个agent能够访问。
2. agent节点要开放7070、19090端口，使heimdall能够访问。
3. 各个agent节点管理的TongWeb 域控制台，如：9061要开放，使heimdall能够访问。

关键字: TongWeb使用端口及防火墙开通策略
文档来源: 
--------------------------------------------------------------------------------

问题编号: 074
问题: TongWeb关于AJP问题的解决方案

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109636309

---

关于
Apache Tomcat
文件包含问题（
CNVD-2020-10487
，
CVE-2020-1938
）
，TongWeb6、TongWeb7.0中间件也有集成AJP功能，因此如果系统所在服务器的TongWeb中间件配置并启用了AJP功能，则系统所在服务器有可能被此影响。
解决办法：
方法一 、系统没有配置AJP端口集群的情况，直接删除conf/tongweb.xml中的AJP端口配置即可，如下：
<ajp-listener name="tong-ajp-listener" address="0.0.0.0" default-virtual-host="server" port="8009" status="started" redirect-port="443" block-enabled="true" uri-encoding="GBK" use-body-encoding-for-uri="false" max-parameter-count="10000" max-post-size="2097152" parse-body-methods="POST" create-time="2020-01-15 14:47:54"></ajp-listener>
方法二、系统有配置AJP端口集群的情况，需要升级到有“ajp secret”配置的TongWeb版本。
同时Apache的worker.properties文件要设置对应的密码项, 如：
worker.worker1.secret=密码，  对应TongWeb AJP通道的ajp secret。

关键字: TongWeb关于AJP问题的解决方案
文档来源: 
--------------------------------------------------------------------------------

问题编号: 075
问题: TongWeb加载本地库常见UnsatisfiedLinkError异常问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109554060

---

开发的 Java 应用，有部分采用本地库开发，需要采用 JNI 方式调用。如何加载本地库?
重点要记住：
1. 32位JDK用32位本地库，64位JDK用64位本地库，注意通过linux的file命令查看本地库属性。
2. 本地库不能跨平台，不同window、linux版本不能混用，要在当前平台编译。
3. Java加载本地库通常是通过环境变量 Linux为LD_LIBRARY_PATH，windows为PATH加载，或是JDK的参数 -Djava.library.path指向so目录。 若设置 -Djava.library.path, 则系统环境变量的不生效。
4. TongWeb的bin目录通常为进程启始目录，也是加载本地库的目录。 若在其它目录启动TongWeb，则启始目录发生改变。
5.System.loadLibrary("hello"); 加载同一本地库只能加载一次，再加载就会报已加载的异常。
6.常见java.lang.UnsatisfiedLinkError异常就是本地库没做好，没有配好引起的。
举例说明linux下加载动态库的方式：
1. 本地库libhello.so放在/home/usr 下。Java代码调用： System.loadLibrary("hello");
2. 需设置环境变量： export LD_LIBRARY_PATH=/home/usr:$LD_LIBRARY_PATH。
3. 若不会设置环境变量，则修改TongWeb的startserver.sh或external.vmoptions启动脚本，增加或修改
-Djava.library.path=/home/usr:$LD_LIBRARY_PATH
4. 以上都不会设置的话，把so放在TongWeb 的bin目录，在bin目录下启动TongWeb即可。
常见问题： UnsatisfiedLinkError Native Library xxx.so already loaded  异常解决办法：
Web应用里引入so文件通过JNI调用，一旦应用重新部署而不重启java进程，so库又重新加载则会报该异常。建议java接口按如下方式改造一下。
static{
   //增加一个全局变量，只要加载过这个so就不再执行，除非进程重启才会清掉该变量。
   if(System.getProperty("myapplibrary")==null){
     System.setProperty("myapplibrary", "test.so");
     System.loadLibrary("test");
   }
}

关键字: TongWeb加载本地库常见UnsatisfiedLinkError异常问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 076
问题: TongWeb卡、TongWeb卡、TongWeb卡卡卡

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109534310

---

问题描述：
现象一. TongWeb启动时卡住了起不来、启动慢。
现象二：TongWeb部署应用时卡在70%不动了。
现象三：TongWeb访问量大时，CPU也不高，JVM内存也够，但就是慢。
现象四：执行stopserver.sh无效，停不下来TongWeb。
问题原因：
多数是由于TongWeb中的应用阻塞导致的。
解决办法：
一定要善用JDK的jstack命令，这是一个分析Java线程的常用命令。
一定要在当前进程卡或慢时执行如下操作，
注意：过了这村就没这店了。千万不要重启TongWeb后再操作，此时已无效。
1. 执行：  jstack  <PID>   >  tongweb.log    把线程栈输出到文件中分析。
注：  <PID>替为TongWeb的进程号，千万别直接输<PID>。
2. 极端情况 Java进程反应不过来，执行jstack无效或没装JDK，没有jstack命令。  这时可以执行 ：kill -3  <PID> ，日志输出在TongWeb的logs/jvm.log中。
注：kill -3不是杀进程。注意保存jvm.log，重启TongWeb后该文件重写。
生成文件后重点看BLOCKED或WAITING线程，间隔几秒多执行几次jstack，若看到BLOCKED或WAITING在同一位置，多个线程锁在同一个地址则可能是这里的原因。
重点查看线程:
1. 如果是应用运行过程中存在线程问题，多关注以端口类型和端口号命名的线程池，如："http-nio-8088-exec-342"
"http-nio-8088-exec-342"
#3049 daemon prio=5 os_prio=0 tid=0x00007f539006f800 nid=0x48da runnable [0x00007f537d4af000]
java.lang.Thread.State: RUNNABLE
at java.net.SocketInputStream.socketRead0(Native Method)
at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
at java.net.SocketInputStream.read(SocketInputStream.java:171)
at java.net.SocketInputStream.read(SocketInputStream.java:141)
at com.mysql.jdbc.util.ReadAheadInputStream.fill(ReadAheadInputStream.java:101)
at com.mysql.jdbc.util.ReadAheadInputStream.readFromUnderlyingStreamIfNecessary(ReadAheadInputStream.java:144)
at com.mysql.jdbc.util.ReadAheadInputStream.read(ReadAheadInputStream.java:174)
- locked <0x00000006c4718ab8> (a com.mysql.jdbc.util.ReadAheadInputStream)
at com.mysql.jdbc.MysqlIO.readFully(MysqlIO.java:3011)
at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:3472)
2. 如果是通过控制台部署应用卡，则多关注以控制台端口命名的线程池，且含有
deploy
关键字的线程，如："http-nio2-9060-exec-9060-63"。
部署卡到70%常见的主要情况为：应用采用开源数据源，但没有配连接超时参数，在部署应用、大并发时获取到不连接，一直卡在获取数据库连接上。
"http-nio2-9060-exec-63"
#104 daemon prio=10 os_prio=0 tid=0x0000007ec007c800 nid=0x700e waiting for monitor entry [0x0000007deebfb000]
java.lang.Thread.State: BLOCKED (on object monitor)
at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:294)
- waiting to lock <0x00000006830e72c8> (a org.apache.commons.dbcp.PoolableConnectionFactory)
at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1148)
at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:96)
at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:882)
3. 如果是TongWeb启动慢，则重点看main主线程即可。
"main"
#1 prio=5 os_prio=0 tid=0x0000ffffb404f000 nid=0x7486 runnable [0x0000ffffbba2b000]
java.lang.Thread.State: RUNNABLE
at java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method)
at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:928)
at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1323)
at java.net.InetAddress.getLocalHost(InetAddress.java:1500)
- locked <0x00000005c008eb50> (a java.lang.Object)
at dm.jdbc.dbaccess.DbPureAccess.isLocalHost(DbPureAccess.java:220)
4. 要善于利用文本工具Notepad++等的统计功能，查看多个线程是否BLOCKED或WAITING在同一地址。
注意：(1). 多线程锁在同一地址的才有问题。(2). 偶尔一、两个BLOCKED或WAITING不是问题。(3).千万别一看到locked就认为有问题。
如上图是一个典型的数据源满在等数据源连接的一个性能问题。 而如下则没有问题，只是http线程池的空闲等待。
"http-nio2-8088-exec-3" #32 daemon prio=5 os_prio=0 tid=0x000000001bf2a000 nid=0x2198 waiting on condition [0x0000000022dbe000]
java.lang.Thread.State: WAITING (parking)
at sun.misc.Unsafe.park(Native Method)
- parking to wait for  <0x0000000080c5a5d8> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
at com.tongweb.web.util.threads.TaskQueue.take(TaskQueue.java:103)
at com.tongweb.web.util.threads.TaskQueue.take(TaskQueue.java:31)
at com.tongweb.web.util.threads.TWThreadPoolExecutor.getTask(TWThreadPoolExecutor.java:1094)
at com.tongweb.web.util.threads.TWThreadPoolExecutor.runWorker(TWThreadPoolExecutor.java:1156)
at com.tongweb.web.util.threads.TWThreadPoolExecutor$Worker.run(TWThreadPoolExecutor.java:628)
at com.tongweb.web.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
at java.lang.Thread.run(Thread.java:748)
另外推荐一个show-busy-java-threads.sh脚本，可以分析每个线程占用的CPU。
https://github.com/oldratlee/useful-scripts/blob/master/docs/java.md#beer-show-busy-java-threadssh

关键字: TongWeb卡、TongWeb卡、TongWeb卡卡卡
文档来源: 
--------------------------------------------------------------------------------

问题编号: 077
问题: TongWeb及应用系统安全加固

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/115348676

---

前言
本文档主要面向运维人员说明常见的TongWeb6、TongWeb7安全加固的配置方法。
TongWeb配置
一、首先建议TongWeb升级到最新版本，早期版本存在一些代码级安全漏洞，无法通过配置解决。截止2021年4月15日TongWeb最新版本号为7.0.4.3。
二、TongWeb禁用
不安全的
HTTP方法，可登录控制台，进入
“http
通道管理
”
进行设置。
若用的TongWeb控制台上无此配置，则
需在应用的
web.xml
中增加如下内容，并重新部署生效。（
二选一，应用配web.xml最佳
）
<?xml?version="1.0"?encoding="UTF-8"?>
.......
 <security-constraint>
    <web-resource-collection>
       <url-pattern>/*</url-pattern>
      <!--  加入禁用的方法 -->
       <http-method>DELETE</http-method>
       <http-method>HEAD</http-method>
       <http-method>OPTIONS</http-method>
       <http-method>TRACE</http-method>
    </web-resource-collection>
    <auth-constraint>
    </auth-constraint>
 </security-constraint>
三、远程访问过滤，限制客户端访问的IP，可在虚拟主机中设置。
登录控制台，进入
“
虚拟主机管理
”
的相应虚拟主机进行设置。具体参考
TongWeb
用户手册。
四、TongWeb控制台与应用访问端口由http改为https，见：
https://blog.csdn.net/realwangpu/article/details/109527473
五、TongWeb老版本默认带AJP端口，修改配置见：
https://blog.csdn.net/realwangpu/article/details/109636309
六、TongWeb防SDOS攻击和HOST头攻击，见：
https://blog.csdn.net/realwangpu/article/details/109553849
七、使用X-Frame-Options防止网页被Frame。
TongWeb6、TongWeb7在启动脚本设置参数：-Dtongweb.X_Frame_Options，防止网页被Frame。可设置参数值如下：
参数值
说明
DENY
浏览器拒绝当前页面加载任何Frame页面
SAMEORIGIN
frame页面的地址只能为同源域名下的页面
ALLOW-FROM
允许frame加载的页面地址
八、HTTP头不暴露应用服务器名称
不要在HTTP头中暴露所用的应用服务器名称,如：
HTTP/1.1 200 OK
Content-Type: text/javascript;charset=utf-8
Content-Length: 631
Server: TongWeb Server
TongWeb6,TongWeb7在控制台的http通道中，相应端口的“其它property属性”设置server值，如下：
TongWeb6.0.6.0及以下老版本改法，如下：
# TongWeb5改http头的server名：
将lib下twns-ee.jar中的com\tongweb\advance\server\Version.properties文件
product.name=TongWeb Server  中TongWeb Server改为其它名字即可。
#TongWeb6改http头的server名：
将lib下common.jar中Version.properties 的TongWeb Server改为其它名字即可。
product.name=TongWeb Server
abbrev.product.name=TongWeb Server
九、TongWeb7.0.4.2打开控制台登录验证码，将-DdisableVerCode=true改为false。更改TongWeb控制台密码、有效期,  见：
https://blog.csdn.net/realwangpu/article/details/109509933
十、通过HTTP Referer头禁用指定的开启验证HTTP Rererer 请求头，不被允许的 Referer请求将被禁止，返回 HTTP状态码 403，默认不开启。开启后可填写允许的主机和允许的IP地址。如果允许的主机和允许的IP地址都为空，将禁止所有的Referer请求,但是来自服务器本机的Referer请求仍然可以处理。
十一、TongWeb7控制台实行三员分立
“ 三员分立” 要求系统管理员、 安全保密管理员、 安全审计员三者之间的关系相互独立、 互相制约， 加强涉密信息系统保密管理， 减少泄密风险。
角色
用户名
密码
默认系统管理员
thanos
thanos123.com
默认安全保密管理员
security
security123.com
默认安全审计员
auditor
auditor123.com
十二、设置TongWeb7审计日志
审计日志文件存储目录为 TW_HOME/logs/audit-log/， 当前使用的日志文件名称为 audit.log， 轮转的日志文件按轮转时刻的日期和时间命名。通过-D 参数可以配置日志相关功能。
参数
含义
-Daudit.log.enabled
审计日志开关， boolean 类型， true 表示开启审计日志记录功能， false 表示关闭审计日志记录功能， 默认值为 true。
-Daudit.log.file.maxSize
审计日志文件按大小轮转阈值，长整数类型， 单位“KB”， 默认值为 1048576， 即10 MB。
-Daudit.log.file.retentionDays
审计日志文件按日期清理阈值， 整数类型， 单位为“天”， 默认值为180， 即 6 个月。
十三、没有用JMS则删除TongWeb的apache-activemq目录，没有用session复制则删除TongWeb的TongDataGrid或Hazelcast目录、samples例子目录也可以删。 这些里面含一些开源组件可能会扫出漏洞。
十四、防止利用sysweb应用上传文件，可以将TongWeb6/7安装目录下applications\sysweb\WEB-INF\web.xml里的upload  servlet删除，如下：
<servlet>
<servlet-name>
upload
</servlet-name>
<servlet-class>com.tongweb.admin.jmx.remote.server.servlet.
AppUploadServlet
</servlet-class>
</servlet>
<servlet-mapping>
<servlet-name>
upload
</servlet-name>
<url-pattern>/upload</url-pattern>
</servlet-mapping>
#关闭该功能后仅是不能通过commandstool命令行远程部署应用，commandstool本地部署应用和通过控制台本地和远程部署应用不受影响。
如果要修改commandstool命令行工具的用户密码，可通过bin目录下的commandstool命令修改，具体可参考对应版本手册。
#TongWeb6.1.5.12及之后版本用户为cli，密码为cli123.com
commandstool> change-admin-password --user cli
Please enter the old admin password>cli123.com
Please enter the new admin password>cli456.com
Please enter the new admin password again>cli456.com
#TongWeb6.1.5.12之前版本用户为root，密码为root
commandstool> change-admin-password --user root
Please enter the old admin password>root
Please enter the new admin password>cli456.com
Please enter the new admin password again>cli456.com
以上配置完成后，重启TongWeb即可。
应用配置
一、 设置应用JSESSIONID、httponly属性，见：
https://blog.csdn.net/realwangpu/article/details/109711846
二、增加安全头信息
某些应用根据安全需求需要在http头上增加X-Content-Type-Options、X-XSS-Protection、Content-Security-Policy等安全信息，可在应用中加filter。TongWeb自带com.tongweb.catalina.filters.CorsFilter可配在应用中，具体请参考《TongWeb7用户使用手册》
public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
   if ((response instanceof HttpServletResponse)) {
       HttpServletResponse httpResponse = (HttpServletResponse)response;
       httpResponse.setHeader("X-Content-Type-Options", "nosniff");
       httpResponse.setHeader("X-XSS-Protection", "1; mode=block");
       httpResponse.setHeader("Content-Security-Policy", "default-src 'self';");
    }
   chain.doFilter(request, response);
}
三、web.xml配置错误页面
在应用WEB-INF/web.xml中增加如下信息和相应页面。如果访问非应用前缀出现404错误，可部署一个前缀为 /  的应用，拦截后做错误页跳转。
<error-page>
    <error-code>403</error-code>
    <location>/403.html</location>
</error-page>
<error-page>
    <error-code>404</error-code>
    <location>/404.html</location>
</error-page>
四、特定的URL请求由http强制调转到https端口
1. 首先在TongWeb上配置http、https端口，http通道中做重定向https端口配置。
2.应用web.xml里配置重定向的URL规则。
<security-constraint>
  <web-resource-collection >
    <web-resource-name >SSL</web-resource-name>
    <url-pattern>/*</url-pattern>
  </web-resource-collection>
  <user-data-constraint>
    <transport-guarantee>CONFIDENTIAL</transport-guarantee>
  </user-data-constraint>
</security-constraint>
五、升级应用中有安全漏洞的开源框架，如：spring、ActiveMQ等，可在
https://www.cnvd.org.cn
查询。

关键字: TongWeb及应用系统安全加固
文档来源: 
--------------------------------------------------------------------------------

问题编号: 078
问题: TongWeb因host表配置不正确导致启动慢、主机名解析失败的解决办法

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109503682

---

现象一：
在部署上应用后，TongWeb启动慢，这时可以查看TongWeb的server.log日志看执行时间慢在哪里。 当日志走到这部分时，通过jstack  <PID>   命令打印出线程栈，可以查看到具体信息。
如下可以明显看到数据库驱动在执行getLocalHost代码，若host表配置不对会导致getLocalHost执行时间长。
```bash
"main" #1 prio=5 os_prio=0 tid=0x0000ffffb404f000 nid=0x7486 runnable [0x0000ffffbba2b000]
java.lang.Thread.State: RUNNABLE at java.net.Inet6AddressImpl.lookupAllHostAddr
(Native Method)
at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:928)
at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1323)
at java.net.InetAddress.getLocalHost(InetAddress.java:1500)
- locked <0x00000005c008eb50> (a java.lang.Object)
at dm.jdbc.dbaccess.DbPureAccess.isLocalHost(DbPureAccess.java:220)
at dm.jdbc.dbaccess.DbPureAccess.setHostName(DbPureAccess.java:201)
at dm.jdbc.dbaccess.DbPureAccess.<init>(DbPureAccess.java:105)
at dm.jdbc.dbaccess.DbAccess.<init>(DbAccess.java:50)
at dm.jdbc.driver.DmdbConnection_bs.tryConnInner(DmdbConnection_bs.java:629)
at dm.jdbc.driver.DmdbConnection_bs.tryConnRandom(DmdbConnection_bs.java:692)
at dm.jdbc.driver.DmdbConnection_bs.tcpIpProtocal(DmdbConnection_bs.java:722)
at dm.jdbc.driver.DmdbConnection_bs.conCommLayer(DmdbConnection_bs.java:751)
at dm.jdbc.driver.DmdbConnection_bs.openConnection(DmdbConnection_bs.java:763)
at dm.jdbc.driver.DmdbConnection_bs.commInit(DmdbConnection_bs.java:736)
at dm.jdbc.driver.DmdbConnection_bs.initialize(DmdbConnection_bs.java:460)
at dm.jdbc.driver.DmdbConnection_bs.<init>(DmdbConnection_bs.java:341)
at dm.jdbc.driver.DmDriver_bs.connect(DmDriver_bs.java:100)
at dm.jdbc.driver.DmDriver.connect(DmDriver.java:86)
at java.sql.DriverManager.getConnection(DriverManager.java:664)
```
现象二：
应用程序报主机名找不到
```bash
Caused by: java.net.UnknownHostException: xxxxxxxx
at java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method)
at java.net.InetAddress$1.lookupAllHostAddr(InetAddress.java:901)
at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1293)
at java.net.InetAddress.getLocalHost(InetAddress.java:1469)
... 41 more
```
通常host表主机名与IP映射不正确，TongWeb启动慢、主机名解析失败的解决方法如下：
1. 确定本机实际IP是多少，譬如：192.168.75.1
2. 敲命令hostname, 看输出主机名，譬如： host01。
3.  ping host01,  看是否能ping通，且ping出的IP是不是192.168.75.1。
4.  如果不对，就在/etc/hosts文件第一行写上主机名与IP
如：host01  192.168.75.1
5. 若是只用IPv4，则把external.vmoptions文件中的-Djava.net.preferIPv4Stack=false改为true
6. 再ping 主机名，ping通了就可以了。

关键字: TongWeb因host表配置不正确导致启动慢、主机名解析失败的解决办法
文档来源: 
--------------------------------------------------------------------------------

问题编号: 079
问题: TongWeb因sigar而崩溃

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109639529

---

问题描述：
在某些平台下启动TongWeb后JVM进程崩溃，在TongWeb的bin目录下生成hs_err_pid*.log文件，开头内容如下：
#
#  EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x0000000010014ed4, pid=19512, tid=0x0000000000004fbc
#
# JRE version: Java(TM) SE Runtime Environment (8.0_261-b12) (build 1.8.0_261-b12)
# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.261-b12 mixed mode windows-amd64 compressed oops)
# Problematic frame:
# C
[sigar-amd64-winnt.dll+0x14ed4]
#
# Failed to write core dump. Minidumps are not enabled by default on client versions of Windows
解决办法：
sigar用于监控机器CPU、内存，删除后不影响TongWeb使用。
1.增加启动参数-DenableSigar=false关闭sigar。
2. 将TongWeb的lib/sigar目录删除即可。

关键字: TongWeb因sigar而崩溃
文档来源: 
--------------------------------------------------------------------------------

问题编号: 080
问题: TongWeb在Linux下设置开机自启动

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109715096

---

TongWeb在Linux下设置开机自启动：
1. 在专用机下TongWeb安装完成即是开机自启动，无需设置。
2. 在TongWeb  bin目录下installservice.sh命令可做成自启动，具体请看doc目录下TongWeb用户手册。
注：自TongWeb7.0.4.2开始直接运行TongWeb  bin目录下的installservice.sh命令，即完成systemd服务注册。
具体说明：
方式一  专用机和执行installservice.sh命令：
专用机和执行installservice.sh命令是以systemd⽅式管理TongWeb服务，installservice.sh命令需要以root用户执行，该方式是将TongWeb 的service/linux/tongweb.service文件修改复制到/etc/systemd/system/、/usr/lib/systemd/system目录下，其内容如下：
[Unit]
Description=TongWeb Server
After=network.target
[Service]
Type=forking
Environment="JAVA_HOME=/home/jdk8"
#ExecStart=/home/tongweb7/bin/startserver.sh restart
ExecStart=/home/tongweb7/bin/boot.sh
#ExecStop=/home/tongweb7/bin/stopserver.sh stop
PrivateTmp=false
# Disable service start and stop timeout logic of systemd for tongweb service.
TimeoutSec=0
[Install]
WantedBy=multi-user.target
注：boot.sh为自启动该TongWeb所有域，所以只能启动，不能查看运行状态和停止。
方式二：修改systemd⽅式管理TongWeb服务
如果想修订systemd⽅式的启动参数，可直接修改TongWeb 的service/linux/tongweb.service文件，重新执行installservice.sh命令以生效。
[Unit]
Description=TongWeb Server
#在数据库后启动
After=database.target
[Service]
Type=forking
#指定启动用户
User=wangchao
Environment="JAVA_HOME=/home/jdk8"
#进程文件
PIDFile=/home/tongweb7/tongweb.pid
ExecStart=/home/tongweb7/bin/startservernohup.sh
ExecStop=/home/tongweb7/bin/stopserver.sh
PrivateTmp=false
# Disable service start and stop timeout logic of systemd for tongweb service.
TimeoutSec=0
[Install]
WantedBy=multi-user.target
注意如上方式：
1. 启动改为startservernohup.sh单实例启动，同时TongWeb7.0.4.5及之后版本有了 -Dpid_file_path=/home/tongweb7/tongweb.pid参数，于是可以设置服务的PIDFile，通过systemctl status tongweb   命令能查看该实例真实的运行状态。
2. 若需要自启动多个域，可建多个TongWeb  自启动服务，这样每个域的启动、停止、运行状态都可以分别操作。
3. 其它命令：systemctl disable tongweb  注销自启动； systemctl enable tongweb  开机自启动；journalctl -u tongweb 查看服务日志。
方式三：
在/etc/rc.d/rc.local文件中加入TongWeb的启动命令即可。rc.local要有x权限，内容如下：
#切到TongWeb用户
su - ｛TongWeb用户名｝
#设置JAVA_HOME, 设了环境变量也要设，因为这时环境变量还没生效
export JAVA_HOME=/home/jdk7
#进入tongweb目录启动
cd /home/tongweb7/bin
nohup ./startserver.sh &
#这样写脚本最简单。rc.d的目录受启动级别的影响。有的linux下不能换行写，这样写一行
su - root -c  "export JAVA_HOME=/home/jdk7 ; cd /home/tongweb7/bin ; nohup ./startserver.sh &"
注：自启动方式环境变量可能没有生效，所以需要将JAVA_HOME、LD_LIBRARY_PATH等相关环境变量写入启动脚本中。

关键字: TongWeb在Linux下设置开机自启动
文档来源: 
--------------------------------------------------------------------------------

问题编号: 081
问题: TongWeb安装问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109540961

---

在Linux下字符界面安装TongWeb，执行 ./Install_TW7.0.4.1_Enterprise_Linux.bin -i console  仍报错如下：
=======================================================
Installer User Interface Mode Not Supported    或如图中文
Unable to load and to prepare the installer in console or silent mode.
=======================================================
根本原因是缺少Xorg补丁，为了快速安装，可采取如下办法：
解决办法一：
1.先执行 export DISPLAY= 注意是无值的
2. 再执行./InstallTongWeb.bin -i console 可解决。
解决办法二：去掉“转发X11连接到”
若以上办法都无效，则采用终极解决办法，用TW_7041_Enter_Liunx.tar.gz绿色版解压安装。
还有一种情况是操作系统默认为OpenJDK11, 运行TongWeb  bin安装程序报找不到Java虚拟机，这是因为目前bin安装程序还不支持高版本JDK，这时也可以用tar.gz解压安装，TongWeb启动运行可以支持OpenJDK11版本。

关键字: TongWeb安装问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 082
问题: TongWeb对IPv4、IPv6的支持

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/111952963

---

问题：
TongWeb是否支持IPv4、IPv6双栈？
答复：
支持，细则如下：
在说明TongWeb如何支持IPv4、IPv6的，先来说明下JDK对IPv4、IPv6两个重要支持参数
：-Djava.net.preferIPv4Stack=false    -Djava.net.preferIPv6Stack=false
java.net.preferIPv4Stack（默认值false）
官方文档解释：
If IPv6 is available on the operating system, the underlying native socket will be an IPv6 socket. This allows Java applications to connect to, and accept connections from, both IPv4 and IPv6 hosts.
当
java.net.preferIPv4Stack
为默认值false时，在支持IPv6的双栈系统上，使用Java的Socket会默认通过底层native方法创建一个IPv6 Socket，这个IPv6 Socket可以同时支持和IPv4或IPv6主机通信。如果设置为true，Java程序将无法使用IPv6进行网络通信，也就是仅支持IPv4。
java.net.preferIPv6Addresses（默认值false）
官方文档解释：
By default, IPv4 addresses are preferred over IPv6 addresses, for example, when querying the name service (for instance, DNS service), IPv4 addresses would be returned ahead of IPv6 addresses.
当
java.net.preferIPv6Addresses
为默认值false时，IPv4地址会优先使用，例如在DNS通过域名查询IP地址时，会优先使用IPv4地址，反之设为true，则会优先使用IPv6地址。
因此TongWeb默认
bin/external.vmoptions中-Djava.net.preferIPv4Stack=false
以同时支持IPv4、IPv6。
但是往往招标需求与实际使用不符，截止目前还有很多实际生产环境还没有采用IPv6，而服务器网卡却有IPv6地址，导致IPv6引起的各种启动问题，例如：
Caused by: java.lang.IllegalArgumentException: cannot use an unresolved DNS server
address: [fe80::1%enp125s0f1]:53
at io.netty.resolver.dns.DnsServerAddresses.sanitize(DnsServerAddresses.java:179)
at io.netty.resolver.dns.DnsServerAddresses.sequential(DnsServerAddresses.java:67)
at io.netty.resolver.dns.DefaultDnsServerAddressStreamProvider.<clinit>(DefaultDnsServerAddressStreamProvider.java:109)
... 170 more
main" #1 prio=5 os_prio=0 tid=0x0000ffffb404f000 nid=0x7486 runnable [0x0000ffffbba2b000]
java.lang.Thread.State: RUNNABLE
at java.net.
Inet6AddressImpl
.lookupAllHostAddr(Native Method)
at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:928)
at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1323)
at java.net.InetAddress.getLocalHost(InetAddress.java:1500)
要是想禁用IPv6怎么办？
解决办法：bin/external.vmoptions中-Djava.net.preferIPv4Stack设为true。
要是一定要用IPv6,但绑定的是错误的IPv6，导致7200端口启动不起来，怎么办?
解决办法：bin/external.vmoptions中加参数绑定IPv6 -Djava.rmi.server.hostname=[fe80::b0ce:dbf7:2644:dfca]  记得要有中括号。
注意:TongWeb一些老版本还需在conf/tongweb.xml中<jmx-service port="7200" address="[fe80::b0ce:dbf7:2644:dfca]" protocol="rmi"/>绑定IP。
课外知识：要学习IPv6的地址格式。如：http://[::1]:9060/console  中 [::1] 相当于127.0.0.1

关键字: TongWeb对IPv4、IPv6的支持
文档来源: 
--------------------------------------------------------------------------------

问题编号: 083
问题: TongWeb应用移植说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/151955350

---

本文主要指导用户如何将应用移植到TongWeb上，替代Weblogic 、WebSphere 、tomcat、JBoss、Jetty等产品。主要针对有移植需求的用户，前期了解移植过程，对移植要求、步骤有一个初步的认知。
一、TongWeb可移植的应用
TongWeb为JavaEE/JakartaEE应用服务器，移植的应用主要是采用JavaEE/JakartaEE规范标准开发的java应用。不适合移植到TongWeb上的应用：
1.  NET应用为Microsoft 的开发平台，支持ARM、X86等Linux平台，某些国产操作系统也声明支持，但其本身不需要TongWeb来运行。
2.  PHP应用TongHttpServer产品支持。
二、梳理应用基本架构
多数情况下用户并不了解应用开发实际采用的JavaEE/JakartaEE规范，对版本规范之间的差异也并不清楚，所以用户可以从以下几个其它方面来判断应用采用的JavaEE/JakartaEE规范标准，然后根据应用的规范来规划移植的步骤。
1. 通过应用采用的JDK版本来判断。若应用可以在JDK1.7上运行，则说明不可能采用JavaEE8规范。但反之并不成立，采用了JDK1.8，并不代表采用了JavaEE8规范。
2. 通过应用采用的开源框架来判断采用的规范，开源框架网站通常有对容器的规范要求，通过官方说明即可判断。比如：用Spring Boot2.x，Spring Framework6.x、Spring Boot3.x。
而有些应用采用的组件是绑定某种应用服务器的，无法直接移植，如: Kettle是免费的开源轻量级ETL工具，是基于Java语言开发的，其内嵌的jetty是采用API方式，这种方式必然涉及到代码的修改。
3. 应用包结构检查
主要检查应用包的结构，以判断需要采用的TongWeb版本，以及是否需要对应用包进行改造：
(1) 根据采用的应用服务器来检查，若是tomcat则可以判断为web应用，若是Weblogic等，则重点检查有没有EJB。
(2)  若应用包含有ejb jar则特别注意，不同应用服务器ejb jar的JNDI命名规则不同，
EJB2.x的配置文件不同应用服务器不同， 如：Weblogic的weblogic-ejb-jar.xml和WebSphere的ibm-ejb-jar-bnd.xml对应TongWeb的tongweb-ejb-jar.xml文件。
(3) 若应用为嵌入式jar/war包，则重点检查是以Spring Boot方式使用的，还是直接以API方式直接启动容器的，并采用TongWeb嵌入版。
4. 更加深入的了解则需要查看应用代码，重点查看使用的JavaEE  API，有没有采用绑定某一应用服务器的代码。但此方式仅适合移植出现问题时参考应用代码，并不适合移植前查看应用所有代码。
5. 了解其在其它应用服务器上的配置
通过了解应用在其它应用服务器上的配置，以了解应用用了哪些功能，如：数据源、安全域、JMS配置等等。这些配置将来也需要配置在TongWeb上。以最常见的数据源为例：若在tomcat上配置了数据源，则相应用需要在TongWeb上配置数据源。若应用采用第三方开源数据源，则无需在TongWeb上配置。

三、通过应用服务器做初步的分析
某些场景下用户并不清应用采用了哪些JavaEE规范、组件，只能说明采购的应用服务器及版本，这种情况下只能通过用户采购的应用服务器及版本来做初步的判断：通过应用服务器及版本，来判断应用的大概架构。
JavaEE规范常用应用服务器版本
Java EE6
TongWeb6.1、Weblogic12.1.x、WebSphere8.x、tomcat7(web容器)
Java EE7
TongWeb7.0、Weblogic12.2.x、WebSphere9.x、tomcat8.x(web容器)
Java EE8
TongWeb7.0/8.0、tomcat9.x 、Weblogic14.x、WebSphere Liberty18.x
Jakarta EE9
TongWeb8.0、tomcat10.x、WebSphere Liberty21.x
例如：
1. 若应用采用tomcat10版本，则一定是采用了Jakarta EE9规范，jakarta命名空间的应用。则一定要用TongWeb8.0 jakarta命名空间方式来移植。
2. 若应用采用了Jetty、undertow，则大概率采用的是嵌入式方式，嵌入式方式也分为Spring Boot方式和
直接以API方式直接启动容器的方式。
3. 若应用采用了Weblogic、WebSphere等商用中间件，则有可能采用了EJB，这是在后期移植时需要通过迁移工具移植的，还有检查应用是否采用了Oracle、IBM公司一些相关产品。
注意：用户用Weblogic、WebSphere、JBoss时不用过份强调EJB移植，只有在一些老旧应用移植时才有可能会遇到EJB2.x的移植。 近年即使采用Weblogic、WebSphere、JBoss的应用也很少采用EJB技术。
仅仅知道应用服务器及版本只能做大概的移植判断，归根结底还是要以分析应用架构为准。原因是应用服务器的使用方式是多样的，并不能从应用服务器本身判断应用的情况，
某些人存在严重的理解误区：总以为根据原来用的JavaEE应用服务器是什么就能写出移植方案。
例如：
1. 某一用户用的tomcat9.0版本，则有可能是嵌入式方式，也有可能是通常的web应用方式。
2. 某一用户采够了weblogic8.1-weblogic12c等各个版本分散在各个项目上使用，有的项目应用可能采用了老规范的EJB 2.x版本，涉及EJB  xml文件的移植；有的项目应用则是纯web应用；有的项目应用还用了IBM MQ。这种情况就不能仅仅通过应用服务器及版本来判断了。
3. 有的说undertow很少用过，不知怎么移植。这可以判断是嵌入式方式，本质还是看应用的JavaEE/JakartaEE规范，引入的Spring Boot版本。
四、国产平台迁移环境
迁移应用前还要考察是否适配国产平台，主要从几方面考虑：
1. 国产平台多以龙芯、飞腾、鲲鹏、申威、海光、兆芯等CPU的国产操作Linux环境为主，涉及到CPU指令集不同、windows到Linux的转变。
2. 国产平台Open JDK由操作系统自带，多以Open JDK1.8/11/17/21为主，老版本JDK不提供。
3. 数据库的迁移，由Oracle等数据库迁移到国产数据库，同样涉及应用的改造。
4. 判断采购的东方通产品是否合适？ 有的PHP应用，却采购的TongWeb； 有的嵌入式应用，却采购的TongWeb企业版;  有的一听说是云平台，不去了解应用，直接推荐TongWeb容器云版本, 实际有可能是嵌入版。
5. 针对采用本地库的应用，原应用在x86平台下，迁移到国产环境时要对源码重新编译。
6. 其它相关软件是否支持购买的国产平台。

五、举例说明
通过以上说明对应用移植的分析过程有一个初步的了解，下面举几个实例来说明一下移植过程中所涉及的常见修改。
1. Spring3.x版本不支持JDK1.8，报错如下：
Caused by: java.lang.IllegalArgumentException
    at org.springframework.asm.ClassReader.<init>(Unknown Source)
    at org.springframework.asm.ClassReader.<init>(Unknown Source)
    at org.springframework.asm.ClassReader.<init>(Unknown Source)
    at org.springframework.core.type.classreading.SimpleMetadataReader.<init>(SimpleMetadataReader.java:52)
    at org.springframework.core.type.classreading.SimpleMetadataReaderFactory.getMetadataReader(SimpleMetadataReaderFactory.java:80)
原因：spring使用的 asm 类库版本太低，而JDK1.8之后Java class格式有变化，老版本的asm类库不能支持处理 Jdk8 的class文件导致报错抛异常。
解决办法：升级spring到spring4以上版本。
2.  不同应用服务器之间的JNDI上下文和JNDI命名规则不同，所以也需要修改应用调用EJB2.x、数据源的部分。
#weblogic  JNDI上下文
java.naming.provider.url=t3://192.168.1.10:7001
java.naming.factory.initial=weblogic.jndi.WLInitialContextFactory
#websphere  JNDI上下文
java.naming.provider.url=iiop://localhost:2811
java.naming.factory.initial=com.ibm.websphere.naming.WsnInitialContextFactory
#jboss  JNDI上下文
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=localhost:1099
#TongWeb  JNDI上下文
java.naming.provider.url=http://192.168.1.10:5100/ejbserver/ejb
java.naming.factory.initial=com.tongweb.naming.java.javaURLContextFactory
EJB2.x在不同应用服务器下xml的不同。
只有在一些老旧应用移植时才有可能会遇到EJB2.x的移植。 近年即使采用Weblogic、WebSphere、JBoss的应用也很少采用EJB技术。
<!-- tongweb-ejb-jar.xml   -->
<?xml version="1.0" encoding="UTF-8"?>
<tongweb-ejb-jar>
	<ejb-deployment ejb-name="helloEJB">
		<jndi name="helloEJBLocal1"
			interface="com.tongweb.ejb2.HelloWorldLocalHome"></jndi>
		<jndi name="helloEJBRemote1"
			interface="com.tongweb.ejb2.HelloWorldRemoteHome"></jndi>
	</ejb-deployment>
</tongweb-ejb-jar>

<!-- weblogic-ejb-jar.xml  TongWeb可以兼容 -->
<?xml version="1.0" encoding="UTF-8"?>
<weblogic-ejb-jar>
	<weblogic-enterprise-bean>
		<ejb-name>helloEJB</ejb-name>
		<jndi-name>helloEJBRemote1</jndi-name>
		<local-jndi-name>helloEJBLocal1</local-jndi-name>
	</weblogic-enterprise-bean>
</weblogic-ejb-jar>

<!-- jboss.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<jboss>
	<enterprise-beans>
		<session>
			<ejb-name>helloEJB</ejb-name>
			<jndi-name>helloEJBRemote1</jndi-name>
		</session>
	</enterprise-beans>
</jboss>

<!-- ibm-ejb-jar-bnd.xml  TongWeb可以兼容-->
<?xml version="1.0" encoding="UTF-8"?>
<ejbbnd:EJBJarBinding xmi:version="2.0"
	xmlns:xmi="http://www.omg.org/XMI" xmlns:ejb="ejb.xmi" xmlns:ejbbnd="ejbbnd.xmi"
	xmi:id="EJBJarBinding_1393691689296">
	<ejbJar href="META-INF/ejb-jar.xml#ejb-jar_ID" />
	<ejbBindings xmi:id="EnterpriseBeanBinding_1393691689296"
		jndiName="ejb/helloEJBRemote1">
		<enterpriseBean xmi:type="ejb:Session"
			href="META-INF/ejb-jar.xml#helloEJB" />
	</ejbBindings>
</ejbbnd:EJBJarBinding>
3. Hibernate配置
(1) 大部分应用采用Hibernate JPA或Eclipselink来实现，所以TongWeb的JPA功能可以关闭。
(2) Hibernate JPA采用JTA容器事务时，不同应用服务器提供不同的事务实现，在TongWeb8.0下接口类如下设置，注意不同hibernate版本事务接口类不同。
<!-- hibernate4如下 -->
<property name="hibernate.transaction.jta.platform" value="com.tongweb.tongejb.jpa.integration.hibernate.h4.TongWebJtaPlatform" />
<!-- hibernate4.3及之后版本如下 -->
<property name="hibernate.transaction.jta.platform" value="com.tongweb.tongejb.jpa.integration.hibernate.h5.TongWebJtaPlatform" />

错误移植方式：
问题：TongWeb不同产品版本是否向下兼容技术规范？
错误方式：通常建议应用采用的JavaEE版本与TongWeb版本对应，应用是JavaEE5规范只能用TongWeb5.0、JavaEE6规范只能用TongWeb6.1、JavaEE7规范只能用TongWeb7.0。
正确方式：
1. Jakarta EE8及以前规范大部分是可以向下兼容的，不存在规范对应唯一版本的说法。
2. 到了Jakarta EE9规范，由于开发API由javax.servlet变为jakarta.servlet，所以从这个规范开始与之前不兼容。
3. TongWeb8.0提供了对应用 javax.*与jakarta.*  API互转的功能 与 javax/jakarta命名空间转化功能，可以兼容新老规范。

问题：我们应用系统大量采用的是WebSphere, 请问如何移植？
错误方式：提供TongWeb与WebSphre一对一配置参数说明。
正确方式：应用系统各有不同，采用的开发框架也不同，本质还是要从应用本身入手进行分析。

问题：你们在移植方面有什么经验和方案？
错误方式：我们有移植工具，可进行应用移植。随即把移植工具和手册给用户，完毕。
正确方式：移植工具只能解决部分配置类移植，且应用多不提供源码，无法做到代码级的检查。所以还需要人工移植。

六、移植案例过程
案例一：某项目用户有jetty替换需求，公司安排技术人员进行移植技术交流。于是得到的交流结果如下：
(1) 需求：用户需要我们提供jetty的移植方案、需要我们介绍移植过程中的经验，请销售安排人处理。
(2) 提出问题：跟用户交流没有了解用户采用的jetty版本、没有了解用户jetty的使用方式、没有了解应用的情况(采用什么规范、哪些开源框架等等)。 同时对于无法处理的技术问题不找领导协调安排，让销售在售前、售后、开发之间转达，项目无负责人牵头。
(3) 得到答复：用户也不清楚jetty版本、该查看jetty哪些配置、应用情况，只需要我们提供一个通用的测试方案，能按照方案一步步移植即可，移植tomcat这块我们很熟悉了，知道如何移植。jetty遇到的少，所以需要协调他人写jetty移植方案。用户很着急，马上要。

提出问题：
用户不清楚的原因：一是跟沟通交流安排的人不对，二是不能引导用户移植时要关注哪些移植点。 移植方案没有通用的，从jetty1.x到jetty12.x 版本差异就很大，连用户用的版本都无法调查清楚，就无法写移植方案。 移植应用有方法论，但无法做到一步步移植操作说明。 同时也不用说对jetty不熟悉所以写不出来，tomcat移植多，谁能写出一步步移植操作说明。 最后说用户很着急，这个一是拿用户着急催别人干活，二是把事情拖延了。
类似这类事件的本质是安排了不懂移植的人员跟用户沟通移植方案，无法深入了解用户需求，且在无法反馈用户有效信息的情况下，又把工作抛给其他人完成，着急要移植文档也只是为交差而已，属于无效工作。
正常的移植过程应该是这样：
1.  先了解用户在所有项目上用的jetty版本范围，如：主要用jetty8、9版本。这时即使对jetty不熟悉，从jetty官网
https://jetty.org/download.html
也可以看到其jetty8、9支持的规范情况。从而可以判断应用肯定为web应用，在规范Servlet3.1、JSP2.3及以下。
2. 再分别了解每个项目上jetty的使用方式，大概有三种：
方式一：web应用部署在jetty上的方式
了解到这种方式则可以确认需要采用TongWeb企业版/轻量版/容器版，同时再检查其在jetty上的配置，如最常见的数据源配置（不同jetty版本配置不同），再对应TongWeb的数据源配置进行移植。
<!-- 在工程的WEB-INF目录下新建名字为jetty-env.xml的文件   -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://jetty.mortbay.org/configure.dtd">
<Configure class="org.eclipse.jetty.webapp.WebAppContext">
	<New id="DSTest" class="org.eclipse.jetty.plus.jndi.Resource">
		<Arg></Arg>
		<Arg>jdbc/DSTest</Arg>
		<Arg>
			<New class="oracle.jdbc.pool.OracleDataSource">
				<Set name="DriverType">thin</Set>
				<Set name="URL">jdbc:oracle:thin:@fmsswdb1:10017:otcd</Set>
				<Set name="User">xxxx</Set>
				<Set name="Password">xxxx</Set>
				<Set name="connectionCachingEnabled">true</Set>
				<Set name="connectionCacheProperties">
					<New class="java.util.Properties">
						<Call name="setProperty">
							<Arg>MinLimit</Arg>
							<Arg>5</Arg>
						</Call>
						<!-- put the other properties in here too -->
					</New>
				</Set>
			</New>
		</Arg>
	</New>
</Configure>
方式二：Spring Boot 嵌入式jetty的方式
了解到这种方式则可以确定给用户推荐TongWeb嵌入版，这也是最常用的方式。

方式三：非Spring Boot嵌入式的jetty开发方式。
这种方式引用jetty类进行Java开发，同样是推荐采用TongWeb嵌入版，但需要改应用代码。
```java
package start;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.webapp.WebAppContext;

public class Start {
	public static void main(String[] args){
		Server server = new Server(8080);

		WebAppContext context = new WebAppContext();
		context.setContextPath("/jettyWebApp");
		context.setDescriptor("webRoot/WEB-INF/web.xml");
		server.setHandler(context);

		try {
			server.join();
			server.start();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}
```
初步了解到用户采用的jetty版本范围，各个项目上jetty的使用方式后，才能确定需要采用的TongWeb版本，才能针对性能写移植方案。
案例二：

某项目用户有tomcat移植替换需求, 通过交流从用户处得到信息，应用采用tomcat10版本，有非spring框架的web应用，也有Spring Boot嵌入式的应用，采用了hibernate持久化框架，并要将Oracle数据库会替换为达梦国产数据库。
通过以上大概信息就可以做出如下判断：
1. 采用tomcat10版本则肯定是Jakarta EE9的Web容器规范，也无需考虑存在EJB的可能性。且需要TongWeb8.0转为Jakarta命名空间来移植。
2. tomcat下为web应用，则TongWeb8.0开启轻量模式移植最简单。
3. 有Spring Boot嵌入式的应用，则还应该加上TongWeb8.0嵌入版移植。
4. 采用hibernate框架要将Oracle数据库替换为达梦数据库，则能想到需要将org.hibernate.dialect.OracleDialect方言类改为org.hibernate.dialect.DMDialect方言类。
5. 熟悉tomcat的，会再检查server.xml是否采用了tomcat数据源，将应用中lookup("java:comp/env/jdbc/test")方式改为lookup("jdbc/test")方式。
6. 检查应用包下用的开源组件版本，比如：CXF4.0版本，则可以判断必须用JDK17及以上版本，且不要开启TongWeb本身的Web Service功能。
如此细致方可写出移植方案。

关键字: TongWeb应用移植说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 084
问题: TongWeb开启http2协议

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/122537982

---

TongWeb开启http2协议的条件：
1. http通道类型改为https。
2. IO默认改为apr。
3.
开启 openssl 选项。
通过方问https://IP:8088/index.jsp 可以从响应头看到开启了http2协议
HTTP/2 200 OK
set-cookie: JSESSIONID=405EEA78A3545EB54AB55FE2612B7AEF;path=/;Secure;HttpOnly
content-type: text/html;charset=GBK
date: Mon, 17 Jan 2022 05:25:39 GMT
在前端有负载均衡THS5.0(TongHttpServer)的情况下，通过THS配置。
#开启SSL后，标红为开启http2
ProtocolsHonorOrder On
Protocols h2 h2c http/1.1
SSLProtocol TLSv1.2
SSLCertificateFile "crt/common_cert/server.crt"
SSLCertificateKeyFile "crt/common_cert/server.key"
SSLEngine on
SSLProxyEngine on
SSLProxyVerify none
SSLProxyCheckPeerCN off
SSLProxyCheckPeerName off

关键字: TongWeb开启http2协议
文档来源: 
--------------------------------------------------------------------------------

问题编号: 085
问题: TongWeb异常宕机问题分析

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/156774410

---

TongWeb异常宕机问题分析
声明：两台服务器TongWeb崩溃问题均为jdk崩溃后导致TongWeb崩溃，均由jdk生成hs_error文件。
一、服务器1TongWeb/domain_2崩溃，并有hs文件生成。
Jvm配置：xmx2024m xms2024m
服务器内存mem：total 509g used 41g free 366g
swap total 4g used0 free4g
此处为崩溃问题所在，JVM 本地内存分配失败，具体由系统资源不足和 JVM 配置不合理共同导致。
核心问题：1、系统层面：物理内存或交换空间耗尽，无法满足 JVM 对本地内存的申请需求。查看过服务器，物理内存资源充足。交换空间为4G，需要扩展。建议16G。
2、应用层面：ActiveMQ 连接未合理释放，导致 Transport 线程持续累积，叠加线程池线程阻塞，进一步加剧内存占用。
建议：应用 需要限制 ActiveMQ 连接数：配置连接池最大连接数，避免无限制创建 Transport 线程（例如设置maxConnections参数。
3、JVM层面：增加jdk参数-Xss 512k，文件中有提到设置-XX:ReservedCodeCacheSize=0x100000000参数（即 4GB 虚拟地址以上），
该参数强制 Java 堆从 4GB 以上地址开始分配，彻底避开本地堆的低地址扩展区域，解决地址冲突问题。
可以把-XX:ReservedCodeCacheSize=0x100000000参数添加到启动参数中
启动后通过jinfo 查看，确保HeapBaseMinAddress值为0x100000000。
二、服务器2TongWeb崩溃，并有生成hs文件
Jvm配置：xmx为131072m xms为65536m、MaxMetaspaceSize=8192m
服务器内存mem：total 509g used 41g free 366g
swap total 4g used0 free4g
结合完整崩溃日志、JVM 配置（-Xmx131072m/-Xms65536m、CICompilerCount=6、MaxMetaspaceSize=8192m）及服务器资源（内存 509G、空闲 366G，swap 空闲 4G），崩溃核心矛盾并非 “系统资源不足”，而是JVM 线程管理失控 + 虚拟地址空间分配冲突。
1、此处明显线程泄露，且 99% 以上线程处于_thread_blocked状态。
调整：1、减少线程栈：-Xss512k，降低jvm大小改为Xmx64g -Xms64g，-XX:MaxMetaspaceSize改为4096m。
2、调整tongweb/conf/tongweb.xml，tong-http-listener处两个参数，max-threads=“1000” min-spare-threads=“50”。
3、检查服务器系统内存配置，建议增加swap为16g

关键字: TongWeb异常宕机问题分析
文档来源: 
--------------------------------------------------------------------------------

问题编号: 086
问题: TongWeb抓取性能日志脚本

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/123060655

---

通过之前的文章可以看到，在出现性能问题时除了开启TongWeb监控功能，还需要手工执行一系列性能分析命令来排查问题，因为TongWeb的监控功能不足以分析问题。而这种手工操作对于项目运维人员有难度，往往急于恢复系统，重启TongWeb来解决。下面提供一个脚本，尽可能执行一次就抓取全部日志。
#本脚主要针对在性能出现问题时，一次执行抓取日志命令不全，甚至参数不加全的问题。
#将该脚本放在TongWeb的bin目录下，当发生慢时一次执行记录CPU,netstat,句柄，jstack,kill -3,busy,jmap，执行出错的跳过去继续执行。
#若在涉密机下无权限执行，则通过   . ./slowlog.sh的方式来执行，注意两点有空格。
#执行完把TongWeb的logs目录打包留底。
#若JDK环境变量不对，记得设PATH变量。要有jstack、jmap、jstat命令不能只装jre。

```bash
tongwebhome=`pwd`
export tongwebhome
tongpid=`ps -ef | grep java | grep $tongwebhome | awk '{print $2}'`
export tongpid
echo "execute top command"
top -H -b -d 3 -n 3 > ../logs/top`date +%Y%m%d%H%M`.log
echo "execute nestat command"
netstat -antlp  > ../logs/netstat`date +%Y%m%d%H%M`.log
echo "execute lsof command"
lsof -p $tongpid > ../logs/lsof`date +%Y%m%d%H%M`.log
echo "execute jstat command"
jstat -gcutil $tongpid 1000  10 > ../logs/jstat`date +%Y%m%d%H%M`.log
echo "execute jstack command"
jstack  $tongpid > ../logs/jstack`date +%Y%m%d%H%M`.log
echo "execute kill -3 command"
kill -3 $tongpid >/dev/null 2>&1
cp ../logs/jvm.log ../logs/jvm`date +%Y%m%d%H%M`.log
echo "execute thread-profiler.sh command"
./thread-profiler.sh -F -p $tongpid -c 500 -a ../logs/busy`date +%Y%m%d%H%M`.log  3 3   >/dev/null 2>&1
echo "execute jmap command"
jmap -histo $tongpid  > ../logs/heap`date +%Y%m%d%H%M`.log
jmap -dump:live,format=b,file=../logs/heap`date +%Y%m%d%H%M`.bin $tongpid
echo "complete......... "
```

关键字: TongWeb抓取性能日志脚本
文档来源: 
--------------------------------------------------------------------------------

问题编号: 087
问题: TongWeb控制台密码错误或没有权限

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/121585788

---

现象：
登录TongWeb控制台提示密码错误或没有权限，如下图：
问题原因 ：
1.TongWeb控制台密码忘记
2.TongWeb的conf\security中文件损坏，报密码或权限不对。
解决办法：
重置TongWeb密码
方式一：
<TongWeb_home>/domain_template/conf/security为TongWeb的domain模板目录，存放的是TongWeb原始配置文件。
<TongWeb_home>/conf/security目录为TongWeb用户密码相关的文件。
利用 <TongWeb_home>/domain_template/conf/security 中的文件模版去覆盖TongWeb根下的<TongWeb_home>/conf/security目录，或是域下的conf/security目录对应文件即可， 重启TongWeb恢复原始密码。
方式二：
若是老版本没有domain功能，则在测试机上安装一个全新的同版本TongWeb，将<TongWeb_home>/conf/security目录文件拷贝到忘记密码的TongWeb同级目录下，覆盖原文件，重启TongWeb恢复原始密码。

关键字: TongWeb控制台密码错误或没有权限
文档来源: 
--------------------------------------------------------------------------------

问题编号: 088
问题: TongWeb支持InvokerServlet

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109592292

---

InvokerServlet功能早在tomcat7之后已经废除，但由于很多老应用依旧采用而且不想改造，所以TongWeb也增加了该功能。
TongWeb6、TongWeb7 默认不开启InvokerServlet， 需在conf/default-web.xml中增加如下servlet打开InvokerServlet功能。
<servlet>
    <servlet-name>invoker</servlet-name>
    <!-- TongWeb6 配置如下类名 -->
    <servlet-class>com.tongweb.web.thor.servlets.InvokerServlet</servlet-class>
    <!-- TongWeb7 配置如下类名,  注意类包差别，只选其一。    为什么不整成一样的呢？-->
    <servlet-class>com.tongweb.catalina.servlets.InvokerServlet</servlet-class>
    <init-param>
       <param-name>debug</param-name>
       <param-value>0</param-value>
    </init-param>
    <load-on-startup>2</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>invoker</servlet-name>
    <url-pattern>/servlet/*</url-pattern>
</servlet-mapping>

关键字: TongWeb支持InvokerServlet
文档来源: 
--------------------------------------------------------------------------------

问题编号: 089
问题: TongWeb支持Spring Boot、Spring Cloud说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110219850

---

### TongWeb 版本兼容性矩阵

| TongWeb 版本 | JDK 17 | Spring Framework 6.x | Spring Boot 3.x | Spring Cloud Gateway | 支持最高规范 |
| :--- | :---: | :---: | :---: | :---: | :--- |
| **7.0.4** | 支持 | 不支持 | 不支持 | 不支持 | JavaEE 8 |
| **8.0 / 7.0.8** | 支持 | 支持 | 支持 | 不支持 | JakartaEE 10 |
| **嵌入版 (Embedded)** | 支持 | 支持 | 支持 | 支持 | JakartaEE10仅web容器 |


TongWeb支持Spring Boot，Spring  Cloud吗？
说明：
主要看Spring Boot各个版本需要的JavaEE的web容器规范是多少，另外了解应用的运行方式。遵从以下规则：
1. 以web应用传部署方式，则Spring Boot2.x可用
2. TongWeb7、TongWeb8企业版，Spring Boot3.x只能用TongWeb8.0/7.0.8企业版。
3. 以嵌入式方式java  -jar方式运行的，则只能采用TongWeb7/8嵌入式版本。
4. Spring Cloud Gateway的运行不需要web容器， 所以仅可用TongWeb嵌入版的reactor。

注意：Spring Boot的嵌入式运行方式与web运行方式虽然可以互转，但要考虑项目后期维护的便利性， TongWeb企业版与嵌入版也是经常卖错的版本。

常见的使用问题：
问题一：
有人问TongWeb是否支持JDK17?
TongWeb7.0、8.0都支持JDK17，但问该问题的本质是想知道哪个版本支持Spring Boot3.x、Spring Framework6.x 框架。 TongWeb7.0.4版本支持JDK17，但不支持Spring Boot3.x、Spring Framework6.x框架，需要TongWeb8.0。

问题二：
有些应用框架采用Spring Cloud Gateway，运行在非servlet容器上，所以仅可用TongWeb嵌入版的reactor，无法运行在TongWeb企业版上。见Spring官网说明。

问题三：
不能单纯以应用包为jar包或war包来判断采用TongWeb嵌入版或企业版，个别情况下有的应用为war包，但仍以 java  -jar  app.war的嵌入式方式来运行。

问题四：
Spring Boot3.x，Spring Framework6.x为什么不能在TongWeb7.0.4.x版本上运行？
因为从Jakarta EE9规范开始  javax命名空间变为 jakarta命名空间，API发生了本质变化。
1. TongWeb7.0.4.x及以下版本不支持Jakarta EE9规范,也就是不支持Spring Boot3.x版本。
2. TongWeb7.0.8/8.0企业版需要切换为Jakarta命名空间版本来支持Spring Boot3.x应用。
3. TongWeb7/8嵌入版需要引入支持Spring Boot3.x的jar来运行。

问题五：
替换了嵌入版的tomcat，如何判断替换成功？
当嵌入版启动时，看到TongWeb图标时表示采用TongWeb嵌入版的Spring Boot启动。
附：TongWeb7.0.E.x嵌入版打包示例。
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>1.0.0</groupId>
  <artifactId>springboot-tw</artifactId>
  <version>1</version>
  <packaging>jar</packaging>
  <name>springboot-tw</name>
  <url>http://maven.apache.org</url>
  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <java.version>1.8</java.version>
  </properties>
   <parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.3.8.RELEASE</version>
		<relativePath/>
	</parent>
  <dependencies>
      <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
			<!-- 不用tomcat -->
			<exclusions>
              <exclusion>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-tomcat</artifactId>
              </exclusion>
			</exclusions>
      </dependency>
	  <!--引入tongweb包 -->
	  <dependency>
           <groupId>com.tongweb.springboot</groupId>
           <artifactId>tongweb-spring-boot-starter</artifactId>
           <version>2.x.0.RELEASE</version>
      </dependency>
      <dependency>
           <groupId>com.tongweb</groupId>
           <artifactId>tongweb-embed</artifactId>
           <version>7.0.E.1</version>
      </dependency>
      <dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
	</dependency>
  </dependencies>
  <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <mainClass>com.tong.App</mainClass>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>

关键字: TongWeb支持Spring Boot、Spring Cloud说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 090
问题: TongWeb支持shtml

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109591883

---

TongWeb支持shtml语言，只需打开conf/default-web.xml文件中的对应配置即可。将如下描述的注释  <!--   -->去掉即可。
<servlet>
<servlet-name>ssi</servlet-name>
<!--  TongWeb6类名  -->
<servlet-class>com.tongweb.web.thor.ssi.SSIServlet</servlet-class>
<!--  TongWeb7类名，注意类名不同，只选其一。    为什么不整成一样的呢？  -->
<servlet-class>com.tongweb.catalina.ssi.SSIServlet</servlet-class>
<init-param>
<param-name>buffered</param-name>
<param-value>1</param-value>
</init-param>
<init-param>
<param-name>debug</param-name>
<param-value>0</param-value>
</init-param>
<init-param>
<param-name>expires</param-name>
<param-value>666</param-value>
</init-param>
<init-param>
<param-name>isVirtualWebappRelative</param-name>
<param-value>0</param-value>
</init-param>
<load-on-startup>4</load-on-startup>
</servlet>
<servlet-mapping>
<servlet-name>ssi</servlet-name>
<url-pattern>*.shtml</url-pattern>
</servlet-mapping>
<filter>
<filter-name>ssi</filter-name>
<!--  TongWeb6类名  -->
<filter-class>com.tongweb.web.thor.ssi.SSIFilter</filter-class>
<!--  TongWeb7类名，注意类名不同，只选其一。  -->
<filter-class>com.tongweb.catalina.ssi.SSIFilter</filter-class>
<init-param>
<param-name>contentType</param-name>
<param-value>text/x-server-parsed-html(;.*)?</param-value>
</init-param>
<init-param>
<param-name>debug</param-name>
<param-value>0</param-value>
</init-param>
<init-param>
<param-name>expires</param-name>
<param-value>666</param-value>
</init-param>
<init-param>
<param-name>isVirtualWebappRelative</param-name>
<param-value>0</param-value>
</init-param>
</filter>
<filter-mapping>
<filter-name>ssi</filter-name>
<url-pattern>*.shtml</url-pattern>
</filter-mapping>

关键字: TongWeb支持shtml
文档来源: 
--------------------------------------------------------------------------------

问题编号: 091
问题: TongWeb支持spring websocket问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109636708

---

问题描述：
应用部署在TongWeb上spring的websocket插件报错 "No suitable default RequestUpgradeStrategy found" 。
原因：
spring websocket组件有针对不同应用服务器的判断，但恰恰没有TongWeb项。
解决办法：
TongWeb7.0.3.0及之后版本增加了org.apache.tomcat.websocket.server.WsHttpUpgradeHandler相关类，这样spring websocket当TongWeb判断为tomcat处理，保证兼容性。
若您使用TongWeb6.1版本， 请升级到TongWeb7.0.3.0之后版本。

关键字: TongWeb支持spring websocket问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 092
问题: TongWeb数据源原理

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110385749

---

TongWeb数据源原理：通过连接复用减少了创建数据库连接的次数，提高系统的性能。
这类文章很多，就不再细讲了。但在实际使用过程中仍会遇到很多数据源相关问题，接下来介绍几个处理数据源问题常用参数的实现机制。
参数一：泄露超时，打印泄露超时日志是如何实现记录的？
在应用从TongWeb数据源获取数据库连接时，TongWeb记录下当前的stack trace信息，在达到泄露超时时间后，发现该连接还没有回收到连接池，则认为该连接存在泄露的可能性，并将该stack trace信息打印出来。所以看到的stack trace信息是应用获取连接时的代码，此时需要检查该代码在获取连接后有没有执行connection.close()关闭连接。
```bash
[2020-11-30 09:09:52 601] [WARNING] [testdb jdbc-scheduler] [data-source] [java.lang.Exception: A potential connection leak detected for connection pool testdb
at com.tongweb.hulk.HulkDataSource.getConnection(HulkDataSource.java:66)
at com.tongweb.tongejb.resource.jdbc.DecoratorDS.getConnection(DecoratorDS.java:26)
at com.tongweb.tongejb.resource.jdbc.managed.local.ManagedConnection.newConnection(ManagedConnection.java:208)
at com.tongweb.tw.thanos.ThanosManagedConnection.invoke(ThanosManagedConnection.java:70)
at com.sun.proxy.$Proxy153.createStatement(Unknown Source)
at Test.doGet(Test.java:53)   #检查应用处代码有没有close。
at javax.servlet.http.HttpServlet.service(HttpServlet.java:622)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.web.websocket.server.WsFilter.doFilter(WsFilter.java:53)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)
at com.tongweb.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)
at com.tongweb.catalina.core.ThanosStandardContextValve.invoke(ThanosStandardContextValve.java:108)
at com.tongweb.tomee.catalina.OpenEJBValve.invoke(OpenEJBValve.java:44)
at com.tongweb.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:450)
at com.tongweb.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)
at com.tongweb.tomee.catalina.OpenEJBSecurityListener$RequestCapturer.invoke(OpenEJBSecurityListener.java:97)
at com.tongweb.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
at com.tongweb.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)
at com.tongweb.catalina.core.ThanosStandardEngineValve.invoke(ThanosStandardEngineValve.java:43)
at com.tongweb.catalina.realm.RealmValve.invoke(RealmValve.java:21)
at com.tongweb.catalina.connector.ThanosCoyoteAdaptor.service(ThanosCoyoteAdaptor.java:432)
at com.tongweb.coyote.http11.Http11Processor.service(Http11Processor.java:776)
at com.tongweb.coyote.http11.ThanosHttp11Processor.service(ThanosHttp11Processor.java:19)
at com.tongweb.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
at com.tongweb.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:913)
at com.tongweb.web.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1610)
at com.tongweb.web.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
at com.tongweb.web.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:842)
at com.tongweb.web.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:640)
at com.tongweb.web.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:618)
at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)
at sun.nio.ch.Invoker$2.run(Invoker.java:218)
at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)
at com.tongweb.web.util.threads.TWThreadPoolExecutor.runWorker(TWThreadPoolExecutor.java:1172)
at com.tongweb.web.util.threads.TWThreadPoolExecutor$Worker.run(TWThreadPoolExecutor.java:628)
at com.tongweb.web.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
at java.lang.Thread.run(Thread.java:748)
```
参数二："即时泄漏回收”  或 老版本-Dtongweb.resource.leakCheck是如何实时回收连接的？
在应用从TongWeb数据源获取数据库连接时，将数据源连接记录在当前http线程的ThreadLocal中，当http线程处理完请求后，将该线程ThreadLocal中记录的Connection关闭，以此来达到实时关闭连接的目的。该功能仅限TongWeb自身管理线程，应用线程无法管理。 所以有时还需要结合泄露超时回收一块处理。当前应用多采用hibernate、MyBatis框架下本身应不会出现泄露连接的情况，多数是因为SQL执行时间过长，导致的连接占满。

参数三：“语句超时”参数是如何让SQL超时中断执行的？
本质上就是设置JDBC的 java.sql.Statement的setQueryTimeout(int seconds) 方法。该方法用于中断长时间执行的SQL，但是该方法取决于数据库厂家提供的JDBC驱动包是否支持，并非所有数据库厂家的JDBC驱动支持该方法，所以该功能并非 100%有效。

参数四："SQL执行时间过滤" "SQL日志"参数是如何记录的？
大致的记录过程是记录statement执行SQL的前后时间差，以此来判断SQL执行时间，并将大于"SQL执行时间过滤"的SQL语句和执行时间输出在日志中，以便来分析SQL性能影响。 但是该时间包含JDBC处理时间，并非等于SQL在数据库中执行的时间，多数情况该时间大于SQL在数据库中执行的时间。
```java
long start = System.currentTimeMillis();
Statement.executeQuery(SQl);
long end = System.currentTimeMillis();
log.warn("Slow Query Report SQL="+(end-start));
```
参数五：“线程连接关联”  使用场景。
线程连接关联是将一个数据源连接connection对象存在http线程的ThreadLocal中，让数据源连接与线程一一绑定，不真正归还到连接池中。这样做的好处是：1. 从当前线程池中获取连接，提高获取效率。 2. 当应用存在执行connection.close()后，还去执行statement时报  "Connection has already been closed."，勾选上“ 线程连接关联”后，connection对象依然可用。

关键字: TongWeb数据源原理
文档来源: 
--------------------------------------------------------------------------------

问题编号: 093
问题: TongWeb日志报Too many open files

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109711145

---

问题现象：
大量如下日志：
```bash
[2020-05-08 14:39:25] [SEVERE] [web-container] [Http listener ServerSocket[addr=/0.0.0.0,port=0,localport=9060] shutdown by exception: java.net.SocketException:Too many open files]
[2020-05-08 14:39:25] [SEVERE] [web-container] [Http listener ServerSocket[addr=/0.0.0.0,port=0,localport=9060] shutdown by exception: java.net.SocketException:Too  many open files]
```
问题原因：
open files为Linux操作系统下进程允许打开的文件句柄数，若超过此值，则会报此异常。
解决办法：
1. 通过linux系统命令ulimit -a查看open files值为默认的1024，这个值偏小，建议值为65535。
#登录linux系统，输入命令`ulimit –a`。
```bash
[root@5 ~]# ulimit -a
core file size (blocks, -c) 0
data seg size (kbytes, -d) unlimited
scheduling priority (-e) 0
file size (blocks, -f) unlimited
pending signals (-i) 4096
max locked memory (kbytes, -l) 32
max memory size (kbytes, -m) unlimited
open files (-n) 1024      !重点查看此值
max user processes (-u) 4096
```
不同系统可能修改方式不同，  linux将操作系统的open files值改为65535。比如：修改/etc/security/limits.conf,在文件中加上两行：
*  soft  nofile 65535
*  hard  nofile 65535
2. TongWeb6, 7的startserver.sh启动脚本已默认增加了：`ulimit -n 65536 >/dev/null 2>&1`对当前TongWeb进程生效。
3. 若确认了修改open files值为65535后，还报Too many open files，则应用可能存在打开文件句柄过多的情况。 通过操作系统的`lsof -p  <PID>`命令查看打开什么文件多，具体分析。

关键字: TongWeb日志报Too many open files
文档来源: 
--------------------------------------------------------------------------------

问题编号: 094
问题: TongWeb替换tomcat Resource 配置

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/122534654

---

TongWeb的“JNDI资源” 功能用以替换tomcat Resource 配置，该配置常用于JMS、数据源配置.
场景一：JMS配置
tomcat集成ActiveMQ方式
<Resource name="queue/connectionFactory"
                auth="Container"
                type="org.apache.activemq.ActiveMQConnectionFactory"
                description="JMS Connection Factory"
                factory="org.apache.activemq.jndi.JNDIReferenceFactory"
                brokerURL="tcp://localhost:61616"
                brokerName="LocalActiveMQBroker" />
<Resource name="queue/queue0"
                auth="Container"
                type="org.apache.activemq.command.ActiveMQQueue"
                description="My Queue"
                factory="org.apache.activemq.jndi.JNDIReferenceFactory"
                physicalName="Queue" />
TongWeb JNDI资源配置方式如下，这种方式优于genericra方式。
1. 将activemq-all.jar放在TongWeb的lib下或控制台选择jar路径。
2. 队列及队列工厂的配置如下：JMS 连接工厂, JMS 队列
3.可以看到JNDI树上有相应配置
4.在代码上与tomcat区别如下：

```java
InitialContext context = new InitialContext();
/*
 * tomcat方式 QueueConnectionFactory conFactory =
 * (QueueConnectionFactory)
 * context.lookup("java:comp/env/queue/connectionFactory");
 */
// TongWeb方式
QueueConnectionFactory conFactory = (QueueConnectionFactory) context.lookup("queue/connectionFactory");

/*
 * tomcat方式 Queue queue = (Queue)
 * context.lookup("java:comp/env/queue/queue0");
 */
// TongWeb方式
Queue queue = (Queue) context.lookup("queue/queue0");
QueueConnection queConn = conFactory.createQueueConnection();
```

场景二：数据源场景
正常情况下采用JNDI数据源是通过TongWeb的“JDBC配置” ，若想集成第三方开源数据源，且通过JNDI调用方式引用的话也可以配置。以建阿里druid数据源为例的代码使用方式：
```java
Context env = new InitialContext();
DataSource dataSource = (DataSource) env.lookup("jdbc/test");
Connection con = dataSource.getConnection();
```
注：这种是数据源的一种非正常使用方式，非特殊要求尽量少用。

关键字: TongWeb替换tomcat Resource 配置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 095
问题: TongWeb生产环境配置规范之一：安装环境配置

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/148352626

---

一、硬件环境
物理机、虚拟机、POD推荐分配的最低配置为4核CPU、4G内存、20G硬盘。主要考虑系统并发访问量消耗CPU的情况，TongWeb与应用生成日志的存储空间大小。
二、操作系统
建立TongWeb的安装用户，如：tongweb。
检查常用top、nmon、netstat、lsof、ps等监控命令齐全。
根据不同的linux调整open files值为65535 , 比如：在/ect/security/limits.conf文件中加上两行，并确认生效。
```bash
*  soft  nofile 65535
*  hard  nofile 65535​
```
根据不同的linux优化tcp/ip参数，比如：
1. 在/etc/sysctl.conf中加入`net.ipv4.tcp_syncookies = 1 `表示开启SYN Cookies。当出现SYN等待队列溢出时，启用cookies来处理，可防范少量SYN攻击，默认为0，表示关闭；
2. `net.ipv4.tcp_tw_reuse = 1` 表示开启重用。允许将`TIME-WAIT sockets`重新用于新的TCP连接，默认为0，表示关闭；
3. `net.ipv4.tcp_tw_recycle = 1` 表示开启TCP连接中`TIME-WAIT sockets`的快速回收，默认为0，表示关闭。
```bash
net.ipv4.tcp_fin_timeout=10
net.ipv4.tcp_keepalive_time=30
```
三、JDK选择与安装
目前国产操作系统平台主要默认提供OpenJDK1.8、OpenJDK11、OpenJDK17或毕昇JDK、TongJDK等，不要采用Oracle JDK以免引起商务问题。
确认应用需要采用的JDK大版本，并检查小版本号尽量为新版本。如：JDK1.8.0_211为2019年版本，为避免JDK引起的bug问题，建议升级为当前较新的JDK1.8.0小版本。
检查操作系统自带完整的JDK，而非jre。否则无jstack、jmap等分析命令。
设置JDK环境变量:
`export  JAVA_HOME=/home/JDK`
`export  PATH=/home/JDK/bin:$PATH`

四、TongWeb选择与安装
优先选择TongWeb当前发布最新版本安装。 若应用系统已经与TongWeb进行过完整适配，则评估下与最新版本的差距，考虑适合的版本。
安装后，将license.dat放在TongWeb下，若为临时license，则要嘱咐用户license过期时间。
启动访问控制台，修改用户密码后将密码告知用户保存。
按用户要求是否做成开机自启动。
按之前性能测试时定下的JVM参数设置，或是做最基本的调优，主要为堆内存大小。上线初期建议打开GC日志，以便分析内存。
建议配置参数
-Xms2048m -Xmx2048m最大，最小堆内存
-XX:+UnlockDiagnosticVMOptions
-XX:+LogVMOutput
-XX:LogFile=../logs/jvm.log

当jstack不可用时，用kill -3 PID记录线程堆栈。
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath= ../logs/heap.hprof

当JVM出现内存溢出时自动生成heapdump文件
-XX:+PrintGCDetails
-XX:+PrintGCDateStamps
-Xloggc:/logs/gc-%t.log
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=10
-XX:GCLogFileSize=10M

开启GC日志，记录JVM的GC情况，并且将GC日志设置为可轮转，可限制大小的。

常见错误:
1. 未对安装过程做文档记录，事后用户不知安装情况。
2. 操作系统只装了jre，当出现问题时无法通过jstack分析问题。
3. 装的JDK小版本号过低，遇到JVM崩溃问题，需要重新安装JDK 版本。
4. 采用TongWeb嵌入版，未优化open files值，未设置JVM内存，直接java -jar springboot.jar运行系统，导致出现性能问题。
5. 未主动询问用户是否新建系统用户安装TongWeb，配成开机自启动，导致事后又返工重新安装。

关键字: TongWeb生产环境配置规范之一：安装环境配置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 096
问题: TongWeb生产环境配置规范之二：数据源配置

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/148370149

---

一、数据库驱动包选择
数据库驱动包由数据库厂商提供，另外若应用采用hibernate等持久框架，还需要国产数据库提供方言类包，如: 达梦的DmDialect-for-hibernate3.0.jar。
确认数据库版本对应的数据库驱动包的版本。
确认数据库驱动包支持的JDK版本与JDBC规范，目前普遍支持JDK1.8及以上，支持JDBC4.0规范。
错误的方式：从网上下载数据库驱动包直接用，不考虑版本兼容性。
二、数据库驱动包的存放
若应用采用自带开源数据源，则数据库驱动包放在应用或公共库类路径下。
若采用TongWeb数据源，则建议把数据库驱动包直接放在TongWeb的lib目录下，这样数据源与应用采用同一份驱动。
若存在一个TongWeb上配置多个同一类型数据库，但数据库版本不同、对应驱动包版本也不同的情况时，不能将所有驱动包放在TongWeb的lib下。 需要放置在其它目录下，在配置数据源时，指定对应的数据库驱动包。
三、数据源参数的配置
1.  基础参数配置
最小连接数  根据业务系统并发量设置
最大连接数  根据业务系统并发量设置
注意：不得超过数据库可用连接数，否则超出数据库限制。
创建连接时验证 建议开启项，以确保应用获取有效的数据库连接。

验证方式
方式一：通过connection.isValid()方法验证（推荐方式）
方式二：通过SQL语句，需用最简单的SQL语句。

验证间隔
连接验证不是应用每次获取连接都验证，而是有一定的时间间隔。
通常默认值即可，若网络或数据库不稳定导致的连接不稳定，建议把验证间隔设短。

空闲连接检查 建议开启项，当业务不忙时，连接池中空闲的连接数大于连接池的最小连接数时，可以释放连接，保持最小连接数，避免一直占用数据库连接。

URL参数/连接参数
不同数据库有不同的参数，通常在URL或连接参数中配置，如：connectiontimeout、sockettimeout、serverTimezone等等，具体由数据库驱动来设置。

2. SQL与连接泄露场景
若应用系统在运行一段时间后，数据源连接占满，而长时间不释放，则可能存在连接泄露的问题，应用没有对连接进行关闭而又不能修复代码解决，这时需要配置以下参数。
参数

即时泄露回收  遇到泄露问题，无法修复应用代码时建议开启项，该功能是当http请求处理完成后回收连接。但对于应用自启线程使用数据源连接情况，无法跟踪关闭连接。
泄露超时时间  上线初期建议开启，超时时间设为60秒。 在超时时打出stack traces 日志，通过日志查找应用代码泄露的位置。
泄漏时记录日志 泄露回收/关闭连接,若无法修复应用代码，则需要开启强制回收连接功能，需考虑业务最长SQL时间，使“泄露超时时间” 大于业务最长SQL时间再开启。以免中断正常的业务。TongWeb8 增加一个“泄漏判定比例 ” >80%再关闭连接。
语句跟踪/自动关闭语句 当应用statement未关闭，造成游标泄露时，建议开启该项。
跟踪语句堆栈 TongWeb8功能，打出stack traces 日志可以分析应用statement泄露位置。
3.  慢SQL场景
监控有哪些慢SQL影响业务，可以针对性的对SQL进行优化。
慢SQL检测时间 上线初期建议开启，设置慢SQL的检测时间，记录慢的SQL进行优化。
慢SQL日志  SQL超时本质是设置statment的setQueryTimeout方法，若应用SQL长时间执行阻塞无法解决，可以设置此值中止SQL执行。

4. MySQL驱动兼容
针对以mysql驱动为主的国产数据库，TongWeb7 需要开启`Mysql驱动兼容`选项。
具体原因见：`关于TongWeb数据源兼容mysql驱动的注意事项-CSDN博客`
5. SQL异常关闭连接
TongWeb8.0 建议开启“SQL错误时回收”， 当SQL异常时，会回收当前连接。TongWeb7.0无此项，默认SQL异常时就会回收当前连接。
6. 线程关联
若遇到一个请求处理线程需要同时占用多个数据源连接的场景，建议开启线程关联。这样在一次请求处理中，占用的是同一个数据源连接对象。
若一次请求处理中涉及嵌套事务，事务提交的场景，则不能开启该功能。
常见错误的方式：上线初期容易出性能问题，未开启慢SQL日志，泄露日志。最大连接数配置过大，超过数据库允许的连接数。驱动包版本过老。

关键字: TongWeb生产环境配置规范之二：数据源配置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 097
问题: TongWeb的ELException SKIP_IDENTIFIER_CHECK

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109683155

---

TongWeb出现以下异常：
[[2018-06-15 14:55:45] [SEVERE] [web-container] [Servlet.service() for servlet jsp threw exception]  javax.el.ELException: The identifier [class] is not a valid Java identifier as required by section 1.19 of the EL specification (Identifier ::= Java language identifier). This check can be disabled by setting the system property com.tongweb.el.parser.SKIP_IDENTIFIER_CHECK to true.
TongWeb6设置参数 -Dcom.tongweb.
web
.el.parser.SKIP_IDENTIFIER_CHECK=true
TongWeb7设置参数-Dcom.tongweb.el.parser.SKIP_IDENTIFIER_CHECK=true
有个web差别

关键字: TongWeb的ELException SKIP_IDENTIFIER_CHECK
文档来源: 
--------------------------------------------------------------------------------

问题编号: 098
问题: TongWeb的JMX线程过多

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109683291

---

通过JMX采集TongWeb监控值后，长时间运行导致JMX线程不断增加，导致 OutOfMemoryError：unable to create new native thread异常。
通过jstack命令分析主要是JMX的server线程越来越多，而不退出。
JMX server connection timeout 207874&quot; daemon prio=10 tid=0x00007f709474c000 nid=0x457b in Object.wait() [0x00007f70626e6000]
java.lang.Thread.State: TIMED_WAITING (on object monitor)
at java.lang.Object.wait(Native Method)
- waiting on &lt;0x00000000d20fbdf8&gt; (a [I)
at com.sun.jmx.remote.internal.ServerCommunicatorAdmin$Timeout.run(ServerCommunicatorAdmin.java:150)
- locked &lt;0x00000000d20fbdf8&gt; (a [I)
at java.lang.Thread.run(Thread.java:662)
主要原因是”JMX server connection timeout”这个超时监测线程增长过快，根据jstack信息来看已经达到800多个，这是因为每个RMIConnection对象都会对应一个单独的”JMX server connection timeout”线程，用来检测该RMIConnection对象的使用是否超时(默认超时时间是2分钟)，达到超时时间后会关闭该RMIConnection并且结束掉对应的timeout线程。通过-Dtongweb.jmx.remote.connection.timeout把超时时间设置的足够小就可以及时释放用过的RMIConnection对象及对应的timeout线程。
-Dtongweb.jmx.remote.connection.timeout=100
(单位：毫秒)，其本质是设置JMX的服务器端Timeout线程超时时间 jmx.remote.x.server.connection.timeout=120000值。

关键字: TongWeb的JMX线程过多
文档来源: 
--------------------------------------------------------------------------------

问题编号: 099
问题: TongWeb的JVM线程监控为什么老是红的

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109673271

---

问题描述：
总是看到TongWeb的JVM线程监控图是红的。
原因:
因为这个图的计算方式是JDK  Mbean的 getThreadCount()   /  getPeakThreadCount() 比值。
getThreadCount()
返回活动线程的当前数目，包括守护线程和非守护线程。
getPeakThreadCount()
返回自从 Java 虚拟机启动或峰值重置以来峰值活动线程计数。
刚启动TongWeb时这两个方法返回的线程数相近，所以永远是红的。只有当TongWeb经历过线程高峰，线程回落后，这个图才不会为红色。
解决办法：
这不是个问题，线程多监控http通道的线程池即可，这个JVM总线程数监控对分析性能帮助不大。正确方式为查看http通道的线程。

关键字: TongWeb的JVM线程监控为什么老是红的
文档来源: 
--------------------------------------------------------------------------------

问题编号: 100
问题: TongWeb的OutOfMemoryError_ Metaspace 异常

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109711497

---

问题描述:
TongWeb报错OutOfMemoryError: Metaspace， 但是用JDK8没有设置-XX:MaxMetaspaceSize值，怎么还会内存溢出？
问题原因：
-XX:MaxMetaspaceSize这个参数用于限制Metaspace增长的上限，防止因为某些情况导致Metaspace无限的使用本地内存，影响到其他程序，默认无上限。但是TongWeb判断若使用JDK8，则启动时自动增加参数-XX:MaxMetaspaceSize=
192m（限制在了192m）
。所以可能存在查看控制台、external.vmoptions文件配置时无-XX:MaxMetaspaceSize， 但ps -ef|grep java查看进程时能看到-XX:MaxMetaspaceSize参数。
解决办法：
在TongWeb配置中显示写明-XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m值即可，该值通常比应用WEB-INF下lib和classes目录大2-3倍即可。若增大Metaspace还会出现该问题，则可能是
TongWeb上反复重部署应用后异常：application instance has been stopped already 或OutOfMemoryError：Metaspace_realwangpu的博客-CSDN博客
问题。

关键字: TongWeb的OutOfMemoryError_ Metaspace 异常
文档来源: 
--------------------------------------------------------------------------------

问题编号: 101
问题: TongWeb的cacheMaxSize设置

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109509870

---

在TongWeb7上部署应用经常报警告如下, TongWeb7上设这个cacheMaxSize 值一般要比应用所有静态资源总合要大，才不报如下警告：
[WARNING] [other] [Unable to add the resource at [/WEB-INF/lib/lucene-analyzers-common-4.7.2.jar] to the cache because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache]
在
默认虚拟主机server中
，增加其它属性：(或应用所在的虚拟主机)
cacheMaxSize：为部署在此虚拟机下的应用设置静态资源缓存的最大值，单位为 K。
cachingAllowed：为部署在此虚拟机下的应用设置是否允许启用静态资源(HTML、图片、声音等)的缓存。默认值为 true。
cacheObjectMaxSize: 为部署在此虚拟机下的应用设置允许缓存的最大文件容量，大小此容量的文件将不被 Cache。 cacheObjectMaxSize 会被限定在cacheMaxSize/20 以下。
如何判断缓存设置是否够用，打开TongWeb应用监控可以看到缓存使用情况。

关键字: TongWeb的cacheMaxSize设置
文档来源: 
--------------------------------------------------------------------------------

问题编号: 102
问题: TongWeb的debug调试

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109504286

---

TongWeb的eclipse、IDEA开发插件在某些版本上不一定好用，这时我们可以采用JDK本身的远程debug模式来进行调试。方法如下：
1. 通过
./startserver.sh debug 49812
， 启动TongWeb，其中48912为远程debug的端口号。
其本质就是在启动参数中加入了：
-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=端口
2. TongWeb启动完成后就可以在eclipse配置进行远程调试，如下图，具体请参考JDK，eclipse相关文档。

关键字: TongWeb的debug调试
文档来源: 
--------------------------------------------------------------------------------

问题编号: 103
问题: TongWeb的license动态更新

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/121598643

---

自TongWeb7.0.4.5版本起，license更新可以不用重启验证。
通过commandstool.bat update-license命令可以动态更新license。
1. 放要替换的license.dat放在license_update目录下。
2. 执行commandstool.bat update-license命令：
commandstool.bat update-license
Please enter the admin user name>cli
Please enter the admin password>cli456!.COM
************************
consumer_name=aaa
project_name=aaaaaa
license_type=trail
create_date=2021-03-17
end_date=2021-12-17
TW_Product_Name=TongWeb
TW_Version_Number=7.0
TW_Edition=Enterprise
TW_CPU_COUNT=
************************
Command update-license executed successfully.
3. 若license不合法，则更新失败。
commandstool.bat update-license
Please enter the admin user name>cli
Please enter the admin password>cli456!.COM
************************
java.io.IOException: License is not for this edition of product, License type is : Light
************************
CLI137 Command update-license failed.

关键字: TongWeb的license动态更新
文档来源: 
--------------------------------------------------------------------------------

问题编号: 104
问题: TongWeb的license安装与替换

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109611636

---

一、TongWeb企业版简单安装与替换步骤说明
:
1. 登录TongWeb服务器，进入TongWeb目录停止TongWeb。
2. 通过FTP工具将license.dat文件覆盖原有TongWeb根目录下的license.dat。
3. 启动TongWeb即完成替换。
注意：只能叫license.dat，不能改名。
二、TongWeb嵌入版安装:
TongWeb嵌入版license可以放在jar文件类路径上，也可以配置加载路径。
方式一：
将license.dat放在tongweb-embed-7.0.E.x.jar中。
方式二：
在应用spring boot application.properties 或 者application.yaml 文件中指明license的路径。如：
server.tongweb.license.path=D:/springboot/license.dat
这样一台服务起多个TongWeb嵌入版的spring boot实例读取一份license文件即可。更新license无需像方式一重新打包。
三、TongWeb详细安装与替换步骤说明：
1. 确认TongWeb安装的目录、版本类型、二级版本号，
注意: 安全版、企业版、标准版、轻量版、嵌入版、容器云版license不通用，TongWeb6.1与TongWeb7.0的license不通用。
轻量版
标准版
企业/专用机版
安全版
嵌入版
容器云版
license的TW_Edition值
Light
Standard
Enterprise
ASDP
Embed
Cloud
license的TW_Version_Number值
7.0
7.0
7.0
7.0
7.0.E
7.0.C
2. 查看当前license到期时间及版本的三种方法。
（1）执行bin下startserver命令启动TongWeb, 通过日志查看license到期时间。
[2020-01-15 14:47:51] [INFO] [System.out] [
License expires 2020-03-18
]
[2020-01-15 14:47:54] [INFO] [core] [Starting TongWeb Server...]
（2）若bin下有version命令，可执行该命令查看。
./version.sh
服务器：
TongWeb 7.0.2.4
，构建于：2019-10-29 10:09:06
-----------------------------------------
-----------License 信息-------------------
consumer_name=test
project_name=test
license_type=release
create_date=2019-05-13
end_date=2020-05-13   #
到期时间, -1为永不过期
TW_Product_Name=TongWeb
TW_Version_Number=7.0  #
二级版本号
TW_IpAddress=127.0.0.1
TW_CPU_COUNT=1
TW_Edition=Enterprise    #企业版
(3)  登录TongWeb的管理控制台首页查看具体版本和到期时间。
3. 确认版本和到期时间后，联系东方通商务获取TongWeb产品license.dat文件。
4. 在确认重启TongWeb不影响系统的情况下，停止TongWeb。
5. 通过FTP工具将license.dat文件覆盖原有TongWeb根目录下的license.dat。
6. 启动TongWeb，按步骤2检查license是否替换成功。
说明：
license到期注意向东方通商务
申请、临时license到期后凌晨6点会停止TongWeb。
7. 替换不对导致TongWeb无法启动，具体看TongWeb的logs下server.log日志。
[System.out] [Lisence file not found!]   #
没把
license.dat
放
TongWeb
的根目录下
[System.out] [License will never expire.]   #
这是永不过期
[System.out] [License expired.]     #
这是已过期
[System.out] [License expires 2018-11-28]  #
这是过期时间
[System.out] [License is not for this version of product.]   #这是license与产品版本不对应
[System.out] [Invaild license.]    #license不合法
8. 若 license 项目名称为 test，则 http 通道最大线程数为 5，生产环境与性能测试时注意。启动TongWeb时日志有提示。
[core] [License 信息:客户名称=test;项目名称=
test
;到期时间=2020-11-17]
[Starting ProtocolHandler [http-nio2-8088]
License limits the connector to a maximum of 5 threads.
]

关键字: TongWeb的license安装与替换
文档来源: 
--------------------------------------------------------------------------------

问题编号: 105
问题: TongWeb的session复制原理

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110295588

---

session
复制是指
TongWeb
之间
session
信息可以实现共享。
TongWeb
集群可以只配
session
亲和，不配
session
复制，这样只会造成客户端请求跳转到另一个
TongWeb
节点上时
session
信息丢失。也可以配
session
亲和的同时配置
session 复制，session信息在TongDataGrid中存储，这样客户端请求跳转到另一个TongWeb
节点上时session 信息不丢失，从TongDataGrid中恢复，但同时需要维护会话服务器
TongDataGrid
。
session复制只是解决session中的信息同步问题，应用的数据在各个TongWeb节点之间的同步依赖于应用自身完成，如：ehcache二级缓存的同步。
正确的配置方式是：
在session亲和下的session复制
，这样可以保证TongWeb内存中的session与TongDataGrid中的session同步。若前端负载产品功能太差，不能保证session亲和，则会发生什么？如下图：
不亲和的情况下运行会是以下结果：
先访问TongWeb B执行了session.setAttribute("a","1")产生session，并存入值。
session同步到TongDataGrid各个节点上。
由于不亲和访问TongWeb A，但不存在该session。
从TongDataGrid中恢复该session，并执行了session.setAttribute("b","2")。
TongWeb A与TongDataGrid同步该session中值a=1,b=2。
由于不亲和再访问TongWeb B，执行session.getAttribute("b")。由于判断TongWeb B中已有该session对象，但不会校验存的值，不会从TongDataGird中恢复，所以取b值取不到。
该设计的初衷是为了避免频繁从TongDataGrid中存取session造成性能瓶颈，从而在TongWeb处理session时，若TongWeb内存中有该session对象，则不再从TongDataGrid中获取。但是若前端负载实在不争气，就是不能保证session亲和，则必须配session复制，且要开启非亲和情况下的session复制。
TongWeb启动脚本增加参数：-Dwebcluster.session.sticky=false。
某些版本可以在tongweb-web.xml中设置<property name="tongdatagrid-stick" value="false"/>
至少有一个参数设置则 TongWeb集群将运行在非亲和模式下，TongWeb将不再缓存任何session，所有session将从TongDataGrid中直接读取，这无疑增加了性能开销。
题外话：
1. session复制已经是一种过时的免登录方案，目前应用常以单点登录(SSO)作为解决方案。
2. 当采用Apahce shiro应用框架时，session是由shiro产生和管理的，这时session复制需要在shiro中配，见：
shiro使用ehcache实现集群同步和session复制_坚持-CSDN博客
误区：tomcat是通过redis实现session复制，而TongWeb是通过TongDataGrid。可实现session复制即可，无需纠结用的是不是redis。

关键字: TongWeb的session复制原理
文档来源: 
--------------------------------------------------------------------------------

问题编号: 106
问题: TongWeb的session超时设置以及不依赖于TongWeb session的场景

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109697973

---

TongWeb 的 session 超时设置按优先级从高到低依次为：
方式一：
在应用代码中设置 session 超时时间 session.setMaxInactiveInterval(60);//单位为秒。
方式二：
在应用的 web.xml 中设置 session 超时时间，单位为分钟。
<session-config>
<session-timeout>30</session-timeout>
</session-config>
方式三：
在 TongWeb 控制台上设置 session 超时时间，单位为分钟。 tongweb-web.xml 的 session超时配置可忽略，基本不用。
应用若不设置，默认 30 分钟。通常 session 超时时间值为 1-1440 分钟即可， 实际环境中客户每天会打开新的 IE 访问， 产生新的 session。而某些配置人员将 session 设为永久或 1 个月等更长超时， 试想极少存在用户打开IE 后， 一天或连续几天都不访问一次应用的，甚至连 IE 也不关闭的。 这样配置反而导致无用 session 长期存在， 应用服务器产生过多的 session，有内存溢出的可能。
TongWeb的session 不是决定应用会话状态的唯一因素，在SSO、Apache shiro应用场景下，session不起主要作用。这时在TongWeb上配session的超时时间、session共享、复制已无用。
1. 单点登录SSO应用
以CAS应用为例，登录验证的是ticken，而不是session。配置因CAS版本不同而不同，相关超时配置如以下：
<bean id="grantingTicketExpirationPolicy" class="org.jasig.cas.ticket.support.RememberMeDelegatingExpirationPolicy">
<property name="sessionExpirationPolicy">
<bean class="org.jasig.cas.ticket.support.
TimeoutExpirationPolicy
">
<constructor-arg index="0" value="1800000"></constructor-arg>
</bean>
</property>
<property name="rememberMeExpirationPolicy">
<bean class="org.jasig.cas.ticket.support.
TimeoutExpirationPolicy
">
<constructor-arg index="0" value="2592000000"></constructor-arg>
</bean>
</property>
</bean>
2. Apache shiro应用
Shiro提供了三个默认session管理实现，在shiro应用中有时可能会看到产生的session都不是TongWeb所生成的，配session复制更没用。
实现一：DefaultSessionManager：DefaultSecurityManager使用的默认实现；
实现二：ServletContainerSessionManager：用于Web环境，其直接使用Servlet容器的会话；
实现三：DefaultWebSessionManager：用于Web环境的实现，可以替代ServletContainerSessionManager,自己维护着会话,直接废弃了Servlet容器的会话管理。
<bean id="sessionManager" class="org.apache.shiro.web.session.mgt.
DefaultWebSessionManager
">
<!-- 设置超时时间 -->
<property name="globalSessionTimeout" value="1800000"/>
<property name="deleteInvalidSessions" value="true"/>
<property name="sessionValidationSchedulerEnabled" value="true"/>
<property name="sessionIdCookieEnabled" value="true"/>
<property name="sessionIdCookie" ref="sessionIdCookie"/>
</bean>

关键字: TongWeb的session超时设置以及不依赖于TongWeb session的场景
文档来源: 
--------------------------------------------------------------------------------

问题编号: 107
问题: TongWeb的常见too large

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109710743

---

1. TongWeb5 日志  java.lang.IllegalStateException: PWC4662: Request header is too large。将如下request改为8192，如果还不行再增大。TongWeb6，7报 Request header is too large， 不好意思忘记做在控制台上了，需要手工修改conf/tongweb.xml文件，将对应的http通道的max-http-header-size
值加大，重启TongWeb生效。注意：若在控制台修改http通道后该配置恢复原值。
<http-options compression="on" compressable-mime-type="text/html,text/plain,text/xml" compression-min-size="2048" no-compression-user-agents="" disable-upload-timeout="true"
max-http-header-size="8192"
max-keep-alive-requests="100"/>
2. TongWeb5 、6、7 日志Post too large。将http通道如下值改大。

关键字: TongWeb的常见too large
文档来源: 
--------------------------------------------------------------------------------

问题编号: 108
问题: TongWeb的快照目录snapshot为什么这么大？

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109684248

---

snapshot为TongWeb的快照生成目录，如图在满足阈值条件时会收集相应的日志。默认快照影响的几个方面是：
1. jmap内存镜像日志会较大，占用磁盘空间。
2. 默认预警策略较低，当http线程使用量为10时，则很容易达到触发条件，生成快照。
3.在生成快照时系统会有一段时间变慢，是因为快照中的jmap等命令操作导致系统当时变慢，所以在需要快照时不打开jmap就不会有太大影响。
注：快照并不能100%保证在出现问题时抓取到日志，因为快照功能的处理线程在同一个TongWeb进程中，当TongWeb进程假死时，快照线程也可能无法执行。就像一个病人要自己给自己动手术一样。
解决办法：
方式一：.若无性能问题可关闭默认快照。 在控制台上将快照default1的“策略之间的关系”设为"所有"，则基本不再生成。也可以将default1删除，并将conf/tongweb.xml中<snapshot> /<contents 标签 中设为false，如下：
<auto-snapshot interval-second="5" relation="and">
<contents jstack="false" jmap="false" config="false" monitor="false" system-log="false" access-log="false" gc-log="false"/>
方式二：若还有性能问题依赖快照分析，则设置合理的值。如：http线程设为200，内存无问题可关闭jmap生成。
snapshot下的快照文件可以随时删除，不影响TongWeb。

关键字: TongWeb的快照目录snapshot为什么这么大？
文档来源: 
--------------------------------------------------------------------------------

问题编号: 109
问题: TongWeb的数据源连接池常见问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109525749

---

TongWeb的数据源连接池占满时的日志
[2019-05-13 11:15:56] [WARNING] [other] [Failed to obtain/create connection from connection pool [ test ]. Reason : The connection could not be allocated:[http-nio-8080-exec-1] Timeout: Pool empty.
Unable to fetch a connection in 30 seconds, none available[size:10; busy:10; idle:0; lastwait:30000
].]
红色标记内容的意思是：当前使用的数据源连接数已经等于数据源的最大连接数，不能分配更多的连接。
造成数据源问题的原因通常有如下四种：
1. 数据库JDBC驱动包与数据库版本不对应。
2. 数据源最大连接设置过小，并发访问量大的时候数据源连接数不足。或是把最大连接数设的比数据库允许的连接数还大，
数据源配的最大连接数肯定得小于等于数据库允许的连接数
。
3. 应用存在连接泄漏的地方，打开数据库连接后没有正确的关闭，长时间运行后TongWeb的连接池被逐渐占光。
4. 应用存在SQL执行时间过长，长时间执行SQL,占用连接不释放。
TongWeb数据源泄露分析方式：
1. 最低级的错误是连接池配置过小，导致并发时连接不够用。若无论增大连接为多少，连接还不够用，就需要继续分析了。
2.在数据源配置中设置“泄漏超时”为30秒，跟踪连接池中的连接泄漏，并将获取连接的调用栈（堆栈）记录下来， 只记录不关闭连接。
当超时后，以WARNING级别将该堆栈信息输出到日志。从日志中可以分析到哪里存在未关闭的连接。日志示例如下：
[2019-05-13 11:05:55] [WARNING] [data-source] [
A potential connection leak detected for connection pool test. The stack trace of the thread is provided below
: java.lang.Exception
at com.tongweb.web.webutil.jdbc.pool.ConnectionPool.getThreadDump(ConnectionPool.java:1117)
at com.tongweb.web.webutil.jdbc.ThorTomEEDataSourceCreator$ThorTomEEConnectionPool.borrowConnection(ThorTomEEDataSourceCreator.java:1065)
at com.tongweb.web.webutil.jdbc.ThorTomEEDataSourceCreator$ThorTomEEConnectionPool.borrowConnection0(ThorTomEEDataSourceCreator.java:942)
at com.tongweb.web.webutil.jdbc.ThorTomEEDataSourceCreator$ThorTomEEConnectionPool.borrowConnection(ThorTomEEDataSourceCreator.java:921)
at com.tongweb.web.webutil.jdbc.pool.ConnectionPool.getConnection(ConnectionPool.java:219)
at com.tongweb.web.webutil.jdbc.ThorTomEEDataSourceCreator$ThorTomEEConnectionPool.getConnection(ThorTomEEDataSourceCreator.java:729)
at com.tongweb.web.webutil.jdbc.ThorTomEEDataSourceCreator$ThorTomEEDataSource.superGetConnection(ThorTomEEDataSourceCreator.java:241)
at com.tongweb.web.webutil.jdbc.ThorTomEEDataSourceCreator$ThorTomEEDataSource.getConnection(ThorTomEEDataSourceCreator.java:264)
at com.tongweb.tongejb.resource.jdbc.managed.local.ManagedDataSource.getConnection(ManagedDataSource.java:50)
at com.tongweb.tongejb.resource.jdbc.managed.local.ThorManagedDataSource.getConnection(ThorManagedDataSource.java:77)
at com.tongweb.web.webutil.jdbc.ThorTomEEDataSourceCreator$ThorTomEEDataSourceProxy.getConnection(ThorTomEEDataSourceCreator.java:488)
at org.apache.jsp.
DBPoolTest_jsp
._jspService(DBPoolTest_jsp.java:105)
at com.tongweb.web.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)
at com.tongweb.web.jasper.servlet.ThorJspServletWrapper.service(ThorJspServletWrapper.java:264)
at com.tongweb.web.jasper.servlet.ThorJspServlet.serviceJspFile(ThorJspServlet.java:270)
at com.tongweb.web.jasper.servlet.ThorJspServlet.service(ThorJspServlet.java:232)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)
at com.tongweb.web.thor.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
at com.tongweb.web.thor.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
3. 找到应用代码泄露的地方, 确认代码是否会执行
connection.close()。
4. 若100%确认应用代码执行了
connection.close()，
则可能是SQL的执行时间过长，长时间占用连接。这时可以打开“SQL执行时间过滤”记录下执行时间长的SQL，针对SQL进行优化。若确认某些SQL执行时间过长，且数据库无法优化，可设置"语句超时"本质为设置java.sql.Statement.setQueryTimeout(int timeout)。
但要注意某些国产数据库的JDBC驱动不支持该方法
。
同时若应用忘记关游标statement.close()导致 maximum open cursors exceeded，可以勾上“语句跟踪”自动关闭statement。
SQL日志：  2020-11-06 13:18:26 [SQL execute 17 ms : select FILE_ID,FILE_NAME,DIS_NAME,FILE_SORT,DATA_TYPE,SERV_ID,FILE_CAT,FILE_HIST_COUNT,FILE_CHECKSUM,ORIG_FILE_ID,BELONG_DEPT,BELONG_DEPT_NAME,ITEM_CODE,FILE_PATH,FILE_SIZE,FILE_MTYPE,S_FLAG,S_CMPY,S_MTIME,FILE_MEMO,DATA_ID,WF_NI_ID,S_USER,S_UNAME,S_DEPT,S_DNAME,IESS_PROCESS_ID from SY_COMM_FILE where 1=1 and data_id = '09G2NPWVZ7TUJrJ4UKkzpr' order by FILE_SORT Thread[http-nio2-0.0.0.0-8088-exec-14]#3 Connection[2115205428]]
5. 若SQL超时不起作用，应用又不能修改代码执行connection.close()。只能用最终解决办法“
泄露回收
”。勾上后会在泄露超时后强制关闭连接，
会导致正在执行的SQL中断，一定要考虑清楚再配上。

关键字: TongWeb的数据源连接池常见问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 110
问题: TongWeb的日志输出阻塞

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109637446

---

问题描述：
并发情况下查看TongWeb线程大部分阻塞在日志输出上。日志如下：
"http-nio2-8080-exec-397" #850571 daemon prio=5 os_prio=0 tid=0x00000058dc0a0000 nid=0x7614 waiting for monitor entry [0x0000005908e30000]
java.lang.Thread.State:
BLOCKED
(on object monitor)
at org.apache.log4j.Category.callAppenders(Category.java:201)
- waiting to lock <0x00000003c1c33640> (a org.apache.log4j.Logger)
at org.apache.log4j.Category.forcedLog(Category.java:388)
at org.apache.log4j.Category.log(Category.java:853)
at org.apache.commons.logging.impl.
Log4JLogger.debug
(Log4JLogger.java:171)
at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:863)
at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:967)
at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:869)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:648)
原因：
应用log4j日志配置为DEBUG级别日志输出，这样在大并发的情况下，会导致多线程大量的日志输出到日志文件中造成日志输出阻塞，造成系统性能问题。
解决办法：
1. 在性能测试或生产系统上运行时，应用log4j日志级别不能设为DEBUG级别， 理应为INFO级别日志。
2. 若应用设为INFO级别后仍然日志阻塞，TongWeb7.0.4.1及之后版本增加了异步日志输出功能， 增加启动参数
-DlogThreads=1
可开启异步日志输出。

关键字: TongWeb的日志输出阻塞
文档来源: 
--------------------------------------------------------------------------------

问题编号: 111
问题: TongWeb的超时线程日志

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/121670707

---

问题:
在多数情况下，请求处理慢需要查看线程信息，但是多数情况下：不会用jstack命令打线程、打jstack线程不及时、打出线程不会看。
解决办法：
开启TongWeb的超时线程日志功能。
当http线程执行超时时，server.log中会打出相应日志，如下：
[2021-12-02 09:53:43 117] [INFO] [
ThanosStandardService hung thread check
[2121744517:1638408782579]] [core] [Request Info: Url=http://127.0.0.1:8088/web/Test Parameters
Thread Info: "http-nio2-8088-exec-10" id=39 state=TIMED_WAITING
at java.lang.Thread.sleep(Native Method)
at com.tong.Test.doGet(Test.java:47)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:622)
at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.web.websocket.server.WsFilter.doFilter(WsFilter.java:53)
at com.tongweb.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)
at com.tongweb.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)
at com.tongweb.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)
at com.tongweb.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)
at com.tongweb.catalina.core.ThanosStandardContextValve.invoke(ThanosStandardContextValve.java:107)
at com.tongweb.tomee.catalina.OpenEJBValve.invoke(OpenEJBValve.java:44)
at com.tongweb.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:452)
at com.tongweb.catalina.core.StandardHostValve.invoke(StandardHostValve.java:344)
at com.tongweb.tomee.catalina.OpenEJBSecurityListener$RequestCapturer.invoke(OpenEJBSecurityListener.java:97)
at com.tongweb.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:625)
at com.tongweb.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)
at com.tongweb.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)
at com.tongweb.catalina.core.ThanosStandardEngineValve.invoke(ThanosStandardEngineValve.java:43)
at com.tongweb.catalina.realm.RealmValve.invoke(RealmValve.java:21)
at com.tongweb.catalina.connector.ThanosCoyoteAdaptor.service(ThanosCoyoteAdaptor.java:469)
at com.tongweb.coyote.http11.Http11Processor.service(Http11Processor.java:867)
at com.tongweb.coyote.http11.ThanosHttp11Processor.service(ThanosHttp11Processor.java:19)
at com.tongweb.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
at com.tongweb.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:921)
at com.tongweb.web.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1625)
at com.tongweb.web.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
at com.tongweb.web.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:857)
at com.tongweb.web.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:631)
at com.tongweb.web.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:609)
at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)
at sun.nio.ch.Invoker$2.run(Invoker.java:218)
at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)
at com.tongweb.web.util.threads.TWThreadPoolExecutor.runWorker(TWThreadPoolExecutor.java:1172)
at com.tongweb.web.util.threads.TWThreadPoolExecutor$Worker.run(TWThreadPoolExecutor.java:628)
at com.tongweb.web.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
at java.lang.Thread.run(Thread.java:748)
Locked synchronizers: count = 1
- com.tongweb.web.util.threads.TWThreadPoolExecutor$Worker@1322b575
]

关键字: TongWeb的超时线程日志
文档来源: 
--------------------------------------------------------------------------------

问题编号: 112
问题: TongWeb相关http安全头设置方式

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/121973952

---

一、X-Frame-Options响应头配置
X-Frame-Options HTTP 响应头是用来给浏览器指示允许一个页面可否在 <frame>, </iframe> 或者 <object> 中展现的标记。网站可以使用此功能，来确保自己网站的内容没有被嵌套到别人的网站中去，也从而避免了点击劫持 (clickjacking) 的攻击。在TongWeb bin目录下external.vmoptions中设置该参数：
-Dtongweb.X_Frame_Options=SAMEORIGIN
有四个值：
DENY：浏览器拒绝当前页面加载任何 Frame 页面。
SAMEORIGIN：页面只能加载入同源域名下的页面(默认值)。
ALLOW-FROM：只能被嵌入到指定域名的框架中。(部分浏览器不支持)
NONE：关闭该功能
显示结查如下：
HTTP/1.1 200
X-Frame-Options: SAMEORIGIN
Content-Type: text/html;charset=GBK
Content-Length: 160
Date: Thu, 16 Dec 2021 06:19:09 GMT
Server: webserver
二、CORS跨域配置
在应用的web.xml (只对本应用生效) 或TongWeb的conf/default-web.xml(对所有应用生效) 中加入如下filter。
<filter>
    <filter-name>CorsFilter</filter-name>
		<filter-class>com.tongweb.catalina.filters.CorsFilter</filter-class>
		<init-param>
			<!-- 允许访问资源的源列表。可以指定*表示接受任意域名的请求 -->
			<param-name>cors.allowed.origins</param-name>
			<param-value>*</param-value>
		</init-param>
		<init-param>
			<!-- 以逗号分隔的HTTP方法列表 -->
			<param-name>cors.allowed.methods</param-name>
			<param-value>GET,POST</param-value>
		</init-param>
		<init-param>
			<!-- 跨域允许包含的头 -->
			<param-name>cors.allowed.headers</param-name>
			<param-value>Content-Type,X-Requested-With,accept,Origin,Access-Control- Request-Method,Access-Control-Request-Headers</param-value>
		</init-param>
		<init-param>
			<param-name>cors.exposed.headers</param-name>
			<param-value>Access-Control-Allow-Origin,Access-Control-Allow-Credentials </param-value>
		</init-param>
		<init-param>
			<param-name>cors.support.credentials</param-name>
			<param-value>true</param-value>
		</init-param>
		<init-param>
			<param-name>cors.preflight.maxage</param-name>
			<param-value>10</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>CorsFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
当应用访问请求头中含有Origin时
Origin: http://api.test.com
http响应头则含有cors头相关配置
```bash
HTTP/1.1 200
Access-Control-Allow-Origin: http://api.test.com
Access-Control-Allow-Credentials: true
Access-Control-Expose-Headers: Access-Control-Allow-Origin,Access-Control-Allow-Credentials
X-Frame-Options: SAMEORIGIN
Content-Type: text/html;charset=UTF-8
```
注意：TongWeb的CORS跨域配置默认是不开启的，若是在不配置的情况下，还有防跨域配置则多数是由应用spring开启了
CORS跨域配置.
三、预防http host头攻击漏洞
预防非法篡改http host头的值
Host: 192.168.0.33:8080
可以在TongWeb7的web容器配置中设置host头的白名单，非白名单的Host值将被拦截。

关键字: TongWeb相关http安全头设置方式
文档来源: 
--------------------------------------------------------------------------------

问题编号: 113
问题: TongWeb获取应用列表失败

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110137426

---

问题现象：
TongWeb刚启动，进入控制台看应用，显示：获取应用列表失败:部署服务尚未启动完成，请稍后再试！
原因及解决办法：
这是因为TongWeb还没有启动完成，没有完全加载应用列表，需要等TongWeb启动完成后才能显示。  日志中有如下信息，表示TongWeb启动完成。
TongWeb server startup complete in 43325 ms

关键字: TongWeb获取应用列表失败
文档来源: 
--------------------------------------------------------------------------------

问题编号: 114
问题: TongWeb跨域问题处理

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/142909950

---

这里写自定义目录标题
现象
排查思路
现象
f12控制台报错Access to XMLHttpRequest at ‘xxx’ from origin ‘xxxx’ has been blocked by CORS policy: Response to preflight request doesn’t pass access control check: No ‘Access-Control-Allow-Origin’ header is present on the requested resource.
排查思路
确认跨域的请求方式
，如果不是get,post请求，则需要在tongweb控制台放开；
确认后端项目有没有跨域配置
，常见的有过滤器CorsFilter，@CrossOrigin等，如果有则不需要在tongweb中配置跨域，
重复配置会导致冲突，跨域不生效
；
没有使用跨域配置，在项目web.xml或者tongweb/conf/default-web.xml中配置；
<filter>
	<filter-name>CorsFilter</filter-name>
	<filter-class>com.tongweb.catalina.filters.CorsFilter</filter-class>
	<init-param>
		<!-- 允许访问资源的源列表。可以指定*表示接受任意域名的请求 -->
		<param-name>cors.allowed.origins</param-name>
		<param-value>*</param-value>
	</init-param>
	<init-param>
		<!-- 以逗号分隔的HTTP方法列表 -->
		<param-name>cors.allowed.methods</param-name>
		<param-value>GET,POST,TRACE,OPTIONS,HEAD,DELETE,PUT,CONNNECT</param-value>
	</init-param>
	<init-param>
		<!-- 跨域允许包含的头 -->
		<param-name>cors.allowed.headers</param-name>
		<param-value>Content-Type,X-Requested-With,accept,Origin,Access-Control- Request-Method,Access-Control-Request-Headers</param-value>
	</init-param>
	<init-param>
		<param-name>cors.exposed.headers</param-name>
		<param-value>Access-Control-Allow-Origin,Access-Control-Allow-Credentials </param-value>
	</init-param>
	<init-param>
		<param-name>cors.support.credentials</param-name>
		<param-value>true</param-value>
	</init-param>
	<init-param>
		<param-name>cors.preflight.maxage</param-name>
		<param-value>10</param-value>
	</init-param>
</filter>
<filter-mapping>
	<filter-name>CorsFilter</filter-name>
	<url-pattern>/*</url-pattern>
</filter-mapping>

关键字: TongWeb跨域问题处理
文档来源: 
--------------------------------------------------------------------------------

问题编号: 115
问题: TongWeb通过CGI支持PHP的方法

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109591564

---

通俗一句话：等同于tomcat的CGIServlet。  配置方法如下：
1. 前提是要先安装好PHP运行环境，这一步是必须的，请从PHP: Hypertext Preprocessor下载编译安装合适的PHP版本。如果是国产平台，请确保已安装PHP程序，TongWeb不带PHP运行程序。关于PHP更多配置请查相关资料。
2. TongWeb通过CGIServlet调用PHP，配置如下：
在PHP应用目录里建个WEB-INF目录，建个web.xml中加入如下内容，改造成一个JavaEE应用的war结构包。注：有的文章可能写在conf/default-web.xml中配置，其实也可以。 加在应用web.xml中的好处是一次配完，可随意拷贝到其它地方用。
<?xml version="1.0" encoding="UTF-8"?>
<web-app>
	<servlet>
		<servlet-name>cgi</servlet-name>
		<!-- TongWeb6 配置如下类名 -->
		<servlet-class>com.tongweb.web.thor.servlets.CGIServlet
		</servlet-class>
		 <!-- TongWeb7 配置如下类名, 注意类包差别，只选其一。 为什么不整成一样的呢？ -->
		<servlet-class>com.tongweb.catalina.servlets.CGIServlet
		</servlet-class>
		<init-param>
			<param-name>cgiPathPrefix</param-name>
			<!-- 部一个web应用，把php页面放在这个目录，或是根本不配这个参数，直接把PHP页面放在应用根下， 放在应用根下更好 -->
			<param-value>WEB-INF/cgi</param-value>
		</init-param>
		<init-param>
			<param-name>executable</param-name>
			<!-- 指到php-cgi命令 -->
			<param-value>D:/php7.2/php-cgi.exe</param-value>
		</init-param>
		<init-param>
			<param-name>passShellEnvironment</param-name>
			<param-value>true</param-value>
		</init-param>
		<load-on-startup>5</load-on-startup>
	</servlet>
	<servlet-mapping>
		<servlet-name>cgi</servlet-name>
		<!-- 访问应用http://IP:port/前缀/index.php ，只处理php -->
		<url-pattern>*.php</url-pattern>
	</servlet-mapping>
</web-app>
3.  将该PHP目录当JavaEE应用部署在TongWeb上即可访问。
4. 相关PHP问题，还需配置PHP配置文件php.ini, 此处省略。
注：该方式为TongWeb支持PHP的一种变通方式，至于该方式到底实不实用，待看。

关键字: TongWeb通过CGI支持PHP的方法
文档来源: 
--------------------------------------------------------------------------------

问题编号: 116
问题: TongWeb配置http强制跳转https端口

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/122538224

---

配置步骤：
1.在TongWeb上建https端口。
2.在TongWeb建http端口，其中"重定向端口 "配置https端口
3.应用web.xml中配置如下：
<security-constraint>
<web-resource-collection >
<web-resource-name >SSL</web-resource-name>
<url-pattern>/*</url-pattern>
</web-resource-collection>
<user-data-constraint>
<transport-guarantee>CONFIDENTIAL</transport-guarantee>
</user-data-constraint>
</security-constraint>
4.部署应用，当通过http://IP:8088访问时，自动跳转到https://IP:8443上。

关键字: TongWeb配置http强制跳转https端口
文档来源: 
--------------------------------------------------------------------------------

问题编号: 117
问题: TongWeb集群部署方案

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109533346

---

概念
TongWeb集群是由多个同时运行的JavaEE应用服务器组成，在外界看来就像一个服务器一样，这多台服务器共同来为客户提供更高性能的服务。而负载均衡器的任务就是负责多个服务器之间实现合理的请求分配，使这些服务器不会出现因某一台超负荷、而其他的服务器却没有充分发挥处理能力的情况，即便其中一台服务器宕机，其它服务器就会继续接管请求进行处理。通常我们所说的集群、负载均衡、反向代理是一个意思。
在JavaEE应用的集群模式下有session亲和、session复制两个概念需要解释下：
session
亲和
(session
保持
)
是指在集群环境下，同一
IE
客户端的请求会被始终分发到同一个
TongWeb
节点上，这是集群配置时负载软件必须实现的。通常保证
session
亲和的有以下几种方式：基于客户端IP
的
session
亲和、基于cookie
的
session
亲和、基于session id
的
session
亲和。
session
复制(session共享)是指
TongWeb
之间
session
信息可以实现共享。
TongWeb
集群可以只配
session
亲和，不配
session
复制，这样只会造成客户端请求跳转到另一个
TongWeb
节点上时
session
信息丢失。也可以配
session
亲和的同时，也配置
session
复制，这样客户端请求跳转到另一个
TongWeb
节点上时
session
信息不丢失，但同时需要维护会话服务器。目前应用常以单点登录
(SSO)
作为解决方案。
环境说明：
负载设备的选择, 只要是支持http协议的负载均衡设备TongWeb均可支持。硬件负载设备如：F5、深信服、东方通TongADC；软件负载设备如：开源nginx、apache、haproxy、东方通TongHttpServer（THS）。
负载设备部署在前端，客户端访问的是负载设备地址，负载设备作为单点需要HA主备。THS自身即支持集群，也支持HA主备。开源nginx、apache、haproxy需要做主备的话，需要额外配置开源的keepalive或heartbeat这两款HA软件。
若配置https，则通常是SSL证书配在负载设备上，指向后台TongWeb的http端口。SSL证书无需在TongWeb上配置。
至少准备两台服务器安装TongWeb，若是软件负载也可以跟TongWeb安装在同一台服务器上，或独立服务器。
追求高并发量的情况下采用硬负载，并发量不高的情况下采用软负载。
可以采用TongWeb的集中管理一次将THS+TongWeb集群搭起，也可以手配配置TongWeb集群。
采用TongDataGrid集群做为session的存储库，当其中一个TongWeb节点宕机时，其它TongWeb节点可以从TongDataGrid中恢复session数据，从而保证session不丢失。
TongDataGrid的session复制不是必配项，若应用有单点登录(SSO)功能，则完全可以不配session复制功能，SSO为最佳选择。
集群中负载设备、TongWeb、TongDataGrid可以任意增加节点，无启动顺序要求。
部署架构图如下：
具体可参考《TongWeb企业版用户手册.pdf》
https://download.csdn.net/download/realwangpu/18461429

关键字: TongWeb集群部署方案
文档来源: 
--------------------------------------------------------------------------------

问题编号: 118
问题: Tongweb+Ths6011测试websocket（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/140209512

---

本次使用的tongweb版本7049m4，测试包ws_example.war（在tongweb安装目录的samples/websocket下），ths版本6011
首先在tongweb控制台部署一下ws_example.war,部署后测试是否能访问：
然後ths上的httpserver.conf的參考配置如下(由于tongweb和ths都在同一个服务器上，所以用127.0.0.1)：
http
{
server
{
listen
8080
;
server_name localhost
;
access_log logs/access.log main
;
location /
{
proxy_pass http://127.0.0.1:8088
;
}
location ~*.*echoAnnotation$
{
proxy_set_header Upgrade
$http_upgrade
;
proxy_set_header Connection
"upgrade"
;
proxy_pass http://127.0.0.1:8088
;
}
}
}
点击这里
点击第一个
在输入框输入以下内容，ip替换为自己的，如果跟上图所示一致，就说明测试成功
ws://192.168.10.93:8080/ws_example/websocket/echoAnnotation

关键字: Tongweb+Ths6011测试websocket（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 119
问题: Tongweb7 日志报错：HttpServletResponse is exceeding the 65535 bytes limit（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/140461448

---

遇到jsp访问的时候页面加载不全，看tw7日志有如下图信息：
原因： jsp的本质是servlet，编译时会先将他转换成java代码，然后再进行编译。 你的jsp编译成生成的文件太大，导致报错。（Java 编译器限制单个方法的字节大小不能超过 65535 字节。如果 JSP 页面包含大量的 HTML、JavaScript 或嵌入的 Java 代码，编译后生成的 _jspService 方法可能会非常大，超过此限制。）
查询了一下，tomcat的做法是在web.xml里配置了如下配置：
于是尝试在tongweb的conf目录下找到default-web.xml，先备份，然后找到对应的配置部分：
看着跟tomcat的很类似，于是在 development下的 下加了一段配置：
<
init-param
>
<
param-name
>
mappedfile
<
/param-name
>
<
param-value
>
false
<
/param-value
>
<
/init-param
>
配置后重启tongweb，测试一下应用的jsp页面，问题解决。

关键字: Tongweb7 日志报错：HttpServletResponse is exceeding the 65535 bytes limit（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 120
问题: Tongweb7+Tongweb8+Ths6.0.1.0+TongRDS2214 常用指令和初始账号密码(by lqw)

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/136481102

---

Tongweb7
启动
cd到安装目录的bin目录，执行：
sh startservernohup.sh 或./startservernohup.sh
查看日志
cd到安装目录的logs目录，执行：
tail -f server.log
关闭
cd到安装目录的bin目录，执行：
./stopserver.sh quick
查看版本和授权过期时间
./version.sh
开机自启动
cd到安装目录的bin目录，执行：
./installservice.sh
关闭开机自启动
先停止tongweb服务，然后cd到安装目录的bin目录，执行：
systemctl disable tongweb.service
然后删掉以下文件：
rm /etc/systemd/system/tongweb.service
rm /usr/lib/systemd/system/tongweb.service
最后重载
systemctl daemon-reload
控制台访问url和初始账号密码
链接:http://tongweb所在服务器ip:9060/console
账号：thanos
初始密码: thanos123.com
初次登录需要修改密码。
集中管理工具访问url和初始账号密码
链接：http//tongweb所在服务器ip:9060/heimdall/
账号：rig
初始密码: rig123.com
初次登录需要修改密码。
Tongweb8
启动
cd到安装目录的bin目录，执行
./startserver.sh
关闭
cd到安装目录的bin目录，执行
./stopserver.sh
开机自启动
cd到安装目录的bin目录，执行
/admin.sh systemd install
卸载自启服务
请根据自己的安装目录进行修改，以下是装在opt/tw8下的参考
java -jar /opt/tw8/TongWeb8.0.7.0/bin/tongweb-launcher.jar  systemd uninstall
管控台访问url和初始账号密码
链接：https://<TongWebIP>:9060/console
系统管理员账号：thanos
初始密码：thanos123.com
Ths6.0.1.0
启动管控台
cd到安装目录的bin目录，执行
./startManager.sh start
关闭管控台
./startManager.sh stop
启动ths节点
cd到ths的安装节点目录的bin目录（一般节点安装在/opt/THS）
#启动节点
./start.sh
#启动agent，方便控制台识别（需要配置agent相关文件）
./startAgent.sh
#启动高可用（需配置高可用）
./startHA.sh
关闭ths节点
cd到ths的安装节点目录的bin目录（一般节点安装在/opt/THS）
./start.sh stop
./startHA.sh stop
./startAgent.sh stop
管控台访问url和初始账号密码
链接：
https//服务器ip地址：端口号（默认8000）/admin
账号：admin
密码:Ths#123.com
TongRDS2214
启动管控台
cd到管控太安装目录的bin目录（解压后一般目录名为console），执行
./console.sh start
关停管控台
cd到管控太安装目录的bin目录（解压后一般目录名为console），执行
./console.sh stop
查看管控台状态
./console.sh status
管控台访问url和初始账号密码
链接：http://服务器所在ip地址:8083
用户名：admin
密码：admin123

关键字: Tongweb7+Tongweb8+Ths6.0.1.0+TongRDS2214 常用指令和初始账号密码(by lqw)
文档来源: http://tongweb所在服务器ip:9060/console
--------------------------------------------------------------------------------

问题编号: 121
问题: Tongweb7049+TongRDS2214-2216+THS6010-6012 开机自启动（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/142789616

---

原理
配置rc.local（这个网上有很多示范，为了方便使用，在这里总结一下各个产品的配置）
Tongweb7049
Tongweb7049 本身自带开机自启动脚本（bin目录下的installxxx.sh），但是有时执行失败的话，可以参考这个。
chmod
+x /etc/rc.d/rc.local
chmod
755
/etc/rc.d/rc.local
su - root -c “cd tongweb安装目录的bin目录;./startservernohup.sh”，例如：
注意：
1.把root替换为tongweb安装目录所属用户。
2.startservernohup.sh这个脚本记得给执行权限。
TongRDS2214-2216
在/etc/rc.d/rc.local文件中加入TongRDS的启动命令，rc.local要有x权限,相关安装目录请自行替换并测试。
chmod
+x /etc/rc.d/rc.local
chmod
755
/etc/rc.d/rc.local
#启动管理控制台（如果没有可以不添加）
su
- root -c
"cd /home/tongweb/TongRDS/console/bin;nohup ./console.sh start >/dev/null &"
#启动节点管理器，（如果没有可以不添加）
su
- root -c
"cd /home/tongweb/TongRDS/node-mgr;nohup ./probe.sh start >/dev/null &"
#启动中心服务
su
- root -c
"cd /home/tongweb/TongRDS/console/apps/center89/bin; nohup ./StartCenter.sh >/dev/null &"
#启动节点
su
- root -c
"cd /home/tongweb/TongRDS/node-mgr/apps/node1/bin;nohup ./StartServer.sh >/dev/null &"
#启动哨兵节点，如果没有可以不添加
su
- root -c
"cd /home/tongweb/TongRDS/console/apps/sb01/bin;nohup﻿ ./StartServer.sh >/dev/null &"
注意：
1.把root替换为trds安装目录所属用户。
2.上述涉及的脚本记得给执行权限。
THS6010-6012
chmod
+x /etc/rc.d/rc.local
chmod
755
/etc/rc.d/rc.local
#启动节点
su
- root -c
"cd /opt/THS/bin; ./start.sh"
#启动agent（没有的话可以不用配）
su
- root -c
"cd /opt/THS/bin; ./startAgent.sh"
#启动HA（没有的话可以不用配）
su
- root -c
"cd /opt/THS/bin; ./startHA.sh"

关键字: Tongweb7049+TongRDS2214-2216+THS6010-6012 开机自启动（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 122
问题: Tongweb7049M4有关SSL_TLS 服务器瞬时 Diffie-Hellman 公共密钥过弱的处理方案（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/144365065

---

前提条件：Tongweb7049M4已在http通道里配置了https（如何配置https可以参考这个帖子：
东方通TongWEB添加Https证书，开启SSL
）
遇到客户在配置了https后，扫描漏洞提示：
有关SSL/TLS 服务器瞬时 Diffie-Hellman 公共密钥过弱。
当时尝试在jdk.security里配置了相关参数并让客户重启，还是没有解决这个漏洞：
后来参考
SpringBoot项目：SSL/TLS 服务器瞬时 Diffie-Hellman 公共密钥过弱
看到以下配置：
Tongweb的控制台上有类似的配置，就在http通道里：
勾选TLSv1,TLSv1.3,TLSv1.2,TLSv1.1这几个协议，然后在下方的
ciphers里配置下面的内容：
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA
配置成功，可重启Tongweb，再进行漏洞扫描。

关键字: Tongweb7049M4有关SSL_TLS 服务器瞬时 Diffie-Hellman 公共密钥过弱的处理方案（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 123
问题: Tongweb7049m4 遇到 “xxx打开的文件过多” 的处理思路（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143214648

---

遇到一个案例，客户服务的cpu占用，内存占用都不高，看控制台的线程数也很低，但是会报这种错误：
看着像是mybatis刷新什么东西的时候，刷不到对应的信息导致的，于是细看了一下tongweb的server.log，发现了这种日志信息：
关键是查看unlimit -a，配了open files 65535了。
于是让客户先重启恢复服务，等下次遇到同样问题，执行lsof -p 进程号 > log.txt，再把日志发出来看看。
结果隔了大概一天的时间，客户又遇到这个问题，浏览器截图如下：
客户顺利打印出lsof的信息，我看了下，出现最多信息的是两个mapper文件，都跟业务有关，全是mapper文件（用nodepid++ 的统计功能统计的）
好家伙，两个mapper文件的打开文件数加起来都快达到openfile 配置的最大数了，难怪会报打开的文件过多的信息。
后续：
让应用去排查代码逻辑上哪里调用了这两个文件，看看是否是资源没有及时释放，或者是代码问题。

关键字: Tongweb7049m4 遇到 “xxx打开的文件过多” 的处理思路（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 124
问题: Tongweb7049m4+THS6010-6012版本 传真实ip到后端（by yjm+lwq）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143184916

---

遇到客户需要通过ths传真实ip到后端也就是部署到tongweb的需求，在ths的httpserver.conf里的location块配置了以下内容：
proxy_set_header Host
$host
;
proxy_set_header X-Real-IP
$remote_addr
;
proxy_set_header X-Forwarded-For
$proxy_add_x_forwarded_for
;
proxy_set_header X-Forwarded-Proto
$scheme
;
配置后，重启ths，发现后端没有获取到真实ip。
参考
负载场景下TongWeb如何获取真实的客户端IP地址
发现可以在应用层面修改代码，或者tongweb层面配置实现这一效果。
如果要从tongweb层面的着手的话，可以登录控制台进行配置，如下图所示：
com.tongweb.catalina.valves.RemoteIpValve,protocolHeader
=
X-Forwarded-Proto,remoteIpHeader
=
X-Forwarded-For,protocolHeaderHttpsValue
=
https
记得双击保存，然后测试一下应用。

关键字: Tongweb7049m4+THS6010-6012版本 传真实ip到后端（by yjm+lwq）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 125
问题: Tongweb7049m4+THS6010-6012配置故障轉移+重試机制（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/142854919

---

使用场景
1.ths代理tongweb多套后端，假如有其中一套tongweb因为服务器重启或者宕机后没有及时启动，导致ths一直轮询在这个出故障的节点上。
2.即使在tongweb重启了，有的应用启动也需要一定的时间，这个时候只是启动了应用端口，ths仍有可能轮询在对应的tongweb上。
说明：
本文仅供参考，里面的参数配置，最终请根据自身业务场景进行调整。
服务器配置
本次示范使用两台服务器（113和114），分别搭建两套ths和两套tongweb做负载均衡和反向代理，浮动ip使用151，tongweb部分配置了测试用的ssl证书(如何配置ssl的可自行百度)。
httpserver.conf配置
#user  nobody;
worker_processes auto
;
worker_cpu_affinity auto
;
#error_log  logs/error.log;
#error_log  logs/error.log  notice;
error_log logs/error.log info
;
pid logs/httpserver.pid
;
events
{
worker_connections
1024
;
use epoll
;
}
http
{
include mime.types
;
default_type application/octet-stream
;
log_format main
'
$remote_addr
-
$remote_user
[
$time_local
] "
$request
" '
'
$status
$body_bytes_sent
"
$http_referer
" '
'"
$http_user_agent
" "
$http_x_forwarded_for
"'
;
#access_log  logs/access.log  main;
access_log off
;
sendfile on
;
#tcp_nopush     on;
#keepalive_timeout  0;
keepalive_timeout
60
;
# 设置5秒的超时时间
#proxy_connect_timeout 5s;
# 连接超时
#proxy_read_timeout 5s;
# 读取超时
#proxy_send_timeout 5s;
# 发送超时
# 配置切换到其他后端的条件，包括超时和错误状态码
proxy_next_upstream error
timeout
http_404 http_500 http_502 http_503 http_504 http_403
;
#gzip  on;
upstream tongweb
{
#ip_hash;
#server后填写对应所有前端机器的ip
server
192.168
.10.113:8088
max_fails
=
3
fail_timeout
=
2s
;
server
192.168
.10.114:8088
max_fails
=
3
fail_timeout
=
2s
;
#keepalive 200;
health_check
interval
=
30000
rise
=
1
fall
=
3
type
=
ssl_hello
;
#keepalive_requests 10000;
}
server
{
server_name localhost_ths_monitor
;
listen
49151
;
access_log off
;
allow
127.0
.0.1
;
deny all
;
location /thsapi/
{
api /status
;
}
}
server
{
listen
8080
;
server_name localhost
;
#charset koi8-r;
#access_log  logs/host.access.log  main;
access_log off
;
#proxy_next_upstream error timeout http_404 http_500 http_502 http_503 http_504 http_403;
location /
{
root html
;
index index.html index.htm
;
}
#error_page  404              /404.html;
# redirect server error pages to the static page /50x.html
error_page
500
502
503
504
/50x.html
;
location
=
/50x.html
{
root html
;
}
# proxy the PHP scripts to Apache listening on 127.0.0.1:80
#
#location ~ \.php$ {
#    proxy_pass   http://127.0.0.1;
#}
# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
#
#location ~ \.php$ {
#    root           html;
#    fastcgi_pass   127.0.0.1:9000;
#    fastcgi_index  index.php;
#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
#    include        fastcgi_params;
#}
# deny access to .htaccess files, if Apache's document root
# concurs with httpserver's one
#
#location ~ /\.ht {
#    deny  all;
#}
}
server
{
listen
443
ssl
;
server_name localhost
;
# 配置 SSL 证书和密钥
ssl_certificate tools/crt_demo/server.crt
;
ssl_certificate_key tools/crt_demo/server.key
;
proxy_next_upstream error
timeout
http_404 http_500 http_502 http_503 http_504 http_403
;
location /
{
proxy_pass https://tongweb
;
}
}
# HTTPS server
#server {
#listen       443 ssl;
#server_name  localhost;
#ssl_protocols TLSv1.2 TLSv1.3;
#GMTLS key
#ssl_gmtls on;
#ssl_certificate      crts/SS.pem crts/SE.pem;
#ssl_certificate_key  crts/SS.key.pem crts/SE.key.pem;
#https key
#ssl_certificate      crts/common_cert/server.crt;
#ssl_certificate_key  crts/common_cert/server.key;
#ssl_session_cache    shared:SSL:1m;
#ssl_session_timeout  5m;
#ssl_ciphers  HIGH:!aNULL:!MD5;
#ssl_prefer_server_ciphers  on;
#location / {
#root   html;
#index  index.html index.htm;
#}
#}
}
其中核心配置部分主要是这两个地方：
备注：
1.proxy_next_upstream error timeout http_404 http_500 http_502 http_503 http_504 http_403;作用在http，server和location块，请不要配置在其他地方，一般情况下建议可以配在http块里。
测试
先測試113和114部署的應用是否能正常訪問
然後測試用ths的端口訪問是否能正常訪問（包括浮動ip）：
然後可以自己在命令行頁面kill掉其中一台服务器上的tongweb进程，或者在其中一台tongweb控制台上停止该应用（生产环境不推荐，本文只是做测试才用）。
再去访问停掉的应用，发现是访问不了的：
去访问ths和浮动ip，仍然是正常的：

关键字: Tongweb7049m4+THS6010-6012配置故障轉移+重試机制（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 126
问题: Tongweb7049m4部署应用报错：java.lang.ClassNotFoundException_ javax.enterprise.inject.spi.CDIProvider（lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/145679256

---

问题描述
用户同一台服务器环境，使用jdk1.8，部署应用在tomcat8.5能正常运行，部署在tongweb7049m4，将启动参数webonly调整为true后，报以下错误：
Caused by: java.lang.NoClassDefFoundError: javax/enterprise/inject/spi/CDIProvider
	at java.lang.ClassLoader.defineClass1
(
Native Method
)
at java.lang.ClassLoader.defineClass
(
ClassLoader.java:756
)
at java.security.SecureClassLoader.defineClass
(
SecureClassLoader.java:142
)
at java.net.URLClassLoader.defineClass
(
URLClassLoader.java:473
)
at java.net.URLClassLoader.access
$100
(
URLClassLoader.java:74
)
at java.net.URLClassLoader
$1
.run
(
URLClassLoader.java:369
)
at java.net.URLClassLoader
$1
.run
(
URLClassLoader.java:363
)
at java.security.AccessController.doPrivileged
(
Native Method
)
at java.net.URLClassLoader.findClass
(
URLClassLoader.java:362
)
at java.lang.ClassLoader.loadClass
(
ClassLoader.java:418
)
at com.tongweb.server.TWServerURLClassLoader.loadClass0
(
TWServerURLClassLoader.java:46
)
at com.tongweb.server.TWServerURLClassLoader.access
$000
(
TWServerURLClassLoader.java:11
)
at com.tongweb.server.TWServerURLClassLoader
$1
.loadClass
(
TWServerURLClassLoader.java:40
)
at com.tongweb.common.LoadClassCache.cacheLoadClass
(
LoadClassCache.java:63
)
at com.tongweb.server.TWServerURLClassLoader.loadClass
(
TWServerURLClassLoader.java:37
)
at java.lang.ClassLoader.loadClass
(
ClassLoader.java:405
)
at com.tongweb.server.TWServerURLClassLoader.loadClass0
(
TWServerURLClassLoader.java:46
)
at com.tongweb.server.TWServerURLClassLoader.access
$000
(
TWServerURLClassLoader.java:11
)
at com.tongweb.server.TWServerURLClassLoader
$1
.loadClass
(
TWServerURLClassLoader.java:40
)
at com.tongweb.common.LoadClassCache.cacheLoadClass
(
LoadClassCache.java:63
)
at com.tongweb.server.TWServerURLClassLoader.loadClass
(
TWServerURLClassLoader.java:37
)
at java.lang.ClassLoader.loadClass
(
ClassLoader.java:351
)
at com.tongweb.tongejb.core.ConnectorClassLoader.loadClass
(
ConnectorClassLoader.java:146
)
at java.lang.ClassLoader.loadClass
(
ClassLoader.java:351
)
at java.lang.Class.forName0
(
Native Method
)
at java.lang.Class.forName
(
Class.java:348
)
at com.tongweb.catalina.loader.WebappClassLoaderBase.loadClass
(
WebappClassLoaderBase.java:1293
)
at com.tongweb.tomee.catalina.ThanosTomEEWebappClassLoader.access
$201
(
ThanosTomEEWebappClassLoader.java:23
)
at com.tongweb.tomee.catalina.ThanosTomEEWebappClassLoader
$1
.loadClass
(
ThanosTomEEWebappClassLoader.java:95
)
at com.tongweb.common.LoadClassCache.cacheLoadClass
(
LoadClassCache.java:63
)
at com.tongweb.tomee.catalina.ThanosTomEEWebappClassLoader.loadClass
(
ThanosTomEEWebappClassLoader.java:80
)
at com.tongweb.catalina.loader.WebappClassLoaderBase.loadClass
(
WebappClassLoaderBase.java:1176
)
at java.lang.Class.forName0
(
Native Method
)
at java.lang.Class.forName
(
Class.java:348
)
at java.util.ServiceLoader
$LazyIterator
.nextService
(
ServiceLoader.java:370
)
at java.util.ServiceLoader
$LazyIterator
.next
(
ServiceLoader.java:404
)
at java.util.ServiceLoader
$1
.next
(
ServiceLoader.java:480
)
at java.lang.Iterable.forEach
(
Iterable.java:74
)
at javax.enterprise.inject.spi.CDI.findAllProviders
(
CDI.java:125
)
at javax.enterprise.inject.spi.CDI.getCDIProvider
(
CDI.java:82
)
at javax.enterprise.inject.spi.CDI.current
(
CDI.java:64
)
at org.eclipse.yasson.internal.components.JsonbComponentInstanceCreatorFactory.getComponentInstanceCreator
(
JsonbComponentInstanceCreatorFactory.java:48
)
..
.
55
more
Caused by: java.lang.ClassNotFoundException: javax.enterprise.inject.spi.CDIProvider
	at java.net.URLClassLoader.findClass
(
URLClassLoader.java:387
)
at java.lang.ClassLoader.loadClass
(
ClassLoader.java:418
)
at com.tongweb.server.TWServerURLClassLoader.loadClass0
(
TWServerURLClassLoader.java:46
)
at com.tongweb.server.TWServerURLClassLoader.access
$000
(
TWServerURLClassLoader.java:11
)
at com.tongweb.server.TWServerURLClassLoader
$1
.loadClass
(
TWServerURLClassLoader.java:40
)
at com.tongweb.common.LoadClassCache.cacheLoadClass
(
LoadClassCache.java:63
)
at com.tongweb.server.TWServerURLClassLoader.loadClass
(
TWServerURLClassLoader.java:37
)
at java.lang.ClassLoader.loadClass
(
ClassLoader.java:351
)
..
.
97
more
#问题分析和解决思路
看到最后的报错信息是ClassNotFoundException，得确认一下，是找不到class文件，还是已有的class文件跟tongweb自身带的起冲突了（毕竟前面也报了个NoClassDefFoundError）。
参考：
TongWeb78处理应用自身JAR包冲突思路
根据报错信息我们分别尝试在tomcat和tongweb的安装目录执行了以下指令，确认是否缺少了对应的class
grep-Rn
"javax.enterprise.inject.spi.CDIProvider"
/usr/local/tong
grep-Rn
"javax.enterprise.inject.spi.CDIProvider"
/usr/local/tomcat
可以看到是有的，其中tongweb的在lib下的cdi-api.jar，tomcat的在应用的lib目录下的cdi-api-2.0.jar。
这就说明其实并不是class文件没找到，有可能是tongweb和应用的jar包在这一块的代码不一致，导致的冲突和报错。
然后用jar包查看工具查看了一下这两个jar包，发现在CDIProvider上，代码逻辑有点不一样（应用的是extends Prioritized，tongweb的没有）：
所以让客户尝试备份好后，把应用的lib下的cdi-api-2.0.jar后删掉再重启，问题解决。

关键字: Tongweb7049m4部署应用报错：java.lang.ClassNotFoundException_ javax.enterprise.inject.spi.CDIProvider（lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 127
问题: Tongweb7049m4集中管理session报java.lang.ClassNotFoundException_ java.util.List$$EnhancerByCGLIBxxx（lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/145829339

---

现象描述
用户使用tongweb7049m4+集中管理工具+nginx，报错：
java.lang.IllegalStateException: get session: 023EE405E22DF01DCE7DEE39F78B3FE6-32 fail,
find
session: 023EE405E22DF01DCE7DEE39F78B3FE6 fail, redis session uninitialized
看到最后一个case by，是找不到class：
Caused by: java.lang.ClassNotFoundException:
$java
.util.List
$$
EnhancerByCGLIB
$$
c3d9653a
	at com.tongweb.tomee.catalina.ThanosTomEEWebappClassLoader
$1
.loadClass
(
ThanosTomEEWebappClassLoader.java:98
)
at com.tongweb.common.LoadClassCache.cacheLoadClass
(
LoadClassCache.java:63
)
at com.tongweb.tomee.catalina.ThanosTomEEWebappClassLoader.loadClass
(
ThanosTomEEWebappClassLoader.java:80
)
at com.tongweb.catalina.loader.WebappClassLoaderBase.loadClass
(
WebappClassLoaderBase.java:1176
)
at java.lang.Class.forName0
(
Native Method
)
at java.lang.Class.forName
(
Class.java:348
)
at com.tongweb.serializer.kryo.util.DefaultClassResolver.readName
(
DefaultClassResolver.java:136
)
..
.
49
more
原因分析
在反序列化过程中，应用程序试图加载一个增强的代理类（即
java.util.Listjava.util.List
ja
v
a
.
u
t
i
l
.
L
i
s
t
EnhancerByCGLIBEnhancerByCGLIB
E
nhan
cer
B
y
CG
L
I
B
$c3d9653a），但该类未被加载到当前的 ClassLoader 中。
原因：增强类（通常是由 CGLIB 创建的代理类）在序列化环境中创建，但在反序列化环境中不可用，可能因为它是动态生成且未持久化的。
解决方案
1.配置启动参数：-Dwebcluster.session.sticky=false。
2.修改应用代码，如下为示范：

关键字: Tongweb7049m4集中管理session报java.lang.ClassNotFoundException_ java.util.List$$EnhancerByCGLIBxxx（lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 128
问题: Tongweb708使用jmx获取参数+参考应用demo（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/152000422

---

前提
1.已顺利安装好Tongweb708，并顺利启动了Tongweb708，能登录控制台进行操作
2.最好本地准备好jdk，方便用jconsole测试。
相关配置
开启远程jmx
找到该位置，开启远程jmx，配置服务器ip，jmx连接端口号，打开支持jconsole的开关，点击更新或保存。
配置启动参数
-Dcom.sun.management.jmxremote
=
true
-Dcom.sun.management.jmxremote.ssl
=
false
-Dcom.sun.management.jmxremote.authenticate
=
false
-Djava.rmi.server.hostname
=
监控IP
备注：
1.监控ip换成你的本机ip，不要用127.0.0.1
可以通过控制台进行配置：
也可以配置到tongweb.xml下（前提是得关了文件防篡改，否则需要关闭tongweb，记得备份好你的tongweb.xml）：
<
arg
changeToArg
=
""
desc
=
""
enabled
=
"true"
name
=
"-Dcom.sun.management.jmxremote=true"
onlyForLinux
=
"false"
supportedJRE
=
""
/
>
<
arg
changeToArg
=
""
desc
=
""
enabled
=
"true"
name
=
"-Dcom.sun.management.jmxremote.ssl=false"
onlyForLinux
=
"false"
supportedJRE
=
""
/
>
<
arg
changeToArg
=
""
desc
=
""
enabled
=
"true"
name
=
"-Dcom.sun.management.jmxremote.authenticate=false"
onlyForLinux
=
"false"
supportedJRE
=
""
/
>
<
arg
changeToArg
=
""
desc
=
""
enabled
=
"true"
name
=
"-Djava.rmi.server.hostname=192.168.10.123"
onlyForLinux
=
"false"
supportedJRE
=
""
/
>
配置监控用户密码
可通过控制台操作。
重启tongweb并获取jmx连接url
重启tongweb，然后查看启动日志，找到这个信息：
使用jconsole验证
window本地打开你的jdk目录，找到该文件，双击运行：
填入相关信息（包括日志里看到的jmx的连接url，前面配的账号密码）：
点击连接，遇到提示不安全的ssl连接，直接点不安全的连接：
连接成功后，会有页面加载，包括mbean，如下所示：
部署参考demo
首先找到示范demo的war，路径在versionxxx/examples下：
填好应用名和部署路径（即war包所在的路径，例如：/opt/TongWeb7.0.8.905/version7.0.8.905/examples/examples.war），然后点添加：
部署成功后，点击连接进行访问：
点击最下面的jmx&resetapi：
参考demo的示范使用
ip：服务器ip
端口：7200（jmx配置端口）
用户：minnor
密码：minnor的密码，在控制台配置
模块：host
操作：list
填写好后，点击生成jmx代码，然后执行，可以看到有结果：
代码原理和参数的参考指引
首先我们关注一下生成的jmx代码里的这个片段：
其实就是用的jconsole显示的mbean的这个部分：
继续看代码：
这里的参数，正好对应的TongWeb_V7.0.8命令行工具的内容，如下所示：
打个比方，截图显示的model下，有个app的参数，对应的action为access，add，delete，list，monitor，show，start，stop等：
我们往下拉，找到9.3应用这里：
我们拿list来测一下，在jmx的测试demo里输入app和list，然后看看生成的jmx的代码的执行结果：
可以看到执行结果和手册里的参数名能对得上：
所以可以借助这个demo，参考命令行来测试所有你想获取的jmx参数

关键字: Tongweb708使用jmx获取参数+参考应用demo（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 129
问题: Tongweb708命令行脚本使用指引（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/152028228

---

文章目录
声明
通过comm脚本修改用户密码
关于密码加密和passwordfile
通过comm脚本创建用户并赋予角色
关于实例，节点和集群
实例的概念
节点的概念
集群的概念
操作思路
命令行操作实例
新建实例
启动实例
停止实例
删除实例
实例部署应用
实例查看应用列表和配置
实例停止应用
实例启动应用
实例备份应用
实例自定义备份数
默认实例查看应用备份
默认实例删除应用备份
默认实例从应用备份恢复应用
默认实例卸载应用
命令行操作节点
查看节点列表
手动安装的节点进行自动注册
停止手动安装的节点
启动手动安装的节点
删除手动安装的节点
命令行操作集群
创建集群
启动集群
查看集群
集群部署应用
集群启动应用
集群查看应用
集群停止应用
集群删除应用
删除集群
声明
本帖参考Tongweb708命令行手册+控制台脚本录制功能编写，仅供参考，不代表其他版本的tongweb也能用同样的方式，具体以产品对应版本的产品手册为准。
通过comm脚本修改用户密码
./commandstool.sh
--model
=
password
--action
=
update
\
--username
=
thanos
\
--password
=
"Yeyehuo163.com"
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--acceptAgreement
=
true
\
originalPassword
=
"Yeyehuo163.com"
\
newPassword
=
"Yeyehuo164.com"
\
confirmPassword
=
"Yeyehuo164.com"
关于密码加密和passwordfile
正常的comm脚本使用，是要在执行的时候，指定用户名和密码的，例如：
有时我们可能不止一个人使用，并且不想暴露密码给别人，也不想手敲加密的密文那么麻烦，这个时候，可以使用加密工具和passwordfile。
#进入到安装目录的bin
cd
/opt/TongWeb7.0.8.905/bin
[
root@localhost bin
]
# ./admin.sh encrypt id "Yeyehuo164.com"
2025
-09-24
13
:16:50
>>
>
[
domain1
]
id: Tw80EncodedPrefixFlagLFSXSZLIOVXTCNRUFZRW63I
#也可以用comm脚本
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
encryptor
\
--action
=
update
\
--username
=
thanos
\
--password
=
'Yeyehuo164.com'
\
--acceptAgreement
=
true
\
input
=
'Yeyehuo164.com'
\
encryptMethod
=
id
\
digestAlg
=
SHA-256
\
saltLength
=
1
\
iterations
=
1
备注：
1.加密后的密文并不是每次都一样的，这个不妨碍使用。
加密后，自己建一个passwordfile.txt，在里面填写以下内容：
thanos
=
Tw80EncodedPrefixFlagLFSXSZLIOVXTCNRUFZRW63I
# 加密后的密码
这样，当我们执行comm脚本的时候，就可以使用–passwordfile=/opt/passwordfile.txt这种形式
备注：
1.如果有使用控制台的话，一般不建议用thanos这个账号，最好自己单独建一个账号。
2.passwordfile的属主必须和comm脚本的属主一致。
3.示范使用的是在线模式，需要保证tongweb正常运行。
通过comm脚本创建用户并赋予角色
先用thanos用户创建用户
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
user
\
--action
=
add
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
yehuo
\
password
=
'Yeyehuo163.com'
\
confirmPassword
=
'Yeyehuo163.com'
\
digestAlg
=
SHA-256
\
active
=
true
\
info
=
'系统管理员'
\
changeInitPwd
=
false
\
minLen
=
8
\
saltLength
=
4
\
iterations
=
5
\
limitRepeats
=
5
\
passwordMinAge
=
0
\
passwordMaxAge
=
90
\
composition
=
'Tw80EncodedPrefixFlagJZ2W2YTFOIWEG2DBOIWEGYLTMUWFG4DFMNUWC3BMJZXUG33OONSWG5LUNF3GKLCON5KXGZLS'
备注：
1.建议除了用户名，密码之外，其他的参数用示范的，否则需要参考命令行手册和脚本录制自行调整。
然后通过security用户配置角色（例如自带的system），下面是自带角色的介绍：
使用加密工具，加密security的密码（用摘要算法digest）：
#Yeyehuo164.com为要加密的明文
[
root@localhost bin
]
# ./admin.sh encrypt asymmetric "Yeyehuo164.com"
2025
-09-24
16
:21:24
>>
>
[
domain1
]
asymmetric: 150D5EBFED77F17D88C9A638AB18C4F1FD72BA4A8CDB7F9DB7B728142AA1918AD7FD15E162803A7427EE3EC7D217F2E4EE9F16EE3B76E9FFD8F31C0F130DC99411160F9E0D06FFD1FDB1AD4ABAC64C08F544962377DE177EA01B18F99835448828F0E325F3D03E651059DAFE5F79824B2392278E7334B82657C3ED478ABB4099
#还可以通过脚本输出加密密文
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
encryptor
\
--action
=
update
\
--username
=
thanos
\
--passwordfie
=
'Yeyehuo164.com'
\
--acceptAgreement
=
true
\
input
=
'Yeyehuo164.com'
\
encryptMethod
=
asymmetric
新建security_password.txt，内容如下：
#格式：用户名=加密的密文
security
=
150D5EBFED77F17D88C9A638AB18C4F1FD72BA4A8CDB7F9DB7B728142AA1918AD7FD15E162803A7427EE3EC7D217F2E4EE9F16EE3B76E9FFD8F31C0F130DC99411160F9E0D06FFD1FDB1AD4ABAC64C08F544962377DE177EA01B18F99835448828F0E325F3D03E651059DAFE5F79824B2392278E7334B82657C3ED478ABB4099
执行以下指令，将对应的角色赋权给新建的角色：
[
root@localhost bin
]
# ./commandstool.sh     --host=192.168.10.123     --port=9060     --model=userrole     --action=update     --username=security     --passwordfile=/opt/TongWeb7.0.8.905/security_password.txt     --acceptAgreement=true     name=yeyehuo nodes=default     roles=system
{
"models"
:
[
]
,
"attachments"
:
{
}
,
"success"
:
"true"
,
"msg"
:
"权限分配更新成功"
,
"redirectURL"
:
""
,
"dataTime"
:
""
}
参数说明：
备注：
同理：
#进入到安装目录的bin
cd
/opt/TongWeb7.0.8.905/bin
[
root@localhost bin
]
# ./admin.sh encrypt id "Yeyehuo163.com"
2025
-09-24
13
:16:50
>>
>
[
domain1
]
id: Tw80EncodedPrefixFlagLFSXSZLIOVXTCNRTFZRW63I
跟上述一样，自己弄个passwordfile.txt（txt的名字随意，只要是自己能认出来是密码文件即可），把账号密码放进去：
#用户名=密文密码
yehuo
=
Tw80EncodedPrefixFlagLFSXSZLIOVXTCNRTFZRW63I
关于实例，节点和集群
实例的概念
备注：
1.tongweb新装的时候，默认是有自带的实例的，就叫domain1，在安装目录的domains目录可以找到对应的目录。
2.一般情况下，如果用到集群，不建议用默认的domain1部署应用。
节点的概念
备注：
1.可以理解为，一台服务器只能有一个节点。
集群的概念
操作思路
一般情况下，如果是已经建立了集群的，建议从集群的层面来操作（例如部署应用），其次是节点，最后才是实例。
不要通过命令行操作了集群部署了应用，然后自己又用命令行单独改某个节点上的应用，这种很容易出问题。
命令行操作实例
新建实例
前提：
1.需有节点在运行。
2.可以加个name=实例名来命令新实例，如果没有的话，也会自动生成。
使用以下指令查看节点列表：
./commandstool.sh
\
--model
=
node
\
--action
=
list
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
instance
\
--action
=
add
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
"clustertest01-c3c80bbfdd2a4a6d94471f3b8f46a356-1"
node
=
"6bb3f88ce6e0473180dbbe0511af3c27"
启动实例
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
instance
\
--action
=
start
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
"clustertest01-c3c80bbfdd2a4a6d94471f3b8f46a356-1"
停止实例
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
instance
\
--action
=
stop
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
"clustertest01-c3c80bbfdd2a4a6d94471f3b8f46a356-1"
删除实例
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
instance
\
--action
=
delete
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
"clustertest01-c3c80bbfdd2a4a6d94471f3b8f46a356-1"
!
[
在这里插入图片描述
]
(
https://i-blog.csdnimg.cn/direct/36e245f599ad4983afbb882a2eaaaac1.png
)
实例部署应用
一般如果是单机的情况下，可以考虑使用默认实例部署应用。
./commandstool.sh
--model
=
app
--action
=
add
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--username
=
thanos
\
--acceptAgreement
=
true
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
appFrom
=
fromServer
\
filename
=
/opt/TongWeb7.0.8.905/version7.0.8.905/examples/examples.war
\
contextRoot
=
/webserver
\
autoDeploy
=
false
\
targetType
=
instance
targetName
=
domain1
部署后，看到以下提示，说明部署成功：
实例查看应用列表和配置
./commandstool.sh
--model
=
app
--action
=
list
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--username
=
thanos
\
--acceptAgreement
=
true
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
targetType
=
instance
targetName
=
domain1
一般会返回以下信息：
{
"models"
:
[
{
"name"
:
"example"
,
"autoDeploy"
:
"false"
,
"appFrom"
:
"fromServer"
,
"filename"
:
"deployment\/examples"
,
"unpackDir"
:
"deployment"
,
"appTemplate"
:
""
,
"springBootCompatible"
:
"false"
,
"contextRoot"
:
"examples"
,
"host"
:
"localhost"
,
"startupPriority"
:
"99"
,
"refRealm"
:
""
,
"dependentApp"
:
""
,
"delegateFirst"
:
"false"
,
"useEjbStandaloneLoader"
:
"false"
,
"forcedLoad"
:
"javax.ws.rs."
,
"forcedSkip"
:
""
,
"webSocketEnabled"
:
"false"
,
"webModuleOnly"
:
"false"
,
"appImplModules"
:
""
,
"refLib"
:
""
,
"priorityJars"
:
""
,
"reloadable"
:
"false"
,
"addWebinfClassesResources"
:
"false"
,
"loadManifestClassPath"
:
"false"
,
"manifestClassPathBase"
:
""
,
"absoluteOrdering"
:
"false"
,
"showLoadedClasses"
:
"false"
,
"customClassLoader"
:
""
,
"customClass"
:
""
,
"docBases"
:
""
,
"archiveIndexStrategy"
:
"SIMPLE"
,
"sessionCookieName"
:
""
,
"useLegacyCookieProcessor"
:
"false"
,
"allowEqualsInValue"
:
"false"
,
"allowHttpSepsInV0"
:
"false"
,
"useHttpOnly"
:
"true"
,
"sameSiteCookies"
:
"Unset"
,
"maxActiveSessions"
:
"100000"
,
"sessionTimeout"
:
"30"
,
"refSessionHa"
:
""
,
"jspDevelopment"
:
"false"
,
"mappedFile"
:
"false"
,
"quoteAttributeEL"
:
"true"
,
"strictQuoteEscaping"
:
"true"
,
"strictWhiteSpace"
:
"true"
,
"enablePooling"
:
"true"
,
"jspPrecompile"
:
"false"
,
"jspPrecompileThreadCount"
:
"4"
,
"requestCharacterEncoding"
:
"UTF-8"
,
"responseCharacterEncoding"
:
"UTF-8"
,
"javaEncoding"
:
"UTF-8"
,
"fileEncoding"
:
"UTF-8"
,
"slowThreadEnabled"
:
"false"
,
"threshold"
:
"1000"
,
"interruptThreadThreshold"
:
"0"
,
"cachingAllowed"
:
"true"
,
"cacheMaxSize"
:
"102400"
,
"cacheObjectMaxSize"
:
"1024"
,
"cacheTtl"
:
"60"
,
"forceCache"
:
"false"
,
"expiresFilterEnabled"
:
"false"
,
"expiresFilterInitParam"
:
""
,
"expiresFilterUrlPatterns"
:
""
,
"preloadResource"
:
"false"
,
"preCompress"
:
"false"
,
"brEnabled"
:
"false"
,
"forcedContainerHandling"
:
"false"
,
"staticUrlPatterns"
:
""
,
"enableCORSAccess"
:
"false"
,
"corsAllowedOrigins"
:
""
,
"corsAllowedMethods"
:
"GET,POST,HEAD,OPTIONS"
,
"corsAllowedHeaders"
:
"Origin,Accept,X-Requested-With,Content-Type,Access-Control-Request-Method,Access-Control-Request-Headers"
,
"corsExposedHeaders"
:
""
,
"corsSupportCredentials"
:
"false"
,
"corsPreflightMaxAge"
:
"1800"
,
"requestParametersLostValidation"
:
"false"
,
"XSSFilterEnabled"
:
"false"
,
"csrfPrevention"
:
"false"
,
"csrfCacheSize"
:
"20"
,
"tokenValidTimes"
:
"1"
,
"csrfEntryPoints"
:
"\/login"
,
"httpHeaderToken"
:
"false"
,
"secretLevel"
:
""
,
"threadPoolPolicy"
:
"1"
,
"threadPool"
:
""
,
"threadPoolTimeout"
:
"30000"
,
"taskRule"
:
""
,
"exclusionRule"
:
""
,
"otherThreadPool"
:
""
,
"otherThreadPoolTimeout"
:
"30000"
,
"semaphoreEnabled"
:
"false"
,
"concurrency"
:
"10"
,
"block"
:
"true"
,
"interruptible"
:
"true"
,
"restrictedPorts"
:
""
,
"crossContext"
:
"false"
,
"unloadDelay"
:
"20"
,
"allowLinking"
:
"false"
,
"clearReferences"
:
"false"
,
"enableRecycling"
:
"true"
,
"shtmlEnabled"
:
"false"
,
"virtualWebappRelative"
:
"false"
,
"allowExec"
:
"false"
,
"expires"
:
"0"
,
"urlPatterns"
:
"*.shtml"
,
"webAppVersion"
:
""
,
"useRelativeRedirects"
:
"true"
,
"forceUseRelativeRedirects"
:
"false"
,
"allowCasualMultipartParsing"
:
"false"
,
"allowOverrideContentType"
:
"true"
,
"enableStatelessPoolMonitor"
:
"false"
,
"type"
:
"war"
,
"state"
:
"STARTED"
,
"jarScannerImpl"
:
""
,
"useDirectionalScanning"
:
"false"
,
"servletAnnotationDeclarationFile"
:
""
,
"applicationPropertiesFile"
:
""
,
"raPros"
:
""
,
"pkgCompatible"
:
"false"
,
"addResponseHeader"
:
""
}
,
{
"name"
:
"examples"
,
"autoDeploy"
:
"false"
,
"appFrom"
:
"fromServer"
,
"filename"
:
"deployment\/examples"
,
"unpackDir"
:
"deployment"
,
"appTemplate"
:
""
,
"springBootCompatible"
:
"false"
,
"contextRoot"
:
"webserver"
,
"host"
:
"localhost"
,
"startupPriority"
:
"99"
,
"refRealm"
:
""
,
"dependentApp"
:
""
,
"delegateFirst"
:
"false"
,
"useEjbStandaloneLoader"
:
"false"
,
"forcedLoad"
:
"javax.ws.rs."
,
"forcedSkip"
:
""
,
"webSocketEnabled"
:
"false"
,
"webModuleOnly"
:
"false"
,
"appImplModules"
:
""
,
"refLib"
:
""
,
"priorityJars"
:
""
,
"reloadable"
:
"false"
,
"addWebinfClassesResources"
:
"false"
,
"loadManifestClassPath"
:
"false"
,
"manifestClassPathBase"
:
""
,
"absoluteOrdering"
:
"false"
,
"showLoadedClasses"
:
"false"
,
"customClassLoader"
:
""
,
"customClass"
:
""
,
"docBases"
:
""
,
"archiveIndexStrategy"
:
"SIMPLE"
,
"sessionCookieName"
:
""
,
"useLegacyCookieProcessor"
:
"false"
,
"allowEqualsInValue"
:
"false"
,
"allowHttpSepsInV0"
:
"false"
,
"useHttpOnly"
:
"true"
,
"sameSiteCookies"
:
"Unset"
,
"maxActiveSessions"
:
"100000"
,
"sessionTimeout"
:
"30"
,
"refSessionHa"
:
""
,
"jspDevelopment"
:
"false"
,
"mappedFile"
:
"false"
,
"quoteAttributeEL"
:
"true"
,
"strictQuoteEscaping"
:
"true"
,
"strictWhiteSpace"
:
"true"
,
"enablePooling"
:
"true"
,
"jspPrecompile"
:
"false"
,
"jspPrecompileThreadCount"
:
"4"
,
"requestCharacterEncoding"
:
"UTF-8"
,
"responseCharacterEncoding"
:
"UTF-8"
,
"javaEncoding"
:
"UTF-8"
,
"fileEncoding"
:
"UTF-8"
,
"slowThreadEnabled"
:
"false"
,
"threshold"
:
"1000"
,
"interruptThreadThreshold"
:
"0"
,
"cachingAllowed"
:
"true"
,
"cacheMaxSize"
:
"102400"
,
"cacheObjectMaxSize"
:
"1024"
,
"cacheTtl"
:
"60"
,
"forceCache"
:
"false"
,
"expiresFilterEnabled"
:
"false"
,
"expiresFilterInitParam"
:
""
,
"expiresFilterUrlPatterns"
:
""
,
"preloadResource"
:
"false"
,
"preCompress"
:
"false"
,
"brEnabled"
:
"false"
,
"forcedContainerHandling"
:
"false"
,
"staticUrlPatterns"
:
""
,
"enableCORSAccess"
:
"false"
,
"corsAllowedOrigins"
:
""
,
"corsAllowedMethods"
:
"GET,POST,HEAD,OPTIONS"
,
"corsAllowedHeaders"
:
"Origin,Accept,X-Requested-With,Content-Type,Access-Control-Request-Method,Access-Control-Request-Headers"
,
"corsExposedHeaders"
:
""
,
"corsSupportCredentials"
:
"false"
,
"corsPreflightMaxAge"
:
"1800"
,
"requestParametersLostValidation"
:
"false"
,
"XSSFilterEnabled"
:
"false"
,
"csrfPrevention"
:
"false"
,
"csrfCacheSize"
:
"20"
,
"tokenValidTimes"
:
"1"
,
"csrfEntryPoints"
:
"\/login"
,
"httpHeaderToken"
:
"false"
,
"secretLevel"
:
""
,
"threadPoolPolicy"
:
"1"
,
"threadPool"
:
""
,
"threadPoolTimeout"
:
"30000"
,
"taskRule"
:
""
,
"exclusionRule"
:
""
,
"otherThreadPool"
:
""
,
"otherThreadPoolTimeout"
:
"30000"
,
"semaphoreEnabled"
:
"false"
,
"concurrency"
:
"10"
,
"block"
:
"true"
,
"interruptible"
:
"true"
,
"restrictedPorts"
:
""
,
"crossContext"
:
"false"
,
"unloadDelay"
:
"20"
,
"allowLinking"
:
"false"
,
"clearReferences"
:
"false"
,
"enableRecycling"
:
"true"
,
"shtmlEnabled"
:
"false"
,
"virtualWebappRelative"
:
"false"
,
"allowExec"
:
"false"
,
"expires"
:
"0"
,
"urlPatterns"
:
"*.shtml"
,
"webAppVersion"
:
""
,
"useRelativeRedirects"
:
"true"
,
"forceUseRelativeRedirects"
:
"false"
,
"allowCasualMultipartParsing"
:
"false"
,
"allowOverrideContentType"
:
"true"
,
"enableStatelessPoolMonitor"
:
"false"
,
"type"
:
"war"
,
"state"
:
"STARTED"
,
"jarScannerImpl"
:
""
,
"useDirectionalScanning"
:
"false"
,
"servletAnnotationDeclarationFile"
:
""
,
"applicationPropertiesFile"
:
""
,
"raPros"
:
""
,
"pkgCompatible"
:
"false"
,
"addResponseHeader"
:
""
}
]
,
"attachments"
:
{
"totalSize"
:
"2"
,
"pageNum"
:
"1"
,
"pageSize"
:
"10"
}
,
"success"
:
"true"
,
"msg"
:
"应用列表成功"
,
"redirectURL"
:
""
,
"dataTime"
:
""
}
可通过该指令，确认应用上的一些配置。
如果知道应用名称，还可以这样查看
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
app
\
--action
=
show
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
\
name
=
example
实例停止应用
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
app
\
--action
=
stop
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
\
name
=
examples
实例启动应用
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
app
\
--action
=
start
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
\
name
=
examples
实例备份应用
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
appbackup
\
--action
=
add
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
\
app
=
examples
\
backupInfo
=
"日常备份-
$(
date
+%Y%m%d
)
"
执行成功后，可到对应目录（domains/domain1/data/app/backup里查看）
实例自定义备份数
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
server
\
--action
=
update
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
\
appBackupCount
=
5
默认实例查看应用备份
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
appbackup
\
--action
=
list
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
默认实例删除应用备份
前提：
1.需要确认删除的应用备份的名称。
可通过以下指令确认：
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
appbackup
\
--action
=
list
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
确认后执行以下指令：
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
appbackup
\
--action
=
delete
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
\
name
=
examples.BackupFlag20230925111529
默认实例从应用备份恢复应用
需要先确认备份的名称，具体参考之前的章节
./commandstool.sh
\
>
--host
=
192.168
.10.123
\
>
--port
=
9060
\
>
--model
=
appbackup
\
>
--action
=
recover
\
>
--username
=
thanos
\
>
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
>
--acceptAgreement
=
true
\
>
targetType
=
instance
\
>
targetName
=
domain1
\
>
name
=
examples.BackupFlag20250925113212
默认实例卸载应用
建议做好了备份再卸载。
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
app
\
--action
=
delete
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
instance
\
targetName
=
domain1
\
name
=
examples
命令行操作节点
查看节点列表
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
node
\
--action
=
list
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
--outputType
=
table
手动安装的节点进行自动注册
假设a跟b已经安装好了tongweb（可参考以下网页链接：https://blog.csdn.net/weixin_39938069/article/details/152000422?spm=1011.2415.3001.5331），安装路径一致，其中a是123，b是111,b需要a进行纳管。
那么需要先开启a的集中管理功能（可通过控制台开启）。
也可以用comm脚本开启：
./commandstool.sh
--host
=
192.168
.10.123
--port
=
9060
--model
=
server
--action
=
update
--username
=
thanos
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
--acceptAgreement
=
true
remoteSupported
=
true
autoRegister
=
true
registerAsNode
=
true
autoClusterId
=
test3
centralizedConsoleUrl
=
"https://192.168.10.123:9060/console"
开启后，同理，b也需要开启集中管理功能。
留意一下，b在开启的时候，centralizedConsoleUrl就要填写a的，也就是https://192.168.10.123:9060/console。
开启后，建议用centralizedConsoleUrl对应的tongweb下执行脚本查看节点列表：
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
node
\
--action
=
list
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
--outputType
=
table
也可以在centralizedConsoleUrl对应的控制台查看，一般只要执行命令里同意了开启自动注册，就会注册进去：
停止手动安装的节点
命令行脚本只支持通过ssh安装的节点，如果是非ssh形式安装，只能手动停止对应节点。
cd 到安装目录的bin目录，执行停止脚本stopserver.sh 或者强停脚本forcestop.sh。
启动手动安装的节点
命令行脚本只支持通过ssh安装的节点，如果是非ssh形式安装，只能手动停止对应节点。
cd 到安装目录的bin目录，执行启动脚本stard.sh。
删除手动安装的节点
手动停止节点后rm -rf删除该节点的安装目录即可。
命令行操作集群
创建集群
前提：
1.节点没有加入到集群
2.需确认节点名称
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
cluster
\
--action
=
add
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
clustertest01
\
node
=
6bb3f88ce6e0473180dbbe0511af3c27,c3c80bbfdd2a4a6d94471f3b8f46a356
\
startwithnode
=
false
\
maxretrycount
=
0
\
autostart
=
false
\
rollingUpdate
=
false
启动集群
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
cluster
\
--action
=
start
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
clustertest01
查看集群
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
cluster
\
--action
=
show
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
clustertest01
集群部署应用
前提：
部署的应用包必须都在同一个目录下。
./commandstool.sh
--model
=
app
--action
=
add
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--username
=
thanos
\
--acceptAgreement
=
true
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
appFrom
=
fromServer
\
filename
=
/opt/examples.war
\
contextRoot
=
/webserver
\
autoDeploy
=
false
\
targetType
=
cluster
targetName
=
clustertest01
集群启动应用
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
app
\
--action
=
start
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
cluster
\
targetName
=
clustertest01
name
=
examples
集群查看应用
./commandstool.sh
--host
=
192.168
.10.123
--port
=
9060
--model
=
app
--action
=
list
--username
=
thanos
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
--acceptAgreement
=
true
targetType
=
cluster
targetName
=
clustertest01
name
=
examples
集群停止应用
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
app
\
--action
=
stop
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
cluster
\
targetName
=
clustertest01
name
=
examples
集群删除应用
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
app
\
--action
=
delete
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
targetType
=
cluster
\
targetName
=
clustertest01
name
=
examples
删除集群
./commandstool.sh
\
--host
=
192.168
.10.123
\
--port
=
9060
\
--model
=
cluster
\
--action
=
delete
\
--username
=
thanos
\
--passwordfile
=
/opt/TongWeb7.0.8.905/passwordfile.txt
\
--acceptAgreement
=
true
\
name
=
clustertest01
备注：
1.如有提示，请根据提示处理
例如下图，提示是集群正在被实例占用，并提供了实例名，这个时候可以先停止和卸载了对应的实例，再操作即可。

关键字: Tongweb708命令行脚本使用指引（by lqw）
文档来源: https://blog.csdn.net/weixin_39938069/article/details/152000422?spm=1011.2415.3001.5331），安装路径一致，其中a是123，b是111,b需要a进行纳管。
--------------------------------------------------------------------------------

问题编号: 130
问题: Tongweb7启动的时候显示要输入java参数（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/142252116

---

问题描述：
启动tongweb7的时候，提示要输入java参数，如下图所示：
原因：
tongweb安装目录bin目录下的external.vmoptions文件改动，在# 符号后加多了一个空格。
external.vmoptions记录的是启动参数，在external.vmoptions文件里，#并非是注释符号，而是作为标签栏进行读取和识别的，所以在改动external.vmoptions的时候，默认的#部分请不要动，如有不需要的启动参数，也请直接删除。
总而言之：
编辑external.vmoptions的时候，最好做个备份，除了默认的#号，不要有多余的符号，包括空格，不需要的启动参数请直接删除。

关键字: Tongweb7启动的时候显示要输入java参数（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 131
问题: Tongweb7部署后，启动遇到报错“environrment.conf linexxx： xxxx_bin_java：no such file”（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/134880963

---

在麒麟v10部署tongweb的时候，想要使用自带jdk，于是通过以下指令，查了下jdk安装目录：
which java
#输出：
#/usr/bin/java
#2. 终端输入：
ls
-
lr
/
usr/bin/java
#输出：
#/usr/bin/java ->
#3. 终端输入
ls
-
lrt
/
etc/alternatives/java
#输出：
#/etc/alternatives/java -> /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.xx.x86_64
当时按照以往的经验，直接在/etc/profile 里面加了下面几行：
export JAVA_HOME=
/
usr/lib/jvm/java-1
.
8
.
0-openjdk-1
.
8
.
0
.
xx
.
x86_64
export JRE_HOME=
$JAVA_HOME
/
jre
export CLASSPATH=
$JAVA_HOME
/
lib:
$JRE_HOME
/
lib:
$CLASSPATH
export PATH=
$JAVA_HOME
/
bin:
$JRE_HOME
/
bin:
$PATH
然后source /etc/profile，启动tongweb，结果报错了：
根据报错信息，问题出在设置的javahome的目录下找到对应的文件，于是我cd 到对应的文件夹目录，才发现“echo $JAVA_HOME”指令所示的文件夹确实没有该文件，该文件在/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.xx.x86_64/jre/bin下面：
于是我在/etc/profile里面修改了javahome的路径，然后source之后又重启Tongweb，还是同样的报错。
我一度怀疑是不是没修改成功，重启之后输入echo $JAVA_HOME，甚至还使用了指令：java_home=xxxxxx，结果还是报错。正当我灰心的时候，我想起了用来检查tongweb状态的一个指令：
sudo systemctl status tongweb
上图是正常启动tongwebservice的提示，但是我输入同样指令后，也是提示：xxxx/bin/java no such file。
我对比了以下报错信息的目录跟已经设置好的javahome目录，发现不一致，于是vi进去这个文件，看到了以下内容
原来是这里的java_home跟正确的javahome路径设置的不一致，修改后重启服务，访问ok了！
整理一下思路，在部署tongweb之前，tongweb会读取当前环境的javahome设置，然后写入到tongweb.service文件里面，所以在部署tongweb前，一定要检查好javahome的路径！

关键字: Tongweb7部署后，启动遇到报错“environrment.conf linexxx： xxxx_bin_java：no such file”（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 132
问题: Tongweb7重置密码和替换授权文件优化版_（by lqw+xh ）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/139529435

---

重置密码
如图所示，输入初始密码是会报错的，说明已经修改了密码
首先我们先备份一下tongweb的安装目录，避免因为修改过程中出现的差错而导致tongweb无法启动：
备份好了之后，我们关闭掉tongweb。
方式一：
Cd 到tongweb安装目录bin目录下，执行
./forcestopserver.sh
方式二：
输入jps，查看tongweb进程，然后kill掉（jps显示如下图，这个ThorBootstrap 就是tongweb的进程了）
方式三：
输入ps -ef |grep tongweb，查看对应进程id，然后kill掉
配置参数-Dnever.expire=on，配置在tongweb安装目录bin目录下的external.vmoptions
覆盖文件，将安装目录下domain_template/conf/security覆盖到安装目录的conf目录下（cp -r /opt/TongWeb7.0.4.9_M3_Enterprise_Linux/domain_template/conf/security  /opt/TongWeb7.0.4.9_M3_Enterprise_Linux/conf）
覆盖完检查一下，如果security目录下有这种文件，直接删除（很多重置失败的都是因为tongweb进程没关，參數沒配，或者是这两个备份文件没删，导致重置失败）：
删除后看一下twusers.properties，看看里面的thanos密码是不是这样的：
3d6391e41e9c4319
$3
$6774c6fc94b9d29478de176c4e1b9ddfdf741bba57a75ec8b97f0a7221cef769
$SM3
$$
0
$$
0
$30
$44r3azwdq5xc52e5wdgqv7yj2komtplz
然后启动一下tongweb（cd到安装目录的bin目录，执行./startservernohup.sh）,访问控制台，输入一下初始密码：thanos123.com ，成功登录
替换授权文件
当容器日志报授权还有…天到期,请及时联系商务申请新的授权文件
1、进入tongweb安装根目录
图中红色框的就是授权文件 license.dat ，删除旧的文件，复制新文件到tongweb的根目录下
执行bin目录下的version.sh脚本
替换前：
替换后：
检查end_date时间，判断是否替换成功，如果是永久授权时间则为-1。
替换授权文件不必重启容器，tongweb本身会在每日凌晨自动读取license.dat

关键字: Tongweb7重置密码和替换授权文件优化版_（by lqw+xh ）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 133
问题: Tongweb8 使用命令行对应用进行操作（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/140381768

---

文章目录
声明
思路和概念
新增应用
更新应用
启动应用
停止应用
删除应用
启停
声明
本帖只是做一些简单的命令行操作，仅供参考，详细内容建议参考TongwebV8.0 命令行工具参考，生产环境操作，最好先做好备份。
思路和概念
首先我们要知道，tw8的命令行工具在哪里（一般在tw8安装目录的bin目录下）：
其次，我们要弄清楚对象。
在tw8 里，有以下三个重要的对象的概念：实例，节点和集群
根据业务的需求不同，应用可以部署在实例里，也可以部署在节点和集群里，所以我们要弄清楚，操作的对象是哪一个，是实例，节点，还是集群，这个是在命令行工具里用到的非常重要的参数：
本次示范主要用实例和节点来操作（其中实例为默认实例domain1，节点为自建节点testnode01）
以查看domain1下的应用列表为例：
./commandstool.sh --model=app --action=add --username=thanos
–password=Yeyehuo163.com --acceptAgreement=true --port=9060 --host=localhost appFrom=fromUpload
fromUpload=/opt/TongWeb8.0.7.3/examples/webServiceExample.war
首先，我們要整理清楚，是针对谁，例如节点，实例，集群；做什么操作，例如增删查；以及需要什么参数，例如用户名，密码，应用名，应用路径，应用上传形式。
以上面的例子来说明：
–model=app 意思是应用模块，–acion=add 就是新增操作 --username 意思是用户名，–password 意思是密码，–port 是端口（这个一般有默认设置的，就用默认的好了），—host 是使用的虚拟主机名（一般默认localhost），appFrom=fromUpload 意思是上传的形式上传应用包 ，fromUpload就是指应用包路径。
其中，–action就是操作，下图是支持的操作列表：
好了，接下来我们根据这种逻辑去试一下
新增应用
参考示范：
./commandstool.sh
--model
=
app
--username
=
thanos
--password
=
Yeyehuo163.com
--acceptAgreement
=
true
--action
=
add
targetType
=
instance
targetName
=
domain1
appFrom
=
fromUpload
fromUpload
=
/opt/TongWeb8.0.7.3/vesionexample/examples/examples.war
这里用的是thanos用户，密码Yeyehuo163.com，新增操作，针对对象为实例，实例名字为domain1，fromUpload 进行上传，上传路径/opt/TongWeb8.0.7.3/vesionexample/examples/examples.war。
实际操作请确认一下targetType和targetName（targetType：cluster（集群），node（节点），instance（实例） ）。
更新应用
./commandstool.sh
--model
=
app
--username
=
thanos
--password
=
Yeyehuo163.com
--acceptAgreement
=
true
--action
=
update
targetType
=
instance
targetName
=
domain1
name
=
examples
这里用的是thanos用户，密码Yeyehuo163.com，更新操作，针对对象为实例，实例名字为domain1，应用名examples。
实际操作请确认一下targetType和targetName（targetType：cluster（集群），node（节点），instance（实例） ）。
启动应用
./commandstool.sh
--model
=
app
--username
=
thanos
--password
=
Yeyehuo163.com
--acceptAgreement
=
true
--action
=
start
targetType
=
instance
targetName
=
domain1
name
=
examples
这里用的是thanos用户，密码Yeyehuo163.com，启动操作，针对对象为实例，实例名字为domain1，应用名examples。
实际操作请确认一下targetType和targetName（targetType：cluster（集群），node（节点），instance（实例） ）。
停止应用
./commandstool.sh
--model
=
app
--username
=
thanos
--password
=
Yeyehuo163.com
--acceptAgreement
=
true
--action
=
stop
targetType
=
instance
targetName
=
domain1
name
=
examples
这里用的是thanos用户，密码Yeyehuo163.com，停止操作，针对对象为实例，实例名字为domain1，应用名examples。
删除应用
./commandstool.sh
--model
=
app
--username
=
thanos
--password
=
Yeyehuo163.com
--acceptAgreement
=
true
--action
=
delete
targetType
=
instance
targetName
=
domain1
name
=
examples
这里用的是thanos用户，密码Yeyehuo163.com，删除操作，针对对象为实例，实例名字为domain1，应用名examples。
实际操作请确认一下targetType和targetName（targetType：cluster（集群），node（节点），instance（实例） ）。
启停
以集群为例：
# 进入到tw8的bin目录
cd
/opt/TongWeb8.0.7.3/bin
# 启动集群
./commandstool.sh
--model
=
cluster
--action
=
start
--password
=
Yeyehuo163.com
--acceptAgreement
=
true
--username
=
thanos
name
=
cluster
#停止集群
./commandstool.sh
--model
=
cluster
--action
=
stop
--password
=
Yeyehuo163.com
--acceptAgreement
=
true
--username
=
thanos
name
=
cluster
实际操作请确认一下model和tnameame（model：cluster（集群），node（节点），instance（实例） ）。

关键字: Tongweb8 使用命令行对应用进行操作（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 134
问题: Tongweb8074+7049m4 安装TongFlowControl(by lqw)

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/141596326

---

文章目录
介绍
安裝包和説明
Tongweb8074 安装TongFlowControl
Tongweb7049m4 安装TongFlowControl
介绍
TongFlowControl是面向分布式服务架构的流量监控工具，是TongWeb基于QPS/并发数和调用关系的流量
控制功能，可在TongFlowControl控制台进行实时监控和流量策略配置。
安裝包和説明
备注：flowcontrol-console.jar的启动需要用到tongweb嵌入式的授权，相关授权请跟商务联系获取。
Tongweb8074 安装TongFlowControl
前提条件：
1.Tongweb8074已安装并能够通过页面访问控制台。
2.安装请安装步骤来，别跳步，很容易出问题。
3.生产环境建议备份好tw8的安装目录，再做操作。
首先在本地将flowcontrol-console.jar里的licese.dat 替换为有效授权。
在tw8安装目录的domains/domain1/lib下，新建/flowcontrol/client 和 /flowcontrol/service 目录并在其目录中添加所需要的jar。
将如下jar包放在“/flowcontrol/service”目录:
▪ flowcontrol-console.jar
将如下jar包放在“/flowcontrol/client”目录:
▪ flowcontrol-core.jar
▪ flowcontrol-datasource-extension.jar
▪ flowcontrol-json.jar
▪ flowcontrol-parameter-flow-control.jar
▪ flowcontrol-transport-common.jar
▪ flowcontrol-transport-simple-http.jar
▪ flowcontrol-web-servlet.jar
放入后记得检查权限。
将TongFlowControl启动脚本放入Tongweb8074安装目录的bin目录下，放入后检查一下权限：
在Tongweb8074控制台配置启动参数登录控制台 > 基础配置 > 启动参数。
配置的參數如下：
-DenableFlowcontrol
=
true
-Dcsp.flowcontrol.api.port
=
8060
-Dcsp.flowcontrol.dashboard.server
=
127.0
.0.1:8060
其中127.0.0.1可替换为服务器ip，8060端口需检查是否被其他服务占用。
配置后重启Tongweb8074然後在Tongweb8074的控制台部署 flowcontrol.war。
输入自己的flowcontrol.war的路径进行部署。
部署成功后可以点击检查是否能正常访问：
之后cd到tw8的bin目录，执行脚本：
./startflowcontrol.sh
执行后cd到Tongweb8074安装目录的/domains/domain1/logs下看看是否有这个文件：
有的説明已經有日志输出了，可以直接tail -100f nohup_flowcontrol.out 看看日志输出内容
如果有类似这种提示，说明授权过期了，需要更换授权（授权用的是嵌入式版本tongweb授权，需联系商务获取）：
有类似这种则说明启动成功
启动成功后，使用服务器ip:8060访问flowcontrol的控制台页面：
◦ 默认用户名：flowcontrol
◦ 初始密码：flowcontrol
刚进去的时候只有这些内容
登录后回到tw8的控制台，点击这里访问一下
访问后点点这两个
之后回到flowcontrol的控制台，会发现多了这些：
同理，在Tongweb8074控制台部署完其他应用后，记得点击一下相关应用的访问连接，以便flowcontrol识别到。
flowcontrol的控制台的使用，请参考002_TongWeb V8.0 用户指南_8070A01.pdf，5.2.20. TongFlowControl这一章节。
Tongweb7049m4 安装TongFlowControl
前提条件：
1.Tongweb7049m4已安装并能够通过页面访问控制台。
2.安装请安装步骤来，别跳步，很容易出问题。
3.生产环境建议备份好tw8的安装目录，再做操作。
首先在本地将flowcontrol-console.jar里的licese.dat 替换为有效授权。
由于Tongweb7049m4的目录结构跟Tongweb8074的有点不一样，所以我们需要在Tongweb7049m4的安装目录下，创建以下目录（安装目录为/opt/TongWeb7.0.4.9_M4_Enterprise_Linux/domains/作为例子）：
1./opt/TongWeb7.0.4.9_M4_Enterprise_Linux/domains/domain1/logs
2./opt/TongWeb7.0.4.9_M4_Enterprise_Linux/domains/domain1/lib/flowcontrol/client
3./opt/TongWeb7.0.4.9_M4_Enterprise_Linux/domains/domain1/lib/flowcontrol/service
将如下jar包放在“/opt/TongWeb7.0.4.9_M4_Enterprise_Linux/domains/domain1/lib/flowcontrol/service”目录:
▪ flowcontrol-console.jar
将如下jar包放在“/opt/TongWeb7.0.4.9_M4_Enterprise_Linux/domains/domain1/lib/flowcontrol/client目录:
▪ flowcontrol-core.jar
▪ flowcontrol-datasource-extension.jar
▪ flowcontrol-json.jar
▪ flowcontrol-parameter-flow-control.jar
▪ flowcontrol-transport-common.jar
▪ flowcontrol-transport-simple-http.jar
▪ flowcontrol-web-servlet.jar
放入后记得检查权限。
将TongFlowControl启动脚本放入Tongweb7049m4安装目录的bin目录下，放入后检查一下权限：
登录Tongweb7049m4的控制台，添加一下启动参数：
以下是添加的启动参数
-DenableFlowcontrol
=
true
-Dcsp.flowcontrol.api.port
=
8060
-Dcsp.flowcontrol.dashboard.server
=
127.0
.0.1:8060
其中127.0.0.1可替换为服务器ip，8060端口需检查是否被其他服务占用。
配置后重启Tongweb7049m4然後在Tongweb7049m4的控制台部署 flowcontrol.war。
部署完毕后，可以点一下http访问看看是否成功：
cd到Tongweb7049m4的bin目录，执行以下指令启动flowcontrol：
./startflowcontrol.sh
启动后看看/opt/TongWeb7.0.4.9_M4_Enterprise_Linux/domains/domain1/logs/nohup_flowcontrol.out 输出的日志
tail
-100f
nohup_flowcontrol.out
如果有类似这种提示，说明授权过期了，需要更换授权（授权用的是嵌入式版本tongweb授权，需联系商务获取）：
有类似这种则说明启动成功
启动成功后，使用服务器ip:8060访问flowcontrol的控制台页面：
◦ 默认用户名：flowcontrol
◦ 初始密码：flowcontrol
刚进去的时候只有这些内容：
点一下这两个让flowcontrol识别到
之后回到flowcontrol的控制台，会发现多了这些：
同理，在Tongweb7049m4控制台部署完其他应用后，记得点击一下相关应用的访问连接，以便flowcontrol识别到。
flowcontrol的控制台的使用，请参考002_TongWeb V8.0 用户指南_8070A01.pdf，5.2.20. TongFlowControl这一章节。

关键字: Tongweb8074+7049m4 安装TongFlowControl(by lqw)
文档来源: 
--------------------------------------------------------------------------------

问题编号: 135
问题: Tongweb8080企业版安装（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143113491

---

文章目录
安装准备
配置jdk
安装Tongweb8080企业版
关闭Tongweb
密码修改
忘记密码
安装准备
1.已配置jdk环境变量（最低jdk1.8也就是jdk8）。
2.将Tongweb8080企业版安装包和授权上传到服务器（授权联系商务获取）
3.防火墙已经关闭，或者放行8088和9060端口。
配置jdk
Tongweb8080企业版启动需要用到jdk，jdk一般有系统自带和自行解压新的jdk安装包两种形式。
系统自带的话，使用which is java 查看jdk安装目录
[
root@localhost opt
]
# which is java
/usr/bin/which: no is
in
(
/opt/bisheng-jdk-11.0.24/bin::/opt/bisheng-jdk-11.0.24/bin::/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
)
/opt/bisheng-jdk-11.0.24/bin/java
记下这个路径，待会配置要用。
輸入 java -verison 看看是否有jdk信息，沒有的話説明沒有配置jdk环境变量。
如果没有的话，推荐可以根据自己应用所需jdk版本来进行下载和解压安装（最低要求jdk1.8，也就是jdk8）。
下载推荐使用bishengjdk，链接如下：
bishengjdk下载链接
例如本文示范的時候,使用的是bisheng-jdk-11.0.24-linux-x64.tar.gz（本地测试的应用需要用到jdk11），下载好后放上去服务器，直接解压。
备注：
1.bishengjdk有分arrch和x86的安装包，可以输入lscpu查看自己的cpu架构进行选择。
无论是解压的jdk还是系统自带的jdk，都要去检查/etc/profile这个文件里是否已经配置了jdk环境变量。
没有的话，可以vi /etc/profile
#这里的jdk路径换成你的jdk路径
JAVA_HOME
=
/opt/bisheng-jdk-11.0.24
JAVA_BIN
=
$JAVA_HOME
/bin
JRE_HOME
=
$JAVA_HOME
/jre
PATH
=
$JAVA_BIN
:
$JRE_BIN
:
$PATH
export
JAVA_HOME JRE_HOME
PATH
vi后esc输入：wq保存，然后source /etc/profile,输入java -version 查看是否生效：
[
root@localhost opt
]
# source /etc/profile
[
root@localhost opt
]
# java -version
openjdk version
"11.0.24"
2024
-07-16
OpenJDK Runtime Environment BiSheng
(
build
11.0
.24+11
)
OpenJDK
64
-Bit Server VM BiSheng
(
build
11.0
.24+11, mixed mode
)
[
root@localhost opt
]
#
如果遇到系统存在多个jdk版本，且默认版本的jdk不兼容的情况下，可以在安装目录的bin目录下，新建一个JAVA_HOME的txt，里面写一下jdk的路径，如下图：
安装Tongweb8080企业版
确认jdk已经配置，且网络层面已经确保能访问9060后，解压Tongweb8080的安装包：
tar
-zvxf TongWeb8.0.8.0.tar.gz
解压后会得到一个目录(記得把license.dat也就是授权文件放进去)：
放进去后先cd 到解压目录的bin目录，执行./version.sh,看看授权是否有效：
之后先到解压目录的domains/domain1/conf目录下，找到console.xml，配置信任ip（也就是允许访问Tongweb控制台的ip）：
打个比方，部署完Tongweb8080企业版后，我想用我本地的window 的ip 进行访问，那就配这个window 的ip ：
如果是同一个网段的，则最后一位改成*：
如果是不限制的话，则直接改成*：
改完后，cd到解压目录的bin目录，执行以下指令：
./startd.sh
启动后可以使用jps 或者ps -ef |grep tongweb 看看是否存在对应进程：
如果需要查看日志，可cd 到解压目录的/domains/domain1/logs/server下，查看server.log.
之後本地win+r 輸入cmd ，輸入telnet 服务器ip 9060 进行测试（沒改的話，控制台訪問端口默認為9060）：
一般telent 成功的話，如下圖所示：
然後訪問https://服務器ip:9060/console
初次登陸，初始賬號：thanos，初始密碼：thanos123.com
相关使用手册可以在解压目录的version8.0.8.0.zip里，解压后找到docs目录：
关闭Tongweb
直接在解压目录的bin目录执行：
./forcestop.sh
或者ps -ef |grep tongweb 然后kill进程。
密码修改
忘记密码
关闭Tongweb服务（最好直接kill 进程），然后找到Tongweb安装目录domains/domain1/conf/console.xml,备份好console.xml
将丢失账户（如 “thanos” ）对应的 “changeInitPwd” 字段修改为 “true”，要求该账户登录时，必须修改初始密码，同时替换掉password的部分。
thanos初始密码为：
44D3
$2
$0B8AA118786066B2A9DF05A44B342AE2FC147F2164B5A9F232259E50DE5D9F1C
$SHA
-256
替换后重启Tongweb。

关键字: Tongweb8080企业版安装（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 136
问题: Tongweb8081如何打Docker镜像（by lqw)

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/144719253

---

文章目录
Tongweb7跟Tongweb8081 的区别
安装准备
如何使用Tongweb8081打Docker镜像并运行
如何测试打好的docker镜像
Tongweb7跟Tongweb8081 的区别
安装准备
1.已有docker环境，并且已经拉取了操作系统镜像和jdk镜像，如下图所示：
上图拉取的是centos7和openjdk8的镜像。
如果遇到docker镜像无法拉取的情况，可以参考这个帖子：
解决docker: Error response from daemon: Get “https://registry-1.docker.io/v2/“:连接超时问题
如果是国产的操作系统（例如麒麟），请联系对应厂商获取相关镜像。
2.已经搭建了Tongweb8081控制台，并且能正常运行。
搭建参考：
Tongweb8080企业版安装（by lqw）
3.确认生成的版本。
Tongweb8081里的版本生成，如下图所示：
里面会有区分企业版和轻量版，以及在java使用上，会区分javax和jakarta。
所以在制造镜像之前，必须确认使用哪种。
如何使用Tongweb8081打Docker镜像并运行
确认了docker里已经拉取了操作系统和jdk镜像后，来到控制台，找到版本生成这个功能：
点击创建，选择好对应的版本，并把Docker镜像这个开关打开：
然后在基础镜像里，填写上jdk的基础镜像（例如我拉取的镜像是openjdk 8，那就是openjdk:8）,这里示范的是轻量版，请根据需求选择对应的版本。
一般只需要等待一段时间，列表就会出现对应的镜像包的名称：
也可以自己用docker images指令查看：
另外对应的镜像包也可以在这里找一找
如何测试打好的docker镜像
以下是我本地测试的指令,将容器里的8088和9060映射到宿主机：
docker
run
-d
--name
my_tongweb_console
-p
8089
:8088
-p
9061
:9060 tongweb-enterprise-javax-console:8.0.8.1
其中my_tongweb_console 是我起的名字，tongweb-enterprise-javax-console是我打好的镜像名称：
由于我创建镜像的时候勾选了控制台，所以在浏览器上访问https://服务器ip：9061/console进行测试：
如果不熟悉目录结构，或者后期有绑定目录结构的需求，可以通过dockers ps -a 找到对应的CONTAINER ID，然后使用这个指令，进去容器内部查看里面的结构：
docker
exec
-it
CONTAINER ID /bin/bash
也可以自行部署应用进行测试，例如Tongweb8081安装包里的version.zip里的example.war：
由于docker容器里本身没有这个war，我们需要借助文件上传的形式进行部署，需要先放开文件上传的限制：
放开后重启容器，上传这个war包进行部署：
部署后用服务器ip：映射端口/访问前缀进行访问：
备注：
1.打镜像的时候，Tongweb8081的授权会同步被打入到镜像里，所以请确保授权的使用时间还没过期，避免后期更换麻烦。

关键字: Tongweb8081如何打Docker镜像（by lqw)
文档来源: 
--------------------------------------------------------------------------------

问题编号: 137
问题: Tongweb8082如何打docker镜像（by lh+lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/145035070

---

说明
8082新增了以下机制：
目前直接使用8081版本的方式在8082控制台生成镜像并运行，会有如下报错(也就是说8081版本的方法暂时不适用于8082，得等后续通知)：
安装准备
1.本地已有对应的Tongweb8082的安装包，并且已经根据自身需求在控制台上生成对应的Tongweb8082的版本并且运行没有问题。
Tongweb8082的控制台版本生成，可根据自身需求生成例如轻量版，企业版以及javax和jakarta命令空间的版本，需要先确认对应的版本，在本地安装运行没问题后再打成镜像。
2.docker已拉取对应的操作系统和jdk镜像：
如果遇到docker镜像无法拉取的情况，可以参考这个帖子：
解决docker: Error response from daemon: Get “https://registry-1.docker.io/v2/“:连接超时问题
如果是国产的操作系统（例如麒麟），请联系对应厂商获取相关镜像。
安装
以本地安装tongweb8目录为/opt/TongWeb为例：
编写Dockerfile，并将Dockerfile放在opt：
# 操作系统镜像
FROM centos:7
# jdk镜像
FROM openjdk:8
COPY ./TongWeb /opt/TongWeb
WORKDIR /opt/TongWeb
EXPOSE
9060
8088
VOLUME
[
"/opt/TongWeb/domains/domain1"
]
CMD
[
"java"
,
"-server"
,
"-Xms2048M"
,
"-Xmx2048M"
,
"-Dtongweb.home=/opt/TongWeb"
,
"-Dtongweb.base=/opt/TongWeb/domains/domain1"
,
"-Djava.io.tmpdir=/opt/TongWeb/domains/domain1/temp"
,
"-Djava.util.logging.manager=com.tongweb.logger.JulLogManager"
,
"-javaagent:/opt/TongWeb/version8.0.8.2/boot/tongweb-bootstrap.jar"
,
"-classpath"
,
"/opt/TongWeb/version8.0.8.2/boot/tongweb-bootstrap.jar"
,
"com.tongweb.main.TongWebMain"
,
"start"
]
Dockerfile的权限如下所示：
cd 到opt，执行以下指令：
docker
build
-t
my-tongweb-app
.
并用docker images查看：
然后可以执行以下指令启动容器：
docker
run
-d
--name
my_tongweb
-p
8089
:8088
-p
9061
:9060
-v
/opt/TongWeb/domains/domain1:/opt/TongWeb/domains/domain1 my-tongweb-app
之后可以用docker ps -a 查看是否运行：
用docker ps -a查看到的CONTAINER ID查看日志：
部分版本的镜像还可以访问控制台：
如果需要访问容器内部，可以执行：
docker
exec
-it
CONTAINER ID /bin/bash

关键字: Tongweb8082如何打docker镜像（by lh+lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 138
问题: Tongweb8命令行使用收集（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143963162

---

文章目录
声明
对应版本
修改thanos用户密码
部署应用到默认实例
节点相关操作
新增节点(一般一个服务器ip只能装一个节点)
启动节点（需确认节点没有运行）
停止节点
删除节点
节点新增应用
节点查看应用
节点启动应用
节点停止应用
节点卸载应用（谨慎操作，卸载后应用就没有了,建议备份后操作）
实例相关操作
新增实例（需确认在哪个节点上新建）
启动实例（需确认实例没有在运行）
停止实例
删除实例
实例新增应用
实例启动应用
实例停止应用
实例卸载应用（谨慎操作，卸载后应用就没有了，建议备份后操作）
集群相关操作
创建集群（前提：创建节点且节点正常运行，节点间能正常通信，节点没有加入其他集群）
启动集群
停止集群
查看集群信息（包括集群里的节点和实例）
集群中部署应用（需保证应用都在同一个目录且集群是正常运行状态）
集群查看应用
集群启动应用
集群停止应用
集群卸载应用（谨慎操作，卸载后应用就没有了,建议备份后操作）
声明
1.命令行工具在哪里：
一般在tw8安装目录的bin目录下：commandstool.sh
备注：
1.使用该工具的时候，例如使用thanos用户的时候，会把正在登录了thanos的控制台给挤掉，导致控制台需要重新登录。（同理，jmx监控也是如此，所以不建议一起使用）
2.在tw8 里，有以下三个重要的概念：实例，节点和集群
其中一个服务器ip只能有一个节点，集群>节点>实例。
根据业务的需求不同，应用可以部署在实例里，也可以部署在节点和集群里，所以我们要弄清楚，操作的对象是哪一个，是实例，节点，还是集群，这个是在命令行工具里用到的非常重要的参数：
3.关于脚本录制
命令行页面的很多指令都可以通过脚本录制获取：
如有遇到一些本文没有记录的操作，需要使用命令行操作的，建议可以先开启脚本录制，录制相关操作后点击完成，之后下载到本地。
4. Tongweb8中的应用启动和停止，还有卸载，不建议反复执行，容易导致资源没有回收，具体参考这个：
TongWeb上反复重部署应用后异常：application instance has been stopped already 或OutOfMemoryError：Metaspace
5. 本次操作仅供参考，最终以命令行工具使用手册为准。
对应版本
Tongweb8081。
修改thanos用户密码
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
password --username
=
thanos --password
=
Yeyehuo163.com --acceptAgreement
=
true  --action
=
update
originalPassword
=
Yeyehuo163.com
newPassword
=
Yeyehuo163.com2
confirmPassword
=
Yeyehuo163.com2
# tw8所在服务器ip
--host
=
192.168
.10.113：指定管理服务所在的服务器 IP 地址。
# 控制台端口
--port
=
9061
：用于连接管理服务的端口。
--model
=
password：操作类型指定为密码操作。
--username
=
thanos：需要更新密码的用户名。
# 当前thanos使用的密码
--password
=
Yeyehuo163.com：当前用于身份验证的用户密码。
--acceptAgreement
=
true：表示您已接受相关协议。
--action
=
update：您正在执行的是更新操作。
originalPassword
=
Yeyehuo163.com：当前有效的原始密码。
newPassword
=
Yeyehuo163.com2：新密码。
confirmPassword
=
Yeyehuo163.com2：确认新密码。
部署应用到默认实例
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
app --action
=
add --username
=
thanos --password
=
Yeyehuo163.com2 --acceptAgreement
=
true
appFrom
=
fromServer
filename
=
/opt/Tongweb/TongWeb8.0.8.0/version8.0.8.0/examples/jmsExample.war
./commandstool.sh

这是一个脚本文件，通常用于执行一系列预定义的命令，以便与服务器进行交互。
--host
=
192.168
.10.113

指定目标服务器的 IP 地址，在这里是
192.168
.10.113。
--port
=
9061
指定服务器监听的端口号为
9061
。通常用于指定与服务交互的端口。
--model
=
app

模式设置为 app，表示这是一个应用相关的操作。
--action
=
add

指定动作为 add，表明这是一个添加或部署新的应用程序到服务器的操作。
--username
=
thanos

用于认证的用户名是 thanos。
--password
=
Yeyehuo163.com2

指定用户 thanos 用于认证的密码。
--acceptAgreement
=
true

明确同意某些相关的协议，这可能是部署或使用软件时必要的同意条款。
appFrom
=
fromServer

表示应用的filename
=
/opt/Tongweb/TongWeb8.0.8.0/version8.0.8.0/examples/jmsExample.war

指定要添加或部署的应用程序文件的完整路径。
节点相关操作
新增节点(一般一个服务器ip只能装一个节点)
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9061
--model
=
node --action
=
add --password
=
Yeyehuo163.com2 --acceptAgreement
=
true --username
=
thanos
sshPort
=
22
sshUserName
=
root
nodeCreationType
=
SSH
ip
=
192.168
.10.115
sshPassword
=
yeyehuo163
autostart
=
false
keyPairType
=
ssh-rsa
javaHome
=
/opt/bisheng-jdk-11.0.24
port
=
9061
name
=
node115
passwordType
=
PASSWORD
maxretrycount
=
0
installationPath
=
/opt/tongweb8node115
# tw8所在服务器ip
--host
=
192.168
.10.113：远程管理服务的服务器 IP。
# 控制台端口
--port
=
9061
：连接到管理服务的端口。
--model
=
node：操作的对象类型是一个节点。
--action
=
add：指定对节点执行添加操作。
--password
=
Yeyehuo163.com2：用于身份验证的密码。
--acceptAgreement
=
true：您已同意相关协议。
--username
=
thanos：执行操作的用户名。
sshPort
=
22
：SSH 连接使用的端口。
sshUserName
=
root：用于 SSH 连接的用户名。
nodeCreationType
=
SSH：节点创建类型，通过 SSH。
ip
=
192.168
.10.115：新节点的 IP 地址。
sshPassword
=
yeyehuo163：用于 SSH 的密码。
autostart
=
false：配置节点在启动时是否自动开始。
keyPairType
=
ssh-rsa：使用的密钥对类型。
javaHome
=
/opt/bisheng-jdk-11.0.24：Java 环境的安装路径。
port
=
9061
：新节点将使用的端口。
name
=
node115：节点名称。
passwordType
=
PASSWORD：密码类型指定为普通密码。
maxretrycount
=
0
：最大重试次数配置。
installationPath
=
/opt/tongweb8node115：节点的安装路径。
启动节点（需确认节点没有运行）
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
node --action
=
start --password
=
Yeyehuo163.com2 --acceptAgreement
=
true --username
=
thanos
name
=
node115
--host
=
192.168
.10.113：目标管理服务的服务器 IP 地址。
--port
=
9061
：连接到管理服务的端口。
--model
=
node：操作的对象类型是一个节点。
--action
=
start：指定对节点执行启动操作。
--password
=
Yeyehuo163.com2：用于身份验证的密码。
--acceptAgreement
=
true：表明您已同意相关协议。
--username
=
thanos：执行操作的用户名。
name
=
node115：要启动的节点名称。
备注：如果节点已经是运行中，会有这种提示
停止节点
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
node --action
=
stop  --password
=
Yeyehuo163.com2 --acceptAgreement
=
true --username
=
thanos
name
=
node115
# tw8所在服务器
--host
=
192.168
.10.113：目标管理服务的 IP 地址。
# 控制台端口
--port
=
9061
：连接到管理服务的端口。
--model
=
node：操作的对象类型是一个节点。
--action
=
stop：指定对节点执行停止操作。
--password
=
Yeyehuo163.com2：用于身份验证的密码。
--acceptAgreement
=
true：表示您已同意相关协议。
--username
=
thanos本停止节点 node115。以下是对命：执行操作的用户名。
name
=
node115：指定停止的节点名称是 node115。
删除节点
./commandstool.sh --host
=
192.168
.10.113 --port
=
9060
--model
=
node --action
=
delete --password
=
thanos123.com --acceptAgreement
=
true --username
=
thanos
name
=
node115
# tongweb8服务器ip
--host
=
192.168
.10.113：指定目标主机的IP地址为192.168.10.113。
#tw8控制台端口
--port
=
9060
：指定连接到目标主机的端口为9060。
--model
=
node：指定操作的模型或类型为node（节点）。
--action
=
delete：指定要执行的动作是删除（delete）。
# 改成登录控制台thanos的密码
--password
=
Yeyehuo163.com：指定连接的密码为Yeyehuo163.com。
--acceptAgreement
=
true：表示接受相关的协议或条款。
--username
=
thanos：指定用于连接的用户名为thanos。
name
=
node115：指定要操作的节点名称为node115。
节点新增应用
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
app --action
=
add --username
=
thanos --password
=
Yeyehuo163.com2 --acceptAgreement
=
true
targetType
=
node
targetName
=
node113
appFrom
=
fromServer
filename
=
/opt/Tongweb/TongWeb8.0.8.0/version8.0.8.0/examples/examples.war
cacheMaxSize
=
1024000
--host
=
192.168
.10.113

指定目标服务器的 IP 地址，即运行应用服务器的机器。

--port
=
9061
指定服务器监听的端口，用于与服务通信。

--model
=
app

表示操作的模式为 app，即与应用程序相关。

--action
=
add

指定执行的动作为 add，这意味着当前的任务是部署新的应用程序。

--username
=
thanos 和 --password
=
Yeyehuo163.com2

提供的用户名和密码用于认证，以确保命令拥有必要的权限来操作服务器。

--acceptAgreement
=
true

表示同意相关协议或条款，这是许多工具中为操作合法性设计的参数。
targetType
=
node 和
targetName
=
node113
targetType
=
node：部署目标类型为单个节点。
targetName
=
node113：指定目标节点的名称为 node113，即部署的服务器具体节点。
appFrom
=
fromServer

指定应用的filename
=
/opt/Tongweb/TongWeb8.0.8.0/version8.0.8.0/examples/examples.war
cacheMaxSize
=
1024000
设置应用程序缓存的最大大小，为
1024000
（通常以字节为单位）。
这是一个可选参数，用于优化应用程序的缓存行为
节点查看应用
./commandstool.sh -host
=
192.168
.10.113 --port
=
9061
--model
=
app  --username
=
thanos --password
=
Yeyehuo163.com2  --acceptAgreement
=
true  --action
=
list
targetType
=
node
targetName
=
node113
[
root@localhost bin
]
# ./commandstool.sh -host=192.168.10.113 --port=9061 --model=app  --username=thanos --password=Yeyehuo163.com2  --acceptAgreement=true  --action=list targetType=node targetName=node1132024-11-22 16:24:14 >>> Execute the command: commandstool
{
"models"
:
[
{
"name"
:
"examples"
,
"autoDeploy"
:
"false"
,
"appFrom"
:
"fromServer"
,
"filename"
:
"\/opt\/Tongweb\/TongWeb8.0.8.0\/version8.0.8.0\/examples\/examples"
,
"appTemplate"
:
""
,
"springBootCompatible"
:
"true"
,
"contextRoot"
:
"examples"
,
"host"
:
"localhost"
,
"startupPriority"
:
"99"
,
"refRealm"
:
""
,
"dependentApp"
:
""
,
"delegateFirst"
:
"false"
,
"useEjbStandaloneLoader"
:
"false"
,
"forcedLoad"
:
"javax.ws"
,
"forcedSkip"
:
""
,
"webSocketEnabled"
:
"false"
,
"webModuleOnly"
:
"false"
,
"appImplModules"
:
""
,
"disableCDI"
:
"false"
,
"refLib"
:
""
,
"priorityJars"
:
""
,
"reloadable"
:
"false"
,
"addWebinfClassesResources"
:
"false"
,
"loadManifestClassPath"
:
"false"
,
"manifestClassPathBase"
:
""
,
"absoluteOrdering"
:
"false"
,
"customClassLoader"
:
""
,
"customClass"
:
""
,
"docBases"
:
""
,
"archiveIndexStrategy"
:
"BLOOM"
,
"sessionCookieName"
:
""
,
"useLegacyCookieProcessor"
:
"false"
,
"allowEqualsInValue"
:
"false"
,
"allowHttpSepsInV0"
:
"false"
,
"useHttpOnly"
:
"true"
,
"sameSiteCookies"
:
"Unset"
,
"maxActiveSessions"
:
"100000"
,
"sessionTimeout"
:
"30"
,
"refSessionHa"
:
""
,
"jspDevelopment"
:
"false"
,
"mappedFile"
:
"false"
,
"quoteAttributeEL"
:
"true"
,
"strictQuoteEscaping"
:
"true"
,
"strictWhiteSpace"
:
"true"
,
"enablePooling"
:
"true"
,
"jspPrecompile"
:
"false"
,
"jspPrecompileThreadCount"
:
"4"
,
"requestCharacterEncoding"
:
"UTF-8"
,
"responseCharacterEncoding"
:
"UTF-8"
,
"javaEncoding"
:
"UTF-8"
,
"fileEncoding"
:
"UTF-8"
,
"slowThreadEnabled"
:
"false"
,
"threshold"
:
"60"
,
"interruptThreadThreshold"
:
"0"
,
"cachingAllowed"
:
"true"
,
"cacheMaxSize"
:
"1024000"
,
"cacheObjectMaxSize"
:
"1024"
,
"cacheTtl"
:
"60"
,
"forceCache"
:
"false"
,
"preloadResource"
:
"false"
,
"preCompress"
:
"false"
,
"forcedContainerHandling"
:
"false"
,
"staticUrlPatterns"
:
""
,
"brEnabled"
:
"false"
,
"enableCORSAccess"
:
"false"
,
"corsAllowedOrigins"
:
""
,
"corsAllowedMethods"
:
"GET,POST,HEAD,OPTIONS"
,
"corsAllowedHeaders"
:
"Origin,Accept,X-Requested-With,Content-Type,Access-Control-Request-Method,Access-Control-Request-Headers"
,
"corsExposedHeaders"
:
""
,
"corsSupportCredentials"
:
"false"
,
"corsPreflightMaxAge"
:
"1800"
,
"requestParametersLostValidation"
:
"false"
,
"XSSFilterEnabled"
:
"false"
,
"csrfPrevention"
:
"false"
,
"csrfCacheSize"
:
"20"
,
"tokenValidTimes"
:
"1"
,
"csrfEntryPoints"
:
"\/login"
,
"httpHeaderToken"
:
"false"
,
"secretLevel"
:
""
,
"threadPoolPolicy"
:
"1"
,
"threadPool"
:
""
,
"threadPoolTimeout"
:
"30000"
,
"taskRule"
:
""
,
"exclusionRule"
:
""
,
"otherThreadPool"
:
""
,
"otherThreadPoolTimeout"
:
"30000"
,
"semaphoreEnabled"
:
"false"
,
"concurrency"
:
"10"
,
"block"
:
"true"
,
"interruptible"
:
"true"
,
"restrictedPorts"
:
""
,
"crossContext"
:
"false"
,
"unloadDelay"
:
"20"
,
"allowLinking"
:
"false"
,
"clearReferences"
:
"false"
,
"shtmlEnabled"
:
"false"
,
"virtualWebappRelative"
:
"false"
,
"allowExec"
:
"false"
,
"expires"
:
"0"
,
"urlPatterns"
:
"*.shtml"
,
"webAppVersion"
:
""
,
"useRelativeRedirects"
:
"true"
,
"allowCasualMultipartParsing"
:
"false"
,
"allowOverrideContentType"
:
"false"
,
"enableStatelessPoolMonitor"
:
"false"
,
"type"
:
"war"
,
"state"
:
"STARTED"
,
"jarScannerImpl"
:
""
,
"raPros"
:
""
,
"pkgCompatible"
:
"false"
}
]
,
"attachments"
:
{
"totalSize"
:
"1"
,
"pageNum"
:
"1"
,
"pageSize"
:
"10"
}
,
"success"
:
"true"
,
"msg"
:
"应用列表成功"
,
"redirectURL"
:
""
,
"dataTime"
:
""
}
--host
=
192.168
.10.113

指定目标服务器的 IP 地址，命令将作用于此服务器上。

--port
=
9061
服务器监听的端口号, 用于工具与服务器之间的通信。

--model
=
app

操作对象为应用程序，表明该命令属于应用程序管理任务。

--username
=
thanos 和 --password
=
Yeyehuo163.com2

登录信息，用以验证用户权限的合法性。

--acceptAgreement
=
true

确认接受协议条款，这是运行命令前的必要条件。

--action
=
list

指定操作为列出当前节点上的应用程序，而非删除或其他管理操作。
targetType
=
node 和
targetName
=
node113
targetType
=
node：目标为某个特定节点，兴趣集中在节点级部署的应用程序。
targetName
=
node113：该节点的名称为 node113，这是正在查询哪个节点的具体说明。
节点启动应用
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
start --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
targetName
=
node10
name
=
examples
targetType
=
node
--host
=
192.168
.10.113:

目标服务器的 IP 地址，用于连接操作。
--port
=
9060
:

目标服务器的端口，指定应用管理接口。
--model
=
app:

指定操作的模块为 app，表示对应用进行管理操作。
--action
=
start:

操作类型为 start，表示要启动应用或服务。
--password
=
Yeyehuo163.com:

用于身份验证的密码。应注意这类信息的安全管理，避免硬编码。
--acceptAgreement
=
true:

指定已同意相关使用协议，通常用于许可条款。
--username
=
thanos:

执行操作的用户名，确保具有相应权限。
targetName
=
node10:

要操作的具体节点名称。此处为 node10。
name
=
examples:

需要启动的应用或服务名称。此处为 examples。
targetType
=
node:

指定目标类型为 node，即该操作针对具体的节点。
节点停止应用
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
stop --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
targetName
=
node10
name
=
examples
targetType
=
node
--host
=
192.168
.10.113:

目标服务器的 IP 地址，用于连接操作。
--port
=
9060
:

目标服务器的端口，指定应用管理接口。
--model
=
app:

指定操作的模块为 app，表示对应用进行管理操作。
--action
=
stop:

操作类型为 stop，表示要停止的应用或服务。
--password
=
Yeyehuo163.com:

用于身份验证的密码。应注意这类信息的安全管理，避免硬编码。
--acceptAgreement
=
true:

指定已同意相关使用协议，通常用于许可条款。
--username
=
thanos:

执行操作的用户名，确保具有相应权限。
targetName
=
node10:

要操作的具体节点名称。此处为 node10。
name
=
examples:

需要启动的应用或服务名称。此处为 examples。
targetType
=
node:

指定目标类型为 node，即该操作针对具体的节点。
节点卸载应用（谨慎操作，卸载后应用就没有了,建议备份后操作）
./commandstool.sh -host
=
192.168
.10.113 --port
=
9061
--model
=
app --username
=
thanos --password
=
Yeyehuo163.com2 --acceptAgreement
=
true  --action
=
delete
targetType
=
node
targetName
=
node113
name
=
examples
--host
=
192.168
.10.113

指定目标服务器的 IP 地址，表示运行应用服务器的机器。

--port
=
9061
服务器用于接收工具请求的监听端口。

--model
=
app

操作的对象为应用程序，强调这次操作的中心是应用管理。

--username
=
thanos 和 --password
=
Yeyehuo163.com2

提供合法的认证凭据，以确保有权限在服务器上执行这些操作。

--acceptAgreement
=
true

确认接受了与操作相关的协议或条款，为合规性而设。

--action
=
delete

指定执行的操作是删除一个应用程序。
targetType
=
node 和
targetName
=
node113
targetType
=
node：表明目标是一个节点级别的操作。
targetName
=
node113：指定目标节点，即从 node113 节点上删除应用程序。
name
=
examples

指定要删除的应用程序名称为 examples
实例相关操作
新增实例（需确认在哪个节点上新建）
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
instance --action
=
add --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
node
=
default
needConsolePort
=
true
name
=
testexamples002
startwithnode
=
false
appPort
=
8091
maxretrycount
=
0
installationPath
=
/opt/testexamples002
autostart
=
false
#这里我指定的是tongweb8控制台所在的服务器ip
--host
=
192.168
.10.113：指定目标主机的 IP 地址为
192.168
.10.113。
#这里的9061是我的tongweb8控制台的端口
--port
=
9061
：指定与目标服务交互的端口为
9061
。
--model
=
instance：指明操作的对象为一个实例。
--action
=
add：执行的操作是添加一个新的实例。
#这个password是我修改的thanos账户的密码
--password
=
Yeyehuo163.com：设置实例的相关密码为 Yeyehuo163.com。
--acceptAgreement
=
true：表示接受协议条款。
--username
=
thanos：指定使用的用户名为 thanos。
#这里使用的是tw自带的节点
node
=
default：使用的节点是 default。
needConsolePort
=
true：明确表示需要一个控制台端口。
name
=
testexamples002：设置实例名称为 testexamples002。
startwithnode
=
false：实例不会随节点一起启动。
appPort
=
8091
：应用程序使用端口
8091
。
maxretrycount
=
0
：设置最大重试次数为
0
。
installationPath
=
/opt/testexamples002：指定实例的安装路径为 /opt/testexamples002。
autostart
=
false：实例不会自动启动。
启动实例（需确认实例没有在运行）
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9061
--model
=
instance --action
=
start --password
=
Yeyehuo163.com2 --acceptAgreement
=
true --username
=
thanos
name
=
testexamples001
# tw8所在服务器ip
--host
=
192.168
.10.113：目标管理服务的服务器 IP 地址。
# 控制台端口
--port
=
9061
：连接到管理服务的端口。
--model
=
instance：操作的对象类型是一个实例。
--action
=
start：指定对实例执行启动操作。
--password
=
Yeyehuo163.com2：用于身份验证的密码。
--acceptAgreement
=
true：表示您已同意相关协议。
--username
=
thanos：执行操作的用户名。
name
=
testexamples001：要启动的实例的名称。
停止实例
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9061
--model
=
instance --action
=
stop --password
=
Yeyehuo163.com2 --acceptAgreement
=
true --username
=
thanos
name
=
testexamples001
--host
=
192.168
.10.113：目标管理服务的 IP 地址。
--port
=
9061
：用于连接管理服务的端口号。
--model
=
instance：表明操作的目标类型是实例（instance）。
--action
=
stop：指定对实例执行停止操作。
--password
=
Yeyehuo163.com2：身份验证使用的密码。
--acceptAgreement
=
true：表明已同意相关协议，允许操作继续。
--username
=
thanos：执行操作的用户名。
name
=
testexamples001：需要停止的实例名称。
备注：如果已停止的时候执行，会有以下提示
删除实例
./commandstool.sh --host
=
192.168
.10.113 --port
=
9060
--model
=
instance --action
=
delete --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
name
=
testinstance001
实例新增应用
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
app --action
=
add --username
=
thanos --password
=
Yeyehuo163.com2 --acceptAgreement
=
true
targetType
=
instance
targetName
=
testexamples002
appFrom
=
fromServer
filename
=
/opt/Tongweb/TongWeb8.0.8.0/version8.0.8.0/examples/webServiceExample.war
contextRoot
=
/
--host
=
192.168
.10.113

目标服务器的 IP 地址，用于指定部署目标的机器。

--port
=
9061
服务器的监听端口，负责接收该工具的请求。

--model
=
app

操作对象为应用程序，强调此次操作是与应用有关。

--action
=
add

执行的动作是添加一个新应用，意味着会将指定的 WAR 包部署到服务器上。

--username
=
thanos 和 --password
=
Yeyehuo163.com2

提供访问服务器所需的认证信息，以确保具有进行此操作的权限。

--acceptAgreement
=
true

确认接受了与这些操作相关的协议或条款，这通常是必要的法律合规措施。
targetType
=
instance 和
targetName
=
testexamples002
targetType
=
instance：目标类型为实例级别的部署。
targetName
=
testexamples002：指定目标实例的名称为 testexamples002，表明应用部署的具体实例。
appFrom
=
fromServer

指定应用源为 fromServer，这通常表示应用程序包已经存在于目标服务器上，而不需要从本地上传。
filename
=
/opt/Tongweb/TongWeb8.0.8.0/version8.0.8.0/examples/webServiceExample.war

指定要部署的应用程序文件，此处为 webServiceExample.war
contextRoot
=
/
指定应用程序的上下文根为 /，意味着该应用将会成为默认应用程序，直接通过根路径访问
实例启动应用
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
start --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
targetName
=
testinstance10
name
=
examples
targetType
=
instance
--host
=
192.168
.10.113:

目标服务器的 IP 地址，用于连接操作。
--port
=
9060
:

目标服务器的端口，指定应用管理接口。
--model
=
app:

指定操作的模块为 app，表示对应用进行管理操作。
--action
=
start:

操作类型为 start，表示要启动应用或服务。
--password
=
Yeyehuo163.com:

用于身份验证的密码。应注意这类信息的安全管理，避免硬编码。
--acceptAgreement
=
true:

指定已同意相关使用协议，通常用于许可条款。
--username
=
thanos:

执行操作的用户名，确保具有相应权限。
targetName
=
testinstance10:

要操作的具体实例名称。此处为 testinstance10。
name
=
examples:

需要启动的应用或服务名称。此处为 examples。
targetType
=
instance:

指定目标类型为 instance，即该操作针对具体的实例。
实例停止应用
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
stop --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
targetName
=
testinstance10
name
=
examples
targetType
=
instance
--host
=
192.168
.10.113:

目标服务器的 IP 地址，用于连接操作。
--port
=
9060
:

目标服务器的端口，指定应用管理接口。
--model
=
app:

指定操作的模块为 app，表示对应用进行管理操作。
--action
=
stop:

操作类型为 stop，表示要停止应用或服务。
--password
=
Yeyehuo163.com:

用于身份验证的密码。应注意这类信息的安全管理，避免硬编码。
--acceptAgreement
=
true:

指定已同意相关使用协议，通常用于许可条款。
--username
=
thanos:

执行操作的用户名，确保具有相应权限。
targetName
=
testinstance10:

要操作的具体实例名称。此处为 testinstance10。
name
=
examples:

需要启动的应用或服务名称。此处为 examples。
targetType
=
instance:

指定目标类型为 instance，即该操作针对具体的实例。
实例卸载应用（谨慎操作，卸载后应用就没有了，建议备份后操作）
./commandstool.sh -host
=
192.168
.10.113 --port
=
9061
--model
=
app --username
=
thanos --password
=
Yeyehuo163.com2 --acceptAgreement
=
true  --action
=
delete
targetType
=
instance
targetName
=
testexamples002
name
=
examples
-host
=
192.168
.10.113

目标服务器的 IP 地址，表示运行应用服务器的机器。

--port
=
9061
工具请求所连接的服务器端口，用于接收并处理命令。

--model
=
app

操作的对象是应用程序，表明此次操作是针对某个应用进行管理。

--username
=
thanos 和 --password
=
Yeyehuo163.com2

提供认证信息，以确保用户拥有执行该操作的权限。

--acceptAgreement
=
true

表示接受与操作相关的条款或协议，这通常是为了遵守软件使用规定。

--action
=
delete

执行的操作是删除用于移除指定的应用程序。
targetType
=
instance 和
targetName
=
testexamples002
targetType
=
instance：表明目标为一个具体的应用程序实例。
targetName
=
testexamples002：指定应用程序从哪个实例中删除，这里是 testexamples002。
name
=
examples

要删除的应用程序的名称为 examples
集群相关操作
创建集群（前提：创建节点且节点正常运行，节点间能正常通信，节点没有加入其他集群）
./commandstool.sh --host
=
192.168
.10.113 --port
=
9061
--model
=
cluster --action
=
add --password
=
Yeyehuo163.com2  --acceptAgreement
=
true --username
=
thanos
node
=
node113,node114,node115
autoUpdateLbConf
=
true
name
=
clustertest01
startwithnode
=
false
maxretrycount
=
0
autostart
=
false
rollingUpdate
=
false
--host
=
192.168
.10.113 和 --port
=
9061
指定目标服务器的 IP 和端口，用于连接到管理服务器。

--model
=
cluster

表明操作是基于集群的管理任务。

--action
=
add

指定操作为添加，意味着将节点加入到指定的集群中。

--username
=
thanos 和 --password
=
Yeyehuo163.com2

提供用于身份验证的用户名和密码，确保权限符合要求。

--acceptAgreement
=
true
node
=
node113,node114,node115

列出要添加到集群的节点列表，这里包括 node113、node114 和 node115。
name
=
clustertest01

指定目标集群的名称为 clustertest01，将这些节点加入此集群。
autoUpdateLbConf
=
true

指定在操作后自动更新负载均衡配置，这有助于确保集群的流量分发功能立即反映新增节点。
startwithnode
=
false

指定新增节点是否自动启动服务：
false
表示不自动启动，可能需要后续手动操作启动。
maxretrycount
=
0
表明对失败的操作不重试，0 意味着没有最大重试次数。
autostart
=
false

新增节点加入集群后是否自动启动集群：
false
表示不会自动启动。
rollingUpdate
=
false

是否进行滚动更新：
false
表示不会逐个节点滚动更新，可能用于一次性添加多个节点。
备注：
1.不要把已经加入到其他集群的节点加入到新建的集群，一般推荐最好一个节点加入一个集群即可，否则很容易出现各种问题。
2.本次示范新建的集群并没有负载均衡功能，需要负载均衡功能的，建议使用Tonghttpserver。
启动集群
./commandstool.sh --host
=
192.168
.10.113 --port
=
9060
--model
=
cluster --action
=
start  --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
name
=
clustertest01
--host
=
192.168
.10.113：目标主机的 IP 地址为
192.168
.10.113。
--port
=
9060
：指定连接到目标主机的端口为
9060
。
--model
=
cluster：指定操作的模型或类型为 cluster（集群）。
--action
=
start：表示要执行的动作是启动（start）。
--password
=
Yeyehuo163.com：指定连接的密码为 Yeyehuo163.com。
--acceptAgreement
=
true：表示接受相关协议或条款。
--username
=
thanos：指定用于连接的用户名为 thanos。
name
=
clustertest01：指定要操作的集群名称为 clustertest01
停止集群
./commandstool.sh --host
=
192.168
.10.113 --port
=
9060
--model
=
cluster --action
=
stop  --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
name
=
clustertest01
--host
=
192.168
.10.113：目标主机的 IP 地址是
192.168
.10.113。
--port
=
9060
：连接到目标主机所用的端口为
9060
。
--model
=
cluster：表示操作对象的类型为 cluster（集群）。
--action
=
stop：指要执行的动作是停止（stop）。
--password
=
Yeyehuo163.com：用于连接的凭证密码为 Yeyehuo163.com。
--acceptAgreement
=
true：表示用户已接受必要的协议或条款。
--username
=
thanos：用于连接的用户名为 thanos。
name
=
clustertest01：指定要操作的集群名称为 clustertest01。
查看集群信息（包括集群里的节点和实例）
./commandstool.sh -host
=
192.168
.10.113 --port
=
9061
--model
=
cluster  --username
=
thanos --password
=
Yeyehuo163.com2  --acceptAgreement
=
true  --action
=
list
targetType
=
cluster
targetName
=
cluster
--host
=
192.168
.10.113

指定目标服务器的 IP 地址，这里是与哪台服务器进行通信的具体 IP。

--port
=
9061
服务器监听的端口号，工具通过该端口与服务器通讯。

--model
=
cluster

表示当前操作涉及的对象是集群。

--username
=
thanos 和 --password
=
Yeyehuo163.com2

用于用户身份验证的信息，确保具备执行此操作的权限。

--acceptAgreement
=
true

需要明确接受使用协议才能执行此命令。
--action
=
list

指定的操作为列出，即查询集群信息的操作。
targetType
=
cluster

目标类型为集群，表明要列出与集群相关的内容。
targetName
=
cluster

这是要查询的具体集群名称（或全局标识符），用于指定在哪个集群上执行操作。
集群中部署应用（需保证应用都在同一个目录且集群是正常运行状态）
需保证应用都在不同服务器的同一个目录之下，不然很容易出各种问题。
./commandstool.sh --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
add --username
=
thanos --password
=
Yeyehuo163.com --acceptAgreement
=
true
targetType
=
cluster
targetName
=
clustertest01
appFrom
=
fromServer
filename
=
/opt/examples.war
cacheMaxSize
=
1024000
contextRoot
=
/
# tw8服务器ip
--host
=
192.168
.10.113：目标主机的 IP 地址是
192.168
.10.113。
# 控制台端口
--port
=
9060
：连接目标主机使用的端口号为
9060
。
--model
=
app：操作的模型为 app，即应用。
--action
=
add：执行的动作是添加（add）。
--username
=
thanos：用于连接的用户名为 thanos。
--password
=
Yeyehuo163.com：用于连接的密码为 Yeyehuo163.com。
--acceptAgreement
=
true：表示用户已接受必要的协议或条款。
targetType
=
cluster：目标类型为集群。
targetName
=
clustertest01：目标集群的名称为 clustertest01。
appFrom
=
fromServer：表示应用filename
=
/opt/examples.war：应用的文件路径为 /opt/examples.war。
cacheMaxSize
=
1024000
：指定缓存的最大大小为
1,024
,000（单位可能是字节，需根据系统文档确认）。
contextRoot
=
/：应用的部署路径为根路径 /
集群查看应用
./commandstool.sh -host
=
192.168
.10.113 --port
=
9060
--model
=
app  --username
=
thanos --password
=
Yeyehuo163.com  --acceptAgreement
=
true  --action
=
list
targetType
=
cluster
targetName
=
clustertest01
-host
=
192.168
.10.113：指定目标服务器的 IP地址为
192.168
.10.113。
--port
=
9060
：指定连接到目标服务器的端口号为
9060
。
--model
=
app：操作的对象类型是应用程序。
--username
=
thanos：用于认证的用户名为 thanos。
--password
=
Yeyehuo163.com：用于认证的密码。
--acceptAgreement
=
true：确认接受协议或条款。
--action
=
list：指定动作为列出当前已经部署的应用程序。
targetType
=
cluster：指定目标的类型是集群。
targetName
=
clustertest01：指定目标集群的名称为 clustertest01。
输出信息解析：
应用信息：
"name"
:
"examples"
：应用名称是 examples。
"autoDeploy"
:
"false"
：自动部署选项被禁用。
"appFrom"
:
"fromServer"
：应用来自服务器。
"filename"
:
"\/opt\/examples"
：应用文件的路径。
"springBootCompatible"
:
"true"
：应用与Spring Boot兼容。
"contextRoot"
:
"\/"
：应用部署在根路径（即 /）。
部署与启动：
"host"
:
"localhost"
：运行应用的主机为 localhost。
"startupPriority"
:
"99"
：启动优先级为99。
缓存配置：
"cacheMaxSize"
:
"1024000"
：缓存的最大大小为
1,024
,000。
"cacheObjectMaxSize"
:
"1024"
：单个缓存对象的最大大小为
1,024
。
"cacheTtl"
:
"60"
：缓存存活时间为
60
秒。
CORS设置：
"enableCORSAccess"
:
"false"
：CORS访问未启用。
"corsAllowedMethods"
:
"GET,POST,HEAD,OPTIONS"
：允许的HTTP方法。
状态信息：
"type"
:
"war"
：应用的类型是 WAR 文件。
"state"
:
"STARTED"
：应用当前的状态为已启动。
输出元数据：
"success"
:
"true"
：操作成功。
"msg"
:
"应用列表成功"
：操作成功的信息提示。
"attachments"
：分页相关信息，这表示当前返回的应用列表的大小与分页情况
集群启动应用
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
start --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
targetName
=
clustertest01
name
=
examples
targetType
=
cluster
--host
=
192.168
.10.113:

指定目标服务器的 IP 地址，工具将连接到此主机。
IP 地址
192.168
.10.113 是本地网络中的服务器。
--port
=
9060
:

指定目标服务器的端口号，工具将在此端口上与服务器通信。
--model
=
app:

模块名称，表示此次操作针对的模块为 app。
app 可能是某种服务、应用或组件的逻辑名称。
--action
=
start:

操作名称，此处表示执行“启动”操作。
start 可能是启动应用或服务的指令。
--password
=
Yeyehuo163.com:

用户的密码，通常用于身份验证。
注意：在实际场景中，建议避免直接在命令行中明文写密码，以免泄露。可以改用配置文件或环境变量。
--acceptAgreement
=
true:

表示接受某种协议或条款，一般用于软件许可协议的确认。
--username
=
thanos:

用户名，表示执行此次操作的用户是 thanos。
targetName
=
clustertest01:

目标名称，此处为集群的名称 clustertest01。
可能表示操作的对象是一个特定的集群实例。
name
=
examples:

应用或服务的名称，此处为 examples。
具体可能是部署的某个应用程序名称或服务实例的标识。
targetType
=
cluster:

目标类型，此处指定目标为 cluster（集群）。
表示这次操作针对的是集群类型的目标，而非单独的节点。
输出内容分析：
Application Model Details

name: examples
应用程序的名称。
autoDeploy:
"false"
是否允许自动部署。
appFrom:
"fromServer"
应用程序的filename:
"/opt/examples"
部署的应用程序文件路径。
springBootCompatible:
"true"
该应用是否兼容Spring Boot。
contextRoot:
"/"
应用的上下文根，通常在Web服务器中用于定义应用的访问路径。
host:
"localhost"
主机，这里指应用服务运行的主机。
startupPriority:
"99"
启动优先级。
其余字段大多数是应用程序的特性配置，涉及类加载、缓存、编码、CORS 配置、线程池等与应用服务部署相关的细节。
Configuration Options

虽然其中许多选项是布尔值（true或false）和数值配置，但这些都用于控制应用程序的各个方面，如是否启用Web Socket，HTTP cookie的相关配置，是否启用CORS访问等。
archiveIndexStrategy, cacheMaxSize, sessionTimeout,等参数决定了如何处理应用内部的资源管理和计算。
Operational Result

success:
"true"
表明操作执行成功。
msg:
"应用启动成功"
具体的操作结果信息，这里表示应用程序成功启动。
Unused Fields

attachments, redirectURL, dataTime 在此JSON响应中是空或未被使用变量，可能在其他上下文中有用。
集群停止应用
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
stop --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
targetName
=
clustertest01
name
=
examples
targetType
=
cluster
--host
=
192.168
.10.113:

目标服务器的 IP 地址。
用于指示在哪里连接进行操作。
--port
=
9060
:

目标服务器的端口号。
--model
=
app:

指明所涉及的模块是 app，可能是对此模块的管理操作。
--action
=
stop:

这次执行“停止”操作，表示要停止运行的应用或服务。
--password
=
Yeyehuo163.com:

用于身份验证的密码。
实际应用中推荐使用更安全的方式管理密码。
--acceptAgreement
=
true:

是否接受协议，一般是许可协议确认。
--username
=
thanos:

用于操作的用户名。
targetName
=
clustertest01:

目标对象的名称，这里是一个叫 clustertest01 的集群。
name
=
examples:

要进行操作的应用或服务的名称。
targetType
=
cluster:

指定目标类型为 cluster（集群）。
集群卸载应用（谨慎操作，卸载后应用就没有了,建议备份后操作）
./commandstool.sh  --host
=
192.168
.10.113 --port
=
9060
--model
=
app --action
=
delete --password
=
Yeyehuo163.com --acceptAgreement
=
true --username
=
thanos
targetName
=
clustertest01
name
=
examples
targetType
=
cluster
--host
=
192.168
.10.113:

目标主机的 IP 地址，表示操作的目标服务器。
--port
=
9060
:

目标服务器的端口号。
--model
=
app:

指定操作的模型是 app，即对应用进行管理操作。
--action
=
delete:

操作类型是 delete，表示删除应用或服务。
--password
=
Yeyehuo163.com:

用于身份验证的密码。需要确保密码管理的安全性。
--acceptAgreement
=
true:

表示已经接受了操作协议，通常这是一个许可协议。
--username
=
thanos:

用于执行操作的用户名。
targetName
=
clustertest01:

目标对象名称，这里是 clustertest01，可能是一个集群的名称。
name
=
examples:

要删除的应用或服务名称，examples 是该应用的名称。
targetType
=
cluster:

指定目标类型为 cluster，即该操作是对集群进行管理

关键字: Tongweb8命令行使用收集（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 139
问题: Tongweb嵌入式报“net.sf.jasperreports.engine.util.JRFontNotFoundException“（by lqw））””

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/146481804

---

问题描述
用户使用tongweb嵌入式p11版本，已确认linux下有黑体的字体，应用里也配置了黑体，但是直接报错：
解决方案
在应用的resource下新建一个jasperreports.properties，内容如下：
net.sf.jasperreports.awt.ignore.missing.font
=
true

关键字: Tongweb嵌入式报“net.sf.jasperreports.engine.util.JRFontNotFoundException“（by lqw））””
文档来源: 
--------------------------------------------------------------------------------

问题编号: 140
问题: Tongweb配置跳过扫描应用jar的配置指引（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/148477831

---

Tongweb8090
Tongweb嵌入式e6p14
Tongweb7049m6

关键字: Tongweb配置跳过扫描应用jar的配置指引（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 141
问题: WebService导致TongWeb6启动慢的问题

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109554166

---

问题描述：
启动TongWeb慢，通过jstack分析主线程在执行WebService扫描部署， 如下：com.tongweb.tongejb.config.WsDeployer可看出来。
解决办法：
多数情况下应用自带开源WebService组件，无需TongWeb的WebService功能，可以在启动脚本中增加-Dopenejb.webservices.enabled=false参数，不扫WebService以加快启动速度。
"main" prio=10 tid=0x00007f043c00b000 nid=0x231f runnable [0x00007f0443a63000]
java.lang.Thread.State: RUNNABLE

```java
at java.net.PlainSocketImpl.socketConnect(Native Method)
at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
- locked <0x00000007d738fc90> (a java.net.SocksSocketImpl)
at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
at java.net.Socket.connect(Socket.java:579)
at java.net.Socket.connect(Socket.java:528)
at sun.net.NetworkClient.doConnect(NetworkClient.java:180)
at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)
at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)
- locked <0x00000007d738fc08> (a sun.net.www.http.HttpClient)
at sun.net.www.http.HttpClient.<init>(HttpClient.java:211)
at sun.net.www.http.HttpClient.New(HttpClient.java:308)
at sun.net.www.http.HttpClient.New(HttpClient.java:326)
at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:997)
at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:933)
at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:851)
at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1301)
- locked <0x00000007d738f220> (a sun.net.www.protocol.http.HttpURLConnection)
at java.net.URL.openStream(URL.java:1037)
at com.tongweb.tongejb.loader.IO.read(IO.java:355)
at com.tongweb.tongejb.config.ReadDescriptors.readWsdl(ReadDescriptors.java:676)
at com.tongweb.tongejb.config.WsDeployer.getWsdl(WsDeployer.java:387)
at com.tongweb.tongejb.config.WsDeployer.processPorts(WsDeployer.java:200)
at com.tongweb.tongejb.config.WsDeployer.deploy(WsDeployer.java:65)
at com.tongweb.tongejb.config.ConfigurationFactory$Chain.deploy(ConfigurationFactory.java:366)
at com.tongweb.tongejb.config.ThorConfigurationFactory.configureApplication(ThorConfigurationFactory.java:887)
at com.tongweb.twnt.thor.ThorTomcatWebAppBuilder.startInternal(ThorTomcatWebAppBuilder.java:1205)
at com.tongweb.twnt.thor.ThorTomcatWebAppBuilder.configureStart(ThorTomcatWebAppBuilder.java:1000)
at com.tongweb.twnt.thor.GlobalListenerSupport.lifecycleEvent(GlobalListenerSupport.java:118)
at com.tongweb.web.thor.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
at com.tongweb.web.thor.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)
at com.tongweb.web.thor.core.ThorStandardContext.startInternal(ThorStandardContext.java:239)
- locked <0x00000007ee025bc0> (a com.tongweb.web.thor.core.ThorStandardContext)
at com.tongweb.web.thor.util.LifecycleBase.start(LifecycleBase.java:150)
- locked <0x00000007ee025bc0> (a com.tongweb.web.thor.core.ThorStandardContext)
at com.tongweb.web.thor.core.ContainerBase.addChildInternal(ContainerBase.java:913)
at com.tongweb.web.thor.core.ContainerBase.addChild(ContainerBase.java:889)
at com.tongweb.web.thor.core.StandardHost.addChild(StandardHost.java:618)
at com.tongweb.web.thor.core.ThorStandardHost.addChild(ThorStandardHost.java:462)
at com.tongweb.web.thor.startup.ThorHostConfig.deployWar(ThorHostConfig.java:701)
at com.tongweb.twnt.thor.ThorTomcatWebAppBuilder.fireTomcatProcess(ThorTomcatWebAppBuilder.java:2438)
at com.tongweb.twnt.thor.ThorTomcatWebAppBuilder.deployApplication(ThorTomcatWebAppBuilder.java:2378)
at com.tongweb.deploy.TongWebDeployer.deploy(TongWebDeployer.java:216)
at com.tongweb.twnt.thor.TongwebLoader.initDeploy(TongwebLoader.java:414)
at com.tongweb.twnt.thor.TongwebLoader.event(TongwebLoader.java:263)
at com.tongweb.web.thor.startup.Tomee.laststep(Tomee.java:891)
at com.tongweb.web.thor.startup.Tomee.start(Tomee.java:752)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:606)
at com.tongweb.web.thor.startup.ThorBootstrap.start(ThorBootstrap.java:352)
at com.tongweb.web.thor.startup.ThorBootstrap.main(ThorBootstrap.java:495)
```

关键字: WebService导致TongWeb6启动慢的问题
文档来源: 
--------------------------------------------------------------------------------

问题编号: 142
问题: k8s+helm部署tongweb7云容器版（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/147266614

---

安装准备
1.联系销售获取安装包和授权（例如：tongweb-cloud-7.0.C.6_P3.tar.gz）。
2.已安装docker和k8s集群，参考：
k8s集群搭建
3.有对应的docker私库，没有的可以参考：
harbor搭建
4.docker已经拉取对应的一些基础镜像，例如jdk（版本不低于1.8）。
5.安装helm，可参考
Helm安装
测试和打包镜像
拿到安装包后，先解压并放入授权测试，测试可以正常运行并输出日志（需安装并配置jdk环境变量）。
然后看看logs目录下是否有日志滚动，如下为正常显示：
cd
/opt/tongweb-cloud-7.0.C.6/tongweb/kernel/bin
./startservernohup.sh
停止tongweb（可以直接ps -ef |grep tongweb然后kill掉进程id，或者执行stopserver.sh这个脚本）。
把dockerfile-example复制过来，改名为Dockerfile：
cd到Dockerfile所在的目录，执行下面指令（tongweb:v70c6可根据需要修改）：
docker build -t tongweb:v70c6 -f Dockerfile
.
之后看看docker images里是否有对应镜像，测试是否能跑通
#tongweb:v70c6是指镜像名和版本
docker run -itd --name my_tongweb -p
8099
:8080 -v /opt/tongweb-cloud-
7.0
.C.6/tongweb:/opt/Tongweb tongweb:v70c6
查看日志没问题的话，打包和push到私库（192.168.10.126:80是本地安装好的harbor的私库地址）
docker tag tongweb:v70c6
192.168
.10.126:80/tongweb7/tongweb:v70c6
docker push
192.168
.10.126:80/tongweb7/tongweb:v70c6
查看私库是否已经有对应的镜像，例如可视化页面，或者指令：
[
root@master .docker
]
# curl -u 'admin:harbor12345' -X GET
'http://192.168.10.126/api/v2.0/projects/tongweb7/repositories/tongweb/artifacts
'
[
{
"accessories"
:null,
"addition_links"
:
{
"build_history"
:
{
"absolute"
:false,
"href"
:
"/api/v2.0/projects/tongweb7/repositories/tongweb/artif
acts/sha256:6cfc4c6c6c14d1111d496b830285d13c4ca24f6fab1c10dd95bce9f17260ec67/add
itions/build_history"
}
}
,
"digest"
:
"sha256:6cfc4c6c6c14d1111d496b830285d13c4ca24f6
fab1c10dd95bce9f17260ec67"
,
"extra_attrs"
:
{
"architecture"
:
"amd64"
,
"author"
:
""
,
"config"
:
{
"ArgsEscaped"
:true,
"Entrypoint"
:
[
"/opt/TongWeb/kernel/bin/startserver.sh"
]
,
"Env"
:
[
"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/jvm
/java-1.8-openjdk/jre/bin:/usr/lib/jvm/java-1.8-openjdk/bin"
,
"LANG=C.UTF-
8"
,
"JAVA_HOME=/usr/lib/jvm/java-1.8-
openjdk"
,
"JAVA_VERSION=8u212"
,
"JAVA_ALPINE_VERSION=8.212.04-
r0"
,
"TZ=Asia/Shanghai"
]
,
"ExposedPorts"
:
{
"8088/tcp"
:
{
}
}
}
,
"created"
:
"2025-04-
10T11:12:32.784615336+08:00"
,
"os"
:
"linux"
}
,
"icon"
:
"sha256:0048162a053eef4d4ce3fe
7518615bef084403614f8bca43b40ae2e762e11e06"
,
"id"
:2,
"labels"
:null,
"manifest_media
_type"
:
"application/vnd.docker.distribution.manifest.v2+json"
,
"media_type"
:
"appl
ication/vnd.docker.container.image.v1+json"
,
"project_id"
:4,
"pull_time"
:
"2025-04-
10T03:25:46.345Z"
,
"push_time"
:
"2025-04-
10T03:20:42.567Z"
,
"references"
:null,
"repository_id"
:2,
"size"
:139075466,
"tags"
:
[
{
"artifact_id"
:2,
"id"
:2,
"immutable"
:false,
"name"
:
"v70c6"
,
"pull_time"
:
"0001-01-
01T00:00:00.000Z"
,
"push_time"
:
"2025-04-
10T03:20:42.607Z"
,
"repository_id"
:2
}
]
,
"type"
:
"IMAGE"
}
]
[
root@master .docker
]
#
导出tongweb镜像以防万一，然后删掉docker里的tongwbe镜像，试试看能不能重新拉取下来：
docker save -o tongwebcloud_7.0.c.6.tar tongweb:v70c6
docker rmi -f
192.168
.10.126:80/tongweb7/tongweb:v70c6
docker pull tongweb:v70c6
helm安装
下载地址
#解压安装包
tar
-zxvf helm-v3.15.2-linux-amd64.tar
mv
linux-amd64/helm /usr/local/bin/helm
helm version
到解压好的tongweb7的目录下，在对应路径找到chart.yaml（最好是自己单独复制一个helm目录出来去执行，这里只是为了演示方便）
修改helm目录下的values.yaml
将最新的tongweb.xml放入到helm的configs目录下
cd到helm目录的上一级目录，执行以下指令（其中default是k8s的命令空间，tongweb是指release_name，如果需要用其他的命令空间，可以使用指令：kubectl create namespace 自行创建）。
helm
install
--namespace default tongweb helm/
提示信息解读：
helm/:
如截图所示，这个路径指向 /opt/tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm，
而该路径包含了一个 Helm chart 目录。
目录包含重要文件如 Chart.yaml 和 values.yaml，以及 templates/ 目录。
Chart.yaml 存储了 chart 的元信息，如名称、版本等。
values.yaml 用于定义 chart 的默认配置值。
templates/ 目录里面通常存储了 Kubernetes 资源的 YAML 模板。
命令结果:
Helm 成功将名为 tongweb 的 release 安装到了 default 命名空间中。
STATUS: deployed 表示资源已成功部署。
NOTES: 部分提供了一些使用提示，比如如何获取应用的 URL。这通常是 chart 定义者提供的信息，用于
帮助用户更好地使用部署后的应用。
使用kubectl get pods查看状态
如果状态如上图所示，可以使用指令
#tongweb-7849bf9554-gzf46为Name显示的信息
kubectl describe pod tongweb-7849bf9554-gzf46
这种情况下，修改仓库配置完毕后，卸载重装，卸载指令如下：
#其中tongweb为安装指令里的release-name
[
root@master templates
]
# helm uninstall tongweb
release
"tongweb"
uninstalled
[
root@master templates
]
# kubectl get pods
No resources found
in
default namespace.
[
root@master templates
]
# helm list
NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION
[
root@master templates
]
#
重新安装和检查
[
root@master templates
]
# kubectl get pods |grep tongweb
tongweb-bbff654f-v4h2r
1
/1 Running
0
2m29s
[
root@master templates
]
# kubectl describe pod tongweb-bbff654f-v4h2r
Name: tongweb-bbff654f-v4h2r
Namespace: default
Priority:
0
Node: node2/192.168.10.128
Start Time: Thu,
10
Apr
2025
15
:20:50 +0800
Labels: app.kubernetes.io/instance
=
tongweb
app.kubernetes.io/name
=
tongweb
pod-template-hash
=
bbff654f
Annotations: sidecar.istio.io/inject:
false
Status: Running
IP:
10.244
.2.10
IPs:
IP:
10.244
.2.10
Controlled By: ReplicaSet/tongweb-bbff654f
Containers:
tongweb:
Container ID:
docker://9a93d33bc315273dce919dede39c33ee5129509d2b2591d5b85e3d2cc80a95f6
Image:
192.168
.10.126:80/tongweb7/tongweb:v70c6
Image ID: dockerpullable://192.168.10.126:80/tongweb7/tongweb@sha256:6cfc4c6c6c14d1111d496b83028
5d13c4ca24f6fab1c10dd95bce9f17260ec67
Ports:
8088
/TCP,
8443
/TCP
Host Ports:
0
/TCP,
0
/TCP
State: Running
Started: Thu,
10
Apr
2025
15
:20:52 +0800
Ready: True
Restart Count:
0
Environment:
ENV_TYPE: cloud
POD_NAME: tongweb-bbff654f-v4h2r
(
v1:metadata.name
)
MEM_REQUEST:
0
(
requests.memory
)
MEM_LIMIT: node allocatable
(
limits.memory
)
Mounts:
/opt/TongWeb/kernel/autodeploy from autodeploy-volume
(
rw
)
/opt/TongWeb/kernel/conf/tongweb.xml from tongweb-volume
(
rw,path
=
"tongweb.xml"
)
/opt/TongWeb/kernel/logs from log-volume
(
rw
)
/var/run/secrets/kubernetes.io/serviceaccount from default-token-jj8c9
(
ro
)
Conditions:
Type Status
Initialized True
Ready True
ContainersReady True
PodScheduled True
Volumes:
log-volume:
Type: HostPath
(
bare
host
directory volume
)
Path: /home/work/logs
HostPathType: DirectoryOrCreate
autodeploy-volume:
Type: EmptyDir
(
a temporary directory that shares a pod's lifetime
)
Medium:
SizeLimit:
<
unset
>
tongweb-volume:
Type: ConfigMap
(
a volume populated by a ConfigMap
)
Name: tongweb
Optional:
false
登录dashboard，可以看到有相关信息：
values.yaml文件配置说明
default-token-jj8c9:
Type: Secret
(
a volume populated by a Secret
)
SecretName: default-token-jj8c9
Optional:
false
QoS Class: BestEffort
Node-Selectors:
<
none
>
Tolerations: node.kubernetes.io/not-ready:NoExecute
op
=
Exists
for
300s
node.kubernetes.io/unreachable:NoExecute
op
=
Exists
for
300s
Events:
Type Reason Age From Message
---- ------ ---- ---- -------
Normal Scheduled 2m40s default-scheduler Successfully assigned
default/tongweb-bbff654f-v4h2r to node2
Normal Pulling 2m39s kubelet Pulling image
"192.168.10.126:80/tongweb7/tongweb:v70c6"
Normal Pulled 2m39s kubelet Successfully pulled image
"192.168.10.126:80/tongweb7/tongweb:v70c6"
in
83
.379623ms
Normal Created 2m39s kubelet Created container tongweb
Normal Started 2m38s kubelet Started container tongweb
登录dashboard，可以看到有相关信息：
values.yaml文件配置说明
Plain Text
Default values
for
tongweb.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
replicaCount:
1
#镜像地址和拉取策略
image:
repository: tongweb
tag: latest
pullPolicy: Always
#secret配置
imagePullSecrets:
[
]
nameOverride:
"tongweb"
fullnameOverride:
""
#配置tongweb运行所需的环境变量
env:
#环境类型为云上
- name: ENV_TYPE
value:
"cloud"
- name: POD_NAME
valueFrom:
fieldRef:
fieldPath: metadata.name
- name: MEM_REQUEST
valueFrom:
resourceFieldRef:
resource: requests.memory
- name: MEM_LIMIT
valueFrom:
resourceFieldRef:
resource: limits.memory
#tongweb端口暴露配置
ports:
#tongweb http端口配置
- port-http:
8088
# tongweb https端口配置
- port-https:
8443
#tongweb挂载文件配置当前值支持hostpath,nfs,emptyDir,configmap挂载方式配置
#参数说明:
#name:表示挂载名称
#mountPath表示k8s容器中需要挂载的目录或者文件
#subPath 表示k8s容器中需要挂载的子目录或者文件
#下面介绍每一种挂载方式配置:
#hostpath挂载
#hostpah挂载参数说明
#hostPath:宿主机挂载目录
#hostpath挂载示例
#- name: log-volume
# mountPath: /opt/TongWeb/kernel/logs
# hostPath: /home/work/logs
#
#nfs挂载
#nfs挂载参数说明
#nfsPath:表示nfs服务器上面的挂载目录
#nfsServer:表示nfs服务器的ip地址
#nfs挂载示例
#- name: log-volume
# mountPath: /opt/TongWeb/kernel/logs
# nfsPath: /home/work/logs
# nfsServer: 127.0.0.1
#
#emptyDir挂载
#emptyDir挂载参数说明
#emptyDir:采用空目录挂载
#emptyDir挂载示例
#- name: log-volume
# mountPath: /opt/TongWeb/kernel/logs
# emptyDir: {}
#
#configMap挂载
#configMap参数说明
#configMapName: configMap名称
#configMap挂载示例
#- name: tongweb-volume
# mountPath: /opt/TongWeb/kernel/conf/tongweb.xml
# subPath: tongweb.xml
# configMapName: tongweb
#pvc挂载配置
#- name: autodeploy-volume
# mountPath: /opt/TongWeb/kernel/autodeploy
# pvc: autodeploy-pvc
mounts:
- name: log-volume
mountPath: /opt/TongWeb/kernel/logs
hostPath: /home/work/logs
- name: autodeploy-volume
mountPath: /opt/TongWeb/kernel/autodeploy
emptyDir:
{
}
- name: tongweb-volume
mountPath: /opt/TongWeb/kernel/conf/tongweb.xml
subPath: tongweb.xml
configMapName: tongweb
#pvc配置
#persistence:
# enabled: 开关
# pvc:
# - name: pvc名称
# accessMode: 访问模式
# size: 请求资源大小
# storageClass: storageClass名称
# annotations: 注解
persistence:
enabled:
false
pvc:
- name: log-pvc
accessMode: ReadWriteOnce
size: 500Mi
storageClass: nfs-client
annotations:
{
}
- name: autodeploy-pvc
accessMode: ReadWriteOnce
size: 500Mi
storageClass: nfs-client2
annotations:
{
}
# initContainer容器配置，主要是支持应用的部署和文件的上传,利用initcontainer可以部署应用和上
传jar包
# initContainer参数说明
# enabled: initcontainer开关
# containers：容器配置
# - image: 镜像地址
# name: 容器名称
# packagePath: 镜像中文件的路径，建议都放置到同一个路径下面。采用同一个路径可以把所有的文件
都复制下来。
# mounts: 需要挂载到容器中的哪个挂载配置
# mountName: 挂载名称,对应上面的mounts的name配置
initContainers:
enabled:
false
containers:
- image: testwar
name: application
packagePath: /opt/app/.
mounts:
- mountName: autodeploy-volume
#为了方面用户修改或替换tongweb.xml等配置文件，无需重新制作镜像，或者单独的创建每一个
configMap。tongweb helmchart提供一次性的创建所有的configMap,需要把配置文件放到根目录的
configs目录下，通过helm install就可创建所有的configmap
#configMapfile:
#- key: configMap中的key
# value: 配置文件的路径
# configMapName: configMap的名称
#configMapfile配置示例
#configMapfile:
#- key: "tongweb.xml"
# value: "configs/tongweb.xml"
# configMapName: tongweb
configMapfile:
- key:
"tongweb.xml"
value:
"configs/tongweb.xml"
configMapName: tongweb
serviceAccount:
# Specifies whether a service account should be created
create:
false
# Annotations to add to the service account
annotations:
{
}
# The name of the service account to use.
# If not set and create is true, a name is generated using the fullname
template
name:
""
podAnnotations:
{
}
podSecurityContext:
{
}
# fsGroup: 2000
securityContext:
{
}
# capabilities:
# drop:
# - ALL
# readOnlyRootFilesystem: true
# runAsNonRoot: true
# runAsUser: 1000
# service访问配置
# type: 外部访问方式
# portParam:
# - name: port名称
# port: 内部访问端口配置
# targetPort: 目标端口配置
#当type类型为NodePort时可以固定nodePort
# nodePort: 外部访问端口
service:
type: NodePort
portParam:
- name: port-http
port:
9060
targetPort:
8088
# nodePort: 30021
ingress:
enabled:
false
annotations:
{
}
# kubernetes.io/ingress.class: nginx
# kubernetes.io/tls-acme: "true"
hosts:
- host: chart-example.local
paths:
[
]
tls:
[
]
# - secretName: chart-example-tls
# hosts:
# - chart-example.local
resources:
{
}
# We usually recommend not to specify default resources and to leave this as a
conscious
# choice for the user. This also increases chances charts run on environments
with little
# resources, such as Minikube. If you do want to specify resources, uncomment
the following
# lines, adjust them as necessary, and remove the curly braces after
'resources:'
.
# limits:
# cpu: 100m
# memory: 128Mi
# requests:
# cpu: 100m
# memory: 128Mi
autoscaling:
enabled:
false
minReplicas:
1
maxReplicas:
100
targetCPUUtilizationPercentage:
80
# targetMemoryUtilizationPercentage: 80
nodeSelector:
{
}
tolerations:
[
]
affinity:
{
}

关键字: k8s+helm部署tongweb7云容器版（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 143
问题: k8s一键部署tongweb7容器版脚本（by why+lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/149016827

---

声明
此贴仅供参考，请根据自身需求在测试环境测试和修改。
安装准备
1.获取对应的安装包和授权,并将授权和安装包放在同一个目录下：
2.docekr已配置远程仓库
3.提前拉取jdk的镜像（这里配置了使用openjdk:8）
安装
将以下内容复制到k8s_deploy_TongWeb.sh里：
#!/bin/bash
# TongWeb Kubernetes 全自动部署脚本（支持镜像仓库）
# 使用说明：
# 文件准备统一在同级目录下：
# /部署目录/
# ├── k8s_deploy_TongWeb.sh  部署脚本
# ├── license.dat      产品授权
# └── tongweb-cloud-7.0.C.6_P5.tar.gz  安装包
# 执行权限：chmod +x k8s_deploy_TongWeb.sh
# 运行部署：sudo ./k8s_deploy_TongWeb.sh
# 配置信息
APP_NAME
=
"tongweb"
APP_VERSION
=
"7.0.C.6_P5"
TAR_PACKAGE
=
"tongweb-cloud-
${APP_VERSION}
.tar.gz"
INSTALL_DIR
=
"/opt/tongweb-cloud-7.0.C.6"
NAMESPACE
=
"tongweb-namespace"
IMAGE_NAME
=
"tongweb:v70c6"
K8S_DIR
=
"/tmp/tongweb-k8s-manifests"
# 镜像仓库配置（根据实际情况修改）
REGISTRY_URL
=
"192.168.10.108:5000"
# 镜像仓库地址
REGISTRY_PROJECT
=
"tongweb7-cloud"
# 仓库中的项目/命名空间名称（若无可留空）
REGISTRY_USER
=
"admin"
# 仓库用户名
REGISTRY_PASSWORD
=
"Harbor12345"
# 仓库密码
APP_VERSION
=
"7.0.C.6_P5"
# 需在脚本中定义版本变量
# 完整镜像地址格式：
REMOTE_IMAGE_NAME
=
"
${REGISTRY_URL}
/
${REGISTRY_PROJECT}
/tongweb:
${APP_VERSION}
-
$(
date
+%Y%m%d%H%M
)
"
# 初始化环境
init_env
(
)
{
# 创建临时目录
mkdir
-p
"
$K8S_DIR
"
# 检查必需命令
for
cmd
in
docker kubectl
tar
;
do
if
!
command
-v
$cmd
&>
/dev/null
;
then
echo
"错误：必需命令
$cmd
未找到！"
exit
1
fi
done
}
# 解压安装包
extract_package
(
)
{
if
[
!
-f
"
$TAR_PACKAGE
"
]
;
then
echo
"错误：安装包
$TAR_PACKAGE
不存在！"
exit
1
fi
echo
"正在解压安装包..."
tar
-zxvf
"
$TAR_PACKAGE
"
-C /opt
cp
license.dat
"
$INSTALL_DIR
"
}
# 配置Kubernetes
setup_kubernetes
(
)
{
# 创建命名空间
if
!
kubectl get namespace
"
$NAMESPACE
"
&>
/dev/null
;
then
kubectl create namespace
"
$NAMESPACE
"
fi
# 创建ConfigMap
kubectl create configmap license
\
--from-file
=
license.dat
\
-n
"
$NAMESPACE
"
}
# 构建并推送镜像
build_and_push_image
(
)
{
# 基础镜像配置（可根据需要修改）
local
BASE_IMAGE
=
"openjdk:8"
# 生成Dockerfile
echo
"正在生成Dockerfile..."
cat
>
"
$INSTALL_DIR
/Dockerfile"
<<
EOF
FROM
${BASE_IMAGE}
ENV TZ=Asia/Shanghai
\\
LANG=C.UTF-8
ADD tongweb /opt/TongWeb
EXPOSE 8088 8443
ENTRYPOINT ["/opt/TongWeb/kernel/bin/startserver.sh"]
EOF
# 构建本地镜像
echo
"正在构建本地镜像..."
if
!
docker build -t
"
$IMAGE_NAME
"
-f
"
$INSTALL_DIR
/Dockerfile"
"
$INSTALL_DIR
"
;
then
echo
"镜像构建失败！"
exit
1
fi
# 标记并推送镜像
echo
"正在标记镜像..."
docker tag
"
$IMAGE_NAME
"
"
$REMOTE_IMAGE_NAME
"
echo
"登录镜像仓库..."
if
!
docker login -u
"
$REGISTRY_USER
"
-p
"
$REGISTRY_PASSWORD
"
"
$REGISTRY_URL
"
;
then
echo
"镜像仓库登录失败！"
exit
1
fi
echo
"正在推送镜像到仓库..."
if
!
docker push
"
$REMOTE_IMAGE_NAME
"
;
then
echo
"镜像推送失败！"
exit
1
fi
echo
"镜像推送成功：
$REMOTE_IMAGE_NAME
"
}
# 生成部署文件
generate_manifests
(
)
{
# 生成Deployment
cat
>
"
$K8S_DIR
/deployment.yaml"
<<
EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name:
$APP_NAME
spec:
  selector:
    matchLabels:
      app:
$APP_NAME
replicas: 1
  template:
    metadata:
      labels:
        app:
$APP_NAME
spec:
      containers:
      - name:
$APP_NAME
image:
$REMOTE_IMAGE_NAME
# 使用仓库镜像地址
        imagePullPolicy: Always    # 总是从仓库拉取
        env:
        - name: CONFIG_REMOTE_ENABLE
          value: "false"
        - name: ENV_TYPE
          value: "cloud"
        ports:
        - name: port-http
          containerPort: 8088
        - name: port-https
          containerPort: 8443
        volumeMounts:
        - name: log-volume
          mountPath: /opt/TongWeb/kernel/logs
        - name: autodeploy-volume
          mountPath: /opt/TongWeb/kernel/autodeploy
        - name: license
          mountPath: /opt/TongWeb/kernel/license.dat
          subPath: license.dat
      volumes:
      - name: log-volume
        hostPath:
          path: /home/work/logs
          type: DirectoryOrCreate
      - name: autodeploy-volume
        hostPath:
          path: /home/work/autodeploy
          type: DirectoryOrCreate
      - name: license
        configMap:
          name: license
EOF
# 生成Service（保持不变）
cat
>
"
$K8S_DIR
/service.yaml"
<<
EOF
apiVersion: v1
kind: Service
metadata:
  name:
${APP_NAME}
srv
spec:
  selector:
    app:
$APP_NAME
type: NodePort
  ports:
  - name: port-http
    nodePort: 30080
    port: 9060
    targetPort: 8088
  - name: port-https
    nodePort: 30081
    port: 9443
    targetPort: 8443
EOF
}
# 部署应用到集群
deploy_to_cluster
(
)
{
echo
"正在部署应用..."
kubectl apply -f
"
$K8S_DIR
/deployment.yaml"
-n
"
$NAMESPACE
"
kubectl apply -f
"
$K8S_DIR
/service.yaml"
-n
"
$NAMESPACE
"
# 等待Pod就绪
local
retry
=
0
while
[
$retry
-lt
15
]
;
do
local
pod_status
=
$(
kubectl get pod -n
"
$NAMESPACE
"
-l
app
=
$APP_NAME -o
jsonpath
=
'{.items[0].status.phase}'
)
local
image_pulled
=
$(
kubectl get pod -n
"
$NAMESPACE
"
-l
app
=
$APP_NAME -o
jsonpath
=
'{.items[0].status.containerStatuses[0].state}'
)
if
[
"
$pod_status
"
==
"Running"
]
;
then
echo
-e
"
\n
Pod 已正常运行！"
kubectl get pod -n
"
$NAMESPACE
"
return
0
elif
[
[
"
$image_pulled
"
==
*
"ErrImagePull"
*
]
]
;
then
echo
-e
"
\n
错误：镜像拉取失败！请检查："
echo
"1. 镜像地址是否正确：
$REMOTE_IMAGE_NAME
"
echo
"2. 仓库认证信息是否正确"
exit
1
fi
echo
-n
"."
((
retry
++
))
sleep
5
done
echo
-e
"
\n
错误：Pod 启动超时！"
kubectl describe pod -n
"
$NAMESPACE
"
-l
app
=
$APP_NAME
exit
1
}
# 主流程
main
(
)
{
init_env
    extract_package
    setup_kubernetes
    build_and_push_image
    generate_manifests
    deploy_to_cluster
echo
""
echo
"═"
*50
echo
"部署完成！"
echo
"镜像地址：
$REMOTE_IMAGE_NAME
"
echo
"如部署应用访问地址：http://<节点IP>:30080"
echo
"管理命令："
echo
"  kubectl get pod -n
$NAMESPACE
"
echo
"  kubectl logs -f <pod名称> -n
$NAMESPACE
"
echo
"═"
*50
}
# 执行主流程
main
执行以下指令：
执行权限：chmod +x k8s_deploy_TongWeb.sh
运行部署：sudo ./k8s_deploy_TongWeb.sh
执行后，使用以下指令查看日志
# 通过该指令查看pod名称
kubectl get pod -n tongweb-namespace
 kubectl logs -f
<
pod名称
>
-n tongweb-namespace
如果安装有问题，需要删掉pod重新操作，可执行以下指令（）
#先查pod名称
kubectl get pod -n tongweb-namespace
#删除pod
kubectl delete pod pod名 -n tongweb-namespace
#删除跟license相关的configmap
kubectl delete configmap license -n tongweb-namespace
#删除命名空间（前提是该命名空间只有tongweb相关的资源和配置）
kubectl delete namespace tongweb-namespace
本地完整日志如下，可供参考
[
root@k8s-master tongweb7-cloud
]
# sudo ./k8s_deploy_TongWeb.sh
正在解压安装包
..
.
tongweb-cloud-7.0.C.6/
tongweb-cloud-7.0.C.6/tongweb/
tongweb-cloud-7.0.C.6/tongweb/kernel/
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/luncher.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/jdk-tool.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/tw.env
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/env.options
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/external.vmoptions
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/startdebug.bat
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/startdebug.sh
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/startserver.bat
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/startserver.sh
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/startservernohup.sh
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/stopserver.bat
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/stopserver.sh
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/version.bat
tongweb-cloud-7.0.C.6/tongweb/kernel/bin/version.sh
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/security/
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/security/twgroups.properties
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/security/twusers.properties
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/gm.pfx
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/mykey.cer
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/mykey.p12
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/sm2.enc.pfx
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/sm2.sig.pfx
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/tongweb.cer
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/tongweb.keystore
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/ssl/ss.keystore
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/prometheus.properties
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/default-web.xml
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/application.properties
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/logging.properties
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/monitor.properties
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/server.properties
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/tongweb.policy
tongweb-cloud-7.0.C.6/tongweb/kernel/conf/tongweb.xml
tongweb-cloud-7.0.C.6/tongweb/kernel/autodeploy/
tongweb-cloud-7.0.C.6/tongweb/kernel/tmp/
tongweb-cloud-7.0.C.6/tongweb/kernel/logs/
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-jsp.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-commons.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-license.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-websocket.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-core.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-boot.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-log.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-session.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-config.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-cmd.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/lib/tongweb-servlet-simple.jar
tongweb-cloud-7.0.C.6/tongweb/kernel/README.md
tongweb-cloud-7.0.C.6/tongweb/extends/
tongweb-cloud-7.0.C.6/tongweb/extends/templates/
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/configs/
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/configs/tongweb.xml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/NOTES.txt
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/_helpers.tpl
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/configmap.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/deployment.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/pvc.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/serviceaccount.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/ingress.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/templates/service.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/Chart.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/helm/values.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/operator/
tongweb-cloud-7.0.C.6/tongweb/extends/templates/operator/tongweb_operator_all.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/operator/tongweb_samples.yaml
tongweb-cloud-7.0.C.6/tongweb/extends/templates/docker-set-env.env
tongweb-cloud-7.0.C.6/tongweb/extends/templates/docker-swarm-template-sample.tpl
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-template-job.sh
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-template.sh
tongweb-cloud-7.0.C.6/tongweb/extends/templates/docker-swarm-template.sh
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-template-job-nfs.tpl
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-set-env.options
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-template-deployment-hostpath.tpl
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-template-service.tpl
tongweb-cloud-7.0.C.6/tongweb/extends/templates/docker-image-run.sh
tongweb-cloud-7.0.C.6/tongweb/extends/templates/docker-repo-run.sh
tongweb-cloud-7.0.C.6/tongweb/extends/templates/docker-swarm-template-config.options
tongweb-cloud-7.0.C.6/tongweb/extends/templates/docker-repo-transfer.sh
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-set-job.options
tongweb-cloud-7.0.C.6/tongweb/extends/templates/k8s-template-deployment-nfs.tpl
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/heapinfo.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/showbusyjavathreads.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/licenseinfo.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/connectorinfo.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/licenseinfo.bat
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/deadlockcheck.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/loganalysis.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/cloud-granfan-k8s-template.json
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/cloud-granfan-template.json
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/testjdbcconnection.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/topobjectmemorycheck.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/jdbcconnectioninfo.sh
tongweb-cloud-7.0.C.6/tongweb/extends/scripts/image-upgrade.sh
tongweb-cloud-7.0.C.6/tongweb/extends/tools/
tongweb-cloud-7.0.C.6/tongweb/extends/tools/image/
tongweb-cloud-7.0.C.6/tongweb/extends/tools/image/convertor/
tongweb-cloud-7.0.C.6/tongweb/extends/tools/image/convertor/convertor.bat
tongweb-cloud-7.0.C.6/tongweb/extends/tools/image/convertor/convertor.sh
tongweb-cloud-7.0.C.6/tongweb/extends/tools/image/convertor/tongweb-convertor.jar
tongweb-cloud-7.0.C.6/tongweb/extends/tools/image/Dockerfile-example
tongweb-cloud-7.0.C.6/tongweb/extends/tools/encipher/
tongweb-cloud-7.0.C.6/tongweb/extends/tools/encipher/cipher-tool.jar
tongweb-cloud-7.0.C.6/tongweb/extends/tools/encipher/cipher-tool.sh
tongweb-cloud-7.0.C.6/tongweb/extends/tools/encipher/cipher-tool.bat
tongweb-cloud-7.0.C.6/tongweb/extends/libs/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libssl.so.1.1
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libssl.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libtwnative-1.la
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libapr-1.so.0
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libtwnative-1.so.0
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libcrypto.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libcrypto.so.1.1
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libtwnative-1.so.0.2.24
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libtwnative-1.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/aarch64/libtwnative-1.a
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libapr-1.so.0
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libtwnative-1.so.0
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libtwnative-1.la
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libtwnative-1.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libssl.so.10
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libtwnative-1.so.0.2.24
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libtwnative-1.a
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/mips64/libcrypto.so.10
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libtwnative-1.a
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libssl.so.10
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libtwnative-1.so.0.2.24
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libapr-1.so.0
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libtwnative-1.la
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libtwnative-1.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libtwnative-1.so.0
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/linux/x64/libcrypto.so.10
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/windows/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/windows/x64/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/windows/x64/twnative-1.dll
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/windows/x86/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/apr/windows/x86/twnative-1.dll
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/aarch64/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/aarch64/libzlog.so.1.2
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/aarch64/libzlog.so.1
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/aarch64/libzlog.a
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/aarch64/libzlog.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/mips64/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/mips64/libzlog.a
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/mips64/libzlog.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/mips64/libzlog.so.1
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/mips64/libzlog.so.1.2
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/x86_64/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/x86_64/libzlog.a
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/x86_64/libzlog.so.1
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/x86_64/libzlog.so
tongweb-cloud-7.0.C.6/tongweb/extends/libs/fastlog/x86_64/libzlog.so.1.2
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/json-databind-2.11.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/tongweb-dynamic.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/pool2-2.6.2_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/json-core-2.11.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/client.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/monitor-core-1.0.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/simpleclient-common.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/simpleclient.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/HdrHistogram-2.1.11_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/ws-mini-0.0.1.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/Latencyutils-2.0.3_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/json-annotations-2.11.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/logger-adapter-1.0.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/tw-cm-Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/HulkCP-java7-7.3.9.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/common-socket-7.0.0.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/tongweb-jdk9plus-api.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/monitor-enhance-1.0.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/license-client-4.5.1.7.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/host/tongweb-jdbc.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/app/
tongweb-cloud-7.0.C.6/tongweb/extends/libs/goova-22.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/tongweb-c.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/tongweb-gmssl-1.0.0.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/lang3-3.10_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/nacos-api-1.2.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/tongweb-servlet-all.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/nacos-common-1.2.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/nacos-client-1.2.0_Tianfu.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/kafka-clients.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/atomikos-integration-extension.jar
tongweb-cloud-7.0.C.6/tongweb/extends/libs/dynamic-agent.jar
tongweb-cloud-7.0.C.6/tongweb/extends/plugins/
tongweb-cloud-7.0.C.6/tongweb/extends/plugins/pinpoint-plugins/
tongweb-cloud-7.0.C.6/tongweb/extends/plugins/pinpoint-plugins/tongweb-pinpoint-plugin-1.5.2.jar
tongweb-cloud-7.0.C.6/tongweb/extends/plugins/skywalking-plugins/
tongweb-cloud-7.0.C.6/tongweb/extends/plugins/skywalking-plugins/tongweb-skywalking.jar
namespace/tongweb-namespace created
configmap/license created
正在生成Dockerfile
..
.
正在构建本地镜像
..
.
Sending build context to Docker daemon
97
.22MB
Step
1
/5
:
FROM openjdk:8
 ---
>
b273004037cc
Step
2
/5
:
ENV
TZ
=
Asia/Shanghai
LANG
=
C.UTF-8
 ---
>
Running
in
983a90545142
Removing intermediate container 983a90545142
 ---
>
e51ff15d78bb
Step
3
/5
:
ADD tongweb /opt/TongWeb
 ---
>
59bfa478c0a3
Step
4
/5
:
EXPOSE
8088
8443
---
>
Running
in
8ebd49b60b53
Removing intermediate container 8ebd49b60b53
 ---
>
3be34a57ffe5
Step
5
/5
:
ENTRYPOINT
[
"/opt/TongWeb/kernel/bin/startserver.sh"
]
---
>
Running
in
1c62c83a212d
Removing intermediate container 1c62c83a212d
 ---
>
ffb67754d9f5
Successfully built ffb67754d9f5
Successfully tagged tongweb:v70c6
正在标记镜像
..
.
登录镜像仓库
..
.
WARNING
!
Using --password via the CLI is insecure. Use --password-stdin.
WARNING
!
Your password will be stored unencrypted
in
/root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/
#credentials-store
Login Succeeded
正在推送镜像到仓库
..
.
The push refers to repository
[
192.168
.10.108:5000/tongweb7-cloud/tongweb
]
a45ec45194fc: Pushed
6b5aaff44254: Layer already exists
53a0b163e995: Layer already exists
b626401ef603: Layer already exists
9b55156abf26: Layer already exists
293d5db30c9f: Layer already exists
03127cdb479b: Layer already exists
9c742cd6c7a5: Layer already exists
7.0
.C.6_P5-202506232031: digest: sha256:153f17b4146a6e822c1e4482ca296cf721e86cc77e4ba7450ccc4abc80dc75e2 size:
2007
镜像推送成功：192.168.10.108:5000/tongweb7-cloud/tongweb:7.0.C.6_P5-202506232031
正在部署应用
..
.
deployment.apps/tongweb created
service/tongwebsrv created
..
..
Pod 已正常运行！
NAME                       READY   STATUS    RESTARTS   AGE
tongweb-5f8c8bb459-p4zvv
1
/1     Running
0
27s

═*50
部署完成！
镜像地址：192.168.10.108:5000/tongweb7-cloud/tongweb:7.0.C.6_P5-202506232031
如部署应用访问地址：http://
<
节点IP
>
:30080
管理命令：
  kubectl get pod -n tongweb-namespace
  kubectl logs -f
<
pod名称
>
-n tongweb-namespace
═*50
[
root@k8s-master tongweb7-cloud
]
# kubectl get pod -n tongweb-namespace
NAME                       READY   STATUS    RESTARTS   AGE
tongweb-5f8c8bb459-p4zvv
1
/1     Running
0
46s
[
root@k8s-master tongweb7-cloud
]
# kubectl logs -f tongweb-5f8c8bb459-p4zvv -n tongweb-namespace
[
2025
-06-25
11
:47:01.638
]
[
INFO
]
[
config
]
[
Logging started
]
[
2025
-06-25
11
:47:01.709
]
[
INFO
]
[
console
]
[
----------------License Info------------------
]
[
2025
-06-25
11
:47:01.710
]
[
INFO
]
[
console
]
[
Consumer_Name:            金融
]
[
2025
-06-25
11
:47:01.710
]
[
INFO
]
[
console
]
[
Project_Name:             国产化
]
[
2025
-06-25
11
:47:01.711
]
[
INFO
]
[
console
]
[
License_Type:             trial
]
[
2025
-06-25
11
:47:01.711
]
[
INFO
]
[
console
]
[
Max_Number:               -1
]
[
2025
-06-25
11
:47:01.711
]
[
INFO
]
[
console
]
[
Expiry_Date:
2025
-09-09
]
[
2025
-06-25
11
:47:01.711
]
[
INFO
]
[
console
]
[
Product_Name:             TongWeb
]
[
2025
-06-25
11
:47:01.711
]
[
INFO
]
[
console
]
[
Product_Edition:          Cloud
]
[
2025
-06-25
11
:47:01.712
]
[
INFO
]
[
console
]
[
Product_version:
7.0
.C
]
[
2025
-06-25
11
:47:01.712
]
[
INFO
]
[
console
]
[
----------------License Info------------------
]
[
2025
-06-25
11
:47:02.027
]
[
INFO
]
[
config
]
[
TongWeb init success
]
[
2025
-06-25
11
:47:02.608
]
[
INFO
]
[
web-container
]
[
Initializing ProtocolHandler
[
"http-nio-8088"
]
]
[
2025
-06-25
11
:47:02.688
]
[
INFO
]
[
web-container
]
[
Starting
service
[
TongWeb
]
]
[
2025
-06-25
11
:47:02.689
]
[
INFO
]
[
web-container
]
[
Starting Servlet engine:
[
TongWeb/7.0.C.6_P5
]
]
[
2025
-06-25
11
:47:02.834
]
[
INFO
]
[
web-container
]
[
Starting ProtocolHandler
[
"http-nio-8088"
]
]
[
2025
-06-25
11
:47:02.865
]
[
INFO
]
[
boot
]
[
TongWeb Server Started
]

关键字: k8s一键部署tongweb7容器版脚本（by why+lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 144
问题: k8s一键部署tongweb企业版7049m6（by why+lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/149052348

---

声明
1.此贴仅供参考，请根据自身需求在测试环境测试和修改。
安装准备
1.获取对应的安装包和授权,并将授权和安装包放在同一个目录下
2.docekr已配置远程仓库
3.提前拉取jdk的镜像（这里配置了使用openjdk:8）
安装
将以下内容复制到k8s_deploy_TongWeb7049m6.sh里：
#!/bin/bash
# TongWeb Kubernetes 全自动部署脚本（支持镜像仓库）
# 使用说明：
# 文件准备统一在同级目录下：
# /部署目录/
# ├── k8s_deploy_TongWeb.sh  部署脚本
# ├── license.dat      产品授权
# └──TongWeb7.0.4.9_M6_Enterprise_Linux.tar.gz  安装包
# 执行权限：chmod +x k8s_deploy_TongWeb7049m6.sh
# 运行部署：sudo ./k8s_deploy_TongWeb7049m6.sh
# 配置信息
APP_NAME
=
"tongweb"
APP_VERSION
=
"7.0.4.9_M6_Enterprise_Linux"
TAR_PACKAGE
=
"TongWeb7.0.4.9_M6_Enterprise_Linux.tar.gz"
INSTALL_DIR
=
"/opt/tongweb-7049m6"
NAMESPACE
=
"tongweb7049m6cloud-namespace"
IMAGE_NAME
=
"tongweb:7049m6"
K8S_DIR
=
"/tmp/tongweb-k8s-manifests"
# 镜像仓库配置（根据实际情况修改）
REGISTRY_URL
=
"192.168.10.108:5000"
# 镜像仓库地址
REGISTRY_PROJECT
=
"tongweb7-cloud-7049m6"
# 仓库中的项目/命名空间名称（若无可留空）
REGISTRY_USER
=
"admin"
# 仓库用户名
REGISTRY_PASSWORD
=
"Harbor12345"
# 仓库密码
APP_VERSION
=
"7.0.4.9_M6_Enterprise_Linux"
# 需在脚本中定义版本变量
# 完整镜像地址格式：
REMOTE_IMAGE_NAME
=
"
${REGISTRY_URL}
/
${REGISTRY_PROJECT}
/tongweb:
${APP_VERSION}
-
$(
date
+%Y%m%d%H%M
)
"
# 初始化环境
init_env
(
)
{
# 创建临时目录
mkdir
-p
"
$K8S_DIR
"
# 检查必需命令
for
cmd
in
docker kubectl
tar
;
do
if
!
command
-v
$cmd
&>
/dev/null
;
then
echo
"错误：必需命令
$cmd
未找到！"
exit
1
fi
done
}
# 解压安装包
extract_package
(
)
{
if
[
!
-f
"
$TAR_PACKAGE
"
]
;
then
echo
"错误：安装包
$TAR_PACKAGE
不存在！"
exit
1
fi
echo
"正在解压安装包..."
tar
-zxvf
"
$TAR_PACKAGE
"
-C /opt
mv
"/opt/TongWeb
${APP_VERSION}
"
"
$INSTALL_DIR
"
cp
license.dat
"
$INSTALL_DIR
"
}
# 配置Kubernetes
setup_kubernetes
(
)
{
# 创建命名空间
if
!
kubectl get namespace
"
$NAMESPACE
"
&>
/dev/null
;
then
kubectl create namespace
"
$NAMESPACE
"
fi
# 创建ConfigMap
kubectl create configmap license7049m6
\
--from-file
=
license.dat
\
-n
"
$NAMESPACE
"
}
# 构建并推送镜像
build_and_push_image
(
)
{
# 基础镜像配置（可根据需要修改）
local
BASE_IMAGE
=
"openjdk:8"
# 生成Dockerfile
echo
"正在生成Dockerfile..."
cat
>
"
$INSTALL_DIR
/Dockerfile"
<<
EOF
FROM
${BASE_IMAGE}
# 时区配置
ENV TZ=Asia/Shanghai
\\
LANG=C.UTF-8


# 拷贝TongWeb
#ADD tongweb /opt/TongWeb
ADD . /opt/TongWeb


# 暴露端口（按需求改）
EXPOSE 8080 8443 9060


# 启动命令
#ENTRYPOINT ["/opt/TongWeb/bin/startservernohup.sh"]
# 启动命令
ENTRYPOINT ["/opt/TongWeb/bin/startserver.sh"]


RUN echo "[
$(
date
'+%Y-%m-%d %H:%M:%S'
)
] TongWeb
${APP_VERSION}
镜像构建成功"
EOF
# 构建本地镜像
echo
"正在构建本地镜像..."
if
!
docker build -t
"
$IMAGE_NAME
"
-f
"
$INSTALL_DIR
/Dockerfile"
"
$INSTALL_DIR
"
;
then
echo
"镜像构建失败！"
exit
1
fi
# 标记并推送镜像
echo
"正在标记镜像..."
docker tag
"
$IMAGE_NAME
"
"
$REMOTE_IMAGE_NAME
"
echo
"登录镜像仓库..."
if
!
docker login -u
"
$REGISTRY_USER
"
-p
"
$REGISTRY_PASSWORD
"
"
$REGISTRY_URL
"
;
then
echo
"镜像仓库登录失败！"
exit
1
fi
echo
"正在推送镜像到仓库..."
if
!
docker push
"
$REMOTE_IMAGE_NAME
"
;
then
echo
"镜像推送失败！"
exit
1
fi
echo
"镜像推送成功：
$REMOTE_IMAGE_NAME
"
}
# 生成部署文件
generate_manifests
(
)
{
# 生成Deployment
cat
>
"
$K8S_DIR
/deployment.yaml"
<<
EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name:
$APP_NAME
spec:
  selector:
    matchLabels:
      app:
$APP_NAME
replicas: 1
  template:
    metadata:
      labels:
        app:
$APP_NAME
spec:
      containers:
      - name:
$APP_NAME
image:
$REMOTE_IMAGE_NAME
# 使用仓库镜像地址
        imagePullPolicy: Always    # 总是从仓库拉取
        env:
        - name: CONFIG_REMOTE_ENABLE
          value: "false"
        - name: ENV_TYPE
          value: "cloud"
        ports:
        - name: http
          containerPort: 8080
        - name: https
          containerPort: 8443
        - name: admin
          containerPort: 9060
        volumeMounts:
        - name: log-volume
          mountPath: /opt/TongWeb/logs
        - name: autodeploy-volume
          mountPath: /opt/TongWeb/autodeploy
        - name: license
          mountPath: /opt/TongWeb/license.dat
          subPath: license.dat
      volumes:
      - name: log-volume
        hostPath:
          path: /home/work/logs
          type: DirectoryOrCreate
      - name: autodeploy-volume
        hostPath:
          path: /home/work/autodeploy
          type: DirectoryOrCreate
      - name: license
        configMap:
          name: license7049m6
EOF
# 生成Service
cat
>
"
$K8S_DIR
/service.yaml"
<<
EOF
apiVersion: v1
kind: Service
metadata:
  name:
${APP_NAME}
srv
spec:
  selector:
    app:
$APP_NAME
type: NodePort
  ports:
  - name: http
    port: 8088
    targetPort: 8088
    nodePort: 30808  # 修改为有效范围内的端口
  - name: https
    port: 8443
    targetPort: 8443
    nodePort: 32443  # 修改为有效范围内的端口
  - name: admin
    port: 9060
    targetPort: 9060
    nodePort: 30906  # 修改为有效范围内的端口
EOF
}
# 部署应用到集群
deploy_to_cluster
(
)
{
echo
"正在部署应用..."
kubectl apply -f
"
$K8S_DIR
/deployment.yaml"
-n
"
$NAMESPACE
"
kubectl apply -f
"
$K8S_DIR
/service.yaml"
-n
"
$NAMESPACE
"
# 等待Pod就绪
echo
-n
"等待Pod启动"
local
retry
=
0
local
max_retries
=
30
# 把重试次数增加为30
local
sleep_time
=
15
# 增加检查间隔为10秒
while
[
$retry
-lt
$max_retries
]
;
do
local
pod_status
=
$(
kubectl get pod -n
"
$NAMESPACE
"
-l
app
=
$APP_NAME -o
jsonpath
=
'{.items[0].status.phase}'
)
local
image_pulled
=
$(
kubectl get pod -n
"
$NAMESPACE
"
-l
app
=
$APP_NAME -o
jsonpath
=
'{.items[0].status.containerStatuses[0].state}'
)
if
[
"
$pod_status
"
==
"Running"
]
;
then
echo
-e
"
\n
Pod 已正常运行！"
kubectl get pod -n
"
$NAMESPACE
"
return
0
elif
[
[
"
$image_pulled
"
==
*
"ErrImagePull"
*
]
]
;
then
echo
-e
"
\n
错误：镜像拉取失败！请检查："
echo
"1. 镜像地址是否正确：
$REMOTE_IMAGE_NAME
"
echo
"2. 仓库认证信息是否正确"
exit
1
fi
echo
-n
"."
((
retry
++
))
sleep
$sleep_time
done
echo
"错误：Pod 启动超时！"
kubectl describe pod -n
"
$NAMESPACE
"
-l
app
=
$APP_NAME
exit
1
}
# 主流程
main
(
)
{
init_env
    extract_package
    setup_kubernetes
    build_and_push_image
    generate_manifests
    deploy_to_cluster
echo
""
echo
"═"
*50
echo
"TongWeb 7.0.4.9_M6 部署完成！"
echo
"管理控制台： http://<节点IP>:30906/console"
echo
"管理控制台初始账号：thanos"
echo
"管理控制台初始密码：thanos123.com"
echo
"如部署应用，访问： http://<节点IP>:30808"
echo
"管理命令："
echo
"  kubectl get pod -n
$NAMESPACE
"
echo
"  kubectl logs -f <pod名称> -n
$NAMESPACE
"
echo
"═"
*50
}
# 执行主流程
main
执行以下指令：
# 执行权限：
chmod
+x k8s_deploy_TongWeb7049m6.sh
# 运行部署：
sudo
./k8s_deploy_TongWeb7049m6.sh
执行后，使用以下指令查看日志：
kubectl get pod -n tongweb7049m6cloud-namespace
 kubectl logs -f
<
pod名称
>
-n tongweb7049m6cloud-namespace
如果安装有问题，需要删掉pod重新操作，可执行以下指令：
#先查pod名称
kubectl get pod -n tongweb7049m6cloud-namespace
#删除pod
kubectl delete pod pod名 -n tongweb7049m6cloud-namespace
#删除跟license相关的configmap
kubectl delete configmap license -n tongweb7049m6cloud-namespace
#删除命名空间（前提是该命名空间只有tongweb相关的资源和配置）
kubectl delete namespace tongweb7049m6cloud-namespace

关键字: k8s一键部署tongweb企业版7049m6（by why+lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 145
问题: tongweb7 勾选refer后控制台部分资源加载失败，无法正常使用tongweb控制台（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/135203786

---

实际使用中由于某些需求，需要使用refer，便在下面勾选的两个http通道里勾选了refer：
重启后发现控制台出现问题了，部分资源加载失败，无法使用控制台
后来才弄明白了，这两个通道是tongweb自带的，一般情况下尽量不要动里面的配置
但是现在控制台已经无法正常使用了，为了恢复正常，我找到tongweb.xml,修改了以下两个配置（第一个配服务器ip地址，第二个直接输入true即可）
问题解决！

关键字: tongweb7 勾选refer后控制台部分资源加载失败，无法正常使用tongweb控制台（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 146
问题: tongweb7049m1升级到tongweb7049m3，启动 报错：realm can not be null（by jjz+yjm+lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/139408482

---

原因：该版本的tongweb7049m1是由旧版本的tongweb升级到7049m1版本，升级包在升级的时候，没有把对应的tongweb.xml里的默认配置同步到tongweb.xml，导致tongweb.xml 的配置有缺失。
解决思路：
备份好要升级的tongweb目录，然后自行解压一个新的tongweb7049m3，用工具分析m3的tongweb.xml和要升级的m1的tongweb.xml，是不是有缺失的部分，有的话添加到对应的tongweb.xml，然后重新升级，再去启动

关键字: tongweb7049m1升级到tongweb7049m3，启动 报错：realm can not be null（by jjz+yjm+lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 147
问题: tongweb7049上传报：Caused by_ com.tongweb.web.util.http.fileupload.FileCountLimitExceededException（lqw

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/155054835

---

问题描述
客户使用tongweb7049部署应用后，应用上传文件 formData 参数超过10 个, 会报错,：Caused by: com.tongweb.web.util.http.fileupload.FileCountLimitExceededException
问题分析
经查看，tongweb的lib下的jar有以下代码：
也就是说maxPartCount，默认限制就是10个。
解决方案
虽然代码里默认限制是10个，但可以通过控制台的http通道里添加配置maxPartCount，将maxPartCount改大，如下图所示：

关键字: tongweb7049上传报：Caused by_ com.tongweb.web.util.http.fileupload.FileCountLimitExceededException（lqw
文档来源: 
--------------------------------------------------------------------------------

问题编号: 148
问题: tongweb7之系统字体如何映射到应用中

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/146341023

---

tongweb7之系统字体如何映射到应用中
解决：
1.将准备好的字体存放到服务器上，默认在两个位置：/usr/share/fonts（针对所有用户）或者~/.fonts（针对当前用户）
2.服务重启后会加载系统字体

关键字: tongweb7之系统字体如何映射到应用中
文档来源: 
--------------------------------------------------------------------------------

问题编号: 149
问题: tongweb7控制台无法访问

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/146342881

---

tongweb7控制台无法访问
排查
1.首先确认版本，如果版本是轻量级版本，轻量版不支持会话(session)的备份和复制、管理控制台、APM 运维工具等企业级增量功能。
2.查看端口
命令：ss -tnlp 或者netstat -tnlp  确认控制台端口是否开启
3.在conf下面查看tongweb-xml查看web-app下其是否存在console应用，查看其应用上下文前缀，另外也关注下其绑定的虚拟主机和端口，以及是否启动，如下图所示，主机和端口一般不做更改。

关键字: tongweb7控制台无法访问
文档来源: 
--------------------------------------------------------------------------------

问题编号: 150
问题: tongweb7部署应用后应用卡顿的参考思路（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/136687564

---

文章目录
1.优化jvm和openfile相关参数
2.排除网络延迟（仅供参考）
3 查看服务器资源的使用情况
3.1查看方式
3.1.1cpu占用过高
方法1：使用脚本show-busy-java-threads.sh进行分析
方法2：使用jstack
3.1.2内存占用过高
3.1.1线程阻塞
3 数据源原因
4.应用代码层面
5.查看并杀掉僵尸进程（仅供参考）
1.优化jvm和openfile相关参数
上图是控制台的jvm参数的配置位置，在这里请确保至少2048m（这里配的是xmx和xms参数）。
Openfile（专用机的话请无视这一步）：在服务器上的命令行工具输入：`ulimit -a`
建议调整为65535，可通过vi /etc/security/limits.conf，添加以下两行：
`soft nofile 65535`
`hard nofile 65535`
修改完后通过linux系统命令ulimit a查看open files值生效后重启 TongWeb
2.排除网络延迟（仅供参考）
可访问服务器ip的电脑上cmd然后ping 域名或者服务器ip：
可访问服务器ip的电脑上cmd ，tarcert 域名或者服务器ip
如果应用本身有其他服务器或者ip交互的配置（例如应用a在服务器a上部署，配置的是b服务器上的数据库或者其他中间件）,可以尝试使用traceroute 域名或者服务器ip，看看响应时间是否超时或者过长：
3 查看服务器资源的使用情况
3.1查看方式
可以在tongweb的控制台查看
重点关注以下内容：
1.内存使用率和cpu使用率
2.使用中堆内存和下面的线程相关的参数，或者在服务器命令行页面执行:`top`，然后执行：`1`
最后执行：`c`。相当于执行了一次top命令，展示当前系统的资源使用情况。之后根据查看的结果，主要有以下几种情况：cpu占用过高，内存占用过高，线程阻塞。
3.1.1cpu占用过高
方法1：使用脚本show-busy-java-threads.sh进行分析
以下是脚本的内容，可以自己建一个sh脚本，将内容复制粘贴进去，然后改名为show-busy-java-threads.sh（使用前提：服务器已配置jdk环境变量，支持例如jmap和jstack指令）
> **工具说明**：该脚本用于快速找出 Java 进程中消耗 CPU 最高的线程，并打印其堆栈信息（jstack），直接定位到耗时的代码行。
> **脚本```bash
#!/bin/bash
# Find out the highest cpu consumed threads of java processes, and print the stack of these threads.

readonly PROG="`basename $0`"
readonly -a COMMAND_LINE=("$0" "$@")
readonly USER="`whoami`"

# util functions
readonly ec=$'\033'
readonly eend=$'\033[0m'

colorEcho() {
    local color=$1; shift
    [ -t 1 ] && echo "$ec[1;${color}m$@$eend" || echo "$@"
}

colorPrint() {
    local color=$1; shift
    colorEcho "$color" "$@"
    [ -n "$append_file" -a -w "$append_file" ] && echo "$@" >> "$append_file"
    [ -n "$store_dir" -a -w "$store_dir" ] && echo "$@" >> "${store_file_prefix}$PROG"
}

normalPrint() {
    echo "$@"
    [ -n "$append_file" -a -w "$append_file" ] && echo "$@" >> "$append_file"
    [ -n "$store_dir" -a -w "$store_dir" ] && echo "$@" >> "${store_file_prefix}$PROG"
}

redPrint() { colorPrint 31 "$@"; }
greenPrint() { colorPrint 32 "$@"; }
yellowPrint() { colorPrint 33 "$@"; }
bluePrint() { colorPrint 36 "$@"; }
die() { redPrint "Error: $@"; exit 1; }

logAndRun() { echo "$@"; echo; "$@"; }
logAndCat() { echo "$@"; echo; cat; }

usage() {
    local -r exit_code="$1"
    shift
    [ -n "$exit_code" -a "$exit_code" != 0 ] && local -r out=/dev/stderr || local -r out=/dev/stdout
    cat <<EOF >$out
Usage: ${PROG} [OPTION]... [delay [count]]
Example:
  ${PROG}       # show busy java threads info
  ${PROG} 1     # update every 1 second
  ${PROG} -c 10 # show top 10 busy threads
EOF
    exit $exit_code
}

# Check OS support
uname | grep '^Linux' -q || die "$PROG only support Linux!"

# Parse options
ARGS=`getopt -n "$PROG" -a -o p:c:a:s:S:Pd:Fmlh -l count:,pid:,append-file:,jstack-path:,store-dir:,use-ps,top-delay:,force,mix-native-frames,lock-info,help -- "$@"`
[ $? -ne 0 ] && { echo; usage 1; }
eval set -- "${ARGS}"

while true; do
    case "$1" in
        -c|--count) count="$2"; shift 2 ;;
        -p|--pid) pid="$2"; shift 2 ;;
        -a|--append-file) append_file="$2"; shift 2 ;;
        -s|--jstack-path) jstack_path="$2"; shift 2 ;;
        -S|--store-dir) store_dir="$2"; shift 2 ;;
        -P|--use-ps) use_ps=true; shift ;;
        -d|--top-delay) top_delay="$2"; shift 2 ;;
        -F|--force) force=-F; shift ;;
        -m|--mix-native-frames) mix_native_frames=-m; shift ;;
        -l|--lock-info) more_lock_info=-l; shift ;;
        -h|--help) usage ;;
        --) shift; break ;;
    esac
done

count=${count:-5}
update_delay=${1:-0}
[ -z "$1" ] && update_count=1 || update_count=${2:-0}
top_delay=${top_delay:-0.5}
use_ps=${use_ps:-false}

# Check jstack path
if [ -n "$jstack_path" ]; then
    [ -x "$jstack_path" ] || die "$jstack_path is NOT executable!"
elif which jstack &> /dev/null; then
    jstack_path="`which jstack`"
else
    [ -x "$JAVA_HOME/bin/jstack" ] && jstack_path="$JAVA_HOME/bin/jstack" || die "jstack not found!"
fi

# Biz Logic
readonly run_timestamp="`date "+%Y-%m-%d_%H:%M:%S.%N"`"
readonly uuid="${PROG}_${run_timestamp}_${RANDOM}_$$"
readonly tmp_store_dir="/tmp/${uuid}"
mkdir -p "$tmp_store_dir"

if [ -n "$store_dir" ]; then
    readonly store_file_prefix="$store_dir/${run_timestamp}_"
else
    readonly store_file_prefix="$tmp_store_dir/${run_timestamp}_"
fi

trap "rm -rf $tmp_store_dir" EXIT

findBusyJavaThreadsByPs() {
    local -a ps_cmd_line=(ps ${pid:+-p $pid} ${pid:- -C java -C jsvc} -wwLo pid,lwp,pcpu,user --sort -pcpu --no-headers)
    ps "${ps_cmd_line[@]}" | head -n "${count}"
}

findBusyJavaThreadsByTop() {
    local -a top_cmd_line=(top -H -b -d $top_delay -n 2)
    HOME="$tmp_store_dir" top -H -b -d $top_delay -n 2 | awk -v count="$count" '
    BEGIN { blockIndex = 0; lineCount = 0; }
    /top - / { blockIndex++; }
    blockIndex == 2 && ($NF == "java" || $NF == "jsvc") {
        if(lineCount < count) { print $1, $9; lineCount++; }
    }' | while read line_top; do
        local tid=$(echo $line_top | awk '{print $1}')
        local pcpu=$(echo $line_top | awk '{print $2}')
        ps -wwLo pid,lwp,user -p ${pid:-$(pgrep -d, -u $USER java)} --no-headers | awk -v tid="$tid" -v pcpu="$pcpu" '$2==tid {printf "%s %s %s %s\n", $1, tid, pcpu, $3}'
    done
}

printStackOfThreads() {
    while read line_info; do
        local pid=$(echo $line_info | awk '{print $1}')
        local tid=$(echo $line_info | awk '{print $2}')
        local tid0x="0x`printf %x $tid`"
        local pcpu=$(echo $line_info | awk '{print $3}')
        local user=$(echo $line_info | awk '{print $4}')

        bluePrint "Busy ($pcpu%) thread ($tid/$tid0x) stack of java process ($pid) under user ($user):"

        local jstackFile="${tmp_store_dir}/jstack_${pid}"
        if [ "$user" == "$USER" ]; then
            "$jstack_path" $force $mix_native_frames $more_lock_info $pid > "$jstackFile"
        else
            sudo -u "$user" "$jstack_path" $force $mix_native_frames $more_lock_info $pid > "$jstackFile"
        fi

        if [ -n "$mix_native_frames" ]; then
            sed -n "/$tid/,/^--/p" "$jstackFile"
        else
            sed -n "/nid=$tid0x/,/^$/p" "$jstackFile"
        fi
        echo
    done
}

main() {
    for (( i = 0; update_count <= 0 || i < update_count; ++i )); do
        (( i > 0 )) && sleep "$update_delay"
        if $use_ps; then findBusyJavaThreadsByPs; else findBusyJavaThreadsByTop; fi | printStackOfThreads
    done
}

main
```
这个指令会将查出来的结果输出位xx.txt文件输出到opt目录下，方便后面追踪。主要看 Busy里的占比，看看有没有占比比较高的，以及busy里较高的日志信息，有没有相关提示，详细可参考：
how-busy-java-threads脚本初体验，快速排查Java的CPU性能问题
方法2：使用jstack
参考：
记一次java程序CPU占用过高问题排查大致思路：top查一下系统资源占用情况，找出pid
或者也可以跟之前一样，通过监听9060端口和jps指令确认tongweb进程，拿到tongweb的pid
通过这个指令看一下占用和tid：`ps-mp pid -o THREAD,tid,time`找到tid后，通过指令得到16位进制的数字（方便之后使用）`printf“%x\n” tid`之后拿找到的pid和tid转换过来的数字，进行精确定位（红色框第一个是pid，第二个是tid转换过来的数字）：`jstack pid|grep`。tid转换的十六位进制数字，其中显示出了较为详细的代码信息。另外为了方便追踪，也可以执行：`jstack pid | grep`tid转换的数字
上面显示的内容会存入到jstack.txt里面，然后把这个文件交给开发，让开发来排查一下是否是应用代码层面的问题。
3.1.2内存占用过高
这种现象通常是TongWeb控制台和应用访部都很慢，日志中有“OutOfMemoryError：Java heap space”，就跟前面说的“死”一样，但进程还在。通过查看bin下gc.log日志，或通过jstat
命令，查看内存是否占满，Full GC是否频繁。首先，请参考tw7配置gc日志和阈值可执行`jstat ­gcutil 进程号 2000 20`当确认内存满了，执行以下操作：
(1) 要求出现OutOfMemoryError：Java heap space时不要重启Java进程，保留进程继续执行如
下操作。
(2) 利用JDK的jps –v命令查出Java的进程号（或者查看一下tongwbe的进程id）。
(3) 通过jmap –histo > mem.txt 打出文本日志，生成过程很快，文件很小。
(4) 采用jmap生成完整的内存镜像文件
`jmap -dump: format= b,file=/opt/heap.hprof<PID>` 或
`jmap ­dump:live,format = b,file=heap.bin<PID>`
在当前执行命令目录下生成，如果内存设为2G，则生成的内存镜像文件也有2G。
(5) 生成的mem.txt文件可以用文本工具打开直接看，内存镜像文件可以用MemoryAnalyzer内
存分析工具分析。下载地址如： http://www.eclipse.org/mat。 分析这些文件需要用大内存机
器才行，建议用64位windows机器，安装64位MemoryAnalyzer软件，物理内存至少为内存镜
像文件的3倍。
MemoryAnalyzer使用指引参考：
【JVM】日志分析工具一Memory Analyzer Mat介绍和使用
tongweb生成hprof文件并结合Memory Analyzer Mat分析内存溢出
3.1.1线程阻塞
这种现象通常表现为CPU使用不高，TongWeb控制台访问正常，但应用所有页面访问都慢，这种情况通常是应用的http线程池出现阻塞导致的。
出现这种问题时可使用JDK的jstack命令打出线程栈来分析。 如：jstack <java进程id> > log.txt， 输出到指定文件。
重点看：
1.是不是BLOCKED线程很多，这些线程是不是lock在同一地址上， 偶尔几个BLOCKED线程对系统不影响。
如果多次出现这种提示，最好将打印出的文件发给开发来进行排查。
2.有时不一定是BLOCKED，表现为控制台日志一直没有实时滚动，看控制台的线程使用率已满，但是jstack日志信息里没有BLOCKED。
查看jstack日志，有多个 TIMED WAITING (parking)的话，可以看看里面是否有例如数据源相关的代码（ctrl+f搜关键字看看多不多），每段线程下的描述都可以提取关键字进行搜索然后分析：
3 数据源原因
这种现象通常表现为CPU使用不高，TongWeb控制台访问正常，但应用跟数据库无关的页面访问正常，跟数据库有关的页面访问慢。这种分种情况：
(1). 数据源连接池占满，TongWeb的server.log中可以看到数据源占满的日志(开源和
TongWeb数据源都会有)，通过jstack可以看到线程阻塞在数据源上。可能是连接数过小引起的，若加大后还出现就有可能是存在连接泄露问题了，找应用代码泄露的地方改掉。 改不了应用代码就把“泄漏超时”“泄漏回收”同时设置上，这样到达超时时间后，强制回收数据库连接。开源连接池也有这参数。
(2).查看慢sql日志，优化慢sql语句。
4.应用代码层面
1.可记录下应用卡顿的场景，看看应用对应场景的代码，是否设置超时时间（设置过长的超时时间，或者没有设置超时时间，都有可能导致卡顿甚至没有响应）。
2.应用代码里有System.exit(0)代码（找出应用代码用System.exit的地方并删掉，或者启动参数加入­-Djava.security.manager）。
3.使用jstack指令（前面章节有介绍）进行排查。
4.查看日志，例如tongweb的安装目录的logs目录下的日志文件（例如：server.log）。
5.看看应用是否存在重复的类，冲突的jar包和代码。
5.查看并杀掉僵尸进程（仅供参考）
参考：
【Linux】如何杀掉defunct进程-僵尸进程

关键字: tongweb7部署应用后应用卡顿的参考思路（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 151
问题: tongweb信创项目线上业务添堵问题排查

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/146290657

---

1. 介绍
老项目迁移到TongWeb服务内，另外还需要接入其他的新服务与功能。
TongWeb 是一款国产的应用服务器软件，TongWeb 由东方通科技股份有限公司研发，旨在为企业级应用提供可靠、高效且安全的运行环境，能够承载和支撑各类 Java EE 等相关应用的部署、运行与管理。

2. 生产上状况
TongWeb: 专用机版本
jvm堆:16G;卡顿时大概使用10G多
国产CPU：64核使用率大概74%
线程池:最少50，最高1500/400/200都试过，都可以复现;
http通道:io模式:nio2/nio都可以复现;
用户数:高峰时间，大概300多人:
监控信息看:线程池线程已使用完，使用率100%，感觉是线程不释放。
重启tongweb可以解决卡顿;每天大概8点多可以均可以复现，偶尔不复现

3. 猜想
业务堵塞，导致tongWeb的线程资源耗尽 ，说白了执行业务任务耗时，高峰时期尤为明显
CPU偏高：CPU冲高问题，由于某些代码不考性能，并发一高特别容易出现CPU资源不够，又进一步拖累业务。

4. 排查思路
请注意以下操作一定要在业务堵塞高峰时期执行，请提前写好shell
(1) 第一步 排除系统上其他进程，系统资源，磁盘IO等干扰
    查看其他进程的CPU，内存，磁盘IO（特别是交换分区），网络IO,命令：top ,free,iostat 等
(2) 第二步 网络抓包使用tcpdump抓取pcap包tcpdump -i any tcp port 端口
    可以明显看到TCP的零窗口堵塞非常之多，是否服务器返回数据字节数偏多，是前端、还是后端，如下图所示，明显该服务不是前后端分离。
    注意，请求到服务返回将近3秒。请一定结合网卡的吞吐量来排查确定问题。如果要求高并发，优化点之一重置连接数也如此之多，更加说明业务被堵塞了
(3) 第三步 使用命令netstat抓取tcp链接的详情`netstat -nat | grep -i “tcp” | grep -i  “:端口” > tcp.txt`可以看到redis连接数惊人，可想而知写代码的人， redis相关业务代码一定存在什么问题。业务服务请求的连接数大概470 正常。
(4) 第四步 打印GC日志
    猜测使用G1算法 整体看下正常。但是GC线程数过大浪费资源。设计GC参数设置不合理这里不过多展开。
(5) 第五步 dump文件，以及jstack打印线程堆栈分析
    内存使用没有多大问题，存在内存泄漏风险几乎可以排除

5. 首先分析TongWeb线程
查看大多数线程堆栈线程日志都调用这几个方法，结合业务代码发现在这里，堵塞主要原因，（由于安全没法截取源码代码演示大家看）
业务逻辑代码逻辑bug漏洞
那CPU问题呢？继续查看堆栈线程日志
经典的Apache BeanUtils 拷贝对象性能问题
BeanUtils.copyProperties 方法虽然方便，但在性能上并不理想。它使用反射来获取和设置属性，而反射操作是比较慢的。
当需要大量复制对象时，性能影响会变得更加显著
BeanUtils 默认允许对所有属性进行读写，这可能导致意外地修改不应该被修改的字段
如果你的对象中有敏感数据，直接使用 BeanUtils 复制可能会导致数据泄露。
使用 BeanUtils 时，异常处理通常较为粗糙
sleep持有cpu的资源不释放。
redis可能得大key问题，至于内存碎片化要去服务器排查
JDK原生序列化问题
1、无法跨语言
这一缺点几乎是致命伤害，对于跨进程的服务调用，通常都需要考虑到不同语言的相互调用时候的兼容性，而这一点对于jdk序列化操作来说却无法做到。这是因为jdk序列化操作时是使用了java语言内部的私有协议，在对其他语言进行反序列化的时候会有严重的阻碍。
2、序列化之后的码流过大
jdk进行序列化编码之后产生的字节数组过大，占用的存储内存空间也较高，这就导致了相应的流在网络传输的时候带宽占用较高，性能相比较为低下的情况
各种序列化技术性能对比
第五步 打印threaID的cpu高于阈值并打印堆栈线程日志
由于安全问题，朋友告诉甲方不允许执行该脚本。（请注意top -Hp 方式排查cpu高的问题，有时候线程一闪而过导致手动铺抓比较难，故使用脚本比较好），具体详情请参考
添加链接描述
推荐脚本编写

```bash
#!/bin/bash

# 由crontab触发每分钟执行一次，判断CPU使用率大于阈值时触发dump
# 使用方式：
# 把当前文件放到项目中与start.sh相同的目录
# 修改start.sh 在脚本最后加一行，一般是这一行后边 echo "$APP_NAME is up runnig :)"
# echo "* * * * * sh /export/App/bin/cpu-peak-dump.sh" | crontab -
# 可配置项:
# 触发dump的cpu阈值。default 70
# STACK_DUMP_CPU_THRESHOLD=xxx
# 触发dump时列举的线程数（按使用率由高到低排列) default 10
# STACK_DUMP_THREAD_COUNT=xxx
# 配置方式，使用行云分组的环境变量配置即可
# stack log 存放目录 /export/Logs/
# stack log 文件名: jstack_snapshot_$(date +%Y%m%d%H%M%S).log
# 最后，记得配置相应的日志清理策略
# 设置CPU阈值，当CPU使用率达到该阈值时触发线程快照

CPU_THRESHOLD="${STACK_DUMP_CPU_THRESHOLD:-100}"
THREAD_COUNT="${STACK_DUMP_THREAD_COUNT:-30}"

echo "Current CPU_THRESHOLD is $CPU_THRESHOLD"

JAVA_PID=$(pgrep -d, -x java)
echo "Current JAVA_PID is $JAVA_PID"

# 使用top命令获取当前CPU使用率，并提取其中的CPU利用率百分比
CPU_USAGE=$(top -b -n 1 | grep -A10 "PID USER" | grep java | grep "$JAVA_PID" | awk '{print $9}' | cut -d'.' -f1)

echo "Current Java($JAVA_PID) CPU_USAGE ：$CPU_USAGE"%

if [ -z "$JAVA_PID" ]; then
  echo "No Java process found."
  exit 1
fi

# 检查CPU使用率是否超过阈值
if [[ $CPU_USAGE -gt $CPU_THRESHOLD ]]; then

  # 使用top命令查找占用CPU最高的前十个线程，并获取它们的信息
  TOP_THREADS=$(top -H -b -n 1 -p "$JAVA_PID" | grep -A$THREAD_COUNT 'PID USER' | head -n $THREAD_COUNT | grep -v 'PID')

  # 使用jstack捕捉JVM线程快照
  # 请将下面的Java进程ID替换为你要监视的Java进程的实际进程ID
  JSTACK_OUTPUT=$(/export/servers/jdk1.8.0_191/bin/jstack "$JAVA_PID")

  JSTACK_OUTPUT_FILE="/export/Logs/jstack_snapshot_$(date +%Y%m%d%H%M%S).log"
  echo "当前JAVA进程ID($JAVA_PID)CPU使用率:$CPU_USAGE"% >>$JSTACK_OUTPUT_FILE

  # 获取占用CPU最高的前十个线程的信息，包括线程的PID和堆栈信息，并将它们合并到同一行输出
  echo "Top ${THREAD_COUNT} CPU占用线程信息：" >>$JSTACK_OUTPUT_FILE
  while read -r THREAD_INFO; do
    THREAD_TID=$(echo "$THREAD_INFO" | awk '{print $1}')
    THREAD_NID=$(printf "%x\n" $THREAD_TID)

    THREAD_STACK=$(echo "$JSTACK_OUTPUT" | sed -n "/nid=0x$THREAD_NID /,/^$/p")
    THREAD_CPU_USAGE=$(echo "$THREAD_INFO" | awk '{print $9}')

    echo "=======================================================" >>$JSTACK_OUTPUT_FILE
    echo "线程TID: $THREAD_TID, THREAD_NID:$THREAD_NID, CPU使用率: $THREAD_CPU_USAGE%" >>$JSTACK_OUTPUT_FILE
    echo "$THREAD_STACK" >>$JSTACK_OUTPUT_FILE
  done <<<"$TOP_THREADS"

  #  echo "====all stack as below:====" >>$JSTACK_OUTPUT_FILE
  #  echo "$JSTACK_OUTPUT" >>$JSTACK_OUTPUT_FILE
  echo "捕捉了JVM线程快照并保存到 $JSTACK_OUTPUT_FILE"
fi
```

关键字: tongweb信创项目线上业务添堵问题排查
文档来源: 
--------------------------------------------------------------------------------

问题编号: 152
问题: tongweb安全整改（by cz）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143994838

---

一 禁止以root账号运行tongweb服务
1 如果是首次安装须创建普通用户安装tongweb
2 如果已经使用root账号安装了tongweb
2.1 创建普通用户
2.2 使用root账号授予tongweb安装目录宿主权限为普通用户
2.3赋权成功后，后续启动tongweb服务必须为普通用户
二 tongRDS隐藏FLUSHALL、SHUTDOVN、CONFIC、FLUSHDE等危险命令
1 进入tongRDS安装目录pmemdb/etc找到cfg.xml配置文件
2 编辑cfg.xml文件，添加或修改以下配置
如下图所示：
<
DangerousCommandFilter
>
true
<
/DangerousCommandFilter
>
<
DangerousCommands
>
flushall，shutdown,config,flushdb
<
/DangerousCommands
>
3.保存修改后的配置文件，并重启TongRDS服务以使配置生效。
三 配置tongweb控制台访问白名单
3.1 登录tongweb控制台进入WEB容器配置>虚拟主机管理 选择需要配置的虚拟机
3.2 点击进入虚拟机管理开启远程过滤，可以配置允许的IP地址也可以配置禁止的IP地址，用或者||配置多个IP，也可以使用通配符的正则表达式表示 168.1.103.0 到 168.1.103.99 的远程
地址：168.1.103.([0-9]|[1-9][0-9])（“.”为“.”的转义字符，“|”
为“或”选择符）用逗号分隔一个正则表达式。
四 配置tongwb错误页重定向，（指定错误页的绝对路径），（指定错误号），（指定错误原因）
4.1在应用 WEB-INF/web.xml 中增加如下信息和相应页面。
若访问的 URL 地址非应用前缀，同样会导致 404 错误，这样 web.xml 中的错误页起不到作用。可编写一个 web 应用，里面只含有 404 错误 html 页面和 web.xml 中相应描述，部署TongWeb 上，“应用前缀”设为/，则所有错误请求都会被拦截
五 开启tongweb访问日志
5.1 登录tongweb控制台进入WEB容器配置>虚拟主机管理 选择需要配置的虚拟机
5.2 点击开启访问日志
5.3 开启后会在tongweb/logs/access的目录下生成访问日志文件，记录了客户端访间的本机IP、访问时间、访问的资源、请求使用的协议以及返回的状态码等内容，著发现有攻击现象可以打开访问日志，通过分析访问日志可以知道哪此IP访问了系统资源
六 配置tongweb安全证书支持https协议安全访问
6.1 登录tongweb控制台进入WEB容器配置>HTTP通道管理 选择需要配置的http通道
6.2 选择http通道类型为https
6.2 下拉到ssl属性，填写正确的证书类型，证书存放路径和证书密码点击保存配置完成

关键字: tongweb安全整改（by cz）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 153
问题: tongweb新建节点的时候提示节点无法启动，日志提示：Unable to access jarfile（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/135203560

---

tongweb在新建节点之后，提示节点无法启动，以下是节点配置和日志信息：
后来我cd到安装目录，发现安装目录只有一个zip格式包，于是安装了unzip，安装后再重新新建节点，问题解决！
原因：linux没有安装unzip，导致新建节点的时候，无法解压zip包。

关键字: tongweb新建节点的时候提示节点无法启动，日志提示：Unable to access jarfile（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 154
问题: tongweb生成hprof文件并结合Memory Analyzer Mat分析内存溢出（by lqw）

解决方法:
## 1. 什么是堆

JVM中的堆（Heap）是Java虚拟机管理的内存中的一部分，它用于存储所有的Java对象实例。堆内存被所有线程共享，其目的是为了存放对象实例和数组。

堆的大小在JVM启动时就已经设定好了，大家可以通过选项 "-Xmx" 和 "-Xms"来进行设置。"-Xms" 用于表示堆区的起始内存，等价于 -xx:InitialHeapSize。"-Xmx" 用于表示堆区的最大内存，等价于 -xx:MaxHeapSize。一旦堆区中的内存大小超过"-xmx"所制定的最大内存时，将会抛出outofMemoryError异常。

通常会将-Xms 和 -Xmx两个参数配置相同的值，其目的是为了能够在Java垃圾回收机制清理完堆区后不需要重新分隔计算堆区的大小，从而提高性能。默认情况下：初始内存大小：物理电脑内存大小/64，最大内存大小：物理电脑内存大小/4。

## 2. 什么是年轻代和老年代

堆内存按照对象的生命周期进行划分为几个区域：

**年轻代（Young Generation）**：新创建的对象首先被分配在年轻代。年轻代包含Eden区以及两个幸存区（Survivor spaces，通常简称S0和S1）。

**老年代（Old Generation）**：对象在年轻代中存活了一定的垃圾收集循环后，如果还没有被回收，那么会被移动到老年代。老年代的大小通常远大于年轻代，并且垃圾回收在老年代中发生的频率较低。

**永久代/元数据空间（Metaspace）**：JDK 8开始使用元数据空间代替了永久代，这部分用于存储类的元数据信息。它位于堆外内存（native memory）。

堆的大小和垃圾收集的方式直接影响了Java程序的性能。垃圾收集器会自动管理堆内存，回收不再使用的对象所占用的空间，从而避免内存泄露。通过使用jstat命令，开发者可以监控并调整堆的大小和监控垃圾收集的性能，以优化Java应用的效率。

Java7及之前堆内存在逻辑上分为三部分：新生区 + 养老区 + 永久区。Young Generation Space 新生区 Young/New 又被划分为Eden区和Survivor区，Tenure generation space 养老区 Old/Tenure，Permanent Space 永久区 Perm。

Java 8及之后堆内存逻辑上分为三部分：新生区 + 养老区 + 元空间。Young Generation Space 新生区 Young/New 又被划分为Eden区和Survivor区，Tenure generation space 养老区 Old/Tenure，Meta Space 元空间 Meta。

约定：新生区 -> 新生代 -> 年轻代 、 养老区 -> 老年区 -> 老年代、 永久区 -> 永久代。

## 3. 堆内存区域工作原理

我们创建的对象，一般都是存放在Eden区的，当我们Eden区满了后，就会触发GC操作，一般被称为YGC/Minor GC操作。当我们进行一次垃圾收集后，红色的将会被回收，而绿色的还会被占用着，存放在S0(Survivor From)区。同时我们给每个对象设置了一个年龄计数器，一次回收后就是1。

同时Eden区继续存放对象，当Eden区再次存满的时候，又会触发一个MinorGC操作，此时GC将会把 Eden和Survivor From中的对象 进行一次收集，把存活的对象放到 Survivor To区，同时让年龄 + 1。

我们继续不断的进行对象生成 和 垃圾回收，当Survivor中的对象的年龄达到15的时候，将会触发一次 Promotion晋升的操作，也就是将年轻代中的对象 晋升到 老年代中。

## 4. 为什么会发生OOM

我们都知道，JVM的调优的一个环节，也就是垃圾收集，我们需要尽量的避免垃圾回收，因为在垃圾回收的过程中， 容易出现STW的问题。而Major GC和Full GC出现STW的时间，是Minor GC的10倍以上。

JVM在进行GC时，并非每次都对上面是哪个内存区域一起回收的，大部分时候回收的都是新生代。针对Hotspot VM的实现，它里面的GC按照回收区域又分为两大种类型：一种是部分收集（Partial GC），一种是整堆收集（FullGC）。

**部分收集**：不是完整收集整个Java堆的垃圾收集。其中又分为：
- 新生代收集（MinorGC/YoungGC）: 只是新生代的垃圾收集。
- 老年代收集（MajorGC/OldGC）: 只是老年代的垃圾收集。目前，CMsGC会有单独收集老年代的行为。
- 混合收集（MixedGC）：收集整个新生代以及部分老年代的垃圾收集。目前，只有G1 GC 会有这种行为。

**整堆收集**（FullGC）: 收集整个java堆和方法区的垃圾收集。

触发Full GC执行的情况有如下五种：
1. 调用System.gc（）时，系统建议执行FullGC，但是不必然执行。
2. 老年代空间不足
3. 通过Minor GC后进入老年代的平均大小大于老年代的可用内存。
4. 由Eden区，survivor space0（Form Space）区向survivor space1（To Space）区复制时，对象大小大于To Space可用内存，则把该对象转存到老年代，且老年代的可用内存大于该对象大小。
5. 说明：Full GC是开发或调优中尽量要避免的。这样暂时时间会短一些。

触发OOM的时候，一定是进行了一次Full GC，因为只有在老年代空间不足时候，才会爆出OOM异常。

## 5. 测试代码案例

```java
/**
 * GC测试
 */
public class GCTest {
    public static void main(String[] args) {
        int i = 0;
        try {
            List<String> list = new ArrayList<>();
            String a = "mogu blog";
            while (true) {
                list.add(a);
                a = a + a;
                i++;
            }
        } catch (Exception e) {
            e.getStackTrace();
        }
    }
}
```

设置JVM启动参数：-Xms10m -Xmx10m -XX:+PrintGCDetails

打印出日志：
```
[GC (Allocation Failure) [PSYoungGen: 2038K->500K(2560K)] 2038K->797K(9728K), 0.3532002 secs] [Times: user=0.01 sys=0.00, real=0.36 secs]
```

第一行里的 `[GC (Allocation Failure) [PSYoungGen: 2038K->500K(2560K)]` 指出发生了一次年轻代（Young Generation）的垃圾收集（GC），收集前年轻代占用了2038K，收集后500K，年轻代总共可用空间为2560K。这次垃圾收集是因为分配失败（Allocation Failure）触发的，即JVM尝试分配对象时，没有足够的空间。

`2038K->797K(9728K), 0.3532002 secs]` 表示在这次GC事件中，整个堆从占用2038K减少到了797K，堆的总大小是9728K。垃圾收集过程耗时大约0.353秒。

`[Times: user=0.01 sys=0.00, real=0.36 secs]` 这表示用户时间为0.01秒，系统时间为0秒，而实际经过的墙钟时间为0.36秒。

后续行提供相似的信息，只是具体的数字有所不同，如年轻代和老年代（ParOldGen）的大小、使用情况和GC耗时等。出现 `Full GC (Ergonomics) [PSYoungGen: ...] [ParOldGen: ...]` 指的是进行了一次完整的垃圾收集，涉及到年轻代和老年代，同时优化器（Ergonomics）也在尝试自动调整性能参数。

最末尾的部分 `Heap` 是堆的总结信息，给出了年轻代（PSYoungGen）、老年代（ParOldGen）和元空间（Metaspace）的总大小、使用情况、提交的内存和保留的内存。

最后异常信息 `java.lang.OutOfMemoryError: Java heap space` 表示Java堆空间不足，无法再分配对象，通常是因为长时间运行后所有的可用堆内存都被用完了，这可能是内存泄露或者是堆容量设置过小导致的。相关的堆栈跟踪显示出错发生在 `com.atguigu.java.chapter08.GCTest.main` 函数的第20行。

## 6. 常用JVM相关指令

### jps：查看正在运行的Java进程
jps（Java Process Status）：显示指定系统内所有的HotSpot虚拟机进程（查看虚拟机进程信息），可用于查询正咋运行的虚拟机进程。说明：对于本地虚拟机进程来说，进程的本地虚拟机ID与操作系统进程ID是一致的，是唯一的。

基本使用语法为：`jps [options] [hostid]`

我们还可以通过追加参数，来打印额外的信息。

**options 参数**
- -q：仅仅显示LVMID（local virtual machine id），即本地虚拟机唯一id。不显示主类的名称等。
- -l：输出应用程序主类的全类名 或 如果进程执行的是jar 包，则输出jar完整路径。
- -m：输出虚拟机进程启动时传递给主类 main()的参数。
- -v：列出虚拟机进程启动时的JVM参数。比如： -Xms20m -Xmx50m是启动程序指定的jvm参数。

### jstat：查看 JVM 统计信息
jstat（JVM Statistics Monitoring Tool）：用于监视虚拟机各种运行状态信息的命令行工具。它可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾收集、JIT 编译等运行数据。在没有 GUI 图形界面，只提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具。常用于检测垃圾回收问题以及内存泄漏问题。
官方文档：https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html
基本使用语法为：`jstat - [-t] [-h] [ []]`
查看命令相关参数：`jstat-h` 或 `jstat-help`

其中 vmid 是进程 id 号，也就是 jps 之后看到的前面的号码，如下：一般建议用jps -l，能区分判断到tongweb的相关进程。

关键字: tongweb生成hprof文件并结合Memory Analyzer Mat分析内存溢出（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 155
问题: tongweb迁移工具从tomcat迁移到tongweb下（by liuhui）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/139423498

---

说明：tongweb使用版本7049m3,tomcat版本8.5版本
1,先把a.jar下面的TongWebStarter.class覆盖到tongweb工作目录下tools/TW-toolkit/TW-toolkit.jar
2,把需要迁移的tomcat项目放到webapps目录下启动tomcat解压war包，如下图TC_examples项目
3，进入到tongweb目录下执行（ linux下classpath 是 冒号： 不是分号 ; 间隔jar 。windows下classpath 是 分号; 不是冒号 ： 间隔jar  其中com.tongweb.migration.TongWebStarter  8   /dft/apache-tomcat-8.5.100   /dft/TongWeb7.0.4.9_M3_Enterprise_Linux      三个参数依次为tomcat版本，路径，tongweb版本）如下图
java  -Dhome="/dft/TongWeb7.0.4.9_M3_Enterprise_Linux/tools/TW-toolkit"   -classpath "/dft/TongWeb7.0.4.9_M3_Enterprise_Linux/tools/TW-toolkit/TW-toolkit.jar:/dft/TongWeb7.0.4.9_M3_Enterprise_Linux/lib/bootstrap.jar;/dft/TongWeb7.0.4.9_M3_Enterprise_Linux/lib/tongweb.jar:/dft/TongWeb7.0.4.9_M3_Enterprise_Linux/lib/jdk-api.jar:/dft/TongWeb7.0.4.9_M3_Enterprise_Linux/lib/jdk-impl.jar:/dft/TongWeb7.0.4.9_M3_Enterprise_Linux/lib/activation-api.jar"  com.tongweb.migration.TongWebStarter  8   /dft/apache-tomcat-8.5.100   /dft/TongWeb7.0.4.9_M3_Enterprise_Linux
4，启动tongweb 报错如下
报错原因由于tongweb.xml下出现file
进入到tongweb.xml中修改为大写File,项目启动成功
进行访问控制台以及应用

关键字: tongweb迁移工具从tomcat迁移到tongweb下（by liuhui）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 156
问题: zabbix通过jmx监控Tongweb7企业版（by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/137110803

---

一.tongweb配置相关启动参数
参考
Zabbix 监控 Tomcat 服务
可以在控制台页面，或者在tongweb的安装目录的bin目录下，找到external.vmoptions，进行配置：
配置内容如下：
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.registry.ssl=false
-Dcom.sun.management.jmxremote.port=7201
-Djava.rmi.server.hostname=192.168.10.51
其中7201选用没有占用的端口，hostname填写服务器ip
配置后重启tongweb，然后下载cmdline-jmxclient-0.10.3.jar。
下载后，cd到cmdline-jmxclient-0.10.3.jar所在目录，执行：
java -jar cmdline-jmxclient-0.10.3.jar - 192.168.10.51:7201 java.lang:type=Memory NonHeapMemoryUsage
其中192.168.10.51:7201是在external.vmoptions里配置的ip和端口，一般配置成功的话，执行指令会有以下信息显示：
二.部署安装zabbix
参考
https://www.cnblogs.com/m-zhuang/p/17615179.html#2-%E9%83%A8%E7%BD%B2-zabbix-%E6%9C%8D%E5%8A%A1%E7%AB%AF
（1）安装 Zabbix 源
# 获取 zabbix 的下载源
rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm

# 更换 zabbix.repo 为阿里云
sed -i 's#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo

# 清除yum缓存及创建缓存元数据
yum clean all && yum makecache
（2）安装 Zabbix服务端及mysql、客户端
yum -y install zabbix-server-mysql zabbix-agent

yum install zabbix-server-mysql
（3）安装SCL(Software Collections)，便于后续安装高版本的 php，默认 yum 安装的 php 版本为 5.4，版本过低，zabbix 5.0 版本对 php 版本最低要 7.2.0 版本。SCL 可以使得在同一台机器上使用多个版本的软件，而又不会影响整个系统的依赖环境。软件包会安装在 /opt/rh 目录下。
# 开启安装源
sed -i 's/enabled=0/enabled=1/' /etc/yum.repos.d/zabbix.repo

yum install -y zabbix-web-mysql-scl zabbix-apache-conf-scl
如果有下图的报错：
则根据错误提示，需要安装高版本的php，解决方法是安装 Software Collections，再去安装SCL
# yum install centos-release-scl -y

# yum install zabbix-web-mysql-scl zabbix-apache-conf-scl
（4）安装 zbbix 所需的数据库
yum -y install mariadb-server mariadb
systemctl enable --now mariadb

# 初始化数据数据库,并设置密码，如 123123
mysql_secure_installation
初始话数据库的时候，第一个按回车
第二个输y
输入新密码，这里用的123123，需要输入两次，然后提示成功：
由于是本地测试，剩余的一直输入n
5）添加数据库用户以及 zabbix 所需的数据库信息
# 登录数据库
mysql -u root -p123123

# 创建zabbix数据库并设置编码为utf-8
create database zabbix character set utf8 collate utf8_bin;

# 给用户赋权
grant all on zabbix.* to 'zabbix'@'%' identified by 'zabbix';

CREATE USER 'zabbix'@'localhost' IDENTIFIED BY 'zabbix';
GRANT ALL PRIVILEGES ON zabbix.* TO 'zabbix'@'localhost';


# 刷新
flush privileges;

# 退出数据库界面
\q
6）导入数据库信息（注意查到sql文件路径后要对比和替换掉，不然会报错）
# 查询sql文件的位置
rpm -ql zabbix-server-mysql

# 导入数据库信息
zcat /usr/share/doc/zabbix-server-mysql-5.0.36/create.sql.gz | mysql -u root -p123123 zabbix
（7）修改 zabbix server 配置文件，修改数据库密码
vim /etc/zabbix/zabbix_server.conf
把注释去掉，配成下图所示：
（8）修改 zabbix 的 php 配置文件
# 找到对应的zabbix.conf文件
find / -name "zabbix.conf"
# 修改下述文件
vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf
# 25行，取消注释，修改时区
php_value[date.timezone] = Asia/Shanghai
（9）启动 zabbix 相关服务,然后访问服务器ip/zabbix
systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm
systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm
查看日志
cat /var/log/zabbix/zabbix_server.log
如果有下图的提示，关闭防火墙和修改SELINUX=disabled修改配置文件永久关闭（修改后需要reboot）
setenforce 0 && sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config
另外建议给对应的目录赋权
sudo chown zabbix:zabbix /var/run/zabbix
sudo chmod 755 /var/run/zabbix
直接next
输入zabbix，然后next：
输入名称，其他别动，next
账号：Admin
密码：zabbix
切换中文：
三.部署zabbix_java_getaway和修改相关配置
安装指令：
yum -y install zabbix-java-gateway.x86_64
修改配置：
vim /etc/zabbix/zabbix_java_gateway.conf
检查是否配对zabbix_java的pid（这里用默认的）
第九行放开注释，使用默认配置：
第17行放开注释，使用默认配置：
第三十五行放开注释，使用默认配置（开启的工作线程数量）
修改配置：
vim /etc/zabbix/zabbix_server.conf
JavaGateway这里配成geteway安装的服务器ip，如下图所示：
配上javagatewayPort(建议使用默认的10052)
配StartJavaPollers=5（采集数据的进程数）
执行以下指令启动zabbix-java-gateway.service
systemctl start zabbix-java-gateway.service
systemctl enable zabbix-java-gateway.service
四.导入模版
之后到zabbix的控制台，导入模版（模版是网上找的jvm相关模版，这个有很多，按需自己去百度下载和修改）。
之后找到要配置的主机：
点击配置
添加jmx,配上之前tongweb配的ip和端口：
选择Templates：
选择刚刚导入的模版：
等一两分钟，刷新页面，有jmx标志说明配置成功
到主机页面查看(图里的promblem请无视，是本地应用代码的问题)：

关键字: zabbix通过jmx监控Tongweb7企业版（by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 157
问题: 一台服务器上能装几套TongWeb，一个TongWeb能跑几个应用？

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110293306

---

常问问题：
1. 一台服务器上能不能装多套TongWeb？
2.装多套TongWeb是按几套产品算费用？
3.专用机默认只能装在/opt/TongWeb下，能不能装在别的目录下用？
4.一个TongWeb上能部署多少个应用？
5.一个TongWeb设多大内存最优？
答复：
一台机器上装一套TongWeb即可，一套可建多个domain域，这样多个TongWeb  domain域实例可充分利用机器资源。一个TongWeb  domain域 能运行的应用并不是以应用个数来计算的。
解释：
概念：一套TongWeb：指一个完整TongWeb物理安装位置。
domain域或实例: 指在TongWeb下能过domain.sh create命令建的一个运行实例，除共用lib下库、license授权、console控制台等之外，其它配置文件、日志、脚本为domain域自有文件，domain域之间是相互独立的Java进程，互不影响。
所以：
1. 一套TongWeb可以通过域domain方式新建并启动多个TongWeb实例，各个实例之间独立运行互不影响，没必要安装多套TongWeb。
2 TongWeb的bin目录下的domain.sh为新建、删除domain的命令。startdomain.sh为启动domain的命令。stopdomain.sh为停止domain的命令。
3. 专用机默认装在/opt/TongWeb，但可以通过 ./domain.sh create  /home/tongweb（绝对路径） 命令将domain建在合适的目录下来用。
4. 应用系统按功能区分： 有的一个应用包含成百上千个功能模块，有的应用系统将各个应用模块独立拆分成十几个应用包，应用功能差别很大；   应用系统按用户量区分，有的应用系统用户量几十万，有的应用系统扔在那没人用； 应用系统按程序来区分，有的应用程序互相冲突并不能在一个JVM进程中运行。所以一台机器启多少个TongWeb实例，一个TongWeb能部多少个应用要按以下规则来判断：
(1)  应用之间互相冲突的，不能部在一个TongWeb  domain域上。
(2）应用有内存溢出或占用线程资源多，频繁出问题的放一个TongWeb domain域上运行，别影响其它应用。
(3)  并发访问量大的应用，还要多个TongWeb domain域上部同一个应用组成集群。
(4)   访问量小又不冲突的应用，可以在一个TongWeb  domain域 上部署多个。
(5)  只要服务器的CPU和内存够用，就可以启多个TongWeb实例。
5.  一个domian 域配多大JVM内存为最优？
误区一：-Xmx设置的内存与top命令看到Java进程占用的不一致。
答：Java程序时会把它所管理的内存划分为若干个不同的运行时数据区域，主要包括：程序计数器、方法区、虚拟机栈、本地方法栈和堆。 -Xmx只是设堆内存，所以通过top看到的Java进程占用内存往往比-Xmx值大。
误区二：JVM内存参数-Xms  -Xmx值越大，性能越高。
答：JVM的性能主要取决于GC(垃圾回收)的效率，GC特别是Full GC执行的越快，则JVM的效率越高。 配置多大内存，取决于应用并发量、业务复杂度。
JVM内存优化这块内容较多，具体可参考：
JVM内存优化、垃圾回收、内存分析知识-Web开发文档类资源-CSDN下载

关键字: 一台服务器上能装几套TongWeb，一个TongWeb能跑几个应用？
文档来源: 
--------------------------------------------------------------------------------

问题编号: 158
问题: 一键部署Tongweb7049M6 脚本参考（by lqw+why）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/148847236

---

安装前准备
1.安装包和授权已放上服务器
2.已安装并配置jdk环境（jdk不低于1.8）
3.使用root账号进行安装。
安装说明
本帖提供的是脚本的形式进行安装，需提前将脚本内容copy到deploy_TongWeb.sh,赋权后执行，安装目录在opt下的TongWeb7.0.4.9_M6_Enterprise_Linux，下面是脚本内容：

```bash
#!/bin/bash
# 虚机全自动TongWeb部署脚本
#使用说明：
#文件准备统一在同级目录下：
#/部署目录/
#├── deploy_TongWeb.sh  部署脚本
#├── license.dat      产品授权
#└── TongWeb7.0.4.9_M6_Enterprise_Linux.tar.gz  安装包
#执行权限：chmod +x deploy_TongWeb.sh
#运行部署：sudo ./deploy_TongWeb.sh

#!/bin/bash
# =================================================================
# 虚机全自动 TongWeb 部署脚本
# 运行部署：sudo ./deploy_TongWeb.sh
# =================================================================

# --- 配置信息 ---
TARGET_DIR="/opt"
INSTALL_NAME="TongWeb7.0.4.9_M6_Enterprise_Linux"
CURRENT_DIR=$(cd "$(dirname "$0")"; pwd)
INSTALL_PACKAGE="${CURRENT_DIR}/${INSTALL_NAME}.tar.gz"
LICENSE_FILE="${CURRENT_DIR}/license.dat"
SERVICE_NAME="TongWeb"

# 颜色输出函数
error_echo() { echo -e "\033[31m$1\033[0m"; }
success_echo() { echo -e "\033[32m$1\033[0m"; }

# 1. 环境校验
check_env() {
    [ $(id -u) -eq 0 ] || { error_echo "错误：必须使用 root 权限执行！"; exit 1; }
    [ -f "$INSTALL_PACKAGE" ] || { error_echo "错误：安装包 ${INSTALL_NAME}.tar.gz 不存在！"; exit 1; }
    [ -f "$LICENSE_FILE" ] || { error_echo "错误：授权文件 license.dat 不存在！"; exit 1; }
}

# 2. 安装流程
install_process() {
    # 清理旧版本
    echo "正在清理旧版本..."
    rm -rf "${TARGET_DIR}/${INSTALL_NAME}"

    # 解压安装包
    echo "正在解压安装包至 ${TARGET_DIR}..."
    if ! tar -zxvf "$INSTALL_PACKAGE" -C "$TARGET_DIR" > /dev/null; then
        error_echo "安装包解压失败！"
        exit 1
    fi

    # 部署授权文件
    cp "$LICENSE_FILE" "${TARGET_DIR}/${INSTALL_NAME}/"

    # 安装系统服务 (systemd)
    echo "正在初始化系统服务..."
    cd "${TARGET_DIR}/${INSTALL_NAME}/bin" || exit 1
    chmod +x *.sh
    ./installservice.sh

    # 启动服务
    echo "正在启动服务..."
    nohup ./startservernohup.sh > /dev/null 2>&1 &

    sleep 5
}

# 3. 安装验证
verify_installation() {
    local PID_FILE="${TARGET_DIR}/${INSTALL_NAME}/bin/tongweb.pid"
    local retry=0
    local max_retry=5
    local found_pid=false

    echo "正在等待服务初始化并生成 PID 文件..."
    while [ $retry -lt $max_retry ]; do
        if [ -f "$PID_FILE" ]; then
            local pid=$(cat "$PID_FILE" 2>/dev/null)
            if ps -p "$pid" > /dev/null; then
                success_echo "服务验证通过，进程 PID: $pid"
                found_pid=true
                break
            else
                echo "检测到无效 PID: $pid，清理并重试..."
                rm -f "$PID_FILE"
            fi
        fi
        ((retry++))
        echo "等待中 ($retry/$max_retry)..."
        sleep 5
    done

    if ! $found_pid; then
        error_echo "服务启动异常，请检查日志！"
        error_echo "可能原因：1. JDK未安装 2. 端口占用 3. 授权过期"
        exit 1
    fi
}

# --- 主流程 ---
main() {
    check_env
    install_process
    verify_installation

    echo "------------------------------------------------------"
    success_echo "TongWeb 安装成功！"
    echo "安装目录：${TARGET_DIR}/${INSTALL_NAME}"
    echo "管理控制台：http://服务器IP:9060/console"
    echo "实时日志查询：tail -f ${TARGET_DIR}/${INSTALL_NAME}/logs/server.log"
    echo "------------------------------------------------------"
}

# 执行主流程
main
```

安装后提示如下：
安装同时会生成/etc/systemd/system/tongweb.service，可以安装后重启服务器，测试是否会开机自启动：如果不想用这种形式安装，可以参考：TongWeb7-绿色版安装及启动停止和控制台访问

关键字: 一键部署Tongweb7049M6 脚本参考（by lqw+why）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 159
问题: 使用TongLINK_Q的java接口导致TongWeb崩溃的原因说明

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110296489

---

问题一：TongWeb不能加载jtlq_client动态库
1. 现象描述如下：TongWeb上的应用日志中报错信息：java.lang.UnsatisfiedLinkError: no jtlq_client in java.library.path
2. 原因分析及解决方案：可能windows的path路径下找不到jtlq_client动态库，或在Linux的LIB_LIBRARY_PATH环境变量中找不到jtlq_client动态库，或是java进程启动参数中缺少-Djava.library.path指向该so目录。（对于安装包安装的TLQ，出现此种情况的概率比较小）由于JDK 32位或64位不能与安装的TLQ81的版本相匹配。例如JDK32位的，而TLQ81安装了一个64位的版本。这样也会报上述现象错误。
3. 解决方法：TongWeb使用64位JDK则采用TLQ 64位版本，并配置相应的环境变量。

问题二：TongWeb进程异常退出或数据包错乱
1. 现象描述如下：TongWeb 异常退出，会产生虚拟机的日志文件hs*****.log，内容大概如下：
调用TlqQCU类里putMessage或getMessage方法，调用方法抛出错误信息“receive first packet, head doesn't match(<C,2>, <1,1>)”
2. 原因分析及解决方案：由于使用TlqQCU，TlqConnection里面的方法没有实现串行化，即要对这两个类的所有方法的调用要进行排队。因为TongLINK/Q手册里有说明，这两个类实例的所有方法只能在一个线程里使用。如果多个线程同时使用这两个类同一实例的所有方法的就要对这两个类的所有方法的调用进行加锁，否则就容易造成TongWeb崩溃。在TongWeb这种多线程应用的场景下，该规则已经显的不合时宜，期望TongLINK/Q下一版本进行改进。

关键字: 使用TongLINK_Q的java接口导致TongWeb崩溃的原因说明
文档来源: 
--------------------------------------------------------------------------------

问题编号: 160
问题: 关于TongWeb数据源兼容mysql驱动的注意事项

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/148352220

---

问题现象：
TongWeb数据源在采用mysql驱动的国产数据库时，因数据库慢报超时为数据源配置参数的 validation-query-timeout值5秒，而不是期望的maxwait、connectiontimeout值。
```bash
The last packet successfully received from the server was 5,017 milliseconds ago.  The last packet sent successfully to the server was 5,011 milliseconds ago.
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	........
	at com.tongweb.hulk.pool.ProxyPreparedStatement.executeQuery(ProxyPreparedStatement.java:66)
	at com.tongweb.hulk.pool.HulkProxyPreparedStatement.executeQuery(HulkProxyPreparedStatement.java)
	at com.ruimin.ifs.rql.executor.RqlPreparedExecutor.executeQueryPage(RqlPreparedExecutor.java:118)
	... 23 more
Caused by: java.net.SocketTimeoutException: Read timed out
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
	at java.net.SocketInputStream.read(SocketInputStream.java:171)
	at java.net.SocketInputStream.read(SocketInputStream.java:141)
	```
解释说明：
TongWeb7.0的hulk数据源的连接验证机制是采用validation-query-timeout的值做connection.setNetworkTimeout(Executors, validation-query-timeout) 网络超时校验，而不是执行的SQL， 校验连接完成后会将NetworkTimeout值恢复为原默认值。而mysql驱动在实现setNetworkTimeout方法时是通过异步方式设置的超时时间，所以有可能导致恢复默认值失败。于是TongWeb7.0对mysql做了处理: 若是mysql驱动则不采用setNetworkTimeout方法。
```java
//TongWeb数据源代码判断
private void createNetworkTimeoutExecutor(final DataSource dataSource, final String dsClassName, final String jdbcUrl)
   {
// Temporary hack for MySQL issue: http://bugs.mysql.com/bug.php?id=75615
//源码注释中有对mysql驱动bug的说明。只要class, url里有mysql关键字，则按同步处理。
      if ((dsClassName != null && dsClassName.contains("Mysql")) ||
          (jdbcUrl != null && jdbcUrl.contains("mysql")) ||
          (dataSource != null && dataSource.getClass().getName().contains("Mysql"))) {
         netTimeoutExecutor = new SynchronousExecutor();
      }
```
但是由于基于mysql驱动的国产数据库厂商对driverclass, url做了处理，无mysql关键字，导致TongWeb数据源无法判断，从而引起问题。
解决方法：
先确认国产数据库提供的JDBC驱动是不是基于mysql的。若是的话TongWeb7.0进行以下配置解决：
方式一：在TongWeb数据源的url中增加mysql关键字，如：`jdbc:XXXXXXX://localhost:3306/nbmsdb?virtual mysql=true`
方式二：升级为TongWeb7.0.4.9_M6，增加了对mysql驱动兼容的配置。

关键字: 关于TongWeb数据源兼容mysql驱动的注意事项
文档来源: 
--------------------------------------------------------------------------------

问题编号: 161
问题: 关于jdk17部署tongweb7047出现java.lang.NullPointerException_ Cannot read field “configFactory“（by liuhui）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/136046309

---

问题现象启动报错如下图
Caused by: java.lang.NullPointerException: Cannot read field “configFactory” because “this.assembler” is null]
[2024-02-05 17:55:55 163] [WARNING] [main] [systemout] [        at com.tongweb.tongejb.config.JNDIResourceConfigListener.(JNDIResourceConfigListener.java:30)]
[2024-02-05 17:55:55 163] [WARNING] [main] [systemout] [        at com.tongweb.tongejb.config.EELoader.addJNDIResourceConfigListener(EELoader.java:227)]
问题原因
由于tongweb7047版本跟jdk17不兼容导致
解决办法
更换tongweb版本7.0.8.70版本即可

关键字: 关于jdk17部署tongweb7047出现java.lang.NullPointerException_ Cannot read field “configFactory“（by liuhui）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 162
问题: 关于nacos注册服务端口时获取TongWeb应用端口的方式

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/153312817

---

应用场景：
在使用Spring Boot、Spring Cloud向nacos注册服务端口时，在TongWeb嵌入版、tomcat嵌入版的使用方式如下，通过server.port注册端口。
```java
@Component
public class NacosConfig implements ApplicationRunner {

@Autowired(required = false)
private NacosAutoServiceRegistration registration;

@Value("${server.port}")
Integer port;

@Override
public void run(ApplicationArguments args) {
    if (registration != null && port != null) {
        registration.setPort(port);
        registration.start();
    }
 }
}
```
面临问题：
而由于种种原因将嵌入式应用改造成war应用部署在TongWeb、tomcat上，这里就需要改造注册端口方式。 大部分参考tomcat方式通过JMX Mbean获取http端口，而在TongWeb7.0下此代码虽然也可以通过该方式获取端口，但由于TongWeb7.0默认启动9060、8088、5100三个端口，所以如下代码方式通过Mbean获取的端口不一定为应用端口， 从而导致注册的端口不对。
```java
/**
 * 让外部tomcat中的程序也能向nacos注册
 */
@Configuration
public class NacosConfig implements ApplicationRunner {

    @Autowired(required = false)
    private NacosAutoServiceRegistration registration;

    @Value("${server.port}")
    Integer port;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        if (registration != null && port != null) {
            Integer apport = port;
            try {
                apport = new Integer(getTomcatPort());
                //TongWeb修改方式
                //apport = new Integer(TongWebPort().getPort());
            } catch (Exception e) {
                e.printStackTrace();
            }

            registration.setPort(apport);
            registration.start();
        }
    }
    /**
     * 获取外部tomcat端口
     */
    public String getTomcatPort() throws Exception {
        MBeanServer beanServer = ManagementFactory.getPlatformMBeanServer();
        Set<ObjectName> objectNames = beanServer.queryNames(new ObjectName("*:type=Connector,*"), Query.match(Query.attr("protocol"), Query.value("HTTP/1.1")));
        String port = objectNames.iterator().next().getKeyProperty("port");
        return port;
    }

}
```
解决办法：
TongWeb7.0.4版本可以通过JMX Mbean获取端口号，将getTomcatPort()代码稍微改造如下：
```java
public static String getTongWebPort(){
    MBeanServer beanServer = ManagementFactory.getPlatformMBeanServer();
	        Set<ObjectName> objectNames = beanServer.queryNames(new ObjectName("*:type=Connector,*"), Query.match(Query.attr("name"), Query.value("tong-http-listener")));
	String port = objectNames.iterator().next().getKeyProperty("port");
	return port;
}
```
TongWeb7,8版本可以通过如下方式从配置文件获取应用端口来进行注册。
```java
package com.tong;

import com.tongweb.server.util.ServerUtil;
import com.tongweb.server.util.XmlUtils;
import java.util.List;
import com.tongweb.config.ConfigTool;
import com.tongweb.config.bean.HttpListener;

public class TongWebPort {

	public static String getPort() {

		String log = System.getProperty("java.util.logging.manager");
		if (log != null & log.equals("com.tongweb.log.TongwebLogManager"))
			return TW7port();
		else if (log != null & log.equals("com.tongweb.logger.JulLogManager"))
			return TW8port();
		else
			return "8088";
	}

   /*
    *获取TongWeb7应用端口
    */

	private static String TW7port() {
		String port = null;
		List<HttpListener> httpListeners = ConfigTool.getRoot().getServer().getWebContainer().getHttpListener();
		for (HttpListener httpListener : httpListeners) {
			if (httpListener.getName().equals("tong-http-listener"))
				port = String.valueOf(httpListener.getPort());
		}
		return port;
	}

   /*
    *获取TongWeb8应用端口
    */

	private static String TW8port() {
		String port = null;
		port = XmlUtils.getProperty(ServerUtil.getTwXmlFile(), "//connector[@name='server']").getProperty("port");
		return port;
	}

}
```

关键字: 关于nacos注册服务端口时获取TongWeb应用端口的方式
文档来源: 
--------------------------------------------------------------------------------

问题编号: 163
问题: 启动TongWeb后控制台及应用无法访问

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/111085958

---

启动TongWeb后控制台无法访问该如何处理：
1. 先确认TongWeb已经启动成功，通过JDK的jps –v命令或ps –ef|grep java命令查看TongWeb的进程是否存在，如下：`7044 ThorBootstrap -Xmx512m -XX:MaxPermSize=192m -XX:+UnlockDiagnosticVMOptions -XX:+LogVMOutput`
2. TongWeb日志server.log中已显示启动完成，只有启动成功才能访问控制台。
```bash
#日志中这句话表示启动完成
[INFO] [core] [TongWeb server startup complete in 72757 ms]
```
3. 检查conf/tongweb.xml中的配置，确认控制台和应用使用端口，并通过netstat 命令确认端口已启动。
#TongWeb控制台访问端口，若有ssl-enabled为true说明是https协议。
<http-listener name="system-http-listener" port="9060" ssl-enabled="true"
4.  在浏览器所在机器上通过`ping  <TongWeb机器IP>`和`telnet  <TongWeb机器IP>  9060`
命令测试是否通？ 常见原因：(1).网络不通。(2). 网络通，但端口不通，这通常是防火墙导致端口不通。请确认网络连通，防火墙端口开启。
注：(1)  <TongWeb机器IP>换成实际的IP地址，有人直接复制ping  <TongWeb机器IP>执行。
(2) 有telnet命令则想办法安装。
(3)  在TongWeb本机用火狐浏览器  127.0.0.1地址访问控制台，若可以则说明是网络问题。
5.某些windows系统下，需要把控制台站点加入IE的受信任站点才可以。
低级错误：别在浏览器上输入`http://TongWebIP:9060/console`访问控制台。TongWebIP要换为实际IP，别直接复制粘贴手册中的内容。

关键字: 启动TongWeb后控制台及应用无法访问
文档来源: 
--------------------------------------------------------------------------------

问题编号: 164
问题: 因易用性导致的TongWeb使用误区

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109713734

---

误区一：
使用TongWeb企业版本，即按照《TongWeb7企业版用户手册.pdf》手册操作。
安装好TongWeb后doc目录下有手册
，TongWeb手册的正确观看顺序：
1. 最先看《TongWeb7快速使用手册.pdf》了解基本的安装、使用。
2.再看《TongWeb7用户使用手册.pdf》手册介绍的是单机console控制台。
3.TongWeb企业版本提供console和heimdall两个管理控制台，在试用、移植测试阶段采用console单机控制台即可。在配置集群、统一管理各个TongWeb节点时可用heimdall控制台。
4.《TongWeb7企业版用户手册.pdf》手册介绍的是heimdall控制台。
5. 配TongHttpServer（THS）集群请参看《TongHttpServer用户手册.pdf》。 集群在heimdall控制台配可以，纯手工配置也可以。
误区二：
在Linux下用./startserver.sh启动TongWeb，这样造成当ssh工具断开与Linux的连接后，TongWeb的进程退出。
正确使用方法：通过TongWeb  bin目录下的
./startservernohup.sh或  nohup  ./startserver.sh &
启动TongWeb，这样为后台启动。
误区三：
以nohup启动TongWeb后，bin下的nohup.out文件越来越大。
正确使用方法：在控制台关闭nohup日志输出。
误区四：
问TongWeb内存是如何管理、释放的？
正解：TongWeb是不管理JVM内存的，所有的内存控制是由JVM来管理。TongWeb所能做的是依靠 -Xms 、 -Xmx 、 -Xmn 、 -XX:MaxPermSize 、-XX:+UseConcMarkSweepGC等JVM本身参数，调整其内存大小及垃圾回收策略。JVM 虽然可自动回收内存，但并不代表程序就不用关心内存问题了。如果对象已经无用，但又一直被引用， JVM 是无法将其回收的。 垃圾回收无法清理出内存，导致内存占光，于是 OutOfMemoryError问题产生了。
注意：JVM内存并非越大越好
，很多运维人员在一出现内存问题时就拼命把内存设大，这是解决不了根本问题的，
重要的是看GC，Full GC越少性能越好。
误区五：
TongWeb怎样配置集群、负载均衡？
正解：TongWeb自身不提供负载均衡功能，是由其自带的TongHttpServer(THS)软件来实现的。另外还可以采用东方通硬件负载设备TongADC、开源的 Apache、 nginx、 Haproxy 等配置TongWeb集群。session复制是通过TongDataGrid来完成的，而不是像tomcat+redis方式。
误区六：
把应用包放在deployment下是不是就可以像tomcat 一样自动部署？
正确使用方法：TongWeb是将应用包放在autodeploy目录下，自动解压在deployment目录下的。而不像tomcat是在当前webapps目录下解压。
误区七：
更新应用文件后，在TongWeb控制台点击停止、启动后应用不更新。
正确使用方法：老版本启动、停止只是允不允许访问应用，并不会更新应用，这与weblogic功能不同，TongWeb并不会执行应用卸载，加载的流程。若要更新应用需要点击“重部署”。  自TongWeb7.0.4.5之后版本启动、停止才会真正执行卸载，加载的流程。
误区八：
专用机版本不要修改startserver.sh、stopserver.sh、conf下environment等shell文件，一旦修改就不允许执行了，只能重装TongWeb。若修改启动参数，
只能改bin下external.vmoptions文件。
在专用机下新建的domain的bin目录下启动脚本是没有可执行权限的，需要以TongWeb根目录bin下的
./startdomain.sh 域名
方式启动。
误区九：
TongWeb 的8005端口找不到，控制台找不到，tongweb.xml里也找不到。
正确使用方法：只能直接在tongweb.xml 的<server标签里增加红色信息 <server
shutdown-port="8015"
jsf="false"> ， 默认没有为8005，一般都不知道，是不是一个缺乏人性化的设计？
误区十：
安装时请把TongWeb性能调到最、最、最优 ； TongWeb能支持多大并发、需要几台服务器才能满足需求？
正解：初次安装TongWeb通常调整系统open files值、JVM内存值、线程数、数据源连接配置，做一个基础调优。这些值没有一个固定的最优值，每个应用系统软、硬件环境不同，访问量不同，优化方式就不同。任何软件都不会直接提供一个最优值，但都会提供相应的优化方法，重要的是掌握优化方法。
应用系统的性能取决于软/硬件的配置，硬件如：CPU、内存、网络带宽。软件如：操作系统、中间件、数据库、更重要的是应用系统的架构设计。评估一个应用系统的性能指标取决于软/硬件的综合能力，并不能在无任何前提条件的情况下，评估出TongWeb的需要几台服务器以及并发能力。  TongWeb可以提供一些项目上性能处理能力供参考。
这好比要去买一辆车，不能仅看发动机就判断车速的快、慢。新车也不是一开始就是最好开的，要经过一段时间的磨合期，才能达到最佳性能。
误区十一：
我们够买的TongWeb嵌入版，需要现场安装。
答复： TongWeb嵌入版为jar 文件，不需要安装。 将来是放在Spring Boot的类路径上，跟应用一起打成jar文件以java -jar的形式运行的，所以无需安装，也无需制作专用机安装包。将来也不会知道TongWeb用在了哪里。
误区十二：
应用系统慢、有异常，重启TongWeb就好了，所以是TongWeb的问题。
答复：TongWeb与应用同在一个JVM进程中共享资源，所以出问题重启TongWeb后，TongWeb与应用的资源都会清理掉并重建。 这种方式可以恢复应用，但并不表明为TongWeb问题。 正如当电脑、手机不好用时，可重启机器来解决问题，但并不能确定是哪方软、硬件造成的。
正如下日志： 应用采用开源数据源，数据源连接占满导致应用访问慢，只要重启TongWeb，应用的开源数据源就会清零，系统自然会恢复。还有诸如内存溢出等问题，只要重启TongWeb都可以解决，但并不表示内存溢出是TongWeb造成的。
```java
java.sql.SQLTransientConnectionException: DatebookHikariCP -
Connection is not available, request timed out after 30000ms.
at com.zaxxer.
hikari
.pool.HikariPool.createTimeoutException(HikariPool.java:548)
at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:186)
at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:145)
at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:99)
at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:111)
```
误区十三：
TongWeb7数据源配置里没有我们需要的数据库类型。
答复：数据库类型只是方便后面的“数据库驱动类名”和"连接url"填写，若没有相应的数据库类型，任选一个再改动“数据库驱动类名”和"连接url"即可。 也可在applications\console\WEB-INF\classes\jdbc\data-type-config.xml中手工添加数据库类型。 以前TongWeb5版本是可以在控制台增加数据库类型的。
误区十四：
生产系统出现性能问题需要用TongAPM进行分析
答复：TongAPM只适合在测试环境下使用，因没有持久化功能，所以不能长时间跟踪记录性能日志，重启TongWeb后日志会消失。推荐一个小巧的工具：TProfiler。
误区十五：
TongWeb的共享库路径配置优先级如何？
答复：TongWeb的共享库路径配置有以下几个：
1. ${TongWeb_Base}\lib\endorsed 目录为最高优先级(优先JDK自身类)， 依赖参数：-Djava.endorsed.dirs=${JAVA_ENDORSED_DIRS}
2. ${TongWeb_Base}\lib目录，常用于存放JDBC驱动类，其它共享jar不建议放。
3. ${TongWeb_Base}\lib\classes、${TongWeb_Base}\lib\common、assets.xml对应的控制台共享库，这三处配置的优先级，以及跟war应用，ear应用/APP-INF目录的优先级、父子加载下的优先级，天知道，试试看吧。
误区十六：
TongWeb要配国密证书
答复：1.TongWeb企业版、标准版、轻量版本身不能配置国密，要通过TongHttpServer(THS)来配置国密证书。 2.   TongWeb嵌入版、容器云版可以直接配置国密证书。  国密制作工具：
GMSSL - 国密SSL实验室

关键字: 因易用性导致的TongWeb使用误区
文档来源: 
--------------------------------------------------------------------------------

问题编号: 165
问题: 如何判断TongWeb是否支持某种数据库？

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/131370614

---

起因：
数据库连接池本是一项成熟的技术，但随着数据库厂家、种类的增加，常常被问到TongWeb是否支持XX数据库？
说明：
数据库连接池的基本思路是，平时建立适量的数据库的连接，放在一个集合中，当有用户需要建立数据库连接的时候，直接到集合中取出一个数据库连接对象（Connection），这样不用再需要重新创建，这样会节省大量的资源，当用户不需要在对数据库进行访问了，那么就将数据库连接对象（Connection）重新放回到集合中，以便方便下次使用。
数据源的使用参见：
https://blog.csdn.net/realwangpu/article/details/115036184
所以判断TongWeb是否支持该数据库，可以基于以下几点来判断？
是关系型数据库、还是非关系型数据库？ 非关系型数据库通常不是JDBC接口。
是否提供标准的JDBC驱动包?  即实现了java.sql.*接口，JDBC驱动程序通常由数据库供应商提供。
还有一些数据库是基于PostgreSQL、 MySQL封装的，可以直接用PostgreSQL 、MySQL的驱动包，这一类的肯定支持。
是采用TongWeb数据源，还是采用开源JDBC数据源( DBCP、 C3P0、Druid、hikari等),  其它开源池  ?   这便于从其配置项判断。 如下：
#采用开源数据源的JDBC数据源
<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
        destroy-method="close">
    <property name="driverClassName" value="${jdbc.driverClassName}" />
    <property name="url" value="${jdbc.url}" />
    <property name="username" value="${jdbc.username}" />
    <property name="password" value="${jdbc.password}" />
    <property name="initialSize" value="${jdbc.initialSize}" />
    <property name="maxActive" value="${jdbc.maxActive}" />
......
</bean>

```java
import org.apache.hadoop.hbase.client.*;
//HBase为非关系型数据库，有自己的连接API，不能配JDBC数据源
public class HBaseTest {

	// 声明静态配置，配置zookeeper
	static Configuration configuration = null;
	static Connection connection = null;
	static {
		configuration = HBaseConfiguration.create();
		configuration.set("hbase.zookeeper.quorum", "study-90:2181,study-91:2181,study-92:2181");
		try {
			connection = ConnectionFactory.createConnection(configuration);
            Table table = connection.getTable(TableName.valueOf(tableName));
            .......
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
```
关于“支持”的定义：支持并不一定指非要配置在TongWeb上的数据源，通过应用中集成开源池可以运行在TongWeb上，也可以认为是支持。
TongWeb本身只是提供数据源的连接，只要是提供JDBC驱动的数据库问题都不大。其实适配数据库最主要的是TongDXP、TongETL这类产品。
常见错误问题：
1. 问：TongWeb是否支持XX数据源？
首先用词不准确："支持"与“提供”是两种不同含义，提供是指产品本身所具有的功能;  支持可以是产品本身不提供，但可以通过其它方式支持。
错误之处：只提供几个字母是无法判断，要问清用户，数据库类型，提供JDBC驱动等。 通病： 往往用户再问是否支持XX技术时，往往还没有问清该技术是什么，就直接转发给同事问：“我们产品是否支持XX”,  这类仅凭几个字母是无法回答的。要进一步问清该技术全称是什么、有什么技术要求等等。
2. 问：TongWeb数据源列表中只有这几种数据库，那是否只支持这几种数据库？
错误之处：只是列出常用数据库，未列出的不代表不支持，还可以通过JDBC模版增加数据源种类。
3. 问：TongWeb数据源是否能配redis池？
错误之处：想想redis是JDBC接口的？

关键字: 如何判断TongWeb是否支持某种数据库？
文档来源: 
--------------------------------------------------------------------------------

问题编号: 166
问题: 如何正确的查看TongWeb日志？

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/109735179

---

当使用TongWeb时出现问题，
第一处理方式为查看TongWeb logs目录下的server.log。
注意：千万不要在控制台查看日志，排序不规则，浏览行数少，不如直接看server.log。
在出现问题时，首先要收集TongWeb日志server.log，收集规则：
1.  若是必然出现的问题则清理一下 TongWeb 日志， 重新启动 TongWeb， 运行应用后收集从 TongWeb 启动后整个server.log日志。
2.  若是偶然问题的出现， 则保留 TongWeb 从开始运行后的所有日志，
且需要注明问题出现的时间点或异常日志行数。
3.  禁止只收集一、 两句的报错信息， 要保证日志的完整性， 应该收集 TongWeb 从启动开始到出现问题时的整个日志。
4.  通常应用采用 log4j 日志输出， 保证应用的 log4j 配置正确， 让应用日志输出在TongWeb 日志中。
```bash
# log4j示例
log4j.rootLogger=INFO, CONSOLE, ROLLINGFILE
# 该控制台输出，会将应用日志输出在TongWeb的server.log中
log4j.appender
.CONSOLE=org.apache.log4j.ConsoleAppender
log4j.appender.CONSOLE.Threshold=INFO
log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout
log4j.appender.CONSOLE.layout.ConversionPattern=%d{ISO8601} - %-5p [%t:%C{1}@%L] - %m%n
# 应用自身日志文件输出
log4j.appender.ROLLINGFILE=org.apache.log4j.RollingFileAppender
log4j.appender.ROLLINGFILE.Threshold=DEBUG
log4j.appender.ROLLINGFILE.File=app.log
```
5. 日志以文本方式查看最为方便。若条件不允许，用电脑截图要截全，用手机拍照要注意提高拍摄水平、拍正、拍清。
6. 要区分哪些是TongWeb输出的日志、哪些是应用输出的日志，server.log中systemout行表示是应用输出。
```bash
[2021-01-13 13:31:51 101] [WARNING] [http-nio2-8088-exec-4] [
systemout
] [javax.xml.soap.SOAPException: Unknown Protocol:   specified for creating MessageFactory]
```
要点：部署、运行异常看server.log日志、乱码问题分析编码，日志作用不大。
查看server.log日志主要查看应用的报错的根本原因，学会找到异常的根本原因，例如如下内容。
```bash
Caused by: javax.naming.NameNotFoundException: Name "JDBC/DPORTAL" not found.
at com.tongweb.tongejb.core.ivm.naming.IvmContext.federate(IvmContext.java:199)
at com.tongweb.tongejb.core.ivm.naming.IvmContext.lookup(IvmContext.java:151)
at com.tongweb.tongejb.core.ivm.naming.OpenejbDelegateContext.lookup(OpenejbDelegateContext.java:48)
at com.tongweb.tongejb.core.ivm.naming.ContextWrapper.lookup(ContextWrapper.java:137)
at com.tongweb.tongejb.core.OpenEJBInitialContextFactory$LocalFallbackContextWrapper.lookup(OpenEJBInitialContextFactory.java:53)
at com.tongweb.naming.SelectorContext.lookup(SelectorContext.java:163)
at com.tongweb.naming.ThanosSelectorContext.lookup(ThanosSelectorContext.java:54)
at javax.naming.InitialContext.lookup(InitialContext.java:417)
at org.springframework.jndi.JndiTemplate$1.doInContext(JndiTemplate.java:155)
at org.springframework.jndi.JndiTemplate.execute(JndiTemplate.java:88)
at org.springframework.jndi.JndiTemplate.lookup(JndiTemplate.java:153)
at org.springframework.jndi.JndiTemplate.lookup(JndiTemplate.java:178)
at org.springframework.jndi.JndiLocatorSupport.lookup(JndiLocatorSupport.java:95)
at org.springframework.jndi.JndiObjectLocator.lookup(JndiObjectLocator.java:105)
at org.springframework.jndi.JndiObjectFactoryBean.lookupWithFallback(JndiObjectFactoryBean.java:200)
at org.springframework.jndi.JndiObjectFactoryBean.afterPropertiesSet(JndiObjectFactoryBean.java:186)
at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1369)
at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)
... 145 more
[2020-11-16 14:41:11] [SEVERE] [core] [One or more listeners failed to start. Full details will be found in the appropriate container log file]
这里是已经失败在解部署，再看下面无意义。
[2020-11-16 14:41:11] [SEVERE] [core] [Context [dportal] startup failed due to previous errors]
[2020-11-16 14:41:11] [INFO] [core] [Closing Spring root WebApplicationContext]
[2020-11-16 14:41:11] [INFO] [deployment] [Undeploying app: /opt/TongWeb7.0/deployment/dportal]
[2020-11-16 14:41:12] [SEVERE] [web-container] [Error deploying web application directory /opt/TongWeb7.0/deployment/dportal]
java.lang.RuntimeException: Start context failed.
at com.tongweb.web.thanos.startup.ThanosHostConfig.deployWar(ThanosHostConfig.java:231)
at com.tongweb.tw.thanos.ThanosWebtierWebAppBuilder.fireTomcatProcess(ThanosWebtierWebAppBuilder.java:416)
at com.tongweb.tw.thanos.ThanosWebtierWebAppBuilder.deployApplication(ThanosWebtierWebAppBuilder.java:363)
at com.tongweb.deploy.TongWebDeployer.deploy0(TongWebDeployer.java:204)
at com.tongweb.deploy.TongWebDeployer.deploy(TongWebDeployer.java:164)
at com.tongweb.deploy.commands.DeployCommand.deploy(DeployCommand.java:269)
at com.tongweb.console.deployer.service.DeployerService.deploy(DeployerService.java:587)
at com.tongweb.console.deployer.controller.DeployerController.deploy(DeployerController.java:361)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at org.jboss.resteasy.core.MethodInjectorImpl.invoke(MethodInjectorImpl.java:137)
at org.jboss.resteasy.core.ResourceMethodInvoker.invokeOnTarget(ResourceMethodInvoker.java:296)
at org.jboss.resteasy.core.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:250)
at org.jboss.resteasy.core.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:237)
at org.jboss.resteasy.springmvc.ResteasyHandlerAdapter.createModelAndView(ResteasyHandlerAdapter.java:96)
at org.jboss.resteasy.springmvc.ResteasyHandlerAdapter.handle(ResteasyHandlerAdapter.java:82)
at org.jboss.resteasy.springmvc.ResteasyHandlerAdapter.handle(ResteasyHandlerAdapter.java:26)
```
如下典型的案例，应用连接nacos失败，主动关闭应用卸载。
```bash
[com.alibaba.nacos.naming.push.receiver] [systemout] [2021-01-22 17:23:07.286 ERROR 75320 --- [g.push.receiver
] com.alibaba.nacos.client.naming
: [NA] error while receiving push data
java.net.SocketException: Socket closed
at java.net.PlainDatagramSocketImpl.receive0(Native Method)
at java.net.AbstractPlainDatagramSocketImpl.receive(AbstractPlainDatagramSocketImpl.java:143)
at java.net.DatagramSocket.receive(DatagramSocket.java:812)
at com.alibaba.nacos.client.naming.core.PushReceiver.run(PushReceiver.java:83)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
at java.util.concurrent.FutureTask.run(FutureTask.java:266)
at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
at java.lang.Thread.run(Thread.java:748)
[2021-01-22 17:23:07.286  INFO 75320 --- [o2-9060-exec-19] com.alibaba.nacos.client.naming          : com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop]
[2021-01-22 17:23:07.286  INFO 75320 --- [o2-9060-exec-19] com.alibaba.nacos.client.naming          : com.alibaba.nacos.client.naming.core.HostReactor do
shutdown stop
]
[2021-01-22 17:23:07.287  INFO 75320 --- [o2-9060-exec-19] com.alibaba.nacos.client.naming          : com.alibaba.nacos.client.naming.net.NamingProxy do
shutdown begin
]
[2021-01-22 17:23:07.287  WARN 75320 --- [o2-9060-exec-19] com.alibaba.nacos.client.naming          : [NamingHttpClientManager] Start destroying NacosRestTemplate]
[2021-01-22 17:23:07.287  WARN 75320 --- [o2-9060-exec-19] com.alibaba.nacos.client.naming          : [NamingHttpClientManager] Destruction of the end]
[2021-01-22 17:23:07.321  INFO 75320 --- [o2-9060-exec-19] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default']
[2021-01-22 17:23:07.324  INFO 75320 --- [o2-9060-exec-19] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closing ...]
[2021-01-22 17:23:07.353  INFO 75320 --- [o2-9060-exec-19] o.s.s.concurrent.ThreadPoolTaskExecutor  : Shutting down ExecutorService 'scopedTarget.asyncExecutor']
[2021-01-22 17:23:07.394  INFO 75320 --- [o2-9060-exec-19] org.mongodb.driver.connection            : Closed connection [connectionId{localValue:2, serverValue:321}] to 192.168.0.101:27017 because the pool has been closed.]
[2021-01-22 17:23:07.396  INFO 75320 --- [o2-9060-exec-19] o.s.s.concurrent.ThreadPoolTaskExecutor  :
Shutting down ExecutorService 'scopedTarget.springSessionRedisTaskExecutor
']
[2021-01-22 17:23:07.396  INFO 75320 --- [o2-9060-exec-19] o.s.s.concurrent.ThreadPoolTaskExecutor  :
Shutting down ExecutorService 'scopedTarget.commonAsyncExecutor'
]
[2021-01-22 17:23:07.401 ERROR 75320 --- [o2-9060-exec-19] o.s.boot.SpringApplication               :
Application run failed
```
最忌讳的日志提供方式：
1. 只发一大堆日志，什么问题也不描述（产品版本，现象，影响等），也不描述出现问题时日志的行数和错误，让别人使劲猜。
2. 只发别人的聊天记录，不做总结描述，让别人看聊天记录分析问题。
3. 只发一句个人认为有问题的日志，上下不连贯，让别人无法分析。
[2020-11-30 13:27:11] [SEVERE] [data-source] [Unable to create initial connections of pool.]
4. 只截取堆栈的中间，看不到开头和结尾的caused  by， 让别人无法分析。
5. 拍照模糊不清、歪歪扭扭。在本可电脑截屏的情况下，依然用手机对着电脑拍屏。
6. 把日志粘贴到word里, 只有文本日志才最好查看。

关键字: 如何正确的查看TongWeb日志？
文档来源: 
--------------------------------------------------------------------------------

问题编号: 167
问题: 应用jar包使用skywalking8（Tongweb7嵌入式p11版本 by lqw）

解决方法:
> 原文地址: https://blog.csdn.net/weixin_39938069/article/details/143706049

---

文章目录
声明
linux使用skywalking
安装包下载
Elasticsearch安装
Skywalking 安装
Skywalking 如何使用Agent探针
window本地使用skywalking
声明
1.安装参考：
SkyWalking 部署（包含ES
2.首先安装一定要根据本帖所建议的版本进行安装和测试，不然会有各种莫名的报错（帖主已经踩了好几个不同版本的坑了，尤其是skywalking跟es之间的版本，有哪个没适配上，报错在网上还不好搜解决方案）。
另外，agent探针部分，示范版本不要用skywalking APM下自带的agent目录的agent.jar，会识别不到的！！！！会识别不到的！！！会识别不到的！！！重要的事情说三次！！！
其次，建议安装高版本一点的jdk，本次示范用的jdk为jdk11(如何安装和配置jdk，自行百度吧)。
3.应用使用了Tongweb7嵌入式p11版本的依赖。
如何使用Tongweb7嵌入式p11，参考这个帖子：
TongWeb7.0.E.6_P11嵌入式版本使用指引（by lqw）
linux使用skywalking
安装包下载
本次示范，使用版本：
1.apache-skywalking-apm-9.5.0.tar.gz（可以理解为web页面+数据收集监控部分）
下载链接：
Skywalking APM
2.apache-skywalking-java-agent-8.16.0.tgz（agent探针，可以理解为缺少这部分的话，无法把应用的监控数据传到apm上）。
下载链接：
Skywalking java agent
3.elasticsearch-8.5.3-linux-x86_64.tar.gz（es作为skywalking的数据源，这个根据自己的系统架构来选，本次示范的是x86的）。
Elasticsearch下载
如果上面的资源失效，可试试点这里：
skywalking下载链接
elasticsearch下载链接
Elasticsearch安装
elasticsearch需要自建普通用户来运行：
adduser elasticsearch
passwd
elasticsearch
新建一个目录用来放elasticsearch的安装包，例如本次示范
```bash
mkdir -p  /opt/elasticsearch
cd /opt/elasticsearch
tar -zvxf elasticsearch-8.5.3-linux-x86_64.tar.gz
chown -R elasticsearch:elasticsearch  /opt/elasticsearch/elasticsearch-8.5.3
```
按照上述解压并修改用户组后，编译一下/opt/elasticsearch/elasticsearch-8.5.3/config/elasticsearch.yml，添加这一行：`xpack.security.enabled: false`
这里相当于是配置了不用密码，如果需要密码的话，则配置成true。
如果配成true，需自行百度一下如何配置elasticsearch的密码（有很多个用户的，例如elasticsearch用户，这里为了方便测试，所以没用配置密码的形式，因为配置后，后面的skywalking的apm上也要配置，很麻烦）
其他都不用动。
然后切换用户，启动elasticsearch，测试是否正常运行：
```bash
su elasticsearch
cd /opt/elasticsearch/elasticsearch-8.5.3/bin./elasticsearch -d
curl http://localhost:9200
```
如果有以下提示，说明elasticsearch已成功安装并运行：
没有的话，最好去看看/opt/elasticsearch/elasticsearch-8.5.3/logs下的日志文件，例如elasticsearch.log有啥报错信息。
Skywalking 安装
skywalking直接用root装就可以了。
请将skywalking下载好的两个包都丢到对应目录，例如本次示范的/opt/skywalking 下：
```bash
mkdir -p /opt/skywalking
tar -xvf apache-skywalking-apm-9.5.0.tar.gz
tar -xvf apache-skywalking-java-agent-8.16.0.tgz
```
解压完后得到这两个包：
需要配置的是apache-skywalking-apm-bin，另一个先别动。
本次示范跟参考的帖子有一些不同，没有配elasticsearch的账号密码，需要改动的地方在/opt/skywalking/apache-skywalking-apm-bin/config/application.yml里，如下图所示：
大概135行左右，配数据源为elasticsearch：
下面大概137行，配一个自定义的命名空间，例如本次示范的skywalking-index（注意默认为"",要填写在“”里面）：
如需配elasticsearch的账号密码，如下所示：
由于elasticsearch跟skywalking配在同一个虚拟机上，所以这里没改：
修改/opt/skywalking/apache-skywalking-apm-bin/webapp下的application.yml，避免端口冲突（默认端口8080）,这里改成8096。保存后启动脚本：
```bash
cd
```/opt/skywalking/apache-skywalking-apm-bin/bin
./startup.sh
```
看到如下提示后：
看看安装目录logs目录的skywalking-oap-server.log和skywalking-webapp.log里是否有报错，防火墙是否已经关闭
systemctl stop firewalld
关闭防火墙后，用http://服务器ip:8096 访问
Skywalking 如何使用Agent探针
到这一步，skywalking只是安装了大部分功能，我们还需要使用agent探针，把应用的信息传到skwalking apm上。
使用了Tongweb7嵌入式版本p11的应用，本质上就是一个打成jar包的java程序，可以使用java -jar来启动，那么在启动的时候，可以利用skwalking的agent包，实现Agent探针。
本地测试，可以使用以下两种方式来监控springboot的应用（前提是已经达成jar包，并且能用java -jar来运行，运行测试没有任何问题）。
执行如下指令：
`java -javaagent:/opt/skywalking/skywalking-agent/skywalking-agent.jar -DSW_AGENT_NAME = skywalkingtestspringboot -DSW_AGENT_COLLECTOR_BACKEND_SERVICES=192.168.10.115:11800 -jar /opt/skywalkingtestjar/skywalking_springboot.jar`
备注：
1.请根据自身的情况进行修改，尤其是修改最后的指定的springboot的应用jar包。
2.如果skywalking apm 跟skywalkingagent.jar同在一个服务器，可以用127.0.0.1，否则用skywalking apm所属服务器或者虚拟机。
3.skywalkingtestsprintboot是我自己起的名字，各位请根据自身需要进行修改和配置。
执行完这个指令后，访问你的应用(不然没法刷新数据同步到skywalking那边)
到skywalking apm的页面看看，是否已经识别到（可多次刷新）。
另外可以在/opt/skywalking/skywalking-agent/plugins下，放入tongweb的jar包（如果是springboot1.x跟2.x，直接放tongweb-plugin.jar,springboot3.x的则放tongweb-plugin-3.x.jar）
这两个包在tongweb-embed-7.0.E.6_P11.zip里
放进去后，执行以下参考指令：
java -javaagent:/opt/skywalking/skywalking-agent/skywalking-agent.jar -Dskywalking.agent.service_name
=
ruoyi-admin -Dskywalking.collector.backend_service
=
192.168
.10.115:11800 -Dserver.port
=
8997
/opt/skywalkingtestjar/ruoyi-admin.jar
备注：
请根据自身需求来配，例如agent.jar的路径，代理服务名称等。
同样也是刷新应用页面后，到skywalking的ui页面看看是否识别：
window本地使用skywalking
这个部分主要是针对开发阶段的，另外没有配置elasticsearch作为数据源，单纯是为了测试window下skywalking是否能识别到idea上部署和运行的springboot应用。
确认本地已配置了jdk：
下载apache-skywalking-apm-8.5.0.tar.gz (linux部分已经贴了下载链接，自行下载吧)，然后解压。
解压后，改一下webapp下的webapp.yml,不要用8080端口，很容易冲突。
idea上，在这里配一下启动参数：
`-javaagent:E:\skywalking\apache-skywalking-apm-8.5.0\apache-skywalking-apm-bin\agent\skywalking-agent.jar -DSW_AGENT_NAME=tongweb_getway_p11 -DWING_INSTANCE_NAME=tongwebgetway_p11_instance  -DSW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800`

其中skywalking-agent.jar直接用apache-skywalking-apm-8.5.0下的agent下的skywalking-agent.jar就好了，其余的根据自身需求调整。
直接用管理者身份运行apache-skywalking-apm-8.5.0这两个脚本（这样做容易看出是否有啥报错）
运行后访问localhost:你修改过的端口，看看是否有skywalking的页面：
然后运行idea上的应用（这两个键都可以，左边是启动，右边是debugger启动）：
多次刷新应用页面，然后刷新skywalking的页面，看看是否识别(没有的话看运行的skywalking的窗口里是否有报错)：

关键字: 应用jar包使用skywalking8（Tongweb7嵌入式p11版本 by lqw）
文档来源: 
--------------------------------------------------------------------------------

问题编号: 168
问题: 应用war_jar包是用TongWeb企业版，还是嵌入版_

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/149772005

---

在判断应用应该采用TongWeb哪个版本时，存在一种错误的观点：如果应用包是jar包，则需要采用TongWeb嵌入版；如果应用包是war包，则需要采用TongWeb企业版。
正确的判断方法：
1.  首先应用为jar包，且符合以下目录结构，则采用TongWeb嵌入版，通过java  -jar webapp.jar方式运行。
2.
若应用包为war包，则不能简单判断为需要运行在TongWeb企业版上。
咨询下用户之前的使用方式，检查下war包结构如下图也可以采用java -jar webapp.war嵌入版方式运行。  如果war包中没有TongWeb、tomcat、jetty、undertow  jar，则是以web应用部署的方式运行。
所以在做替换时要判断以下几点：
1. 若应用是jar包，之前一定运行在嵌入版上。
2. 若应用是war包，要了解用户之前使用方式或检查war包结构，war包有可能运行在嵌入版上，也有可能运行在企业版上。不能以简单的应用包后缀名判断。
3. 再了解用户的运维管理方式适合用嵌入版，还是企业版。 Spring Boot应用的jar与war之间可以互相转化的，转化为war应用在TongWeb企业版上部署时，一定要清除应用里tomcat、jetty、undertow  jar。

关键字: 应用war_jar包是用TongWeb企业版，还是嵌入版_
文档来源: 
--------------------------------------------------------------------------------

问题编号: 169
问题: 慎用TongWeb的JSP预编译功能

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/115263876

---

第一次访问JSP时会有一个JSP编译成class的过程，所以第一次访问JSP会慢，于是应用服务器通常有JSP预编译功能。但是这个功能会影响部署速度，所以尽量少用。如下图在部署应用时有一个"JSP预编译"选项，针对JSP较多的应用该项不要选，否则部署过程会把所有JSP编译一遍，造成部署时间过长，且每次重新启动TongWeb也会重新编译应用的JSP，造成TongWeb启动时间过长。
可以从server.log日志看到，一旦配了"JSP预编译"则每次TongWeb启动都会把所有JSP编译一遍，造成启动时间过长。
```bash
[2021-03-27 13:47:45 367] [INFO] [main] [core] [Built File: \jsp\jsp2\el\functions.jsp]
[2021-03-27 13:47:45 436] [INFO] [main] [core] [Built File: \jsp\jsp2\el\implicit-objects.jsp]
[2021-03-27 13:47:45 488] [INFO] [main] [core] [Built File: \jsp\include\foo.jsp]
[2021-03-27 13:47:45 547] [INFO] [main] [core] [Built File: \jsp\include\include.jsp]
[2021-03-27 13:47:45 596] [INFO] [main] [core] [Built File: \jsp\forward\forward.jsp]
[2021-03-27 13:47:45 662] [INFO] [main] [core] [Built File: \jsp\forward\one.jsp]
[2021-03-27 13:47:45 739] [INFO] [main] [core] [Built File: \jsp\error\err.jsp]
[2021-03-27 13:47:45 795] [INFO] [main] [core] [Built File: \jsp\error\errorpge.jsp]
[2021-03-27 13:47:45 870] [INFO] [main] [core] [Built File: \jsp\dates\date.jsp]
[2021-03-27 13:47:45 935] [INFO] [main] [core] [Built File: \jsp\colors\colrs.jsp]
[2021-03-27 13:47:46 008] [INFO] [main] [core] [Built File: \jsp\checkbox\checkresult.jsp]
[2021-03-27 13:47:46 090] [INFO] [main] [core] [Built File: \jsp\cal\cal1.jsp]
[2021-03-27 13:47:46 168] [INFO] [main] [core] [Built File: \jsp\cal\cal2.jsp]
[2021-03-27 13:47:46 245] [INFO] [main] [core] [Built File: \jsp\async\async1.jsp]
[2021-03-27 13:47:46 300] [INFO] [main] [core] [Built File: \jsp\async\async3.jsp]
[2021-03-27 13:47:46 361] [INFO] [main] [core] [Built File: \jsp\async\index.jsp]
[2021-03-27 13:47:46 697] [INFO] [main] [core] [TongWeb server startup complete in 33487 ms.]
```

关键字: 慎用TongWeb的JSP预编译功能
文档来源: 
--------------------------------------------------------------------------------

问题编号: 170
问题: 慎用TongWeb的热部署功能

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/115264043

---

TongWeb的热部署功能可以在应用的web.xml、class、jar发生变化时自动重部署应用，该功能在应用测试阶段可以用，但在生产环境中一定要关闭"热部署功能"。 否则应用web.xml、class、jar一更新，就会触发自动重部署，造成正在访问的用户中断。甚至可能引发此问题：
TongWeb上反复重部署应用后异常：application instance has been stopped already 或OutOfMemoryError：Metaspace_realwangpu的博客-CSDN博客
从server.log可以看到，应用在重复加载：
```bash
[2021-03-27 13:32:59 325] [INFO] [ContainerBackgroundProcessor] [web-container] [Reloading context [TC_examples]]
[2021-03-27 13:32:59 328] [INFO] [ContainerBackgroundProcessor] [core] [Reloading Context with name [TC_examples] has started]
[2021-03-27 13:32:59 383] [INFO] [ContainerBackgroundProcessor] [core] [SessionListener: contextDestroyed()]
[2021-03-27 13:32:59 384] [INFO] [ContainerBackgroundProcessor] [core] [ContextListener: contextDestroyed()]

关键字: 慎用TongWeb的热部署功能
文档来源: 
--------------------------------------------------------------------------------

问题编号: 171
问题: 手册不全，如何手工刨出TongWeb的监控信息？

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/115485214

---

前言
TongWeb提供几类监控接口，如何通过这些接口获取信息?   我们通过TongWeb7.0.4.2版本讲解下获取方式。
注：换个版本就不一定对了。
一、通过JMX接口获取Mbean信息
TongWeb的JMX默认开启，通过server.log获取JMX  url，更多见：
https://blog.csdn.net/realwangpu/article/details/109506744
```bash
[INFO] [main] [systemout] [tuserport:0;jcport:0]
[INFO] [main] [admin] [URL for the Standard JMXConnectorServer : (
service:jmx:rmi:///jndi/rmi://192.168.163.1:7200/jmxrmi
)]
[INFO] [main] [core] [Starting service TONGWEB]
[INFO] [main] [core] [Starting Servlet Engine: TongWeb]
```
编写JMX程序，主要获取的信息能常有：JVM内存、线程池、数据源连接池、应用session数、应用请求数等，demo如下：
```java
package com.tong;
import java.util.HashMap;
import java.util.Map;
import javax.management.MBeanServerConnection;
import javax.management.ObjectName;
import javax.management.remote.JMXConnector;
import javax.management.remote.JMXConnectorFactory;
import javax.management.remote.JMXServiceURL;

public class TestJMX {
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		try {
			// 创建JMX 的URL
			JMXServiceURL url = new JMXServiceURL("service:jmx:rmi:///jndi/rmi://127.0.0.1:7200/jmxrmi");
			// 构造获取连接所使用的认证信息,使用安全域的用户。
			Map env = new HashMap();
			env.put("jmx.remote.credentials", new String[] { "thanos", "thanos123.com" });
			JMXConnector connector = JMXConnectorFactory.connect(url, env);
			MBeanServerConnection mbsc = connector.getMBeanServerConnection();
			//指定ObjectName
			ObjectName mbeanName = new ObjectName("TONGWEB:type=ThreadPool,name=\"http-nio2-0.0.0.0-8088\"");
			Object obj = mbsc.getAttribute(mbeanName, "maxThreads");
			System.out.println("8088 maxThreads Attribute is " + obj.toString());
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}
```
想获取相关的监控值，主要问题是ObjectName的获取。因为TongWeb手册上不全、不同TongWeb小版本号的ObjectName也不一样，所以想获取真正的ObjectName只有一条路：通过打开 jconsole手工查找相应的监控值，一字诀：刨。
注意：一定要注意TongWeb的小版本号，比如：有的TongWeb版本8088端口的ObjectName为:
`TONGWEB:type=ThreadPool,name="http-nio2-0.0.0.0-8088"`，而有的TongWeb版本8088端口的ObjectName为:`TONGWEB:type=ThreadPool,name="http-nio2-8088"`；换为无敌浩克Hulk数据源后，监控值更不同了。

二、通过rest接口获取TongWeb信息
在应用程序中导入 HttpClient4 所需 jar 包 httpclient-4.x.jar、 httpcore-4.x.jar、commons-logging.jar，${TW_HOME}/lib/agent 目录下的 common-7.0.jar 文件。demo如下：
```java
package com.tong;
import com.tongweb.httpclient.utils.HttpClient4Util;
public class TestRest {

	public static void main(String[] args) {
		String result = null;
		try {
            //注意改用一个thanos外的用户，否则会踢出已登录控制台的thanos用户
			result = HttpClient4Util.execute("/rest/api/listener_detail", "GET", "thanos", "thanos123.com", "127.0.0.1",
					"9060", null);
			System.out.println(result);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}
```
注意：这个rest 接口只有手册提供的部分接口，手册提供就提供了，没提供的就不知道了，不能像jconsole一样去刨。
三、通过集中管理获取所有节点监控值
采用集中管理方式，通过heimdall管理TongWeb各个节点，然后访问
http://127.0.0.1:9060/heimdall/notinrealm/rest/monitor/ibm/view
即可得到各个TongWeb节点的运行状态、内存、JDBC数据源、线程池、应用的监控信息的json数据。
```json
{
    "nodes": [
        {
            "monitorList": [
                {
                    "appname": "",
                    "dbname": "",
                    "monitorName": "nodestatus",
                    "monitorType": "warn",
                    "monitorValue": "stopped",
                    "servletName": "",
                    "threadPoolName": ""
                },
                {
                    "appname": "",
                    "dbname": "",
                    "monitorName": "OOM",
                    "monitorType": "warn",
                    "monitorValue": "",
                    "servletName": "",
                    "threadPoolName": ""
                }
            ],
            "nodeHome": "D:\\TongWeb7042\\TW7E\\domains\\aa",
            "nodeIp": "192.168.163.1",
            "nodeStatus": "stopped"
        }
    ]
}

关键字: 手册不全，如何手工刨出TongWeb的监控信息？
文档来源: 
--------------------------------------------------------------------------------

问题编号: 172
问题: 抛弃手册，开启TongWeb+TongLINK_Q的开发方式

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/115248937

---

问题：
当使用TongWeb+TongLINK/Q产品，想用JMS开发消息服务时，不知如何使用？
1.当你看TongLINK/Q手册《JMS编程参考》时，在给你讲TongWeb5.0+TongLINK/Q8.1的消息驱动bean（Message-Driven Bean，MDB）配置。
2.当你去看TongWeb7的《用户手册》时，在给你讲TongWeb7.0+TongLINK/Q8.1的消息驱动bean（Message-Driven Bean，MDB）配置。
3. TongWeb5.0太老了，MDB开发、配置过程太繁琐。
正确的使用方式：
采用spring  jms框架，抛弃了TongLINK/Q的TongJMS_ra.rar包，省略了一层层的TongWeb配置和MDB开发，单纯的可以通过spring的bean配置快速完成开发，并且可以在ActiveMQ、IBM MQ等JMS服务器之间任意切换，TongWeb无需要任何更改。大致步骤如下：
1.配置TongLINK/Q的jms，只列出片段。如果细讲TLQ配置过程会又臭又长。

```bash
#tlqjndi.conf配置片段
[JndiSystem]		#
[Factory]		# 连接工厂
#
[FactoryRecord]		#
FactoryName = RemoteConnectionFactory		# 连接工厂名称
FactoryType = xqf		#  连接工厂类型
tmqiAddressList = tlq://192.168.32.100:10024	# 远程方式的连接url
#
############################################################
[JndiQueue]		# Jndi队列
#
[JndiQueueRecord]		#
JndiQueueName = lq		# jndi队列名
TlqQueueName = lq		# TLQ的队列名
```
2. spring bean配置文件内容如下：
<?xml version="1.0" encoding="UTF-8"?>
<beans>
	<!-- 配置TLQ的JNDI上下文 -->
	<bean id="jndiTemplate" class="org.springframework.jndi.JndiTemplate">
		<property name="environment">
			<props>
				<prop key="java.naming.factory.initial">tongtech.jms.jndi.JmsContextFactory</prop>
				<prop key="java.naming.provider.url">tlkq://192.168.32.100:10024</prop>
			</props>
		</property>
	</bean>
	<!-- 配置TLQ的JMS连接工厂 -->
	<bean id="JmsQueueConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiTemplate" ref="jndiTemplate" />
		<property name="jndiName" value="RemoteConnectionFactory" />
	</bean>
	<!-- 配置发送队列 -->
	<bean id="sendDestination" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiTemplate" ref="jndiTemplate" />
		<property name="jndiName" value="sendq" />
	</bean>
	<!-- 配置接收队列 -->
	<bean id="receDestination" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiTemplate" ref="jndiTemplate" />
		<property name="jndiName" value="lq" />
	</bean>
	<!-- 配置JMS模版 -->
	<bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory" ref="JmsQueueConnectionFactory" />
	</bean>
	<!-- 消息监听器，相当于MDB类 -->
	<bean id="myTextListener" class="com.tong.jms.TextListener">
	</bean>
	<!-- jms消费 -->
	<bean id="javaConsumer"
		class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="JmsQueueConnectionFactory" />
		<property name="destination" ref="receDestination" />
		<property name="messageListener" ref="myTextListener" />
	</bean>
</beans>
```
3.编写com.tong.jms.TextListener接收消息，相当于MDB

```java
//接受lq队列消息
public class TextListener implements MessageListener {
    public void onMessage(Message message) {
        TextMessage msg = null;
        try {
            if (message instanceof TextMessage) {
                msg = (TextMessage) message;
                System.out.println("Reading message: " + msg.getText());
            } else {
                System.out.println("Message of wrong type: "
                        + message.getClass().getName());
            }
        } catch (JMSException e) {
            System.out.println("JMSException in onMessage(): " + e.toString());
        } catch (Throwable t) {
            System.out.println("Exception in onMessage():" + t.getMessage());
        }
    }
}
```
4.编写发送消息的bean
```java
//发送sendq队列消息片段
JmsTemplate template = (JmsTemplate) ctx.getBean("jmsTemplate");
Destination destination = (Destination) ctx.getBean("sendDestination");
template.send(destination, new MessageCreator() {
	  public Message createMessage(Session session) throws JMSException {
		  return session.createTextMessage("发送消息：Hello TongLINK/Q  Text Message！");
	  }
});
```
5. 完成，是不是比手册的配置过程简单的多？

关键字: 抛弃手册，开启TongWeb+TongLINK_Q的开发方式
文档来源: 
--------------------------------------------------------------------------------

问题编号: 173
问题: 生产系统中TongWeb故障应急处理办法

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/148370215

---

本文档主要说明在上线正式运行的系统中，若TongWeb或部署在TongWeb上的应用出现问题时，现场维护人员或在现场的TongWeb支持人员应当采取的处理步骤。
有说此文档没有具体的操作命令，应急手册重要的告诉处理方法，平时就应该对产品使用熟练，而不是出现问题时，都还不知操作命令。
工作基本原则：
任何操作必须经过项目相关负责人同意后进行，禁止在未允许的情况下做任何操作，否则后果自负。
在重启TongWeb前，需花费几分钟收集相关日志，切记盲目重启TongWeb导致无法收集日志，事后无法分析问题。
以尽快恢复生产系统，不影响用户使用为基本原则。
关于TongWeb进程相关概念的一些说明，请注意在说明时不要混淆：
“TongWeb宕机”的含义：查看TongWeb的Java进程不存在，TongWeb已经因非人为运行stopserver而停止，此种情况称之为TongWeb宕机。
“TongWeb假死”的含义：查看TongWeb的Java进程还在，但TongWeb的控制台和应用都不能访问或访问很慢，此种情况称之为TongWeb进程假死。
“应用访问异常”的含义：查看TongWeb的Java进程还在，TongWeb的控制台也能正常访问，但应用访问不正常或有错误。此种情况称之为“应用访问异常”。
不同情况的处理步骤：
1. license过期情况
TongWeb的license过期后TongWeb自动停止，请尽快联系东方通销售人员索要TongWeb产品的license，TongWeb支持人员无权发正式产品license或可以提供临时license。应用的license过期，请尽快联系应用开发商索要产品的license。SSL证书过期，请尽快联系证书公司索要新的证书。
2. TongWeb已经停止，Java进程已经不存在的情况
立刻启动TongWeb，恢复系统备份出bin、conf下配置文件，并记录这些文件时间，以判断最后一次应用的配置修改时间。打包保留TongWeb的logs目录日志和bin下的nohup.out文件，并记录这些文件的时间，以判断TongWeb是何时停止的。
查看TongWeb的bin目录下有没有生成javacore、hs、heapdump开头的文件，并收集这些文件。
3. 应用系统某些功能点无法使用
某些项目在上线前会有测试不充分的情况，甚至存在移植到TongWeb后就直接上线的情况，所以可能存在上线后，功能都不正常的情况。应用系统有的功能点能用，有的不能用。出现这种情况注意查看TongWeb的日志是否存在异常信息，肯定是因为应用有异常才不能用的。若日志中无任何异常信息，则需要在应用中加入调试信息或打开应用的DEBUG日志，重部署应用或重启TongWeb后，再收集异常日志分析问题。
4. TongWeb的Java进程假死，且应用和TongWeb控制台都不能访问了
存在个别情况下，Java进程还在，但应用和TongWeb控制台都不能访问，这时可通过jstack、jmap、jstat、netstat、lsof等命令生成堆栈日志、端口信息、GC日志以备分析，然后再重启TongWeb。
注：若TongWeb为集群环境，其中一个TongWeb出现问题不影响生产系统运行，建议保留有问题的环境，以供分析。
5. 应用系统运行慢的情况
通过top命令查看TongWeb的java进程占用CPU是否高。若CPU高则通过查看线程占用CPU命令来分析。
若CPU使用不高，TongWeb控制台访问正常，但应用所有页面访问都慢或不能访问应用端口，这种情况通常是应用的http线程池大部分出现阻塞导致的。通过netstat、jstack或kill -3分析。
若CPU使用不高，TongWeb控制台访问正常，但应用跟数据库无关的页面访问正常，跟数据库有关的页面访问慢。查看日志和数据源配置。
TongWeb控制台和应用访部都很慢，日志中有“OutOfMemoryError”或通过jstat命令查看内存占用过高。通过GC日志、jmap命令分析内存。"大部分业务正常，只有个别业务慢"， 这是应用该部分业务的问题，与中间件无关。推荐TongAPM、阿里开源的 java 诊断工具-Arthas，可做源码级性能分析。
6. 重启TongWeb后仍存在问题
重启TongWeb后仍存在问题，应用的某些功能还无法使用。这种情况需根据日志分析具体的原因了，注意收集当时的日志信息。这时问题可能与TongWeb无关，有可能是数据库、网络、更改过应用等方面原因造成的问题。如：访问静态页面无问题，但访问与数据库相关的JSP页面时有问题，则可能是数据库连接或数据库SQL有问题了。
7.低级误操作问题
操作系统、数据库、应用、TongWeb、网络不做基本优化，直接上线。linux下采用不同用户启动TongWeb导致文件权限问题。需采用`chown -R [TongWeb用户]:[TongWeb组]  [TongWeb目录]` 命令改变TongWeb目录文件属主。
前台启动造成停止，需采用nohup后台启动TongWeb，如：`nohup ./startserver.sh &`或 ` startservernohup.sh` 、`startd.sh` 。
系统运行过程中更改应用、TongWeb配置导致访问中断。每次重部应用、修改数据源配置后，需要重启TongWeb，否则容易导致问题。按上述情况进行初步的日志收集，并在恢复系统后，分析日志并找相关人员了解如下情况：
(1) 系统何时开始出现问题的，以前是否一直有问题，出现问题的频率和时间。
(2) 嘱咐现场维护人员，再出现此问题时该收集哪方面的信息。
(3) 最近系统做过哪方面的修改，如：数据库、网络、应用包更新、操作系统的参数修改等等。

关键字: 生产系统中TongWeb故障应急处理办法
文档来源: 
--------------------------------------------------------------------------------

问题编号: 174
问题: 负载场景下TongWeb如何获取真实的客户端IP地址

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/110137907

---

问题描述：
通过负载设备后，TongWeb上的应用通过request.getRemoteAddr()方式得到的是负载设备的IP，而得不到真实的客户端IP。
解决办法一：
经过代理以后，由于在客户端和服务之间增加了中间层，因此服务器无法直接拿到客户端的 IP，服务器端应用也无法直接通过转发请求的地址返回给客户端。但是在转发请求的HTTP头信息中，增加了X-FORWARDED-FOR信息。用以跟踪原有的客户端 IP地址和原来客户端请求的服务器地址。所以通过 request.getRemoteAddr()的方法获取的IP实际上是代理服务器的地址，并不是客户端的IP地址。应该采用
request.getHeader("x-forwarded-for")
方式。完整的方法如:
```java
public String getRemortIP(HttpServletRequest request) {
if (request.getHeader("x-forwarded-for") == null) {
return request.getRemoteAddr();
}
return request.getHeader("x-forwarded-for");
}
```
如果说应用写死request.getRemoteAddr()方式获取IP，应用不能改呀，不想改呀等等理由。可以在应用所在虚拟主机中配置自定义 valve。RemoteIPValve就是利用X-Forwarded-For和X-Forwarded-Proto等字段，得到最原始的客户端的IP和请求信息.
注意：TongWeb6与TongWeb7类名不同。
TongWeb7自定义 valve：com.tongweb.catalina.valves.RemoteIpValve,protocolHeader=X-Forwarded-Proto,remoteIpHeader=X-Forwarded-For
TongWeb6自定义 valve：com.tongweb.web.thor.valves.RemoteIpValve,protocolHeader=X-Forwarded-Proto,remoteIpHeader=X-Forwarded-For

另外TongWeb的访问日志若想记录真实IP。需要在访问日志格式中加入 如下配置：
%{yyyyMMddHHmmssSSS}t %U %m %a %D
%{X-Forwarded-For}i

用扩展日志格式，用 cs(X-Forwarded-For) 方式就可以
cs-method cs-uri-query c-ip s-ip time
cs(X-Forwarded-For)

解决办法二：
如果已确认获取代理的IP，port，http或https协议，可以在http通道中写明代理服务器地址，这样request.getScheme()，request.getServerName()获取的就是代理的值。

关键字: 负载场景下TongWeb如何获取真实的客户端IP地址
文档来源: 
--------------------------------------------------------------------------------

问题编号: 175
问题: 转载TongWeb适配OpenRASP

解决方法:
> 原文地址: https://blog.csdn.net/realwangpu/article/details/122856387

---

OpenRASP 抛弃了传统防火墙依赖请求特征检测攻击的模式，创造性的使用RASP技术（应用运行时自我保护），直接注入到被保护应用的服务中提供函数级别的实时防护，可以在不更新策略以及不升级被保护应用代码的情况下检测/防护未知漏洞，尤其适合大量使用开源组件的互联网应用以及使用第三方集成商开发的金融类应用。
TongWeb适配OpenRASP可参见：
https://rasp.baidu.com/doc/install/manual/tongweb.html

关键字: 转载TongWeb适配OpenRASP
文档来源: 
--------------------------------------------------------------------------------

