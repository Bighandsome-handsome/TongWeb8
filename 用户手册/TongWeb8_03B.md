3. 单击 “确定”，完成实例的删除操作。
若界面弹出 “实例删除成功” 提示信息，则说明删除实例成功。

# 移除实例记录
当该实例无法删除或者冗余时，可从控制台实例列表中删除记录。

# 注意事项
• 当实例所在节点处于运行中时，不允许直接移除记录。
• 移除记录前，请先停止实例，并解除实例与其它组件的关联。
• 移除记录后，服务器的日志记录了完整的信息日志；当出现误删除时，可以通过该信息进行恢复。

# 操作步骤
1. 选择 “集中管理” $>$ “服务管理” $>$ “实例”，进入实例列表页面。
2. 单击目标实例所在行的 “移除记录”，弹出确认移除记录窗口。

# 说明：
用户可根据需要勾选一个或多个实例，并单击列表上方的 “移除记录” 按钮，批量移除实例在控制台的记录。
3. 单击“确定”，完成实例的移除记录操作。
若界面弹出 “实例移除记录成功” 提示信息，则说明移除实例记录成功。

# 4.2.3. 节点管理
节点是对物理环境的抽象，是 TongWeb 集中管理得以实施的基础设施，一台物理设备（准确的说是一个IP）只需要安装一个节点即可，在节点之上可以构建集群、实例、会话服务器、负载均衡器等逻辑组件。在逻辑上，节点只做管理使用，不会参与用户应用的部署和运行（应用由 TongWeb 实例管理），在部署结构上，节点对应的是 TongWeb 的 domain1 这个域。

# 注意事项：
在完成节点创建后，用户可使用 ps -ef|grep tongweb 命令，来查看业务进程。关于查看进程的更多信息，详见《TongWeb_V8.0安装与使用指引》的 “查看 TongWeb 进程” 章节。

# 4.2.3.1. 创建节点
用户可通过 “SSH” 或者 “手动” 方式创建节点。

# 4.2.3.1.1. SSH 创建节点
Windows 系统仅支持通过手动的方式创建节点。
• 一个 IP 只能创建一个节点。
• 一个节点可以创建多个实例。
自动创建节点时，TongWeb 会根据您设置的 TongWeb 安装路径自动在远程节点上安装 TongWeb 且生成一个默认 “${tongweb.home}/domains/domain1” 实例。

# 前置条件
• 已获取管理控制台系统管理员（thanos）的账号和密码。
• 已准备好远程节点的 IP、端口、登录账号、密码。
• 远程节点已安装 JDK 1.8 及以上版本。

# 约束限制
SSH 创建节点的方式只适用于节点操作系统是 Linux 系统。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理” $>$ “节点”，进入节点页面。
4. 单击 “创建”，进入创建节点页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b9697be2aa09ad1ef09b99f38850cd8a51f620cc8ba77cc6040a467ba39ec89e.jpg)
5. 配置节点相关参数。
◦ 名称：必填项，输入节点的名称。请使用常规英文字母，避免使用空格、斜杠、标点等特殊字符。
◦ IP：必填项，输入节点的 IP 地址。支持填入主机名。
注：tongweb.xml 中的 IP 也支持主机名。
◦ 在创建节点过程中，系统优先使用管理端口配置的 IP 地址，其次使用全局 IP（基础配置 $>$ 全局配置> 全局 IP），最后才会自动获取 IP。
关于节点的更多参数说明，详见节点配置参数说明。
6. 单击 “添加”，完成节点的添加操作。
若界面弹出 “节点添加成功” 提示信息，则说明节点添加成功。
添加成功后，节点默认处于 “启动” 状态。

# 4.2.3.1.2. 手动创建节点
• 若节点操作系统是 Windows，则只能通过手动的方式创建节点。
• 若节点操作系统是 Linux，则可以选择使用 “自动” 或者 “手动” 的方式创建节点。
手动创建的节点不能远程启停节点，可以下载日志。

# 前置条件
• 已获取管理控制台系统管理员（thanos）的账号和密码。
• 已在待创建的远程节点上安装并运行 TongWeb。
本地 TongWeb 作为集中管理工具。
• 已在待创建的远程节点上安装 JDK 1.8 及以上版本。

# 方式1：自动注册为节点
1. 登录待创建的远程节点 TongWeb 管理控制台。
2. 切换到默认实例。
3. 在左侧菜单栏中，选择 “基础配置” $>$ “全局配置” > “集中管理”，进入集中管理页面。
4. 打开 “支持集中管理” 开关。
5. 打开 “自动注册” 开关，“注册为节点” 选择为 “节点”，并填写 “注册到集中管理 URL”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/97aa80491d969f4afc171646236d59e465293798b63b67ec107377b223e3bcd1.jpg)


# 说明：
◦ 服务器标识：注册到集中管理的节点名称；若不设置，则系统随机生成。
若当前节点已经被集中管理统一纳管，您在编辑此值后，需自行前往集中管理端同步更新已注册的此标识符号。
◦ 注册到集中管理 URL：配置为集中管理服务器的 TongWeb 控制台访问地址，如“https://localhost:9060/console。
6. 配置完成后，单击 “更新”，即完成自动注册为节点操作。
7. 登录本地 TongWeb 管理控制台，并进入 “集中管理” $>$ “服务管理” > “节点”，即可查看到自动注册的节点。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f01b6aea06ad8287c8f00e56f567585bed35953991625a259f02580158106a72.jpg)


# 方式2：手动注册为节点
1. 复制本地 TongWeb “集中配置” 中的 “加密公钥”。
a. 登录本地 TongWeb 管理控制台。
b. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
c. 在左侧导航栏中，选择 “服务管理” $>$ “集中配置”，进入集中配置页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ad2ec02abaf07ab76dc61eb326272d36ebf646e8ad94089474617d23839e419d.jpg)
d. 复制集中配置中的 “加密公钥”。
2. 将 “加密公钥” 配置到待创建的节点上。
a. 登录待创建的远程节点 TongWeb 管理控制台。
b. 切换到默认实例。
c. 将步骤 1 复制的认证密钥，粘贴到 “基础配置” $>$ “全局配置” $>$ “集中管理” 的加密公钥文本框中。
d. 单击 “更新”，系统自动生成传输密钥，实时生效。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/bb289723cd6922fa0bb23ffc248af1b2507a746fa4400434cf1fb3632e1ebffd.jpg)
若页面弹出 “全局配置更新成功” 提示信息，说明更新认证密钥成功。

# 3. 手动注册到集中管理。
a. 打开本地 TongWeb 管理控制台。
b. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
c. 在左侧导航栏中，选择 “服务管理” $>$ “节点”，进入节点页面。
d. 单击 “创建”，进入创建节点页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f0507284769562d7f3e2760dfc0870d2606db506d3e0f7151296c198fc4a4a19.jpg)


# e. 配置待创建的远程节点。
▪ 名称：必填项，输入节点的名称。请使用常规英文字母，避免使用空格、斜杠、标点等特殊字符。
▪ IP：必填项，输入节点的 IP 地址。支持输入主机名。
▪ 注册方式：必填项，选择为 “手动”。
▪ 传输密钥：必填项，粘贴为 步骤 2 中生成传输密钥。
▪ 同步集中管理配置：非必填，开启后，自动同步远程集中管理的配置到当前集中管理，包含节
点、集群、实例、负载均衡、消息服务器和 TongDataGrid 的配置。
关于节点的更多参数说明，详见节点配置参数说明。
f. 单击“添加”，完成手动创建节点操作。
若界面弹出“节点添加成功”提示信息，则说明节点添加成功。
在节点列表中，可以查看到已添加的节点，注册方式为“手动”。
添加的节点默认处于“启动”状态。

# 4.2.3.2. 下载日志
节点处于“启动中”时，您才可以下载该节点的日志。
节点的日志路径：当前节点安装 TongWeb 路径的默认实例“${tongweb.base}/logs”。
本章节介绍如何下载日志。

# 前置条件
• 已获取系统管理员（thanos）账号和密码。
• 已创建节点且节点“运行中”为“true”。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击“集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理” $>$ “节点”，进入节点列表页面。
4. 单击目标节点所在行的 “下载”，下载日志。
5. 在下载日志下拉框里，选择需要下载的日志文件。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1e4c48c580591292802b60d42c0b5113a2144a8f776311ec0e236ecc35701c91.jpg)
6. 单击“确定”，即可将日志下载到本地。
下载的日志文件的压缩包以节点名称命名。

# 4.2.3.3. 管理节点
您可以根据需要查看、管理、编辑、启动、停止、移除节点以及更新授权等。

# • 查看节点
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 在节点列表页面，您可以查看已创建的节点。
包含节点的名称、运行中、IP、管理端口、实例数量、负载均衡器数量、会话服务器数量、集群数量、注册方式、开机自启、节点版本、待升级等信息。
说明：
用户可单击节点对应的实例数量，进入实例列表页面。

# • 管理节点
用户可管理节点的默认实例 domain1，将默认实例 domain1 可作为业务实例使用。
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 单击目标节点所在行的 “管理”，进入节点的默认实例 domain1 页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d81b17678219566b80aba374c5d2cd591a2f9def62f9827de08666d2e20ea062.jpg)


# • 编辑节点
编辑节点时，您可以根据需要将节点注册方式修改为 “SSH” 或者 “手动”。Windows 仅支持手动创建方式。
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 单击目标节点名称，进入编辑节点页面。
3. 您可以根据提示修改节点信息。
说明：
节点名称、IP 地址不可编辑。
4. 编辑完成后，单击 “更新”，更新节点配置信息。
若界面弹出 “节点更新成功” 提示信息，则说明编辑节点成功。

# • 启动节点
手动创建的节点不能远程启停。
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 单击目标节点所在行的 “启动”，弹出确认启动窗口。

# 说明：
用户可根据需要勾选一个或多个节点，并单击列表上方的 “启动” 按钮，批量启动节点。
3. 单击 “确定”，启动节点。
若界面弹出 “节点启动成功” 提示信息，则说明启动节点成功。

# • 停止节点
手动创建的节点不能远程启停。
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 单击目标节点所在行的 “停止”，弹出确认停止窗口。

# 说明：
用户可根据需要勾选一个或多个节点，并单击列表上方的 “停止” 按钮，批量停止节点。
3. 单击 “确定”，停止节点。
若界面弹出 “节点停止成功” 提示信息，则说明停止节点成功。

# • 强停节点
当节点长时间难以成功停止，或者停止过程出现意外阻塞的情况时，您可以选择使用强制停止进程功能，强制停止通常是以强制杀进程的方式实现。
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 单击目标节点所在行的 “强停”，弹出确认强停窗口。

# 说明：
用户可根据需要勾选一个或多个节点，并单击列表上方的 “强停” 按钮，批量强停节点。
3. 单击 “确定”，强停节点。
若界面弹出 “强停成功” 提示信息，则说明强停节点成功。

# • 更新节点授权
当所在节点的授权和 TongWeb 的授权不一致时，可更新节点的授权信息。
1. 选择 “集中管理” $>$ “服务管理” > “节点”，进入节点列表页面。
2. 单击目标节点所在行的 “更新授权”，弹出确认更新授权窗口。
3. 单击 “确定”，更新该节点的授权。
若界面弹出 “更新授权成功” 提示信息，则说明更新该节点的授权成功。

# • 升级节点
当 TongWeb 升级后，所在节点的 TongWeb 版本和升级后的 TongWeb 版本不一致时，可升级节点的版本信息。
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 单击目标节点所在行的 “重启升级”，弹出确认升级窗口。

# 说明：
用户可根据需要勾选一个或多个节点，并单击列表上方的 “重启升级” 按钮，批量升级节点。
3. 单击 “确定”，升级该节点的版本。
若界面弹出 “升级节点成功” 提示信息，则说明升级该节点的版本成功。

# • 移除节点
移除节点是解除集中管理与该节点上 TongWeb 的关联，该节点上的 TongWeb 还可以继续运行。若需要移除节点，需要停止并删除该节点上运行的 TongWeb 实例，然后将该节点停止后，即可成功将该节点移除。
若节点上 TongWeb 实例被集群引用，在停止并删除该节点上运行的 TongWeb 实例前，需要进入集群详细信息页面，解除集群对该节点上 TongWeb 实例的引用。
说明： 手动创建的节点，不停止节点可直接移除。
移除节点时，节点引用的其它组件不会被删除。操作步骤，如下所示。
1. 选择 “集中管理” $>$ “服务管理” $>$ “节点”，进入节点列表页面。
2. 单击目标节点所在行的 “移除”，弹出确认移除窗口。

# 说明：
用户可根据需要勾选一个或多个节点，并单击列表上方的 “移除” 按钮，批量移除节点。
3. 单击 “确定”，完成节点的移除操作。
若界面弹出 “节点移除成功” 提示信息，则说明移除节点成功。

# 4.2.4. 负载均衡器管理

# 4.2.4.1. 创建负载均衡器
本章节介绍如何创建负载均衡器。

# 前置条件
已在节点安装负载均衡器。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理” $>$ “负载均衡器”，进入负载均衡器页面。
4. 单击 “创建”，进入创建负载均衡器页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/046e91719d27c5fd3d8f02f7c791a77dbb4a834b14036968986913892bbc9863.jpg)
5. 配置负载均衡器的相关参数。
名称：必填项，输入负载均衡器的名称。请使用常规英文字母，避免使用空格、斜杠、标点等特殊字符。
关于负载均衡器的更多参数说明，详见负载均衡器配置参数说明。
6. 单击 “添加”，完成负载均衡器（ths）添加操作。
若界面弹出 “负载均衡器添加成功” 提示信息，则说明负载均衡器添加成功。
添加成功后，节点 “运行中” 默认为 “false” 状态。

# 4.2.4.2. 配置并访问 THS 控制台
本章节介绍如何配置并访问 THS 控制台。

# 前置条件
• 已在节点安装负载均衡器。
• 已获取 THS 控制台地址。

# 注意事项
如果要为已经存在且被引用的负载均衡器配置 THS 控制台地址，那么需要先解除该负载均衡器的所有引用或依赖关系，否则无法编辑该负载均衡器。

# 操作步骤
1. 配置 THS 控制台地址。
a. 登录 TongWeb 控制台。
b. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
c. 在左侧导航栏中，选择 “服务管理” $>$ “负载均衡器”，进入负载均衡器页面。
d. 单击创建或者目标负载均衡器的名称，进入负载均衡器页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/22b63b0fdcb4f71a8e21a0ca020cd23d0cf0d7c3a5dd551fc6f3e3133d261e0f.jpg)
e. 配置负载均衡器相关参数。
▪ 名称：自定义负载均衡器名称。
▪ 类型：选择 “THS”。
▪ THS 控制台地址：配置为 THS 控制台地址，例如 “http://168.1.15.44:8000/”。
▪ 其他参数：请根据实际环境填写。

# 2. 启动 THS 控制台。

# 注意：
该操作仅会向 THS 发送启动指令，不会检测其启动状态，启动成功与否也不能保证。
a. 进入负载均衡器页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3f7fd1dcc307b74ec81d191b0dc541ad0c0df67a34587b69254cea4424c3b87c.jpg)
b. 单击目标负载均衡器所在行的 “启动 THS 控制台”，弹出确认启动 THS 控制台提示窗口。
c. 单击 “确定”，弹出 “负载均衡器启动 THS 控制台成功” 提示信息，则说明启动 THS 控制台成功。

# 3. 访问 THS 控制台。
a. 进入负载均衡器页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c7df13cd831148311c325dd42705c0fe0b854fcebf80521ec041dd8bb7a6f9ca.jpg)
b. 单击目标负载均衡器所在行的 “THS 控制台”，进入 THS 控制台链接页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/bf512de8d81ec85c83f357f1bf6e9a1222f58fb5fc95f74e168f5a7f4f0e08f2.jpg)
c. 单击 THS 控制台链接，即可进入 THS 控制台登录页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/2512eb0f22282c69ea9a9c53a968e090bbf7873435a859cfa79447bdcfca35e2.jpg)
d. 输入 THS 控制台的账号、密码以及验证码，并单击 “确定”，即可登录到 THS 控制台。

# 4.2.4.3. 下载日志
负载均衡器所在节点处于“启动”状态时，您才可以下载负载均衡器的日志。
本章节介绍如何下载日志。

# 前置条件
• 已获取系统管理员账号和密码。
• 负载均衡器所在节点 “运行中”为“true” ，进入集中管理页面。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
4. 单击目标负载均衡器所在行的 “下载”，下载日志。
5. 单击目标实例所在行的 “下载”，弹出“下载日志”窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3dde618a5e80b082ae161a8bac89ab7242812825c6e00e4c5d9763044cb6a1e1.jpg)
6. 勾选需要下载的日志文件。
7. 单击 “确定”，即可将日志下载到本地。
下载的日志文件的压缩包以负载均衡器名称命名。

# 4.2.4.4. 管理负载均衡器
本章节介绍如何查看、编辑、启动、平滑重启、停止、强停、删除负载均衡器以及移除负载均衡器记录。

# 查看负载均衡器
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 在负载均衡器列表页面，您可以查看已创建的负载均衡器。
包含负载均衡器的名称、运行中、类型、所在节点、安装路径、从机所在节点、从机安装路径等信息。

# 编辑负载均衡器
若负载均衡器被集群引用，则该负载均衡器不能编辑。
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 单击目标负载均衡器名称，进入编辑负载均衡器页面。
3. 您可以根据提示修改负载均衡器信息。
说明：
负载均衡器名称不可编辑。
4. 编辑完成后，单击 “更新”，更新负载均衡器配置信息。
若界面弹出 “负载均衡器更新成功” 提示信息，则说明编辑负载均衡器成功。

# 启动负载均衡器
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 单击目标负载均衡器所在行的 “启动”，弹出确认启动窗口。
说明：
用户可根据需要勾选一个或多个负载均衡器，并单击列表上方的 “启动” 按钮，批量启动负载均衡器。
3. 单击 “确定”，启动负载均衡器。
若界面弹出 “负载均衡器启动成功” 提示信息，则说明启动负载均衡器成功。

# 平滑重启负载均衡器
在尽量不中断业务处理的情况下，重新加载负载均衡器相关服务。平滑重启有时也被称作优雅重启。
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 单击目标负载均衡器所在行的 “平滑重启”，弹出确认平滑重启窗口。
3. 单击 “确定”，完成负载均衡器的平滑重启操作。
若界面弹出 “负载均衡器平滑重启成功” 提示信息，则说明负载均衡器平滑重启成功。

# 停止负载均衡器
已创建负载均衡器且处于“运行中”状态。
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 单击目标负载均衡器所在行的 “停止”，弹出确认启动窗口。
说明：
用户可根据需要勾选一个或多个负载均衡器，并单击列表上方的 “停止” 按钮，批量停止负载均衡器。
3. 单击 “确定”，停止负载均衡器。
若界面弹出 “负载均衡器停止成功” 提示信息，则说明停止负载均衡器成功。

# 强停负载均衡器
当负载均衡器长时间难以成功停止，或者停止过程出现意外阻塞的情况时，您可以选择使用强制停止进程功能，强制停止通常是以强制杀进程的方式实现。
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 单击目标负载均衡器所在行的 “强停”，弹出强制停止确认窗口。
说明：
用户可根据需要勾选一个或多个负载均衡器，并单击列表上方的 “强停” 按钮，批量强停负载均衡器。
3. 单击 “确定”，强制停止该负载均衡器。
若界面弹出 “负载均衡器强停成功” 提示信息，则说明负载均衡器强制停止成功。

# 删除负载均衡器
删除负载均衡器时，负载均衡器引用的其它组件不会被删除。
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 单击目标负载均衡器所在行的 “删除”，弹出确认删除窗口。
说明：
用户可根据需要勾选一个或多个负载均衡器，并单击列表上方的 “删除” 按钮，批量删除负载均衡器。
3. 单击 “确定”，完成负载均衡器的删除操作。
若界面弹出 “负载均衡器删除成功” 提示信息，则说明删除负载均衡器成功。

# 移除负载均衡器记录
当负载均衡器无法删除或者冗余时，可将该负载均衡器从控制台中移除记录。
注：移除负载均衡器后，若重新将该负载均衡器添加进来，仍是原来的运行的负载均衡器。
移除负载均衡器前，请先停止负载均衡器，并解除与其它组件的引用。
1. 选择 “集中管理” $>$ “服务管理” $>$ “负载均衡器”，进入负载均衡器列表页面。
2. 单击目标负载均衡器所在行的 “移除记录”，弹出确认移除记录窗口。
说明：
用户可根据需要勾选一个或多个负载均衡器，并单击列表上方的 “移除记录” 按钮，批量移除负载均衡器在控制台的记录。
3. 单击 “确定”，完成负载均衡器的移除记录操作。
若界面弹出 “负载均衡器移除记录成功” 提示信息，则说明移除负载均衡器记录成功。

# 4.2.5. 集中配置
集中配置对集中管理过程中环境、安全等方面进行配置。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/957dac5463d353e7f6676e76a05134711998b3f707788849f226b85027fbf837.jpg)
• 加密公钥可用于手动创建节点，关于如何手动创建节点，请参见手动创建节点。
• 客户端通过 REST、JMX 等接口管理 TongWeb 服务器时，可使用此公钥对敏感数据进行加密后再传输。
◦ 客户端通过 远程 JMX 管理 TongWeb 服务器，如何使用此公钥对密码加密，请参见远程 JMX。
◦ 客户端通过 REST 接口管理 TongWeb 服务器，如何使用此公钥对密码加密，请参
见《TongWeb_V8.0REST API手册》中 “登录认证” 章节。
• 集群子任务超时：集群子任务是指对集群内多个实例所执行的具体操作，每个实例即一个子任务。
关于集中配置的更多参数说明，详见集中配置参数说明。

# 4.2.6. 注册实例
发现和管理注册到集中管理的 TongWeb 服务实例。
用户可通过如下两种方式将远程 TongWeb 实例注册到集中管理。
• 方式1：通过 “全局配置” 模块的 “自动注册” 功能，将自己注册到集中管理。
• 方式2：通过 “全局配置” $>$ “集中管理” 页，开启 “启用服务注册中心”，将自己注册到服务注册中心（如Nacos 等）。

# 4.2.6.1. 注册到集中管理

# 方式1：自动注册为实例
1. 登录远程 TongWeb 管理控制台。
2. 切换到默认实例。
3. 在左侧菜单栏中，选择 “基础配置” $>$ “全局配置” > “集中管理”，进入集中管理页面。
4. 打开 “支持集中管理” 开关。
5. 打开 “自动注册” 开关，“注册为节点” 选择为 “实例”，并填写 “注册到集中管理 URL”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d00f1b42f0cf8c7e86b7f6f09ec0382ab5962504f08bf01997f4d8cb798cc38c.jpg)
说明：
◦ 服务器标识：注册到集中管理的实例名称；若不设置，则系统随机生成。
若当前实例已经被集中管理统一纳管，您在编辑此值后，需自行前往集中管理端同步更新已注册的此标识符号。
◦ 集群标识：具有相同集群标识的服务器会自动组成集群。若无，则不属于任何集群。该标识设置或自动生成后不可变更。
◦ 注册到集中管理 URL：配置为集中管理服务器的 TongWeb 控制台访问地址，如https://localhost:9060/console。
6. 配置完成后，单击 “更新”，即完成自动注册为实例操作。
7. 登录本地 TongWeb 管理控制台，并进入 “集中管理” $>$ “服务管理” $>$ “实例”，即可查看到自动注册的实例。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3b02f616fc0e44422d3cd2b962e41e368123a5fa4337c737872df9b6f16f5449.jpg)


# 方式2：使用服务注册中心注册为实例
在 “全局配置” > “集中管理” 已开启 “启用服务注册中心”。
关于实例注册到集中管理的详细信息，请参见 使用注册中心。

# 4.2.6.2. 查看注册服务实例
用户可查看已注册到集中管理的实例，包含实例名称、别名、IP、管理端口、安装路径、服务器标识、所属集群、标识符、运行中等。
1. 登录本地 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理” $>$ “注册实例”，进入注册实例页面。
4. 可查看已注册的 TongWeb 实例。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/5d872246f90a1eb11629b9fa83da806335980d616c919abdc602a3c29a787979.jpg)


# 4.2.6.3. 移除注册实例
当实例为非运行状态时，支持从 “注册实例” 模块中移除不需要的实例。
• 如果是使用 “注册中心” 注册的服务，那么当服务停止后，它会自动从 “注册实例” 列表中移除。
• 如果不是使用 “注册中心” 注册的服务，且该服务不再需要管理，那么需要用户手动在 “注册实例” 列表中移除。

# 4.2.7. 注册实例集群
注册到集中管理的 TongWeb 实例集群。TongWeb 实例可以通过 “全局配置” 模块的 “自动注册” 功能，将自己注册到集中管理，注册时如果指定了所属集群，则可以在这里进行管理。

# 步骤1：注册到集中管理
注册实例时，指定 “集群标识”，具有相同集群标识的服务器会自动组成集群。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/43f9f9fb77988fbd895aecaa2322a7785b6ca15544b868a40e9143dc51b48ded.jpg)


# 步骤2：查看注册实例集群
1. 登录本地 TongWeb 管理控制台。
2. 进入 “集中管理” $>$ “服务管理” $>$ “注册实例”，查看注册实例。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/fbd249f1ebce05f4d03467f25f20817353d37cb99d6a00eca3c0d263a38583c2.jpg)
3. 进入 “集中管理” > “服务管理” > “注册实例集群”，可查看并管理集群。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/6d4568ec99f039cd4d05691f8e0d2c938e900fd844fd4496d305510cf66ac950.jpg)
4. 单击目标集群所在行的 “管理”，即可切换到该集群，并对该集群进行管理。

# 4.3. 资源配置

# 4.3.1. 实例模板管理
您可以选择一个实例，将它的配置（如实例路径 “${tongweb.base}/conf” 下的数据源、全局变量等配置信息，不包含部署的应用相关配置）制作成模板。
在创建新的实例时，引用该实例模板，即可复用实例模板的配置信息。

# 注意：
• 创建实例模板时，要求已存在一个实例，且实例所在节点处于 “运行中”。
• 只复用配置信息，不复用文件。

# 4.3.1.1. 创建实例模板
用户可根据需要创建自己所需的实例模板。

# 前置条件
已存在一个实例，且实例所在节点处于 “运行中”。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “资源配置” $>$ “实例模板”，进入实例模板页面。
4. 单击“创建”，进入创建实例模板页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/5d16dc2456281f7198097e37832a32353ac5707a23ee87b0ae297e832e3c7672.jpg)
5. 输入实例模板的名称，并选择一个需要设置为模板的运行中的实例。
6. 单击 “添加”，完成实例模板的添加操作。
若界面弹出 “实例模板添加成功” 提示信息，则说明添加实例模板成功。
在实例模板列表中，可查看已添加的实例模板。

# 4.3.1.2. 下载实例模板
您可以根据需要下载已创建的实例模板，并查看该实例模板的配置信息。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “资源配置” $>$ “实例模板”，进入实例模板页面。
4. 单击 “下载”，弹出选择需要下载的文件窗口。
5. 选择待下载的实例模板。
6. 单击 “确定”，即可下载以 “instancetemplate-xxxx.zip” 命名的实例模板。
说明：
下载完成后，解压后是以“实名&实例模板名$xxxx.zip”命名的压缩包。
再次解压后，即可得到 “conf” 文件夹及文件夹下的配置文件，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b81b5218677c317bbaf95505f5f48c239b9e6720c7398d59ede6d1921ddfe304.jpg)


# 4.3.1.3. 引用实例模板
引用已创建的实例模板后，即可复用该实例模板的配置信息。
注意：
创建新的实例时，可引用实例模板；编辑已有实例时无法引用到实例模板。
前置条件
已创建实例模板。

# 创建实例时引用实例模板
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理” $>$ “实例”，进入实例页面。
4. 单击 “创建”，进入创建实例页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c4fd981688cbaf33871372525432e2ad16d2367f5f7bb753253971ebcdba4ed2.jpg)
5. 输入实例的名称，并为 “实例模板” 指定为已创建的实例模板。
6. 其他参数，请根据需要填写。
7. 单击 “添加”，即完成实例的创建操作。
若界面弹出 “实例添加成功” 提示信息，则说明实例添加成功，且实例模板引用成功。
进入已创建实例的 “${tongweb.base}/conf” 目录下，可查看从实例模板复制过来的配置信息。

# 版本生成时引用实例模板
生成的 TongWeb 的默认实例引用实例模板的配置。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧菜单栏中，选择 “扩展支持” $>$ “版本生成”，进入版本生成页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3e366325c93c05db2e3c1a4c891c71e99d27a8499d0ae6355f831ae552f2f327.jpg)
4. 在 “实例模板” 下拉列表中，选择已创建的实例模板。
5. 其他参数，请根据需要配置。
6. 单击 “生成”，即可完成版本生成操作。
生成 TongWeb 的默认实例引用实例模板的配置。

# 4.3.1.4. 管理实例模板
您可以根据需要查看或删除实例模板。

# 查看实例模板
您可以查看已创建的实例模板的名称、实例、创建日期等信息。
1. 选择 “集中管理” $>$ “资源配置” $>$ “实例模板”，进入实例模板页面。
2. 在实例模板列表中，可查看已创建的实例模板的名称、实例、创建日期等信息。
3. 单击目标实例模板的名称，进入实例详细信息页面。
可以查看实例模板的详细信息，包含已创建的实例模板的名称、实例、创建日期等信息。

# 删除实例模板
删除实例模板对基于该实例模板创建的实例没有影响。
删除后不可恢复，请谨慎操作。
1. 选择 “集中管理” $>$ “资源配置” $>$ “实例模板”，进入实例模板页面。
2. 单击目标实例模板所在行的 “删除”，弹出确认删除实例模板窗口。

# 说明：
用户可根据需要勾选一个或多个实例模板，并单击列表上方的 “删除” 按钮，批量删除实例模板。
3. 单击 “确定”，即可删除该实例模板。
若界面弹出 “实例模板删除成功” 提示信息，则说明删除实例模板成功。

# 4.3.2. TongDataGrid 管理
TongDataGrid 用于存储和备份应用的会话（Servlet 规范定义的 Session）数据，可在 TongWeb 实例意外宕机或在分布式环境下提供应用会话数据的高可用能力支撑。

# 4.3.2.1. 创建 TongDataGrid
创建 TongDataGrid 即搭建 TDG 集群。
完成 TongDataGrid 的创建后，TongDataGrid 所在节点自动组建为 TDG 集群。

# 前置条件
已添加用于创建 TongDataGrid 的节点。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 页面。
4. 单击 “创建”，进入创建 TongDataGrid 页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3b54e4b7ca6a33bbd28b0632003b1ff6ec1414cc240e797bcca83fb3923be962.jpg)
5. 配置 TongDataGrid 相关参数。
◦ 名称：必填项，TongDataGrid 的名称。
◦ 所在节点：必填项，勾选 TongDataGrid 所在节点。
关于 TongDataGrid 的更多参数说明，详见TongDataGrid 配置参数说明。
6. 单击 “添加”，完成 TongDataGrid 添加操作。
若界面弹出 “TongDataGrid 添加成功” 提示信息，则说明 TongDataGrid 添加成功。
添加成功后，TongDataGrid 运行中默认 “false” 状态。

# 4.3.2.2. 应用 TongDataGrid
完成 TongDataGrid 创建后，您可以将 TongDataGrid 与应用进行关联。

# 前置条件
• TongDataGrid 所在节点已启动。
• 已创建 TongDataGrid ，且 TongDataGrid 已启动。

# 创建会话服务器
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择 “资源管理” $>$ “会话服务器”，进入会话服务器页面。
4. 单击 “创建”，进入创建会话服务器页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/e7870ae953f8ebebdf1001a2891aea45fb734c6bafd4fb639daeb64e153e0674.jpg)
5. 配置会话服务器相关参数。
◦ 名称：输入会话服务器的名称。
◦ 使用外部会话服务器：不开启
◦ TongDataGrid：在下拉列表中，选择在 “资源配置” $>$ “TongDataGrid” 页面创建的TongDataGrid。
◦ 其他参数：请根据需要配置。
6. 配置完成后，单击 “添加”，完成会话服务器的添加操作。
若界面弹出 “会话服务器添加成功” 提示信息，则说明添加会话服务器成功。

# 应用会话服务器
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
4. 单击 “部署” 或者已部署应用的名称。
5. 单击 “会话与cookie”，选择已创建的会话服务器（TongDataGrid）。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/fea99056478155b7f841cf128f0cf54411b748e5fa586268659d637c26cad6f2.jpg)
6. 选择完成后，完成应用的部署或者更新即可。

# 4.3.2.3. 管理 TongDataGrid
您可以根据需要查看、编辑、启动、停止、强停、删除 TongDataGrid 以及移除 TongDataGrid 在控制台的记录。

# 查看 TongDataGrid
1. 选择 “集中管理” $>$ “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 列表页面。
2. 在 TongDataGrid 列表页面，您可以查看已创建的 TongDataGrid。
包含 TongDataGrid 的名称、所在节点、总实例数、实例端口、运行中等信息。

# 编辑 TongDataGrid
1. 选择 “集中管理” > “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 列表页面。
2. 单击目标 TongDataGrid 名称，进入编辑 TongDataGrid 页面。
3. 您可以根据提示修改 TongDataGrid 信息。
说明：
TongDataGrid 名称不可编辑。
4. 编辑完成后，单击 “更新”，更新 TongDataGrid 配置信息。
若界面弹出 “TongDataGrid 更新成功” 提示信息，则说明编辑 TongDataGrid 成功。

# 启动 TongDataGrid
1. 选择 “集中管理” > “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 列表页面。
2. 单击目标 TongDataGrid 所在行的 “启动”，弹出确认启动窗口。
说明：
用户可根据需要勾选一个或多个 TongDataGrid，并单击列表上方的 “启动” 按钮，批量启动TongDataGrid。
3. 单击 “确定”，启动 TongDataGrid。
若界面弹出 “TongDataGrid 启动成功” 提示信息，则说明启动 TongDataGrid 成功。

# 停止 TongDataGrid
已创建 TongDataGrid 且 TongDataGrid 处于 “运行中”。
1. 选择 “集中管理” > “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 列表页面。
2. 单击目标 TongDataGrid 所在行的 “停止”，弹出确认停止窗口。
说明：
用户可根据需要勾选一个或多个 TongDataGrid，并单击列表上方的 “停止” 按钮，批量停止TongDataGrid。
3. 单击 “确定”，停止 TongDataGrid。
若界面弹出 “TongDataGrid 停止成功”提示信息，则说明停止 TongDataGrid 成功。

# 强停 TongDataGrid
当 TongDataGrid 长时间难以成功停止，或者停止过程出现意外阻塞的情况时，您可以选择使用强制停止进程功能，强制停止通常是以强制杀进程的方式实现。
已创建 TongDataGrid 且 TongDataGrid 处于“运行中”。
1. 选择 “集中管理” $>$ “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 列表页面。
2. 单击目标 TongDataGrid 所在行的 “强停”，弹出强制停止确认窗口。
说明：
用户可根据需要勾选一个或多个 TongDataGrid，并单击列表上方的 “停止” 按钮，批量停止TongDataGrid。
3. 单击 “确定”，强制停止该 TongDataGrid。
若界面弹出 “TongDataGrid 强停成功”提示信息，则说明 TongDataGrid 强制停止成功。

# 删除 TongDataGrid
删除 TongDataGrid 时，TongDataGrid 引用的其它组件不会被删除。
1. 选择 “集中管理” > “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 列表页面。
2. 单击目标 TongDataGrid 所在行的 “删除”，弹出确认删除窗口。
说明：
用户可根据需要勾选一个或多个 TongDataGrid，并单击列表上方的 “删除” 按钮，批量删除TongDataGrid。
3. 单击 “确定”，完成 TongDataGrid 的删除操作。
若界面弹出 “TongDataGrid 删除成功” 提示信息，则说明删除 TongDataGrid 成功。

# 移除 TongDataGrid 记录
当 TongDataGrid 冗余或无法删除时，可通过移除记录的方式，移除 TongDataGrid 在控制台的记录。
移除 TongDataGrid 记录前，请先停止 TongDataGrid，并解除对 TongDataGrid 的相关引用，否则会导致移除失败。
1. 选择 “集中管理” > “资源配置” $>$ “TongDataGrid”，进入 TongDataGrid 列表页面。
2. 单击目标 TongDataGrid 所在行的 “移除记录”，弹出确认移除 TongDataGrid 窗口。
说明：
用户可根据需要勾选一个或多个 TongDataGrid，并单击列表上方的 “移除记录” 按钮，批量移除TongDataGrid 在控制台的记录。
3. 单击 “确定”，完成 TongDataGrid 的移除操作。
若界面弹出 “TongDataGrid 移除记录成功” 提示信息，则说明移除 TongDataGrid 记录成功。

# 4.3.3. 消息服务器
TongWeb 内置的消息服务器 TongWeb-MQ，是一个消息队列应用服务器（推送服务器），支持 JMS 规范。

# 4.3.3.1. 获取安装包
请联系官方获取 TongWeb-MQ 安装包（tongweb-mq-1.0.0.zip），并将其放至“${tongweb.home}/lib/mq” 目录中。

# 4.3.3.2. 创建并启动消息服务器
您可以通过 TongWeb 控制台远程创建 TongWeb-MQ。

# 1. 创建节点
a. 进入 “集中管理” 页面。
b. 在左侧导航栏中，选择 “服务管理” $>$ “节点”，进入节点列表页面。
c. 创建一个安装 TongWeb-MQ 消息服务器的节点。

# 2. 创建消息服务器
在集中管理中，基于已创建的节点，创建一个消息服务器。默认端口为 “7676”。
a. 进入 “集中管理” 页面。
b. 在左侧导航栏中，选择 “资源配置” $>$ “消息服务器”，进入消息服务器列表页面。
c. 单击 “创建”，进入创建消息服务器页面。
▪ 名称：必填项，消息服务器的名称，唯一标识。请使用常规英文字母，避免使用空格、斜杠、标点等特殊字符。
▪ 自启动：非必填，是否开启随节点启动而启动消息服务器。
▪ 所在节点：必填项，选择为创建的节点。
▪ 端口：必填项，消息服务器的端口。
d. 配置完成后，单击 “添加”，添加消息服务器。
消息服务器创建成功后，在 “${tongweb.base}/data/centralized/mq” 下会生成 TongWeb-MQ 运行实例。默认为 “停止” 状态。
在消息服务器列表页面，可对消息服务器进行启动、停止等管理。

# 3. 启动消息服务器
a. 进入 “集中管理” 页面。
b. 在左侧导航栏中，选择 “资源配置” $>$ “消息服务器”，进入消息服务器列表页面。
c. 单击目标消息服务器所在行的 “启动”，即可启动消息服务器。

# 4.3.3.3. 使用消息服务器 （示例说明）
以 “${tongweb.home}\version*\examples” 路径下的 “tmqjmsra.ra” 和 “jmsExample.war” 为例。
更多详细信息，请参见该路径下的 “tmqjmsra-readme.txt” 说明。

# 前置条件
已启动消息服务器。

# 修改适配器应应用
将 “tmqjmsra.rar/META-INF/ra.xml” 中的 “mq://localhost:7676/” 中的 IP 和 Port 修改为对应的消息服务器的 IP 和 Port。

# 部署适配器应用
1. 登录 TongWeb 管理控制台。
2. 部署消息服务器的适配器应用（tmqjmsra.rar）。
3. 创建 JCA 连接池，名称为 “testc”，连接定义选择 “javax.jms.ConnectionFactory”；
4. 创建 JCA 托管对象，名称为 “testd”，资源类型选择 “javax.jms.Queue”；
5. 创建 JCA 托管对象，名称为 “testa”，资源类型选择 “javax.jms.Topic”。

# 部署并访问应用
1. 部署 jmsExample.war 应用。
应用路径：${tongweb.home}\version*\examples
2. 访问 jmsExample.war 应用。
单击 "/MessageSend"。
若输出"testc: OK! testd: OK! send message …… send message successfully !"代表验证成功。
单击其它三个链接，输出类似的信息代表验证成功。
其中，单击 "/XAMessageSend"、"/XAMessageSend?byZero=true" 分别测试 jms XA 的 commit 和rollback。

# 4.3.3.4. 管理消息服务器
本章节介绍如何停止、强停、删除消息服务器以及移除消息服务器记录。

# 停止消息服务器
停止消息服务器后，使用该消息服务器再次发送消息会失败。
1. 选择 “集中管理” $>$ “资源配置” $>$ “消息服务器”，进入消息服务器列表页面。
2. 单击目标消息服务器所在行的 “停止”，弹出确认停止窗口。

# 说明：
用户可根据需要勾选一个或多个消息服务器，并单击列表上方的 “停止” 按钮，批量停止消息服务器。
3. 单击 “确定”，停止消息服务器。
若界面弹出“消息服务器停止成功”提示信息，则说明停止消息服务器成功。

# 强停消息服务器
当消息服务器长时间难以成功停止，或者停止过程出现意外阻塞的情况时，您可以选择使用强制停止进程功能，强制停止通常是以强制杀进程的方式实现。
1. 选择 “集中管理” $>$ “资源配置” $>$ “消息服务器”，进入消息服务器列表页面。
2. 单击目标消息服务器所在行的 “强停”，弹出强制停止确认窗口。

# 说明：
用户可根据需要勾选一个或多个消息服务器，并单击列表上方的 “强停” 按钮，批量强停消息服务器。
3. 单击 “确定”，强制停止该消息服务器。
若界面弹出“消息服务器强停成功”提示信息，则说明消息服务器强制停止成功。

# 删除消息服务器
删除消息服务器时，消息服务器引用的其它组件不会被删除。
1. 选择 “集中管理” > “资源配置” $>$ “消息服务器”，进入消息服务器列表页面。
2. 单击目标消息服务器所在行的“删除”，弹出确认删除窗口。

# 说明：
用户可根据需要勾选一个或多个消息服务器，并单击列表上方的 “删除” 按钮，批量删除消息服务器。
3. 单击 “确定”，完成消息服务器的删除操作。
若界面弹出 “消息服务器删除成功” 提示信息，则说明删除消息服务器成功。

# 移除消息服务器记录
当消息服务器冗余或无法删除时，可通过移除记录的方式，移除消息服务器在控制台的记录。
移除消息服务器记录前，请先停止消息服务器，并解除对消息服务器的相关引用，否则会导致移除失败。
1. 选择 “集中管理” $>$ “资源配置” $>$ “消息服务器”，进入消息服务器列表页面。
2. 单击目标消息服务器所在行的 “移除记录”，弹出确认移除消息服务器窗口。

# 说明：
用户可根据需要勾选一个或多个消息服务器，并单击列表上方的 “移除记录” 按钮，批量移除消息服务器在控制台的记录。
3. 单击 “确定”，完成消息服务器的移除操作。
若界面弹出 “消息服务器移除记录成功” 提示信息，则说明移除消息服务器记录成功。

# 4.4. 安全配置
安全配置是全局配置，对所有实例（包含默认实例 domain1）有效。

# 4.4.1. 三员分立
涉密信息系统中的 “三员” 是指系统管理员、安全保密管理员（security）、安全审计员（auditor）。
“三员分立” 要求系统管理员、安全保密管理员（security）、安全审计员（auditor）三者之间的关系相互独立、互相制约，加强涉密信息系统保密管理，减少泄密风险，而三员分立权限控制模型就是基于“三员分立”权限管理方法。
TongWeb 管理控制台采用了“三员分立”权限管理方法来确保系统的安全保密。
TongWeb 还提供系统资源监视管理员（monitor），要求系统资源监视管理员，可查看系统所有资源，但无法写入。

# 注意：
• 系统管理员、安全保密管理员、安全审计员、系统资源监视员为系统内置用户。
若需要修改密码，需要在安装 TongWeb 的本机 IP 进行修改。详细操作请参见修改密码。
• 内置用户不允许删除。
管理员权限说明
<table><tr><td>管理员</td><td>说明</td></tr><tr><td>系统管理员 (thanos)</td><td>系统管理员权限:创建、编辑、删除管理员对TongWeb进行各种维护、部署、监控及配置操作如下为系统提供的系统管理员初始密码。默认用户名: thanos初始密码: thanos123.com。注意:首次使用系统管理员账号时,需要在安装TongWeb的本机IP修改初始密码。</td></tr><tr><td>安全保密管理员（security）</td><td>负责在系统中创建角色，并将这些角色分配给相应的用户，同时为用户配置数据权限。
安全相关的用户、角色、权限等数据均加密存储，保障用户数据不泄漏。如下为系统提供的安全保密管理员初始密码。
·默认用户名：security
·初始密码：security123.com
只有安全保密管理员具有角色管理权限，详见“角色”章节。
注意：
·首次使用安全保密管理员账号时，需要修改初始密码，可以由系统管理员修改，也可以由安全保密管理员自己修改。
·内置用户需要在安装TongWeb的本机IP修改初始密码。</td></tr><tr><td>安全审计员（auditor）</td><td>系统管理员及安全保密管理员进行的日常操作都会记录在审计日志中。
安全审计员主要负责对系统管理员和安全保密管理员的操作行为进行审计跟踪、分析和监督检查，及时发现违规行为，并定期向系统安全保密管理机构汇报情况。
安全审计员拥有的角色权限是查询已经生成的审计日志。如下为系统提供的安全审计员初始密码。
·默认用户名：auditor
·初始密码：auditor123.com
注意：
·首次使用安全审计员账号时，需要修改初始密码，可以由系统管理员修改，也可以由安全审计员自己修改。
·内置用户需要在安装TongWeb的本机IP修改初始密码。
安全审计员对审计日志的具体操作，请参见“审计日志”章节。</td></tr><tr><td>系统资源监视管理员 (monitor)</td><td>系统资源监视管理员（monitor）可查看系统管理员的相关资源，但无权操作。如下为系统提供的初始密码。
·默认用户名：monitor
·初始密码：monitor123.com注意：
·首次使用系统资源监视管理员时，需要修改初始密码，可以由系统管理员修改，也可以由系统资源监视管理员自己修改。
·内置用户需要在安装TongWeb的本机IP修改初始密码。</td></tr></table>

# 4.4.2. 新增管理员
管理员可登录管理控制台，并对 TongWeb 服务器进行一系列操作。
TongWeb 默认提供了系统管理员、安全保密管理员以及安全审计员。
您也可以根据自己的需要创建您所需要的管理员账户，并赋予该管理员账户指定的权限。该管理员账户即可登录管理控制台，并对 TongWeb 服务器执行相关操作。

# 4.4.2.1. 步骤1：创建管理员
通过系统管理员创建的管理员账号仅包含修改登录密码、使用加密工具等权限。
若您需要给该管理员赋予更多的权限，请使用安全保密管理员账户来执行权限赋予操作，详见分配权限。

# 注意事项
• 系统管理员会为新增用户自定义设置密码，这些用户没有预设的默认密码。
• 系统管理员可以为不同用户设置不同的密码规则（如密码最小长度和复杂度）以进行密码强度校验。新用户可以根据管理员设定的密码规则进行密码更新。
注： 新用户也可以通过添加启动参数 “-Dtongweb.check.disabled=length,age,composition” 的方式，禁用密码强度校验。
分别表示：禁用长度、期限、复杂度。

# 前置条件
已获取系统管理员账号（thanos）和密码。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “管理员”，进入管理员列表页面。
4. 单击 “创建”，进入创建管理员页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/9e4d35c5ba5299c915ed98f14ad3f304e1065c1c9cf6777655da68baa30b465d.jpg)
5. 配置管理员的相关参数。
关键参数说明，如下所示。
◦ 账户名称：必填项，唯一标识。需要使用常规英文字母，避免使用空格、斜杠、标点等特殊字符。
◦ 账户密码：必填项，输入的密码为新增管理员的初始密码，首次登录时要求修改密码。
◦ 确认密码：必填项，与账户密码保持一致。
◦ 摘要算法：必填项，单击 “安全” tab 页签，进入安全页面。“摘要算法” 默认 SHA-256，可选择SM3、SHA-256、SHA-384、SHA-512。
其他参数说明，如下所示。
密码最长使用期限：非必填，用户密码使用期限最长支持设置到 180 天。
关于管理员的更多参数说明，详见管理员配置参数说明。
6. 单击 “添加”，完成管理员的添加操作。
若界面弹出 “管理员添加成功” 提示信息，则说明添加管理员成功。
7. 为管理员授权。
若需要为该管理员赋予相关权限，详见分配权限。

# 4.4.2.2. 步骤2：创建角色
角色主要是管理登录和操作服务器的用户所属角色，不同的角色包含不同的权限。
您需要使用安全保密管理员（security）账号登录 TongWeb 控制台，随后创建角色，并将这些角色分配给相关管理员。
TongWeb 默认提供的内置角色包含：系统管理员（thanos）、安全保密管理员（security）、安全审计员角色（auditor）。
您可以根据基于实际需求创建更多角色。

# 前置条件
已获取安全保密管理员（security）账号和密码。

# 操作步骤
1. 使用安全保密管理员（security）账号登录 TongWeb 管理控制台。
注： 首次登录需要修改初始密码。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 左侧导航栏中，选择 “安全配置” $>$ “角色”，进入角色列表页面。
4. 单击 “创建”，进入创建角色页面。

# 角色
*名称
描述
权限
是否激活
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c5a80d2edbfa7c210169a3fa0d8a3eda27951e12167ce66e2b3268f118d8166f.jpg)
5. 配置角色的相关参数。
◦ 名称：必填项，需要使用常规英文字母，避免使用空格、斜杠、标点等特殊字符。
◦ 其他参数：非必填，请根据实际情况填写。
角色相关参数说明，如下表所示。
持久化位置：conf/console.xml:console>auth>roles>role
Table 2. 角色的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>该角色的唯一标识。</td></tr><tr><td>info</td><td>描述</td><td>该角色的描述说明信息。</td></tr><tr><td>uris</td><td>权限</td><td>角色的权限表示具有该角色的用户可以访问的资源（URI）集合。</td></tr><tr><td>active</td><td>是否激活</td><td>是否激活该角色，激活后，拥有该角色的用户将可以访问该角色对应的资源，否则用户将无法访问对应的资源。</td></tr></table>
6. 单击 “添加”，完成角色的添加操作。
若界面弹出 “角色添加成功” 提示信息，则说明添加角色成功。

# 4.4.2.3. 步骤3：分配权限
角色创建成功后，您可以将其分配给不同的管理员，使这些管理员获得与角色匹配的管理和操作权限。
此外，您还能为管理员配置数据权限（包含实例、集群、节点），若未分配指定数据权限，则表示管理员有管理所有相关数据的权限。

# 注意事项
为了避免普通运维人员对默认实例 domain1 进行操作，系统支持用户采用权限分配的方式，将默认实例domain1 隐藏。
当多节点运行环境下，用户只需要取消勾选 “default” 节点，就能隐藏该管理员对应的的默认实例 domain1页面。

# 前置条件
• 已获取安全保密管理员（security）账号和密码。
• 使用默认的系统内置角色或者已创建自己的角色。
• 若需要分配数据权限，请确认已创建实例、集群或节点。

# 操作步骤
1. 使用安全保密管理员（security）账号登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “权限分配”，进入权限分配列表页面。
4. 单击目标账号，进入权限分配页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ed8c28bbddf00fed5ec759e5e7f529cc25bd4559ef1d61429fc1a3068a7022a6.jpg)
5. 配置权限角色的相关参数，如下表所示。
持久化位置：conf/console.xml:console>auth>users>user
Table 3. 权限分配的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>管理员的登录名。</td></tr><tr><td>roles</td><td>角色</td><td>管理员的角色，给管理员分配不同的角色以控制访问不同的资源。</td></tr><tr><td>instances</td><td>实例</td><td>分配可管理的实例列表。</td></tr><tr><td>clusters</td><td>集群</td><td>分配可管理的集群列表。</td></tr><tr><td>nodes</td><td>节点</td><td>分配可管理的节点列表。</td></tr></table>
6. 单击 “更新”，完成角色的分配操作。
若界面弹出 “权限分配更新成功” 提示信息，则说明权限分配成功。

# 4.4.3. 管理管理员
用户可根据需要查看、编辑或者删除管理员。

# 查看管理员
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 ，进入集中管理页面。
3. 左侧导航栏中，
4. 在管理员列表页面，您可以查看已创建或者 TongWeb 默认提供的管理员。
包含管理员名称、描述、密码最后修改时间、是否激活等信息。

# 编辑管理员
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 左侧导航栏中，选择 “安全配置” $>$ “管理员”，进入管理员列表页面。
4. 单击目标管理员，进入编辑管理员页面。
5. 您可以根据提示修改管理员信息。
6. 编辑完成后，单击 “更新”，更新管理员信息。
若界面弹出 “管理员更新成功” 提示信息，则说明编辑管理员成功。

# 删除管理员
删除管理员时，管理员引用的其它组件不会被删除。
出于安全考虑，TongWeb 提供的内置管理员账号（thanos、security、auditor）不能删除。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “管理员”，进入管理员列表页面。
4. 单击目标管理员所在行的 “删除”，弹出确认删除窗口。
5. 单击 “确定”，完成管理员的删除操作。
若界面弹出 “管理员删除成功” 提示信息，则说明删除管理员成功。

# 4.4.4. 管理角色
用户可根据需要查看、编辑或者删除角色。

# 查看角色
1. 使用安全保密管理员（security）账号登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “角色”，进入角色列表页面。
4. 在角色列表页面，您可以查看已创建或者 TongWeb 默认提供的角色。
包含角色名称、描述、是否激活等信息。

# 编辑角色
出于安全考虑，系统内置角色（system、security、auditor、monitor）不能编辑。
1. 使用安全保密管理员（security）账号登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “角色”，进入角色列表页面。
4. 单击目标角色，进入编辑角色页面。
5. 您可以根据提示修改角色信息。
6. 编辑完成后，单击 “更新”，更新角色信息。
若界面弹出 “角色更新成功” 提示信息，则说明编辑角色成功。

# 删除角色
删除角色时，角色引用的其它组件不会被删除。
出于安全考虑，系统内置角色（system、security、auditor、monitor）不能删除。
1. 使用安全保密管理员（security）账号登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “角色”，进入角色列表页面。
4. 单击目标角色所在行的 “删除”，弹出确认删除窗口。
5. 单击 “确定”，完成角色的删除操作。
若界面弹出 “角色删除成功” 提示信息，则说明删除角色成功。

# 4.4.5. 管理权限分配
用户可根据需要查看或编辑权限分配。

# 查看权限分配
1. 使用安全保密管理员（security）账号登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “权限分配”，进入权限分配列表页面。
4. 在权限分配列表页面，您可以查看已创建或者 TongWeb 内置的管理员、角色以及分配的实例、集群或节点。

# 编辑权限分配
出于安全考虑，系统内置用户不能编辑权限分配。
1. 使用安全保密管理员（security）账号登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “权限分配”，进入权限分配列表页面。
4. 单击目标角色，进入编辑权限分配页面。
5. 您可以根据提示修改权限分配信息。
6. 编辑完成后，单击 “更新”，更新权限分配信息。
若界面弹出 “权限分配更新成功” 提示信息，则说明编辑权限分配成功。

# 4.4.6. 访问令牌
访问令牌是用于身份验证和授权的凭证，通常是一串加密字符串，用于访问受保护的 API、服务或资源。通过访问令牌外部系统可以实现免用户名/密码的认证方式直接管理 TongWeb。
该访问令牌在未触发登录流程时，保持永久有效状态。使用时可反复调用，方便程序集成。

# 1. 创建访问令牌
a. 安全保密管理员（security）账号登录 TongWeb 管理控制台。
b. 在左侧菜单栏中，选择 “安全配置” $>$ “访问令牌”，进入访问令牌页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/0005a69e12f7bb9e90e2b450ee60644ec9c2f91b78b2073e05104efd9f30fed0.jpg)
c. 单击 “创建”，进入创建访问令牌页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/73011cbe96ed3c5e45f568ad3a0ec8e4158d7f4269a9cff700247fd6a3ebfabe.jpg)
d. 配置访问令牌相关属性。
▪ 名称：必填项，访问令牌的名称。
▪ 角色：必填项，指定该令牌的角色，以控制其访问资源的权限。
▪ 激活：必填项，若未激活，则无法登录服务器。
关于访问令牌的更多参数说明，详见访问令牌配置参数说明。
e. 配置完成后，单击 “添加”，即可完成访问令牌的添加操作。

# 2. 获取访问令牌
a. 打开已创建访问令牌的名称对应的链接，进入编辑访问令牌页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/5c38f8399d6e9adea56bd7a6b1bc46908882ce60809674c6aedf6b1c78bb57e0.jpg)
b. 拷贝生成的访问令牌，如上图红框中所示。

# 3. 外部系统以访问令牌方式访问 TongWeb 资源
通过 "tw_access_token=[访问令牌]" 方式进行认证，如下所示。
```txt
https://localhost:9060/console/rest/json/user/list?tw_access_token=rtaLsjWrmpbKGgCTKxf
```

# 4.4.7. 修改密码
修改密码主要是用于更新当前登录用户的密码。
针对系统内置的账号（thanos、security、auditor、monitor）重置初始密码时，需要在安装 TongWeb 的本机 IP 上进行修改。
• 当本地主机有浏览器（如 Windows 系统）时，可直接通过控制台更新密码。
• 当本地主机没有浏览器（如 Linux 系统）时，可通过命令行方式更新密码。

# 注意事项
出于安全考虑，修改密码时，禁止使用最近 5 次使用过的旧密码。

# 约束说明
• 请确认三员首次修改密码的浏览器所在的 IP 为 TongWeb 服务器本机或者已受信任。
• 若浏览器所在 IP 不是 TongWeb 服务器本机 IP 或者不被信任，需要在 TongWeb 服务器主机上设置信任客户端 IP，详见控制台安全。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “修改密码”，进入修改密码页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/430986cdd830bea655fbe425a52399c6ee70d89e23a54c7c9e25f8db97c47e11.jpg)
4. 修改登录密码。
◦ 修改密码：非必填，打开 “修改密码” 开关。若不需要修改密码，则关闭该开关。
◦ 原始密码：必填项，输入该账户登录系统的原始密码。
◦ 新密码：必填项，密码输入大小写字母、特殊符号且不能包含三个或三个以上相同或连续的字符，长度需要满足大于等于 8 个字符。
◦ 确认密码：必填项，与新密码保持一致。
◦ 动态密码：非必填，若需要开启动态密码，详见开启动态密码。
关于修改密码的更多说明，详见修改密码参数配置说明。
5. 密码修改完成后，单击 “更新”，更新登录密码信息。
若界面弹出 “修改密码成功” 提示信息，则说明修改密码成功。

# 4.4.8. 动态密码

# 4.4.8.1. 开启动态密码
开启 “动态密码” 后，“密码” 和 “动态密码” 用户可任选其一登录 TongWeb 控制台。
若开启 “动态密码” 后，再开启 “双因子认证”，则系统会同时验证账户密码和动态密码。

# 前置条件
• 用户系统支持动态密码。
• 手机上已下载生成动态口令的手机客户端软件，如 “宁盾令牌”。
• 请确保安装 TongWeb 的服务器时间与手机时间保持一致。
• 已获取系统管理员账号和密码。

# 约束限制
若仅开启动态密码，没有绑定动态密码，则动态密码不起作用。

# 操作步骤
创建的账户以 “admintest” 为例说明。

# 1. 开启动态密码。
a. 使用 “admintest” 账号登录到 TongWeb 管理控制台。
b. 进入 “集中管理” $>$ “安全配置” $>$ “修改密码”，进入修改密码页面。
c. 为该账户（admintest）开启动态密码。
注： 若不修改密码，则关闭 “修改密码” 开关。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/82f18e515fb2a7d08743ef270a62aef09bce5d4192457e782e234b38993c6f6d.jpg)
d. 单击 “更新”，即可完成动态密码的开启操作。

# 2. 输入动态密码。
a. 选择 “集中管理” $>$ “安全配置” $>$ “修改密码”，进入修改密码页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/530793c6efe0d08faf483253fa6af155b000be50ebac5d7f3bec18e1e57d1698.jpg)
b. 单击 “刷新动态密码”，弹出二维码窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c1ae2d04f5110d1e7c533f80b469a7396f1d9d75c1f0bdf31ed9c2d2a2d945c3.jpg)
c. 使用生成动态口令的手机客户端软件，扫描如上一步中的二维码。
如下以 “宁盾令牌” 手机客户端软件为例。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b1b49160236d31133f458f08758bb8469542fcb6a4bf31227a8cafca9bf5bd1b.jpg)
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/2b951da0edb1d4be69c5ca402a4561ffb3ea7aee5a9c861d9b7ce986703b6607.jpg)
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3f03cb13406855548ed0703afb4843e86085c57dc1daefe00d367cefcbb48bbb.jpg)
d. 将获取的动态码（每30秒更新一次）输入文本框，并单击 “确定”。
若界面弹出 “绑定成功” 提示信息，则说明绑定动态密码成功。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/6459cf35a4fb3e68745be9dfac95cb23ca2a84eecbb833eaa76fd5bea98a5059.jpg)
e. 退出当前登录后，再次登录 TongWeb 管理控制台。
输入动态码，即可成功登录到 TongWeb 控制台。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7b168972a4833165a70d1af795c0ee72ff0e1d767740e3e0931b396cfc563df5.jpg)


# 4.4.8.2. 更新动态密码
为了保证账号的安全，建议定期更新动态密码。
若需要更新动态密码，请单击 “刷新动态密码”，扫描二维码进行重新绑定。

# 前置条件
• 已获取管理员账号和密码，以 “admintest” 为例。
TongWeb 管理控制台的账号均可开启 “动态密码” 验证，请根据实际情况开启或者更新。
• 账号已开启 “动态密码”。
• 手机上已下载生成动态口令的手机客户端软件，如 “宁盾令牌”。
• 若不需要修改密码，则将修改密码开关 “关闭”。

# 操作步骤
1. 使用管理员账号（如 admintest）登录 TongWeb 管理控制台。
2. 选择 “集中管理” $>$ “安全配置” $>$ “修改密码”，进入修改密码页面。

# 修改密码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/2adca5aa2f54eeb7d672812f4a04ccff76196ccd2037289ebf268bfd89e946c0.jpg)
修改密码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/01fc52681b80587a88c0a3071b2295241d0f583ac2e291c88030363cdc5b0960.jpg)
*原始密码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/2d06bbfd6833278d146b700027ce25186690865397e89e1d9f8ca88145d3d3bc.jpg)
*新密码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/4ed4fc7ae1930cea68b89615fd95dcd89238b083b2c507228e4c9a719b057433.jpg)
*确认密码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/8ca529b9202386fcd7495aadb15a5775eb698e712aeae27459ae31f8e3e5882b.jpg)
动态密码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/37d190e2dd69f6ba7fa0a6ab1daf2d3dd3fce38475acd554f8d17b7cb15010e8.jpg)
更新
刷新动态密码
3. 单击 “刷新动态密码”，弹出二维码窗口。
请使用TOTP客户端扫描二维码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/bc7a9bddb2d79b6d524dfe4c13984bdf78dd0aeec6e44c6a585d807ff06a350f.jpg)
请输入动态密码
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/a488e3ee0dd93457bf39df8b58095a197d6a63be3216c20d9346dc30fe8c4c0e.jpg)


# 确定
4. 使用生成动态口令的手机客户端软件，如 “宁盾令牌”，扫描二维码。
5. 将获取的动态码（每30秒更新一次）输入文本框，并单击 “确定”。
若界面弹出 “绑定成功” 提示信息，则说明绑定动态密码成功。
您即可使用动态码进行验证登录 TongWeb 管理控制台。

# 4.4.9. 控制台安全

# 4.4.9.1. 自定义控制台访问前缀
出于安全考虑，用户可能不允许 TongWeb 控制台使用默认的应用前缀（console）。TongWeb 支持自定义控制台的应用前缀。

# 通过控制台自定义
通过控制台自定义访问前缀，需要在提示时间后使用修改后的访问前缀重新访问 TongWeb 管理控制台。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/72b5c1d7c84a778cc6cb9d1d15223b7934e8a1bfba199f2d7315ee9515a6cac5.jpg)
4. 在 “访问前缀” 文本框中，输入自定义的控制台访问前缀。
5. 配置完成后，单击 “更新”，即可使用自定义的控制台前缀登录 TongWeb 管理控制台。

# 通过 tongweb.xml 自定义
TongWeb 控制台的访问前缀为 “/console”，若您需要将 “/console” 修改为其它值，可通过如下方式修改。
注：主配置文件 tongweb.xml 具备防篡改限制，在运行期间禁止对其进行修改。
若需要修改并使其生效，请先停止 TongWeb 服务器，然后再进行修改。
如下以将 “/console” 修改为 “/admin” 为例进行说明。
1. 进入 “${tongweb.base}/conf” 目录。
2. 打开 “tongweb.xml” 文件。
3. 将 “contextRoot” 修改为 “admin”。
```xml
<applications> <app allowCasualMultipartParsing="true" antiClickJackingOption="DENY" appId="console" contextRoot="console" xmlns:SSSFilterEnabled="false" addWebinfClassesResources="false" allowCasualMultipartParsing="false" allowLinkin></applications>
```
4. 修改完成后，保存并启动 TongWeb 服务器。
您即可使用 “/admin” 前缀访问 TongWeb 管理控制台。
例如：https://localhost:9060/admin

# 4.4.9.2. 设置信任 IP
出于安全考虑，TongWeb 对于非信任 IP 禁止登录 TongWeb 管理控制台。用户将无法进行任何操作。
默认仅安装 TongWeb 的本机受信任。
当使用远程浏览器访问 TongWeb 控制台前，请在安装 TongWeb 的本机将远程浏览器所在主机的 IP 设置为“信任 IP”。

# 4.4.9.2.1. 注意事项
• 信任 IP 可为具体的 IP、匹配 IP 的正则表达式或通配符 IP（如：168.1.2.*，168.1.4.5-168.1.4.99）。
• 设置为 “*” 表示信任所有机器（不建议）。
若设置为 “*”，用户可根据需要选择是否开启 “信任 IP 安全警示”。开启 “信任 IP 安全警示” 后，控制台页面上会以 “小红点” 的形式给出安全警示信息。

# 4.4.9.2.2. 限制说明
• 针对本机浏览器
安装 TongWeb 后，默认仅本机受信任，本机操作不受限制。
• 针对远程浏览器
在安装 TongWeb 的本机将远程访问 TongWeb 控制台的主机 IP 设置为 “信任 IP” 后，远程浏览器才有权限执行相关操作。

# 4.4.9.2.3. 限制现象
当使用远程浏览器访问 TongWeb 控制台，并且没有设置信任 IP，可能会遇到 “该操作仅限于在服务器本机或受信任的IP上执行” 等提示信息，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/e59986de201dc98664cc8435924f21cfaf9972b11e3fb8a55f3abbc7b9f3eaa6.jpg)


# 4.4.9.2.4. 方式一：控制台设置信任 IP
需要浏览器所在 IP 是服务器本机或者已受信任。

# 控制台设置信任 IP
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击“集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择“安全配置”>“控制台安全”，进入控制台安全页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f6a06d2eae6bb5224d33fc161d1d20ca2e633676a899876e2c0739e3d06a7ca2.jpg)
4. 配置信任 IP。
指定信任的客户端 IP 地址，其值可为具体的 IP、匹配 IP 的正则表达式或通配符 IP（如：168.1.2.*，168.1.4.5-168.1.4.99）。
5. 配置完成后，单击 “更新”，即可完成控制台安全的配置。
若界面弹出 “控制台安全更新成功”，则说明控制台安全配置成功。

# 4.4.9.2.5. 方式二：命令行设置信任IP
启动 TongWeb，并进入 “${tongweb.home}/bin” 目录，执行如下命令，设置信任IP。
如下以信任 IP 为 “192.168.1.1” 为例说明。
```batch
sh commandstool.sh --username=thanos --password=Thanos12.com --acceptAgreement=true --model=consolesecurity --action=update trustedIP=192.168.1.1
```
若设置的是正则表达式，则需要先进行编码，编码方式如下所示。
1. 进入 TongWeb 管理控制台。
2. 切换到目标实例。
3. 选择“基础配置”>“加密工具”，进入加密工具页面。
4. 加密类型选择“特殊字符”。
5. 单击“加密”，即可得到加密结果。

# 4.4.9.2.6. 方式三：通过修改 console.xml 文件
console.xml 文件路径 “${tongweb.base}/conf/”。
为 console 节点添加或者修改 “trustedIP” 属性，设置完成后，需要重启 TongWeb 服务器，方可生效。
“trustIP” 可以设置为 IP、匹配 IP 的正则表达式或者通配符 IP。

# 注意事项
• 系统默认开启 “服务器主配置文件防篡改”，TongWeb 运行期间禁止对主配置文件 “tongweb.xml” 或“console.xml” 进行修改。
• 若需要修改 “console.xml”，请确保 TongWeb 服务器处于停止状态或 “服务器主配置文件防篡改”（“安全管理” $>$ “安全策略” $>$ “文件防篡改”）关闭。

# 示例说明
如下以将 trustIP 设置为 IP 地址为例进行说明。
```txt
<console trustedIP="192.168.1.1">
```

# 4.4.9.3. 禁用文件上传
禁用文件上传可以在很大程度上保护系统的安全。
禁用后，攻击者将不能再通过 TongWeb 控制台来进行部署木马应用、上传恶意程序等操作。

# 注意事项
• 禁用文件上传后，您仍然可以设置文件在服务器上的位置来进行相关操作。
• 出于安全考虑，控制台默认开启禁用文件上传功能，建议保持开启状态。

# 关闭禁用文件上传
关闭禁用文件上传功能后，用户即可通过上传文件功能上传文件。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/eb0d7c793d0ca1c5bae14af24d7df24618982584dafa8563b47bdf5c5e5884ce.jpg)
4. 关闭 “禁用文件上传”。
5. 单击 “更新”，更新配置。
6. 重启 TongWeb 服务器，使配置生效。
配置生效后，控制台界面的上传功能即可使用。

# 4.4.9.4. 禁用文件下载
禁用文件下载可以在很大程度上保护系统的安全。
禁用后，攻击者将不能再通过 TongWeb 控制台来下载系统相关的文件。

# 注意事项
出于安全考虑，建议保持禁用文件下载功能。

# 关闭禁用文件下载
关闭禁用文件下载功能后，用户即可通过下载文件功能下载文件。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
4. 关闭 “禁用文件下载”。
5. 单击 “更新”，更新配置。
6. 重启 TongWeb 服务器，使配置生效。
配置生效后，控制台界面的下载功能即可使用。

# 4.4.9.5. 设置失败锁定
用户可设置失败锁定次数及锁定时长。当用户连续失败认证达到一定次数后，其账户将被自动锁定，以防止潜在的恶意尝试或误操作。

# 默认锁定
默认情况下，失败锁定次数 “5”，锁定时长 “300” 秒。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
4. 在 “基本属性” 页签下，设置失败锁定次数及锁定时长。
5. 设置完成后，单击 “更新”，即完成失败锁定设置操作。

# 4.4.9.6. 设置控制台会话超时时间
用户可设置控制台会话超时时间。

# 默认超时时间
默认超时时间为 “15” 分钟。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
4. 在 “基本属性” 页签下，设置会话超时时间。
5. 设置完成后，单击 “更新”，即完成会话超时时间设置操作。

# 4.4.9.7. 启/停验证码
开启用户登录时的验证码校验。默认开启，当首次登录失败后，再次登录需要输入验证码。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
4. 在 “基本属性” 页签下，打开/关闭启用验证码开关。
5. 设置完成后，单击 “更新”，即完成启/停验证码操作。

# 4.4.9.8. 允许浏览器记住密码
开启后，可支持通过浏览器记住登录密码。通常情况下，当浏览器对密码进行管理时，会校验当前 SSL/TLS通信证书的有效性。因此，在开启此功能之前，您需要更换为有效的证书（默认的自签名证书可能会校验不通过），或者选择关闭 SSL/TLS 通道（https 协议切换为 http）。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
4. 在 “基本属性” 页签下，打开/关闭 “允许浏览器记住密码”。
5. 设置完成后，单击 “更新”，即完成启用/停用 “允许浏览器记住密码” 操作。

# 4.4.10. OAuth2 协议认证登录控制台
开启 OAuth2 认证，将会关闭 TongWeb 自身的认证机制，而使用统一的 OAuth2 协议的认证服务来登录。
启用 OAuth2 认证后，需要退出登录，并重新输入 TongWeb 控制台的 URL 地址，然后才能进入 OAuth2协议认证平台。

# 注意事项
• 启用后，立即生效，请首先确保 OAuth2 服务已经启动并可正常使用，否则将出现无法登录 TongWeb的情况。
• 开启 OAuth2 认证后，收藏功能将会被屏蔽；关闭 OAuth2 认证后，原收藏菜单里的数据恢复显示。由于收藏功能保存在 console.xml 文件的用户信息里，使用 OAuth2 认证后，根据登录用户信息找不到收藏列表，且也收藏不成功。
• 开启 OAuth2 认证后，所有启用 OAuth2 认证的相关参数在运行期间不可更改。

# 前置条件
• 已搭建且启动 OAuth2 协议的认证服务且可正常使用。
• 已获取 OAtuth2 认证相关信息。
• 已获取登录 OAuth2 协议的云鉴认证平台的账号和密码。

# 步骤1：启用 OAuth2 认证
1. 打开 “启用 OAuth2 认证” 开关。
a. 登录 TongWeb 管理控制台。
b. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
c. 在左侧导航栏中，选择 “安全配置” $>$ “控制台安全”，进入控制台安全页面。
d. 单击 “OAuth2”，进入 OAuth2 页签。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/8908c5cae803b78d7904fa7bf5ea96b62885a110377b617a93cee5f206f39d93.jpg)
e. 打开 “启用 OAuth2 认证” 开关即可。
2. 配置 OAuth2 相关参数。

# 持久化位置：
1. conf/console.xml:console
2. [consoleContextRoot]conf/tongweb.xml:tongweb>server>applications>app
3. [verCodeEnabled]conf/console.xml:console>auth
4. [oauth2]conf/console.xml:console>oauth2
Table 4. 控制台安全的【OAuth2】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用 OAuth2 认证</td><td>开启 OAuth2 认证，这将会关闭 TongWeb 自身的认证模式，转而切换到指定的 OAuth2 认证模式。注：该功能启用后立即生效，请刷新浏览器重新登录，并且相关参数在运行期间不可更改，如需变更则需在停止 TongWeb 后通过手动修改 ${tongweb.base}/conf/console.xml 文件来完成。</td></tr><tr><td>serverVendor</td><td>OAuth2 服务商</td><td>指定 OAuth2 服务的提供商，默认为东方通认证中心产品 TongAuth。出于安全性考虑，此处并未给出已支持的厂商列表，有关定制需求可联系https://www.tongtech.com/。</td></tr><tr><td>twHost</td><td>此 TongWeb 对外域名</td><td>此 TongWeb 服务控制台对外可见的域名，注意不要包含其“访问前缀”，例如：https://localhost:9060/。</td></tr><tr><td>clientId</td><td>客户端ID</td><td>设置从 OAuth2 服务器注册得到的身份ID。</td></tr><tr><td>clientSecret</td><td>客户端密码</td><td>设置从 OAuth2 服务器注册得到的身份ID的验证密码。</td></tr><tr><td>authorizeUrl</td><td>授权地址</td><td>设置从 OAuth2 服务器获得用户授权的 url 地址。</td></tr><tr><td>tokenUrl</td><td>获取 Token 地址</td><td>设置从 OAuth2 服务器获取访问 Token 的 url 地址。</td></tr><tr><td>introspectUrl</td><td>验证 Token 地址</td><td>设置从 OAuth2 服务器刷新 Token 的 url 地址。</td></tr><tr><td>userUrl</td><td>获取用户信息地址</td><td>设置从 OAuth2 服务器获取用户账号等信息的 url 地址。</td></tr><tr><td>logoutUrl</td><td>注销 Token 地址</td><td>设置从 OAuth2 服务器注销 Token 的 url 地址。</td></tr></table>
3. 配置完成后，单击 “更新”，即可开启 OAuth2 认证。

# 步骤2：登录 TongWeb 控制台
1. 退出当前 TongWeb 控制台登录。
2. 在浏览器地址栏中，输入 TongWeb 的登录地址，如 “https://localhost:9060/console”。
3. 系统自动跳转到 OAuth2 协议认证平台登录界面。
如下以 “云鉴” 认证平台为例。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/a8f2e8b1fd414fe2ab780ff18f644fc19804252389e7129fcc570fb50d3fb7f4.jpg)
4. 输入登录 OAuth2 协议认证平台的账号和密码。
5. 单击 “登录”，即可登录到 TongWeb 控制台。

# 关闭 OAuth2 协议认证
通过将 console.xml 文件中 <oauth2> 标签中的 “enabled” 参数的值修改为 ”false“，即可关闭 OAuth2 协议认证，恢复 TongWeb 自身的认证机制。
1. 停止 TongWeb 服务器。
注意：
console.xml 为 TongWeb 主配置文件，具有防篡改限制。若需要修改并使其生效，请先停止 TongWeb服务器，然后再进行修改。
2. 进入 “${tongweb.base}/conf” 目录。
3. 打开 “console.xml” 文件。
4. 将 “enabled” 参数的值修改为 ”false“，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/76148466e3b4c7743d86598eb3315b61db5f1dc1552f8988bdae581c288392ae.jpg)
5. 修改完成后，保存并退出。
6. 在浏览器地址栏中，输入登录 TongWeb 的 URL 地址，即可使用 TongWeb 自身认证机制登录。

# 4.5. 系统管理

# 4.5.1. 页面定制
定制 TongWeb 的控制台的菜单功能。设置隐藏菜单或者扩展字符集后，所有实例（包含默认实例domain1）均有效。

# 4.5.1.1. 隐藏菜单
定制 TongWeb 的功能项，隐藏一些不常用的功能，可使得 TongWeb 更加轻盈，更便于使用，同时可以规避一些安全隐患。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “页面定制”，进入页面定制页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/cca1f5be9f783d4fd3887696794e9e5e4d9d25c7af05bea00756963f9321dfce.jpg)
4. 根据需要勾选禁用功能，例如：应用回收全部功能。
5. 单击 “更新”，即可完成禁用功能操作。
6. 进入 “应用管理” 页面，可查看应用回收功能已隐藏，不可用。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/90b683b7186921053f04d6503cc89cf1d5ae92b3179f8710d0ae69a41b1a9de6.jpg)


# 4.5.1.2. 扩展字符集
用于扩展字符集，设置的字符集可在 TongWeb 编码配置处选择，配置多个字符集以英文逗号分隔。

# 支持的字符集
JDK 支持的字符集。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “页面定制”，进入页面定制页面。
4. 在 “扩展字符集” 输入字符集，例如：BIG5。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/354420a8ed2d3fb873e161a4fa745f5c05e5af81ce08c56528366ff77a8d03d4.jpg)
5. 单击 “更新”，即完成扩展字符集的定制操作。
6. 进入目标实例下应用的详细信息页面。
7. 在 “编码” 页签中，可查看已定制的字符集。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c74574736306e922d16d765276c30541223ea01cfeaea768ba08525c925c9121.jpg)


# 4.5.1.3. 扩展 HTTP 方法
用于扩展 HTTP 方法，设置的 HTTP 方法可在 TongWeb “通道” $>$ “HTTP 属性” 页签中的 “支持 HTTP 方法” 中选择，配置多个 HTTP 方法以英文逗号分隔。

# 1. 设置扩展 HTTP 方法。
a. 登录 TongWeb 管理控制台。
b. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
c. 在左侧导航栏中，选择 “系统管理” $>$ “页面定制”，进入页面定制页面。
d. 在 “扩展 HTTP 方法” 文本框中，设置扩展 HTTP 方法，如：CONNECT,LINK。
+ image::./images/sim_images/set_http.png[width $= 8 0 \% ]$ ]
e. 单击 “更新”，即可完成扩展 HTTP 方法的设置。

# 2. 选择设置的扩展 HTTP 方法。
a. 进入 “Web 容器” $>$ “通道”，进入通道列表页面。
b. 单击指定通道的名称链接，并进入通道的 “HTTP 属性” 页签，即可选择设置的扩展 HTTP 方法。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/08f5a0153f7331a85eff96f6633b915f754a6005666578762bf4aa2a00345c42.jpg)
c. 配置完成后，单击 “更新”，即可完成扩展 HTTP 方法的设置操作。

# 4.5.1.4. 定制模块/字段名称
支持定制页面功能菜单的显示名称。

# 格式说明
格式示例：模块名称、模块名称.字段名称

# 注意事项
• 定制模块名称后需要刷新页面以使得页面功能菜单上的名称更新。
• 仅支持简体中文。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “页面定制”，进入页面定制页面。
4. 在 “定制显示名称” 属性下，单击 $^ { 6 6 } +$ 添加”，并输入变量名和值。
◦ 模块名，如：应用:War包
◦ 模块.字段名，如：通道.协议:端口.HTTP版本
页面定制／编辑☆
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/6eb3f5f86e9c3f9bfee28738d943eace48889c5f9165941b01b1bcc09c82e2da.jpg)
5. 单击 “更新”，即完成模块和字段名称的定制操作。
6. 进入目标实例，查看定制的模块和字段名称。
◦ 模块名
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/a877e4478428f9e7be0b4349afbd18e057562d78ae7a818222f34367ed303d0d.jpg)
◦ 模块.字段名
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1155b882d40037bcd0cbc35654123aa1203a44b4c8e4708d7388eb0c6518cf33.jpg)


# 4.5.2. 本地 JMX
用户可以将服务器实例的配置管理和监视接口注册到本地 MBean（即
ManagementFactory.getPlatformMBeanServer() 上），名称为 “TongWeb:name server”。
本地 MBean 的访问不需要密码，功能范围仅限配置查看和资源监视。

# 4.5.2.1. 打开 “开启本地 JMX” 开关
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧菜单栏中，选择 “基础配置” $>$ “全局配置” > “JMX”，进入 JMX 页签。
4. 打开 “开启本地 JMX” 开关。
5. 单击 “更新”，完成本地 JMX 开关的开启操作。

# 4.5.2.2. 编写应用代码（示例）
list、show、monitor 三个方法的调用方式和参数，如下所示。
• list 方法代码示例
...   
private Object list(StringIRRodelName)throwsException{   
MBeanServer mBeanServer  $=$  ManagementFactory.getPlatformMBeanServer();   
Object[]params  $\equiv$  {modelName};   
String[] signature  $\equiv$  {String.class.getName();   
return mBeanServer.invoke(newObjectName("TongWeb:name  $\equiv$  server"，"list",params,signature);   
}

参数说明，如下所示。
modelName： TongWeb 的类名，详细信息请参见ServerMBean modelName。
• show 方法代码示例
private Object show(StringIRRcome, String name) throws Exception { MBeanServer mBeanServer  $=$  ManagementFactory.getPlatformMBeanServer(); Object[] params  $=$  {modelName, name}; String[] signature  $=$  {String.class.getName(), String.class.getName(); return mBeanServer.invoke(newObjectName("TongWeb:name  $\equiv$  server"), "show", params, signature); }
参数说明，如下所示。
◦ modelName： TongWeb 的类名，详细信息请参见ServerMBean modelName。
◦ name： 数据的唯一标识，在返回数据中可以查看。
• monitor 方法代码示例
private Object monitor(String-modelName,String name) throws Exception { MBeanServer mBeanServer  $=$  ManagementFactory.getPlatformMBeanServer(); Object[] params  $=$  {modelName,name}; String[] signature  $=$  {String.class.getName(),String.class.getName(); return mBeanServer.invoke(newObjectName("TongWeb:name  $\equiv$  server"), "monitor",params,signature);   
}

参数说明，如下所示。
◦ modelName： TongWeb 的类名，详细信息请参见ServerMBean modelName。
◦ name： 数据的唯一标识，在返回数据中可以查看。

# 4.5.2.3. 本地 Jconsole 查看调用方法和参数
使用 jconsole，可以看到 MBean 可调用的方法和参数。
1. 进入 java 安装路径的 “bin” 目录。
2. 运行 jconsole，弹出 Java 监视和管理控制台窗口的“Jconsole:新建连接”窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/e2df7883dd592f8f3b00e5dfe64654f05f0461e228aef3d150a225d643eade9e.jpg)
3. 勾选 “本地进程”，并选择 “com.tongweb.main.TongWebMain start”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/0d30e4362e90c35f773eb89c508991c9dc07ba5d0797aebf056824ead88ff39f.jpg)
4. 单击“连接”，弹出“安全连接失败，是否以不安全的方式重连”窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/39c8d4bed2f23cff97cb712b816082b8ff2426b436467499f56bb44e8e42eaea.jpg)
5. 单击 “不安全的连接”，即可进入 JConsole 控制台。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/9e141cffa4187a7ddac5343277b227be7f4b3c850655c7f314f70d717952a9fd.jpg)
6. 单击 “MBean”，并选择 “TongWeb” $>$ “server” $>$ “操作”，即可查看 MBean 可调用的方法和参数。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/89a4b7c1c8907eb6bed00fd2e395fbf4e99b551ccf4a0e456d91ca124ed2b55d.jpg)


# 4.5.3. 远程 JMX
开启远程 JMX 后，客户端可以通过 java jmx 协议来管理 TongWeb。

# 4.5.3.1. 注意事项
为了保证密码的安全，建议使用加密后的密码进行登录认证。
TongWeb 提供了加密工具。
• 工具路径：${tongweb.home}/version*/sysapp/console/WEB-INF/lib/tongweb-web-console-framework.jar
• 类方法：encryptWithPubKey。
例如：com.tongweb.sdk.util.TongWebUtils.encryptWithPubKey(password,transferKey)

# 4.5.3.2. 打开 “远程 JMX” 开关
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “远程 JMX”，进入远程 JMX 页面。
4. 打开 “启用” 开关，开启远程 JMX。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ad56f3a88784709aec38dc5843f0eb4ff8427f6fea96928cde6a4f8ea778e84c.jpg)
5. 配置服务 IP、端口等信息。
◦ 服务IP：指定 JMX 监听服务绑定的 IP 地址，即 TongWeb 所在 IP 地址，默认为 “0.0.0.0”。
若设置为 “127.0.0.1”，则只能本机调用，远程客户端将无法访问。
◦ 端口：指定 JMX 监听服务绑定的端口。默认为 $" 7 2 0 0 "$ 。
◦ 支持 JConsole：支持在关闭动态密码，使用 jconsole 等 JMX 客户端工具连接到 TongWeb JVM。
关于如何连接到 TongWeb JVM，详见使用 JConsole 连接到 TongWeb JVM。
◦ 开启 SSL：默认关闭。开启后，使用 TLS 加密网络数据。
6. 配置完成后，单击 “更新”，完成远程 JMX 启用操作。
若界面弹出 “远程 JMX 更新成功”，则说明更新远程 JMX 成功。

# 4.5.3.3. 使用 JMX 协议管理 TongWeb（代码编写说明）
1. 配置远程 JMX 的 IP 和端口号
配置为 TongWeb 控制台开启 “远程 JMX” 时，设置的 IP 地址和端口号。
以“192.168.254.4:7200”为例说明。
```javascript
String ipAndPort = "192.168.254.4:7200";
```
2. 配置 JMX 使用的协议
固定为 “service:jmx:rmi://%s/jndi/rmi://%s/server”。
```java
String serviceUrl = String.format("service:jmx:rmi://%s/jndi/rmi://%s/server", ipAndPort, ipAndPort);  
JMXServiceURL url = new JMXServiceURL(serviceUrl);
```
3. 登录认证
使用 TongWeb 的远程 JMX 时，需要登录认证，配置登录 TongWeb 的认证信息。
```typescript
Map<String, Object> environment = new HashMap<>();  
password = com.tongweb.OnClickListener=TongWebUtiles encryptionWithPubMedKey密码，transferKey);  
environment.put(JMXConnector.CREDDENTIALS,new String{}},{username, password, password2fa, "true"});
```
◦ password：TongWeb 登录密码，默认初始密码为 “thanos123.com”。
◦ transferKey：为了保证密码的安全，建议使用 TongWeb 工具类方法（encryptWithPubKey）加密。
进入 “集中管理” $>$ “服务管理” $>$ “集中配置”，在 “加密公钥” 文本框中，获取加密公钥。
◦ username：TongWeb 登录账号，默认为“thanos”，请根据实际情况填写。
◦ password2fa：动态密码，默认不开启为 “null”。若已开启动态密码，需要输入动态密码。
◦ true：许可证协议，默认为“true”，同意许可证协议。
4. (可选)若开启 SSL，则需要配置 SSL 相关信息。
◦ 添加环境变量
```txt
environment.put("com.sun.jndi.rmi.factory(socket", new SslIRMClientSocketFactory());
```
◦ 配置 SSL 证书信息

# 请配置为实际的证书信息。
```java
System.setProperty("javax.net SSLtrustStore",""); //客户端的信任库中需要包含服务端的密钥证书 System.setProperty("javax.net SSLtrustStorePassword",""); if (Boolean.parseBoolean(clientAuth)){ //开启客户端认证，需要将客户端密钥加入服务端的信任库 System.setProperty("javax.net SSL.keyStore",""); System.setProperty("javax.net SSL.keyStorePassword",""); } //以下设置根据服务端配置启用 //System.setProperty("javax.rmi SSL.client.enabledProtocols","TLSv1.3"); //支持的协议 //System.setProperty("javax.rmi SSL.client.enabledCipherSuites","")); //支持的密码套件
```
▪ keyStore：keyStore 证书路径。
▪ keyStorePassword：keyStore 证书密码。
▪ trustStore：trustStore 证书路径，可设置为 “JKS”、“PKCS11” 或 “PKCS12”。
▪ trustStorePassword：trustStore 证书密码。
▪ enabledProtocols：支持的协议，根据服务端配置启用。可设置为
“TLSv1.3”、“TLSc1.2”、“TLSv1.1” 或 “TLSv1”。
▪ enabledCipherSuites：支持的密码套件，可设置多个以英文逗号分隔。不设置表示不限制。

# 5. 创建 JMX 连接器
```txt
JMXConnector connector = JMXConnectorFactory.connect(url, environment);   
connector.connect();   
MBeanServerConnection connection = connector.getMBeanServerConnection();
```

# 6. 管理 TongWeb
以 “展示管理员列表信息” 为例说明。
```javascript
Properties properties = new Properties();  
//可选，支持国际化，设置为“zh”，表示返回信息为中文。若设置为“en”，则返回信息为英文  
properties.setProperty("lang", "zh");  
Object result = connection.invoke(new ObjectName("TongWeb:name=console"), "callServerMethod", //模块名(model)、操作名(action)、参数名  
new Object[]{"user", "list", properties},  
new String[]{String.class.getName(), String.class.getName(), Properties.class.getName());  
System.out.println(result);
```
◦ user：表示 TongWeb 模块名。
◦ list：表示 TongWeb 操作名。
◦ properties：表示 TongWeb 参数名。
关于 TongWeb 的更多管理及操作，请参见《TongWeb_V8.0命令行工具手册》中 “支持的model、action 参数”。

# 4.5.3.4. 完整示例代码
关于生成 JMX 代码示例，请参见“${tongweb.home}\version*\examples\example.war”的“JMX & RESTExamples”示例。
示例代码：
```java
import javax.management.MBeanServerConnection;   
import javax.management.ObjectName;   
import javax.management)VRemote.JMXConnector;   
import javax.management)VRemote.JMXConnectorFactory;   
import javax.management)VRemote.JMXServiceURL;   
import javax.rmi.css.SsIRMICALntSocketFactory;   
import java.util.HasMap;   
import java.util.HasMap;   
import java.util.Properties;   
public class JmxClient {
```
```txt
public static void main(String[] args) throws Exception {  
String ip = "%s";  
String port = "%s";  
String username = "%s";  
String password = "%s";  
String password2fa = "%s";  
String model = "%s";  
String action = "%s";  
String name = "%s";  
StringTRANSFERKey = "%s";  
String useSSL = "false"; // 服务端开启SSL  
String clientAuth = "false"; // 服务端开启客户端认证
```
```groovy
Properties properties = new Properties();  
properties.setProperty("lang", "zh");  
properties.setProperty("name", name);  
// properties.setProperty("", ""); //设置请求的参数  
String ipAndPort = ip + "." + port;  
String serviceUrl = "service:jmx:rmi://" + ipAndPort + "/jndi/rmi://" + ipAndPort + "/server";  
JMXServiceURL url = new JMXServiceURL(serviceUrl);  
Map<String, Object> environment = new HashMap<>();
```
if(!transferKey.isEmpty()){ password  $\equiv$  com.tongwebsdk.util.TongWebUtils encryptionWithPubMedKeypassword,transferKey);   
}   
environment.put(JMXConnector.CREDENTIALS,new String[]{username, password, password2fa,"true"}); if (Boolean.parseBoolean(useSSL)){ environment.put("com.sun.jndi.rmi.factory(socket",new SslRMIClientSocketFactory()); SystemsetProperty("javax.net SSLtrustStore",""); //客户端的信任库中需要包含服务端的密钥证书 SystemsetProperty("javax.net SSLtrustStorePassword",""); if (Boolean.parseBoolean(clientAuth)){//开启客户端认证，需要将客户端密钥加入服务端的信任库 SystemsetProperty("javax.net SSL.keyStore",""); SystemsetProperty("javax.net SSL.keyStorePassword",""); } //以下设置根据服务端配置启用 //SystemsetProperty("javax:rmi_SSL.client.enabledProtocols","TLSv1.3");//支持的协议 //SystemsetProperty("javax:rmi_SSL.client.enabledCipherSuites","");//支持的密码套件   
}   
JMXConnector connector  $=$  JMXConnectorFactory.connect(url, environment); connector.connect(); MBeanServerConnection connection  $=$  connector.getMBeanServerConnection();   
Properties properties  $=$  new Properties(); propertiessetProperty("lang","zh");   
Object result  $=$  connection.invoke(new ObjectName("TongWeb:name=console","callServerMethod", new Object{}\{model, action, properties\}, new String{}\{String.class.getName(), String.class.getName(), Properties.class.getName()\}); System.out.println(result);   
}

# 4.5.3.5. 使用 JConsole 连接到 TongWeb JVM
支持在关闭动态密码时，使用 jconsole 等 JMX 客户端工具连接到 TongWeb JVM。

# 注意：
开启了支持 JConsole 功能，表示您已接受 TongWeb 产品的 “用户许可协议”。

# 1. 开启 JConsole
a. 登录 TongWeb 管理控制台。
b. 单击 “集中管理”，进入集中管理页面。
c. 在左侧导航栏中，选择 “系统管理” $>$ “远程 JMX”，进入远程 JMX 页面。
d. 打开 “启用” 开关，开启远程 JMX。
e. 打开 “支持 JConsole” 开关，开启 JConsole。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/9efbc59681fb7402dcd939c1c19dbcd3c3c88ceeecbd854cbc84b9736a72b175.jpg)
f. 单击 “更新”，完成 JConsole 的开启操作。

# 2. 连接 JConsole
a. 进入 java 安装路径的 “bin” 目录。
b. 运行 jconsole，弹出 Java 监视和管理控制台窗口的 “Jconsole:新建连接” 窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/bf692e16a97e2326eba00eecf94c2cb4b072410217f6616198b0c601580318e8.jpg)
c. 在 TongWeb 的启动窗口中，获取远程进程。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/98a581d8641436bbe2ce81d3e032d6fdf1e5828437a5b58854b4a922ca8ac2b5.jpg)
d. 将获取的远程进程填入 “JConsole:新建连接” 的远程进程文本框中。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7e987ab0463a5bf199c74a98db9d36fdc58519b71237eb7031050ba9a28654f4.jpg)
e. 输入连接 TongWeb 的 “用户名” 和 “口令”。
f. 单击 “连接”，弹出 “安全连接失败，是否以不安全的方式重连” 窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b8ca2f57db736a63c6956565db2c775e7efd1f7dad9cf9d69efc8f1770f660f9.jpg)
g. 单击 “不安全的连接”，即可进入 JConsole 控制台。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7bcc598b84d0b9c931ab19e011c21972da70f2466add86987e57a2c8ba37888b.jpg)


# 4.5.3.6. 使用 JConsole 直接执行监视等模块操作
1. 参照 使用 JConsole 连接到 TongWeb JVM，连接到 JVM。
2. 成功连接到 JVM 后，单击 “MBean”，并选择 “TongWeb” $>$ “console” $>$ “操作”，即可查看 MBean 可调用的方法。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/36d382bf161756e7dc0409fd52a6d4c68d808aea5f682257ea86fdef9e1fc787.jpg)
3. 单击左侧菜单栏中 “操作” 下的 “callServerMethod”，并输入 “p1”、“p2”、“p3” 等。
参数说明，如下所示。
◦ p1：模块名（model）。
◦ p2：操作名（action）。
◦ p3：参数（key1 $=$ value1&key2=value2）。
关于模块名、操作名以及参数的详细信息，详见《TongWeb_V8.0命令行工具手册》中 “支持的model、action 参数”。
4. 单击 “callServerMethod” 按钮，在返回的 “操作返回值” 窗口中即可查看相关监视值。
如下以 “p1=jvm， $\mathsf { p } 2 \mathsf { = }$ monitor，p3 为空” 为例进行说明。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/67fa6c835336059c5516b8f995a108ce9a9800690f18efa31c9196fa304bd1da.jpg)


# 4.5.4. 脚本录制
脚本录制功能可以帮助您轻松捕获在控制台上所执行的所有操作细节。录制完成后，您可以在一个新的环境中回放这些操作，从而提高业务系统的部署效率。

# 录制脚本类型：
• commandstool
• curl
• postman

# 脚本存放位置：
录制完成后，存储在 “${tongweb.base}/data/script-recording” 目录。
不同的类型以子目录分开存放。

# 录制脚本注意事项：
录制时，系统会自动对密码类型的参数进行加密，以保护脚本文件在分发过程的安全性。

# 回放脚本注意事项：
• 在执行录制的脚本前，需要将脚本中的登录信息和访问地址修改为实际环境对应的正确信息。
• 执行 curl 命令前，需要注意：
Windows 平台：
◦ 系统会自动将文件路径参数里的反斜杠改为斜杠，无需手工操作。
◦ 系统会自动把单引号改为双引号。
一般不需要用户手动修改，但自动修改的范围有限，可能会有遗漏。

# 4.5.4.1. 开始录制脚本
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “脚本录制”，进入脚本录制页面。
4. 单击 “创建”，进入创建脚本录制页面。
脚本录制／创建☆
*名称
添加
返回
5. 输入脚本录制的名称。
6. 单击 “添加”，即开始进行脚本录制。
7. 在控制台上执行相关写操作（如：资源添加、修改等类型的操作）。

# 说明：
您在控制台上进行的写操作（如：资源添加、修改等类型的操作）将被记录。
8. 操作完成后，在 “系统管理” $>$ “脚本录制” 页面，单击目标录制任务所在行的 “完成”，即可完成脚本的录制操作。

# 说明：
若系统没有检测到需要记录的操作，当次录制将作废，并且不在脚本录制列表中展示。

# 4.5.4.2. 下载录制脚本
出于安全考虑，TongWeb 出厂设置禁用了文件下载功能，您可在 “安全配置” $>$ “控制台安全” 模块取消文件下载禁用功能。
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “脚本录制”，进入脚本录制页面。
4. 单击目标录制任务所在行的 “下载”，弹出选择需要下载的文件窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/4eac6d845f1aa7c2c2ae4571572f5ed0472ad1235f893e2e2ac7ac1838cdc0c4.jpg)
5. 用户可根据需要选择 “commandstool”、“curl” 或 “postman” 文件。
6. 选择完成后，单击 “确定”，即可下载对应的脚本文件。
下载后的脚本文件即可在一个新的环境中进行回放操作。

# 4.5.4.3. 删除录制脚本
删除后不可恢复，请谨慎操作。
在控制台的录制脚本列表中删除录制脚本后，存储在 “${tongweb.base}/data/script-recording” 目录中的脚本将同步删除。
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “脚本录制”，进入脚本录制页面。
4. 单击目标录制任务所在行的 “删除”，弹出确认删除录制脚本窗口。
5. 若确认无误，则单击 “确定”，即可删除录制脚本。

# 4.5.5. 一键巡检
收集所有受管 TongWeb 的运行状态数据，并生成巡检相应的巡检报告。

# 注意事项
若未启用基线检查功能，系统不会执行安全基线检查操作。此时，生成的巡检报告中 “安全基线检查状态”、“安全基线检查概览” 以及 “安全基线信息” 部分的内容会显示为空。

# 步骤1：设置巡检时间，并开始巡检
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角，单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “一键巡检”，进入一键巡检列表页面。
4. 单击 “巡检”，进入一键巡检页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c1d2619aa6d1d76923635286d8aeef8db34a84c1cb674359a40d5a5de5ea7ce2.jpg)
5. 输入 “超时时间”，并单击 “开始巡检”。
巡检完成后，自动返回一键巡检列表。
若巡检时间超过设置的 “超时时间”，则自动终止后续的巡检。终止后，已收集完成的实例数据仍然可用。

# 步骤2：预览巡检报告
巡检完成后，生成以巡检时间命名的巡检结果。用户可基于巡检结果预览巡检报告。
1. 进入一键巡检列表页面。
2. 单击目标巡检结果所在行的 “预览”，弹出新的巡检结果页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d321ae7cd8956762459fe5bb67fa3a78cad41dbbc9b5ead08ffeea3276d324b4.jpg)
3. 用户可查看各个 TongWeb 实例的运行状态数据。
包含实例名称、别名、IP、管理端口、应用端口、所属集群、运行中、实例版本、CPU 使用率、内存使用率、硬盘使用率、Java 堆使用率、安全基线检查状态以及安全基线检查概览等。
注意：若未启用基线检查功能，“安全基线检查状态” 和 “安全基线检查概览” 显示未空。
4. 单击实例名称链接，可查看实例相关信息，包含实例信息、安全基线信息、系统信息、状态信息、预警信息、Python 脚本检查结果等。
注意：若未启用基线检查功能，“安全基线信息” 显示未空。
实例信息
<table><tr><td>名称</td><td>参数</td><td>值</td></tr><tr><td>应用端口</td><td>appPort</td><td>8088</td></tr><tr><td>ip</td><td>ip</td><td>192.168</td></tr><tr><td>名称</td><td>name</td><td>domain1</td></tr><tr><td>管理端口</td><td>port</td><td>9060</td></tr><tr><td>运行中</td><td>running</td><td>true</td></tr><tr><td>实例版本</td><td>version</td><td></td></tr></table>
安全基线信息
<table><tr><td>检查项</td><td>说明</td><td>基线级别</td><td>是否通过</td><td>建议方案</td></tr><tr><td>JVM堆内存配置</td><td>检查Xmx参数配置是否满足生产环境要求，默认要求≥1024MB内存。</td><td colspan="2">是</td><td></td></tr><tr><td>系统磁盘空间检查</td><td>检测TongWeb所在磁盘分区剩余空间，防止因磁盘写满导致服务异常。</td><td>强制基线</td><td>否，强制修改</td><td>磁盘\E:\tongweb\domains\domain1可用空间：11GB（要求≥20GB）。|请清理E:\tongweb\domains\domain1盘空间：1.使用磁盘清理工具2.删除临时文件。</td></tr><tr><td>自动部署配置检查</td><td>生产环境应关闭自动部署功能，防止热部署导致应用状态不一致。</td><td colspan="2">是</td><td></td></tr></table>

# 系统信息
jstack.txt
server.log.txt

# 状态信息
通道
EJB w3协议
首页
JTA事务
 JVM
■操作系统
→系统日志

# 预警信息

# Python脚本检查结果

# 步骤3：下载巡检报告
注：控制台默认关闭文件下载功能。若需要开启，请参见禁用文件下载。
当文件大小超过 4GB 时，系统将忽略该下载请求。为确保您的下载体验，请确保所需文件大小在可处理的范围内。
1. 进入一键巡检列表页面。
2. 单击目标巡检结果所在行的 “下载”，弹出选择待下载的文件窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/32edc5ab182dde97b9d5d4a27caa5da379f5548906eb400c0e2a7f8ae2df5814.jpg)
3. 勾选需要下载的文件。
◦ index.html：实例运行数据。
◦ instances：实例详情，包含实例信息、安全基线信息、系统信息（jstack.txt）、状态信息（通道、EJB w3 协议、首页、JTA 事务、JVM、操作系统以及系统日志）以及预警信息。
4. 单击 “确定”，即可下载巡检报告。
下载的文件是以巡检时间命名的 “.zip” 文件。

# 5. 命名空间

# 5.1. 自动切换命名空间
TongWeb 支持自动切换命名空间，开启后，TongWeb 会在启动之初切换运行时的 Java EE 命名空间，如果当前是 javax，则会自动切换为 jakarta，反之亦然。
打开 “${tongweb.base}/conf/tongweb.xml” 文件，添加 “reversePkg="true” 后重启即可切换命名空间。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d8023e77ae1b9a0f71db6118c81cd307aba2d53342d33538662309bbdf20b2d5.jpg)
tongweb.xml 为 TongWeb 主配置文件，具有防篡改限制。若需要修改并使其生效，请先停止 TongWeb 服务器，然后再进行修改。
```xml
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- 注意事项 */
<TongWeb 的配置文件 tongweb.xml、console.xml 等，默认开启了防篡改功能 -->
<TongWeb 运行期间，您可能无法对其进行手动编辑（相关操作可能会自动回退） -->
<TongWeb 若您确实需要手动编辑这些文件，请先停止 TongWeb，之后再进行相关操作即可 -->
<TongWeb reversePkg="true">
<java-config workDir="/${tongweb.base}"/>
<environments>
```

# 5.2. 手动切换命名空间
进入 “基础配置” $>$ “全局配置” 页面，打开 “切换命名空间” 开关。然后，重启 TongWeb 使配置生效。此时，TongWeb 在启动时会自动切换命名空间。如果当前是 javax ，则会自动切换为 jakarta ，反之亦然。请注意：不支持单进程模式。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/8a01d3276012c98db3b46b8f29832f52eaea181e0fad939ec80b78de51d4f4cb.jpg)


# 说明：
• “切换实例版本” 和 “切换命名空间” 可联动使用，将指定实例版本切换命名空间。
• 关闭 “切换命名空间” 开关，并重启 TongWeb，可恢复到原始命名空间。

# 5.3. 部署应用时兼容
TongWeb 支持同时部署 javax 和 jakarta 命名空间的应用。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/adf94a599d6eaeb018222d108e55ad65ab6559d6fec18219536e24b50dbcc3d7.jpg)


# 6. 版本生成
用户可生成和下载适用于不同应用场景的 TongWeb 版本。
一般主版本可以兼容所有类型，除非有特殊需求才 “生成” 对应的版本。

# 6.1. 功能差异（生成的轻量版与 license 控制的轻量版）
生成的轻量版主要用于云平台、微服务环境，功能上等同于 license 控制的轻量版。

# 注意事项
• 通过其它版本生成的轻量版，包含 “带控制台的轻量版” 与 “不带控制台的轻量版”。
不带控制台的轻量版，不支持命令行工具（ commandstool.[sh|bat] / cli.[sh|bat] ）。
• 生成的轻量版存在安装包与 license 不对应的情况。
当安装包与 license 不对应时，系统仅展示最低版本的功能。另外，“集中管理” > “服务管理” 页面展示的功能有略微差异，如下表所示。
<table><tr><td>license类别</td><td>差异说明</td></tr><tr><td>·轻量版安装包+轻量版license
·轻量版安装包+标准版license</td><td>“集中管理”&gt;“服务管理”中，无管理节点页，只能管理本机实例。
仅包含“实例”、“集中配置”、“注册实例”和“注册实例集群”。</td></tr><tr><td>·轻量版安装包+企业版license
·轻量版安装包+教学版license</td><td>“集中管理”&gt;“服务管理”中，保留有管理节点页。
包含“实例”、“集群”、“节点”、“负载均衡器”、“集中配置”、“注册实例”和“注册实例到集群”。</td></tr></table>

# 6.2. 生成轻量版
本章节介绍如何生成轻量版 TongWeb。

# 注意事项
生成的不含控制台的版本，默认打开 “启动时部署”。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “扩展支持” $>$ “版本生成”，进入版本生成页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/76bada92460c76070e56be74f94e4335c9977e73ea1ffd91725ef85f2110f006.jpg)
4. “版本类型” 选择 “轻量版”。
关于版本生成的更多参数说明，详见 版本生成配置参数说明。
5. 单击 “生成”，即可生成轻量版。
在版本生成列表中，可查看已构建的产品版本，包含产品版本的名称、版本类型、含控制台以及版本号等。
进入 “${tongweb.home}\TongWeb-lite” 目录下，也可以查看生成的轻量版。
说明：
◦ 若未开启 “含控制台”，则在 “TongWeb-lite” 目录中，生成以 “TongWeb-lite—X.X.X.X” 命名的轻量版。
◦ 若开启 “含控制台”，则 TongWeb 名称增加 “console”，如 “TongWeb-lite-console-X.X.X.X” 命名的轻量版。
若 “含控制台” 或 “不含控制台” 类型的 TongWeb 版本已存在，则无需再次生成。

# 6.3. 生成企业版
本章节介绍如何生成企业版 TongWeb。

# 注意事项
生成的不含控制台的版本，默认打开 “启动时部署”。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “扩展支持” $>$ “版本生成”，进入版本生成页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/6ac145e10f6930c91b7519542e386c11453e6612118c4ba117e35f5bbf1430a8.jpg)
4. “版本类型” 选择 “企业版”。
关于版本生成的更多参数说明，详见 版本生成配置参数说明。

# 5. 单击 “生成”，即可生成企业版。
在版本生成列表中，可查看已构建的产品版本，包含产品版本的名称、版本类型、含控制台以及版本号等。

# 说明：
进入 “${tongweb.home}\TongWeb-enterprise” 目录下，也可以查看生成的企业版。
◦ 若未开启 “含控制台”，则在 “TongWeb-enterprise” 目录中，生成以 “TongWeb-enterprise—X.X.X.X” 命名的企业版。
◦ 若开启 “含控制台”，则 TongWeb 名称增加 “console”，如 “TongWeb-enterprise-console-X.X.X.X” 命名的企业版。
若 “含控制台” 或 “不含控制台” 类型的 TongWeb 版本已存在，则无需再次生成。

# 6.4. 下载产品版本
本章节介绍如何下载已生成的产品版本。

# 注意事项
控制台默认关闭文件下载功能。若需要开启，请参见禁用文件下载。

# 前置条件
已生成轻量版或企业版 TongWeb。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “扩展支持” $>$ “版本生成”，进入版本生成页面。
4. 单击 “下载”，在弹出的下载对话框中，选择对应的轻量版、企业版。
5. 单击 “确定”，即可下载对应的产品版本。

# 6.5. 删除产品版本
用户可以通过控制台界面删除指定产品版本，也可进入 “${tongweb.home}” 目录，删除 “TongWeb-lite”或 “TongWeb-enterprise” 目录下指定产品版本。
若删除 “TongWeb-lite” 或 “TongWeb-enterprise” 目录，则表示删除所有产品版本，控制台列表中的产品版本也同步全量删除。

# 前置条件
已生成轻量版或企业版 TongWeb。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “扩展支持” $>$ “版本生成”，进入版本生成页面。
4. 单击目标版本所在行的 “删除”，弹出确认删除生成的产品版本窗口。

# 说明：
您也可以根据需要勾选一个或多个产品版本，单击列表左上角的 “删除” 按钮，批量删除生成的产品版本。
5. 单击 “确定”，即可删除对应的产品版本。

# 7. 轻量模式

# 7.1. 功能描述
以轻量模式运行 TongWeb，此模式会在原版本的基础上关闭 EJB、JCA 等服务，并尝试从应用自身加载JSF、JavaMail、WebSocket、WebService、Xml 等技术实现。
若应用基于 Tomcat 或其它 Servlet 容器开发，则通常可以获得更好的兼容性。

# 7.2. 注意事项
轻量模式下，不支持非 war 类型的应用。

# 7.3. 切换为轻量模式
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧菜单栏中，选择 “基础配置” $>$ “全局配置”，进入全局配置的服务器页签。
4. 打开 “轻量模式” 开关。
5. 单击 “更新”，完成轻量模式的切换操作。
6. 重启 TongWeb 服务器，使配置生效。
7. 重新登录 TongWeb 管理控制台。
8. 进入首页，可查看 “运行模式” 为 “轻量版”。

# 8. 镜像模式

# 8.1. 功能描述
以镜像模式运行 TongWeb 会尝试从应用（需要在镜像模式下部署的应用，可选在 TongWeb 启动之前，将其放置到 “${tongweb.base}/imagedeploy” 目录下，也可选使用“应用仓库”来获取远程应用包）中查找TongWeb 所需要的配置文件。
查找位置为：应用根目录/META-INF/tongweb
查找到的文件将会合并入 “${tongweb.base}” 目录（“/META-INF/tongweb” 目录下的文件目录结构要与“${tongweb.base}” 目录结构对应），原 “${tongweb.base}” 目录将会整体备份。
在以镜像模式运行时，TongWeb 将处于“只读”状态，即不支持对任何配置参数进行修改。

# 8.2. 切换为镜像模式
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧菜单栏中，选择 “基础配置” $>$ “全局配置” > “远程配置”，进入全局配置的远程配置页签。
4. 打开 “镜像模式” 开关，并设置应用仓库。
5. 单击 “更新”，完成镜像模式的切换操作。
6. 重启 TongWeb 服务器，使配置生效。

# 8.3. 关闭镜像模式
1. 停止 TongWeb 服务器。
2. 打开 “${tongweb.base}/conf/tongweb.xml” 文件。
3. 将 <server> 节点的 “imageMode” 属性值设置为 “false”。
4. 再启动 TongWeb 即可。

# 9. 扩展支持
扩展支持汇总 TongWeb 支持的服务列表。

# 9.1. ASDP
ASDP 是一款安全防护工具。

# 9.1.1. 获取安装包
请联系东方通相关人员获取 ASDP 安装包，包含如下文件。
• security_suite.zip
• license_ss.dat
• tongapm.war

# 9.1.2. 安装 ASDP
1. 解压 “security_suite.zip” 文件
a. 将 “security_suite.zip” 复制并粘贴到 “${tongweb.home}” 目录下。
b. 解压到当前目录（保留 security_suite 目录）。
2. 放 “license_ss.dat” 文件
将 “license_ss.dat” 文件放到 “${tongweb.home}” 目录下。

# 3. 配置启动参数
您可以通过如下任一种方式配置启动参数。配置完成后，需要重启 TongWeb 服务器，使配置生效。
◦ 方式1：进入 TongWeb 控制台的 “基础配置” $>$ “启动参数”，分别创建如下启动参数。
▪ -javaagent:${tongweb.home}/security_suite/agent.jar
▪ -Dxmrasp.tongweb.rule.path $\scriptstyle 1 = \$ 5$ {tongweb.home}/security_suite/rule.json
▪ -Dxmrasp.tongweb.attack_log.path=${tongweb.home}/security_suite/attack_report.log
▪ -Dxmrasp.wrap.request=false
▪ -Dxmrasp.tongweb.enable $=$ true
▪ -Dxmrasp.wrap.response=false
▪ -Dxmrasp.wrap.inputstream $\mid =$ true
◦ 方式2：打开 TongWeb 的 “${tongweb.base}/conf/tongweb.xml” 文件，添加如下启动参数。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7ba515e2dc1cadfc480b49aa2f3215625341c2dfe8031e771b21fdb31a032521.jpg)
tongweb.xml 为 TongWeb 主配置文件，具有防篡改限制。
若需要修改并使其生效，请先停止 TongWeb 服务器，然后再进行修改。
<arg name $1 = "$ -javaagent:${tongweb.home}/security_suite/agent.jar"/>
<arg name="-Dxmrasp.tongweb.rule.path=${tongweb.home}/security_suite/rule.json"/>
<arg name="-Dxmrasp.tongweb.attack_log.path=${tongweb.home}/security_suite/attack_report.log"/>
<arg name  $=$  "-Dxmrasp.tongweb.enabled  $\equiv$  true"/> <arg name  $=$  "-Dxmrasp.WRAP.request=false"/> <arg name  $=$  "-Dxmrasp.WRAP/response=false"/> <arg name  $=$  "-Dxmrasp.WRAPInputStream=true"/>

# 4. 部署“tongapm.war”应用包
a. 登录 TongWeb 管理控制台。
b. 切换到目标实例。
c. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
d. 单击 “部署”，部署 “tongapm.war” 应用。
▪ 单击 “资源加载” 页签，将 “强制从应用加载的类” 配置为 “javax.ws.rs.ex.RuntimeDelegate”。
▪ 开启 “Web 兼容模式”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/32ef36301052802614a31b509b70838213a436807429df05a50546e13945a308.jpg)


# 说明：
若不开启 “Web 兼容模式”，可选择 “基础配置” $>$ “全局配置”，开启 “轻量模式” 达到同样效果。若选择开启 “轻量模式”，需要在部署 “tongapm.war” 应用前开启 “轻量模式” 并重启 TongWeb服务器，否则会报错。
e. 配置完成后，单击“添加”，完成 “tongapm.war” 包的部署。

# 9.1.3. 访问 ASDP 控制台
ASDP 安装完成后，即可访问 ASDP 控制台。
1. 登录 TongWeb 管理控制台。
2. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
3. 单击部署的 “tongapm.war” 应用所在行的 “链接”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/98d56e79d862d9a6c6078e1b9bd0a900f452698eb13b9e59e4a6fb4c361b5779.jpg)
4. 单击应用/链接页面生成的访问链接，即可进入 ASDP 控制台。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7e8c126220b9ff3f2908f0705762fdbf6c709d8cf275b5ca6b998fbf65c457fd.jpg)


# 9.2. ActiveMQ
通过 JCA 连接消息服务器 ActiveMQ。

# 前置条件
• 请自行从官方渠道获取资源适配器（genericra.rar 或者 activemq.rar）。
推荐 activemq.rar，因其包含了连接 ActiveMQ 必需的 jar 包。
• 在产品包中获得 TongWeb 提供的示例，用于队列进行消息收发。
消息资源测试需要借助消息服务器提供的工具，如 ActiveMQ 提供的接口/TongWeb 的 jmstools 工具。

# 操作步骤
1. 在 TongWeb 上部署消息服务器提供的资源适配器（如 activemq.rar）。

# 注意：
消息服务器中配置的均为本地连接（如 tcp://localhost:61616）。
◦ 可自行在资源适配器的 ra.xml 中按需修改后，再部署。
◦ 或在 TongWeb 控制台部署后，再编辑资源适配器。
a. 单击部署的资源适配器名称，进入编辑应用页面。
b. 在 “其它” $>$ “Connector 应用属性” 中按需修改。
用户也可以设置更多属性，如 activemq.rar 适配器，建议配置 UseInboundSession 为 false。
2. 在 TongWeb 上创建连接池和托管对象。
创建过程中选择上一步的资源适配器，并在 “其它属性” 中填入必要的属性信息。
◦ 如 ActiveMQ activemq.rar 适配器
托管对象配置 PhysicalName=testd，testd 为物理队列名称。
◦ 如 genericra.rar 适配器
托管对象配置 DestinationJndiName=testd，testd 为物理队列名称。
3. 确保 ActiveMQ 服务器已启动，在消息服务器中创建对应的消息资源。
4. 测试验证，部署 TongWeb 提供的示例。
使用创建的连接池和托管对象进行消息收发。

# 9.3. ActiveMQ Artemis
通过 JCA 连接消息服务器 ActiveMQ Artemis。

# 前置条件
• 请自行从官方渠道获取资源适配器（artemis.rar）。
• 在产品包中获得 TongWeb 提供的示例，用于队列进行消息收发。
消息资源测试需要借助消息服务器提供的工具，如 ActiveMQ Artemis 提供的接口/TongWeb 的jmstools 工具。

# 操作步骤
1. 在 TongWeb 上部署 ActiveMQ Artemis 消息服务器提供的资源适配器（如 artemis.rar）。
注：部署资源适配器时，在 “其它” $>$ “Connector 应用属性” 页面中指定 UseMaskedPassword 为 false 。
2. 在 TongWeb 上创建连接池和托管对象。
创建过程中选择上一步中部署的资源适配器，并在 “其它属性” 中填入必要的属性信息。
3. 确保 ActiveMQ Artemis 服务器已启动，在消息服务器中创建对应的消息资源（如：本地队列）。
4. 测试验证，部署 TongWeb 提供的示例。
使用创建的连接池和托管对象进行消息收发。

# 9.4. Apollo
Apollo 配置中心是由携程在 2016 年对外开源的一款配置管理工具。该工具虽基于 Spring Boot 和 Eureka技术构建，但实际应用中，项目架构并不局限于 Spring Boot 或 Spring Cloud 体系。Apollo 配置中心采用
客户端/服务端架构模式，其中服务端模块包含三大核心组件：AdminService、PortalService 和ConfigService。系统支持多环境配置管理，具备灰度发布能力，并提供了完善的用户权限控制机制。

# 注意事项
Apollo 仅支持作为配置中心，不支持作为注册中心。

# 使用说明
1. 访问 Apollo 官网，并选择相应的版本下载。
◦ apollo-adminservice-x.x.x-github.zip
◦ apollo-configservice-x.x.x-github.zip
◦ apollo-portal-x.x.x-github.zip
2. 从 参考示例项目中获取数据库脚本，并初始化数据库基础环境。
3. 解压下载的三个服务包 apollo-adminservice、apollo-configservice、apollo-portal，并修改相应的配置，然后启动三个服务。
启动脚本如下所示（也可使用服务包下的 scripts 目录下的脚本启动）。
```batch
java -Xms128m -Xmx128m -jar /opt/apollo/configservice/apollo-configservice-2.4.0.jar --springdatasource.url="jdbc:mysql://localhost:3306/ApolloConfigDB?allowPublicKeyRetrieval=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true" --springdatasource username=root --springdatasource.password=root
```
```batch
java -Xms128m -Xmx128m -jar /home/jasper/vms/apollo/adminservice/apollo-adminservice-2.4.0.jar --springdatasource.url="jdbc:mysql://localhost:3306/ApolloConfigDB?allowPublicKeyRetrieval=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true" --springdatasource username=root --springdatasource.password=root
```
```batch
java -Xms128m -Xmx128m -jar /home/jasper/vms/apollo/portal/apollo-portal-2.4.0.jar --spring.datasource.url="jdbc:mysql://localhost:3306/ApolloPortalDB?allowPublicKeyRetrieval=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true" --spring.datasource username=root --spring.datasource.password=root --dev.meta=http://localhost:8080 --spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLInnoDBDialect --spring.jpa.show --sql=true --spring.jpa.properties.hibernate.format_sql=true
```
4. 将 apollo 如下相关依赖 jar 包放到 $\$ 1$ {tongweb.home}/lib 或 ${tongweb.base}/lib 目录下。
◦ ant-1.10.5.jar
◦ ant-launcher-1.10.5.jar
◦ aopalliance-1.0.jar
◦ apollo-client-2.1.0.jar
◦ apollo-core-2.1.0.jar
◦ apollo-openapi-2.1.0.jar
◦ bcprov-jdk15on-1.64.jar
◦ checker-qual-3.12.0.jar
◦ commons-codec-1.11.jar
◦ cryptacular-1.2.4.jar
◦ ehcache-2.10.6.jar
◦ error_prone_annotations-2.7.1.jar
◦ failureaccess-1.0.1.jar
◦ geronimo-commonj_1.1_spec-1.0.jar
◦ geronimo-health-1.0.1.jar
◦ geronimo-health-common-1.0.1.jar
◦ geronimo-javamail_1.4_mail-1.8.4.jar
◦ geronimo-metrics-1.0.2.jar
◦ geronimo-metrics-common-1.0.2.jar
◦ geronimo-openapi-impl-1.0.12.jar
◦ gson-2.8.9.jar
◦ guava-31.0.1-jre.jar
◦ guice-5.0.1.jar
◦ httpclient-4.5.13.jar
◦ httpcore-4.4.13.jar
◦ j2objc-annotations-1.3.jar
◦ jasypt-1.9.3.jar
◦ java-support-7.3.0.jar
◦ javax.inject-1.jar
◦ jcl-over-slf4j-1.7.36.jar
◦ joda-time-2.9.jar
◦ jsr305-3.0.2.jar
◦ listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
◦ mbean-annotation-api-8.0.4.jar
◦ metrics-core-3.1.2.jar
◦ microprofile-config-api-1.3.jar
◦ microprofile-health-api-1.0.jar
◦ microprofile-jwt-auth-api-1.1.1.jar
◦ microprofile-openapi-api-1.1.2.jar
◦ microprofile-rest-client-api-1.3.3.jar
◦ opensaml-core-3.3.1.jar
◦ opensaml-profile-api-3.3.1.jar
◦ opensaml-saml-api-3.3.1.jar
◦ opensaml-saml-impl-3.3.1.jar
◦ opensaml-security-api-3.3.1.jar
◦ opensaml-security-impl-3.3.1.jar
◦ opensaml-soap-api-3.3.1.jar
◦ opensaml-xacml-api-3.3.1.jar
◦ opensaml-xacml-impl-3.3.1.jar
◦ opensaml-xacml-saml-api-3.3.1.jar
◦ opensaml-xacml-saml-impl-3.3.1.jar
◦ opensaml-xmlsec-api-3.3.1.jar
◦ opensaml-xmlsec-impl-3.3.1.jar
◦ org.osgi.annotation.versioning-1.0.0.jar
◦ slf4j-api-1.7.21.jar
◦ snakeyaml-1.29.jar
◦ stax2-api-3.1.4.jar
◦ stax-api-1.0-2.jar
◦ swizzle-stream-1.6.2.jar
◦ woodstox-core-5.0.3.jar
◦ woodstox-core-asl-4.4.1.jar
◦ xmlsec-2.0.5.jar

# 注意：
如上这些 jar 可以通过 maven 获取。新建一个目录，在该目录下创建一个 pom.xml 文件，然后执行mvn clean install 。待执行结束，复制 ./target/lib 目录下的 jar 即可。
pom.xml 文件内容，如下所示。
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi: schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupld>com.tongtech</groupld>
    <artifactId>myweb</artifactId>
    <version>1.0</version>
    <packaging>jar</packaging>
    <name>apollo</name>
    <dependencies>
        <!-- Apollo Client Core-->
        <dependency>
            <groupld>com.ctrip-frameworkApollo</groupld>
            <artifactId>apollo-client</artifactId>
            <version>2.1.0</version>
        </dependency>
        <!-- Apollo APIs, 用于通过API动态修改配置-->
        <dependency>
            <groupld>com.ctrip-framework)apollo</groupld>
            <artifactId>Apollo-openapi</artifactId>
```
```xml
<version>2.1.0</version> </dependency> </dependencies> <build> <plugins> <plugin> <groupId>org.apache.maven/plugins</groupId> <artifactId>maven-dependency-plugin</artifactId> <version>3.1.2</version> <executions> <execution> <id>copy-dependencies</id> <phase>package</phase> <!--绑定到package阶段--> <goals> <goal>copy-dependencies</goal> </goals> <configuration> <!--指定输出目录为target/lib--> <outputDirectory>${project.builddirectory}/lib</outputDirectory> <!--可选配置：设置是否覆盖已存在的文件--> <overWriteReleases=false</overWriteReleases> <overWriteSnapshots=false</overWriteSnapshots> <overWritelfNewer>true</overWritelfNewer> <!--可选配置：指定复制的依赖范围（如compile）--> <!--includeScope>compile</includeScope> <!--configuration> </execution> </ executions> </plugin> </plugins> </plugins> </build> </project>
```
5. 服务启动后访问 apollo portal（默认地址 http://localhost:8070），配置应用并授权。
注意：
由于 TongWeb 的配置较长，超过 Apollo 默认的长度限制，需要修改默认长度限制。
操作位置：“管理员工具(页面右上角) $>$ 系统参数 $>$ ConfigDB 配置管理标签”，找到item.value.length.limit 选项修改保存即可，1分钟后生效。
6. 启动 TongWeb，访问控制台，在 “资源管理” $>$ “注册中心”，添加页面中填写相关信息保存。
注意：
需要保持 “全局配置” 的 “启用配置注册中心” 为开启状态。

# 9.5. AppDataSource
TongWeb 可监视由应用自行创建和管理的数据源资源的使用情况。
关于AppDataSource如何使用请参见应用数据源。

# 9.6. Consul
Consul 是分布式、高可用、可横向扩展的用于实现分布式系统的服务发现与配置，基于 go 语言开发且非常轻量易部署。

# 支持版本

# 1.20 及以上版本

# 启动服务
1. 访问 Consul 官方下载地址。
2. 选择相应的服务端版本，并配置相关配置参数。
3. 执行如下命令，启动服务。
```batch
/opt/consul/consul agent -ui -pid-file=/opt/consul/consul.pid -config-file /opt/consul/config.json
```
如下为 config.json 的一个简单的配置示例：
```json
{ "server": true, "datacenter": "TongWebDc", "node_name": "consul-server", "ui": true, "log_level": "INFO", "data_dir": "/opt/consul/data", "bootstrap expects": 1, "bind_addr": "0.0.0.0", "client_addr": "0.0.0.0", "enable_syslog": true, "acl": { "enabled": true, "default_policy": "deny", "down_policy": "extend-cache", "enable_token_persistence": false, "tokens": { "default": "74325d19-0221-4b19-876f-95359e0d6773", "master": "74325d19-0221-4b19-876f-95359e0d6773", "agent": "74325d19-0221-4b19-876f-95359e0d6773",
```
```txt
"initial_management": "74325d19-0221-4b19-876f-95359e0d6773" } 1
```

# 使用方法
关于 Consul 用于发现 TongWeb 实例或共享配置的使用方式，详见 注册中心。

# 注意：
• ACL 认证 Token：必填项，填写为 config.json 中的 token，如启动服务中：74325d19-0221-4b19-876f-95359e0d6773
• 也可通过命令行或 api 进行生成 ACL token。
• 需要保持 TongWeb 中 “全局配置” 的 “支持集中管理” 为开启状态。

# 9.7. DaoCloud
道客云上的 TongWeb 使用方法。
1. 登录道客云。
找到 helm 应用，容器管理 $>$ 集群列表 $>$ 集群 cluster $>$ helm 应用。
2. 启动 TongWeb 控制端。
a. 进入 “helm 模板” $>$ 选择 “tongweb”，并单击 “安装”。
b. 设置控制台的应用名称 ”租户-tw-console“ (例：tw-tw-console)，然后选择控制台应用的命名空间。
c. 进行如下配置：
▪ 修改 tongtech.namespace 为步骤 2.b 中设置的命名空间。
▪ 修改 tongtech.tenant.name 为租户名。
▪ 修改 components.console 为 true，表示启动控制台。
▪ 修改 components.instance 为 false，表示不启动实例应用。
▪ 修改 console.namespace 修改上一步中设置的命名空间。
▪ 修改 image 下的属性，设置镜像地址和拉取策略。
d. 配置完成后，单击 “确定”，等待应用启动。
3. 启动 TongWeb 实例集群。
a. 进入 “helm 模板” $>$ 选择 “tongweb”，并单击 “安装”。
b. 设置实例集群的名称（如：tongweb01），选择实例集群的命名空间。
c. 进行如下配置：
▪ 修改 tongtech.namespace 为步骤 2.b 中设置的命名空间。
▪ 修改 tongtech.tenant.name 为租户名(需要与控制台的租户相同)，
▪ 修改 components.console 为 false，表示不启动控制台。
▪ 修改 components.instance 为 true，表示启动实例集群。
▪ 修改 instance.replicaCount 修改实例集群的副本数。
▪ 修改 instance.namespace 修改实例集群的命名空间。
▪ 修改 image 下的属性，设置镜像地址和拉取策略。
▪ 修改 resources 下的属性为 pod 的资源请求和限制。
d. 单击 “确定”，等待应用启动。
4. 在道客云 helm 应用中，找到刚安装的控制端，如 tw-tw-console。
5. 找到访问方式 $>$ 访问 $>$ 登录，即可看到步骤 3 中创建的实例集群并进行操作。

# 9.8. Docker
详见《TongWeb_V8.0容器化部署手册》。

# 9.9. Eclipse
Eclipse 插件的功能主要包括在 Eclipse 中对 TongWeb 应用服务器添加、配置修改、启动和停止、应用部署、调试等功能。
将 TongWeb 集成到 Eclipse 开发工具，以在 Eclipse 上开发、调试、部署应用到 TongWeb 上。

# 9.9.1. 支持的 Eclipse 版本
2020.03 及以上版本（支持社区版）。

# 9.9.2. 下载并安装 Eclipse
在 Eclipse 官网下载并安装即可。
下载地址：https://www.eclipse.org/downloads/

# 9.9.3. 获取 Eclipse TongWeb 插件
请联系东方通相关人员获取如下 TongWeb 插件：
• tongweb-eclipse-2016.zip：支持 Eclipse 的 2016 版本，兼容 IDEA 后面的版本。
• tongweb-eclipse-2022.zip：支持 Eclipse 的 2022 版本，兼容 IDEA 后面的版本。
TongWeb Eclipse 插件包中包含如下 jar 包：
• org.jst.server.tongweb.core_xxxx.x.x.jar
• org.jst.server.tongweb.ui_xxxx.x.x.jar

# 9.9.4. 安装 TongWeb 插件
1. 将获取的 jar 包存放在 “${eclipse.home}/dropins” 目录下。
2. 重启 Eclipse 开发工具。
重启 Eclipse 开发工具后，即可使用该插件。

# 9.9.5. 使用 Eclipse 插件

# 9.9.5.1. 添加 TongWeb 服务器

# 方式一：通过 Preference 添加
1. 打开 Eclipse 开发工具。
2. 选择 “Window” $>$ “Preferences”，弹出 “Preferences” 窗口。
3. 选择 “Server” $>$ “Runtime Environment”，单击 “Add”，添加 TongWeb 服务器。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1635d251fb732efa8f0925095ea87e322162b0453ed4e752a18ee0634bc69326.jpg)
4. 在弹出的对话框中，选择 “TongWeb” 服务器。
若勾选 “Create a new local server”，在服务器配置完成后，将同时生成一个服务器运行时实例，在Server 视图中可以查看到。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/e0a107d6950f3ca3212148b3e2d4dd291e734923bc71f8d50c6aa063b2cc9782.jpg)
5. 单击 “Next”，配置 TongWeb 服务器基本信息。
◦ Name：输入服务器的名称。
◦ TongWeb installation directory：单击 “Browse…”，选择 TongWeb 服务器的安装目录。
◦ JRE：可选择使用自己安装的 JRE，也可使用自带的 JRE。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/879ec237cc895ff81a1977267985b87f11bdf1e8d6f88d9d22f6ab66acc55861.jpg)
6. 单击 “Finish”，即可完成 TongWeb 应用服务器在 Eclipse 中添加操作。
您可以根据需要进行添加、编辑、移除 TongWeb 服务器。
若应用已部署到 TongWeb 服务器，移除 TongWeb 服务器时，在提示框中选中 “Delete all affectedservers” 复选框，将已引用该配置的服务实例一同删除，否则只删除服务器配置信息。

# 方式二：通过 Servers 添加
1. 打开 Eclipse 开发工具。
2. 通过菜单 “Window” $>$ “Show View” $>$ “Servers”，打开 Servers 视图。
3. 右键单击 Servers 视图空白处，选择 “New” $>$ “Server”，添加 TongWeb 服务器。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/13671aeb05fa230b29c3b8e0c7f9050328b81376839db47d28dc2077898c64b1.jpg)
若通过 “方式一：通过 Preference 添加”已添加过服务器配置，用户可在界面中选择一个已有的服务器配置。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/8416827b1d299a6afd9582f182057db42c351a4ba396ff89d531d577b30e872e.jpg)
4. 单击 “Finish” 完成 TongWeb 服务器的添加操作。

# 9.9.5.2. 修改服务器实例配置
在 “Servers” 视图中，双击已添加的 TongWeb 服务器实例配置，可打开 “Overview” 配置界面，对TongWeb 服务器实例的运行配置进行编辑。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/9455389536457b2d0b49a32188fa04e440a7360efb25d5245779bafa712f731d.jpg)
配置说明，如下所示。

# General Information
• Server Name：服务器名称。
• Host Name：主机名，默认为 localhost。
• Runtime Environment：运行时配置名。
• Configuration Path：主要配置文件保存路径。

# Server Locations
• Use workspace metadata：使用 TongWeb 的安装目录。
• Server path：为当前选择 Runtime Environment 配置对应的安装路径。没有应用部署时，可以修改为其他已安装 TongWeb 的目录，否则不可修改。
• Deploy path：默认的部署目录。

# Ports
Ports：通过 Ports，用户可修改的 TongWeb 服务器端口。

# 9.9.5.3. 添加或移除工程
1. 进入 “Servers” 视图。
2. 鼠标右键单击需要添加工程的 TongWeb 服务器实例，选择 “Add and Remove”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/6f0e1af1e41d16d3bd08112012adeb2ec54d91f8acf88a4f72848ccc36e9c834.jpg)
Figure 1. 添加删除工程实例
3. 在弹出 “Add and Remove” 窗口，可添加、删除工程到服务器实例。

# 9.9.5.4. 发布工程
工程添加至服务器后，需要发布到服务器实例，工程才会被正式部署至服务器的运行环境中。
1. 进入 “Servers” 视图。
2. 鼠标右键单击要发布工程的 TongWeb 服务器实例。
3. 单击 “Publish”，发布工程。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/99406924043a0fca05662ffd3975aefb8d4d8e087678c950a079d1b50678b43d.jpg)
Figure 2. 发布工程
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/195f89742c414471be6049486e57c52dc4f94b23214da3cd31a06599de1e8410.jpg)
Figure 3. 发布前应用状态
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/81f3e63c54bb2764826c0d3d5078548e1afd92f825e3b4c7c3a9a644cddea2df.jpg)
Figure 4. 发布后应用状态


# 9.9.5.5. 启动服务器
在 “Servers” 视图中，单击右键菜单 “Start”，启动服务器，同一时间只支持启动一个 TongWeb 实例。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ee39b8ca31077b29e9ce95ba19a6b714b01ae386dfff689a510d0178175b1fd7.jpg)
Figure 5. 启动服务器


# 9.9.5.6. 停止服务器
在 “Servers” 视图中，单击右键 “Stop”，可停止一个已运行的 TongWeb 服务器。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7fd4c18b017e1f518a671d602ec35c158370eb747101998b495481a8a79b431d.jpg)
Figure 6. 停止服务器


# 9.9.5.7. 使用 Debug 功能
1. 用户可以在 Web 工程中的 Java 中设置断点，以 debug 方式启动 TongWeb 实例。在 Server 视图中右键单击 “Debug”，启动 TongWeb 服务器。
2. 如果需要配置远程 Debug 端口，需要在 “Run” $>$ “Debug configuration” $>$ “Remote JavaApplications” 里，右键 “New configuration”，在打开的界面中配置远程监听端口。

# 9.9.6. 卸载 Eclipse 插件
1. 删除 TongWeb 运行实例
在 “Window” $>$ “Show View” $>$ “Servers”中，选择要删除的 TongWeb 实例，将其删除。
2. 删除 TongWeb 服务器配置信息
a. 选择 “Window” $>$ “Preferences” 菜单。
b. 打开 “Server” $>$ “Runtime Environment” 界面。
c. 在右侧 “Server Runtime Environments” 中，选中所有 TongWeb 服务器，单击 “Remove” 删除。
3. 删除 “${eclipse.home}/dropins” 下 TongWeb 插件。
4. 重启 Eclipse。

# 9.10. Etcd
Etcd 是一个使用一致性哈希算法(Raft)在分布式环境下的 key/value 存储服务。利用 Etcd 的特性，应用程序可以在集群中共享信息、配置或作服务发现，Etcd 会在集群的各个节点中复制这些数据并保证这些数据始终正确。

# 9.10.1. 支持的版本
Etcd v3 版本。

# 9.10.2. 搭建 Etcd 环境
请参照官网文档搭建 Etcd 环境。

# 9.10.3. 下载 jar 包及依赖
请通过 etcd 官方渠道下载 java 客户端 jetcd 的 jar 包以及所有的依赖。
如下以 jetcd 0.7.6 版本 jar 包清单为例说明。
• checker-qual-3.33.0.jar
• failsafe-2.4.4.jar
• failureaccess-1.0.1.jar
• grpc-api-1.56.1.jar
• grpc-context-1.56.1.jar
• grpc-core-1.56.1.jar
• grpc-grpclb-1.56.1.jar
• grpc-netty-1.56.1.jar
• grpc-protobuf-1.56.1.jar
• grpc-protobuf-lite-1.56.1.jar
• grpc-stub-1.56.1.jar
• guava-32.1.1-jre.jar
• jackson-core-2.15.0.jar
• jetcd-api-0.7.6.jar
• jetcd-common-0.7.6.jar
• jetcd-core-0.7.6.jar
• jetcd-grpc-0.7.6.jar
• listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
• netty-buffer-4.1.94.Final.jar
• netty-codec-4.1.87.Final.jar
• netty-codec-dns-4.1.94.Final.jar
• netty-codec-http2-4.1.87.Final.jar
• netty-codec-http-4.1.94.Final.jar
• netty-codec-socks-4.1.87.Final.jar
• netty-common-4.1.94.Final.jar
• netty-handler-4.1.94.Final.jar
• netty-handler-proxy-4.1.87.Final.jar
• netty-resolver-4.1.94.Final.jar
• netty-resolver-dns-4.1.94.Final.jar
• netty-transport-4.1.94.Final.jar
• netty-transport-native-unix-common-4.1.87.Final.jar
• perfmark-api-0.26.0.jar
• protobuf-java-3.22.3.jar
• protobuf-java-util-3.22.3.jar
• proto-google-common-protos-2.17.0.jar
• slf4j-api-2.0.7.jar
• vertx-core-4.4.4.jar
• vertx-grpc-4.4.4.jar

# 9.10.4. 使用说明
关于 Etcd 用于发现 TongWeb 实例或共享配置的使用方式，请参见注册中心。

# 9.11. Elasticsearch
Elasticsearch 是一个分布式、基于 RESTful 风格的搜索和数据分析引擎。它能够集中存储用户的数据，使您能够快速进行搜索、优化相关性，并进行强大的数据分析，轻松扩展规模。

# 9.11.1. 下载并安装 Elasticsearch
请前往官网下载并安装 Elasticsearch。
注意：
日志推送对 Elasticsearch 版本没有要求。

# 9.11.2. 使用 Elasticsearch
关于如何使用 Elasticsearch，请参见日志推送。

# 9.12. Flashcat
通过 Flashcat 管理端获取 TongWeb 的监控数据。

# 前置条件
• 已搭建 Prometheus。
• 已搭建 PushGateway。
• 已搭建 Flashcat。

# 操作步骤
1. 新建组合监视。
a. 登录 TongWeb 控制台。
b. 切换到目标实例。
c. 在左侧菜单栏中，选择 “监视管理” $>$ “组合监视”，进入组合监视页面。
d. 单击 “创建”，进入创建组合监视页面。
e. 输入组合监视名称，并选择要监控的数据。
f. 配置完成后，单击 “添加”，完成组合监视的新建。
2. 启用 Prometheus 服务。
a. 登录 TongWeb 控制台。
b. 切换到目标实例。
c. 在左侧菜单栏中，单击 “监视管理” $>$ “Prometheus 服务”，进入 Prometheus 服务页面。
d. 打开 “启用” 开关，启用 Prometheus 服务。
e. 配置 Prometheus 相关参数。
▪ 组合监视：选择步骤1创建的组合监视。
▪ 上报方式：选择 “推送”。
▪ PushGateway 地址：配置为 PushGateway 服务地址。
▪ 其他参数：请根据实际需要填写。
f. 配置完成后，单击 “更新”，完成 Prometheus 服务的启用与配置操作。
3. 在 Flahcat 控制台添加 Prometheus Like。
a. 登录 Flashcat 控制台。
b. 在左侧菜单栏中，选择 “系统配置” $>$ “数据源”，进入数据源管理页面。
c. 单击 “Prometheus Like”，进入创建数据源页面。
d. 配置 Prometheus Like 相关参数。
▪ 名称：自定义数据源的名称。
▪ URL：Prometheus 的 IP 地址和端口。
▪ 其他参数：请根据需要填写。
e. 配置完成后，单击 “测试并保存”，完成 Prometheus Like 的添加操作。
4. 在 Flashcat 控制台添加监控图表。
a. 在 Flashcat 控制台的左侧菜单栏中，选择 “仪表盘” $>$ “监控仪表盘”，进入监控仪表盘页面。
b. 选择指定业务组，并单击 “新增”，弹出创建仪表盘窗口。
c. 配置仪表盘相关参数。
▪ 仪表盘名称：自定义仪表盘名称。
▪ 其他参数：请根据需要填写。
d. 配置完成后，单击 “确定”，完成仪表盘的创建操作。
e. 在仪表盘管理列表中，单击创建的仪表盘名称，进入添加图表页面。
f. 单击 “添加图表”，在弹出的下拉列表中，选择需要的图表类型，弹出添加图表窗口。
g. 配置图表相关参数。
▪ PromQL：输入监控项的查询语句。
监控项的对应语句，可以从 Prometheus 控制台的 Graph 菜单下获取。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/daa5126d570e892339dfdb849f0a199e0314ef333ecd2dc47e57bfa1f2f957ce.jpg)
▪ 其他参数：请根据需要填写。
h. 配置完成后，单击右下角的 “保存”，返回图表概览页面。
在图表概览页面，用户可查看监控项的图表信息。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/df31569bfd52ed7a651fb9c8a1e0342ef381c5fa2aa9f42ab8d724f07d7cdec1.jpg)


# 9.13. Grafana
通过 Grafana 管理端获取 TongWeb 的监控数据。

# 前置条件
• 已搭建 Prometheus。
• 已搭建 PushGateway。
• 已搭建 Grafana。

# 操作步骤
1. 新建组合监视。
a. 登录 TongWeb 控制台。
b. 切换到目标实例。
c. 在左侧菜单栏中，选择 “监视管理” $>$ “组合监视”，进入组合监视页面。
d. 单击 “创建”，进入创建组合监视页面。
e. 输入组合监视名称，并选择要监控的数据。
f. 配置完成后，单击 “添加”，完成组合监视的新建。
2. 启用 Prometheus 服务。
a. 登录 TongWeb 控制台。
b. 切换到目标实例。
c. 在左侧菜单栏中，单击 “监视管理” $>$ “Prometheus 服务”，进入 Prometheus 服务页面。
d. 打开 “启用” 开关，启用 Prometheus 服务。
e. 配置 Prometheus 相关参数。
▪ 组合监视：选择步骤1创建的组合监视。
▪ 上报方式：选择 “推送”。
▪ PushGateway 地址：配置为 PushGateway 服务地址。
▪ 其他参数：请根据实际需要填写。
f. 配置完成后，单击 “更新”，完成 Prometheus 服务的启用与配置操作。
3. 在 Grafana 控制台添加数据源。
a. 登录 Grafana 控制台。
b. 在左侧菜单栏中，选择 “Configuration” $>$ “Add data source”，并选择 “Prometheus”。
c. 配置 Prometheus 相关参数。
▪ URL：配置为 Prometheus 的 IP 和端口号。
▪ 其他参数：请根据需要填写。
d. 配置完成后，单击 “Save & Test”，即完成 Prometheus 的添加操作。
e. 单击 “Add a new panel”，在 “Metrics browser” 下拉框中，即可看到 TongWeb 相关项。
f. 选择要监控的项即可。

# 9.14. Hazelcast
将应用的 Session 存储到外部 Hazelcast 服务器，以获得会话高可用能力。

# 9.14.1. 前置条件
已搭建 Hazelcast 服务。

# 9.14.2. 下载并存放依赖包
1. 进入 Hazelcast 官网下载与已搭建 Hazelcast 服务对应版本的依赖包，如下所示。
◦ hazelcast.jar
◦ hazelcast-client.jar
2. 将下载的依赖包放置于 “${tongweb.base}/lib” 目录下。

# 9.14.3. 创建外部会话服务器(Hazelcast)
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择 “资源管理” $>$ “会话服务器”，进入会话服务器列表页面。
4. 单击 “创建”，进入创建会话服务器页面。
5. 输入会话服务器名称。
6. 开启 “使用外部会话服务器” 开关，并选择 “Hazelcast”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/e628ad0f5c5985f24fc6a67b70cd4819c04b03e114176b61a93b592a02501cdc.jpg)
7. 配置 Hazelcast 外部会话服务器相关参数。
◦ 服务器地址：配置为您搭建的 Hazelcast 服务的 IP 地址和端口。
◦ 认证密码：连接 Hazelcast 外部会话服务器的认证密码。
◦ 其他参数：请根据需要选择是否开启。
8. 配置完成后，单击“添加”，完成外部会话服务器(Hazelcast)的创建操作。
若界面弹出“会话服务器添加成功”提示信息，则说明会话服务器创建成功。

# 9.14.4. 应用外部会话服务器(Hazelcast)
1. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
2. 单击部署或者已部署应用的应用名，进入应用详细信息页面。
3. 单击 “会话与 Cookie”，进入会话与 Cookie 页签。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f50170a91e17ee67339d00526662f125ee526ccbec37ac4975aab5518dc31b9b.jpg)
4. 在 “会话服务器” 下拉列表中，选择已创建的外部会话服务器(Hazelcast)。
5. 其他参数，请根据需要进行配置。
6. 完成应用的部署或者更新，即可应用外部会话服务器(Hazelcast)。

# 9.15. IBM MQ
通过 JCA 连接消息服务器 IBM MQ。
1. 在 TongWeb 上部署 IBM 消息服务器提供的资源适配器（wmq.jmsra.rar，请自行从官方渠道获取，通常位于 IBM MQ 安装目录的 java/lib 下）；
2. 在 TongWeb 上创建连接池和托管对象，创建过程中选择上一步的资源适配器，并填入必要的属性信息。

# 连接池必填属性包括：
◦ 主机名：hostName
◦ 端口：port
◦ 编码字符集：CCSID
◦ 队列管理器：queueManager
◦ 用户名：username
◦ 密码：password

# 托管对象必填属性包括：
◦ 本地队列名：baseQueueName
◦ 编码字符集：CCSID
3. 确保 IBM MQ 服务器已启动，在消息服务器中创建对应的消息资源如本地队列；
4. 测试验证，部署 TongWeb 提供的示例，使用创建的连接池和托管对象进行消息收发。

# 9.16. IBMJDK
支持 IBM JDK。
若使用 IBM JDK，则需要手动放置如下 jar 包到 “${tongweb.home}/lib/compatible” 目录，否则启动TongWeb 失败。
• JDK 8.0
bcprov-jdk15on-1.70.jar
• JDK $8 . 0 +$
bcprov-jdk18on-1.78.1.jar

# 9.17. IntelliJ IDEA
为了满足用户能在 IntelliJ IDEA 中快速开发部署应用程序，TongWeb 开发了 IDEA 插件工具。
将 TongWeb 集成到 IntelliJ IDEA 开发工具，以在 IntelliJ IDEA 上开发、调试、部署应用到 TongWeb 上。
IntelliJ IDEA 插件的基本功能主要包括 TongWeb 的添加、配置修改以及启动和停止、应用部署、调试等功能。
可以在开发工具中添加 TongWeb 服务器，并在不影响源文件的前提下修改端口信息。
还可以在开发工具中配置多个 TongWeb 实例，通过定义不同的端口来实现多实例运行。

# 9.17.1. 支持 IntelliJ IDEA 版本
IntelliJ IDEA 2020 及以上版本（支持社区版）。

# 9.17.2. 下载并安装 IntelliJ IDEA
在 IntelliJ IDEA 的官网下载并安装即可。
下载地址：https://www.jetbrains.com/idea/download/。

# 9.17.3. 获取 IntelliJ IDEA TongWeb 插件
请联系东方通相关人员获取如下 TongWeb 插件：
tongweb-idea-1.0.0.zip ：支持 IntelliJ IDEA 2020 及以上版本（包含社区版）。

# 9.17.4. 安装 IntelliJ IDEA TongWeb 插件
1. 打开 IntelliJ IDEA 开发工具。
2. 依次打开 “File” $>$ “Settings” $>$ “Plugins”，进入 “Plugins” 页面。
3. 单击右侧面板顶部菜单中的设置，选择 “Install Plugin from Disk”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/74e4cf4d13242d23af97e4fa6edc45785140065a849102a4f59da2339c23367e.jpg)
4. 在弹出的 “Choose Plugin File” 窗口中，选择获取的 TongWeb 插件包。
5. 重启 IDEA 开发工具。

# 注意：
IntelliJ IDEA 部分版本的插件可能兼容，但是不能确定一定兼容。若找不到对应版本的插件时，可以尝试使用其他版本。
在 “Plugins” 页面，可查看到已安装的 IntelliJ IDEA TongWeb 插件。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c6c197d6a855c01c639882c4c4a2b933cb7bd98b62f3428401f78fcf1e5e2099.jpg)


# 9.17.5. 使用 IntelliJ IDEA TongWeb 插件

# 9.17.5.1. 添加 TongWeb 服务器
1. 打开 IDEA 开发工具。
2. 在页面右上角，选择 “Edit Configuration”，弹出 “Run/Debug Configurations” 窗口。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/6c3d3932d7183d4b4e2051a2e25f23b9fc6b152bfc9111fc1cacf6397db62b0e.jpg)
3. 单击 “Add new run configuration”，在弹出的菜单中，选择 “TongWeb Server”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d09179e2778b30bfff4210c3d8e6c3326488e107231745cec2a7b3c16492d467.jpg)
4. 进入添加 TongWeb 服务器界面。
◦ TongWeb 服务器：必填项，配置为 TongWeb 服务器安装路径，例如： D:\tongweb 。
◦ TongWeb 域：必填项，配置为实例运行路径，例如： D:\tongweb\domains\domain1\ 。
◦ 部署 web 模块：必填项，选择待部署的 Web 应用。
◦ 其他参数：非必填，用户可根据需要进行修改。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/cf1be42772465a93bdaf398daa9aa217edb154d1d7b4767a55fd4e6f27f25800.jpg)
5. 单击 “OK”，即完成 TongWeb 服务器的添加。
6. 添加完成以后，便可启动（绿色三角形图标）或者调试（绿色小虫子图标）程序。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/90eecfa098cd1b193a20507032849f3fc73d0662752cfec59f9998365452b1fb.jpg)
7. 可以观察 “Output” 中日志信息，启动完成后可以通过浏览器访问项目。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/fee47dfdd9665f1b97178acc02bea50896c07add0f5260155718511b5104a55a.jpg)


# 9.17.5.2. 使用 Debug 功能
在 Web 工程中的 Java 类设置断点，以 debug 启动即可。

# 9.17.5.3. 解部署工程
1. 进入“Run” $>$ “Edit Configurations” 的 “TongWeb Server” 视图。
2. 选择要删除的应用工程，单击 “-” 即可解部署工程。

# 9.17.6. 卸载 IntelliJ IDEA 插件
1. 删除 TongWeb 的运行配置。
在主面板顶部菜单中，选择 “Run” $>$ “Edit Configurations”，并在左边树菜单中找到 TongWeb 的相关运行配置并删除。
2. 进入 “File” $>$ “Settings” $>$ “Plugins” 中，找到 TongWeb 插件。
3. 进入详情，在右上角下拉选项中，单击 “Uninstall”，并重启 IDEA 工具。

# 9.18. LiferayPortal
Liferay 是一个开源的 Portal 产品，提供对多个独立系统的内容集成，为企业信息、流程等的整合提供了一套完整的解决方案。

# 9.18.1. 支持的版本
Liferay Portal 7.0 版本。

# 9.18.2. 下载 LiferayPortal
通过 LiferayPortal 官方渠道 下载 7.0 版本的 LiferayPortal。

# 9.18.3. 下载 tongweb-liferay 插件
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “扩展支持” $>$ “支持列表”，进入支持列表页面。
4. 单击 “LiferayPortal” 所在行的 “下载”，弹出下载窗口。
5. 勾选 “tongweb-liferay”，并单击 “确定”，即可下载以 “LiferayPortal.zip” 命名插件包。

# 9.18.4. 替换 class 到指定 jar 包
1. 将下载的 LiferayPortal.zip 插件包解压。
解压后目录为“tongweb-liferay”。
2. 进入 “tongweb-liferay” 目录。
3. 将如下 class 文件替换为指定 jar 包。
<table><tr><td>class 文件</td><td>替换的 jar 包</td><td>jar 包的位置</td><td>class 替换到 jar 包的位置</td></tr><tr><td>• ServerDetector.class
• ServerDetector$ServerType.class</td><td>portal-kernel.jar</td><td rowspan="8">在 ROOT 应用 “WEB-INF\shielded-container-lib” 路径下</td><td>com.liferay.portal.kernel.util</td></tr><tr><td>PropsUtil.class</td><td>portal-impl.jar</td><td>com.liferay.portal.util</td></tr><tr><td>• JSPEngineShieldedContainerInitializer</td><td>com.liferay.portal.jsp.engine.jar</td><td rowspan="4">com.liferay.portal.jsp.engine internals</td></tr><tr><td>• JSPEngineShieldedContainerInitializer</td><td></td></tr><tr><td>• JSPEngineShieldedContainerInitializer</td><td></td></tr><tr><td>• JSPEngineShieldedContainerInitializer</td><td></td></tr><tr><td>DataSourceFactoryImpl.class</td><td>portal-impl.jar</td><td>com.liferay.portal.dao.jpeg</td></tr><tr><td>GZipFilter.class</td><td>portal-impl.jar</td><td>com.liferay.portalservlet_filters.gzip</td></tr></table>

# 9.18.5. 放置 “tongweb-liferay.jar”
1. 进入解压后的插件包目录 “tongweb-liferay”。
2. 将 “tongweb-liferay.jar” 放入到 ROOT 应用 “WEB-INF\lib” 目录下。

# 9.18.6. 解压并配置 TongWeb
1. 将 TongWeb 解压到 “liferay-ce-portal” 目录下与 tomcat 同级。
2. 启动 TongWeb 应用服务器。
3. 登录 TongWeb 管理控制台。
4. 进入 “基础配置” $>$ “全局配置”，打开 “轻量模式” 开关。
5. 单击“更新”，切换为 TongWeb 轻量模式。
6. 重启 TongWeb，使配置生效。

# 9.18.7. 部署应用
1. 在 TongWeb 左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
2. 单击 “部署”，进入部署应用页面。
3. 在“部署路径”文本框中，输入 ROOT 应用所在的路径。
4. 单击“安全”页签，在安全页签下，开启“允许跨域访问”，允许跨域访问应用。
5. 单击“其它”页签，在“其它”页签中，填写“自定义jar扫描器”实现类为“com.liferay.support.tongweb.util.scan.NOPJarScanner”。
6. 单击“添加”，完成应用的部署操作。
7. 查看 TongWeb 日志。

# 9.19. Nacos
Nacos 是构建云原生应用的动态服务发现、配置管理和服务管理平台。

# 9.19.1. 支持的版本
2.0 以上版本。

# 9.19.2. 搭建 Nacos 环境
请参照官网文档搭建 Nacos 环境。

# 9.19.3. 下载 jar 包及依赖
请通过 Nacos 官方渠道下载 Nacos 客户端 jar 包以及所有的依赖。
如下以 2.2.3 版本 jar 包清单为例说明。
• commons-codec-1.15.jar
• commons-logging-1.2.jar
• httpasyncclient-4.1.3.jar
• httpclient-4.5.3.jar
• httpcore-4.4.6.jar
• httpcore-nio-4.4.6.jar
• jackson-annotations-2.12.7.jar
• jackson-core-2.12.6.jar
• jackson-databind-2.12.7.1.jar
• nacos-auth-plugin-2.2.3.jar
• nacos-client-2.2.3.jar
• nacos-encryption-plugin-2.2.3.jar
• simpleclient_tracer_common-0.12.0.jar
• simpleclient_tracer_otel_agent-0.12.0.jar
• simpleclient_tracer_otel-0.12.0.jar
• simpleclient-0.12.0.jar
• slf4j-api-2.0.7.jar
• snakeyaml-2.jar

# 9.19.4. 使用说明
关于 Nacos 用于发现 TongWeb 实例或共享配置的使用方式，请参见注册中心。

# 9.20. OTLP
关于 OTLP 的使用说明，详见OTLP 支持。

# 9.21. OpenMQ
通过 JCA 连接消息服务器 OpenMQ。

# 9.21.1. 配置方法
1. 请从官网获取消息服务器提供的资源适配器（OpenMQ 为 imqjmsra.rar）。
2. 登录 TongWeb 管理控制台，部署资源适配器应用 “imqjmsra.rar” 。
3. 在 TongWeb 上创建JCA连接池和JCA托管对象。创建时选择已部署的资源适配器 “imqjmsrar”，并填入必要的属性信息。
4. 确保 OpenMQ 服务器已启动，在消息服务器中创建对应的消息资源。

# 9.21.2. 测试方法
部署 TongWeb 提供的示例，使用创建的连接池和托管对象进行消息收发。
消息服务器中配置的均为本地连接（如 mq://localhost:7676/），可自行在资源适配器的 ra.xml 中按需修改，连接池和托管对象的必要属性也可在其中配置，如 OpenMQ 中连接池需指明
UserName admin,Password $\mid =$ admin,AddressList=localhost，托管对象需指明 Name=testd，testd 为队列名称。
TongWeb 提供的示例可在产品包中获得，可测试用队列进行消息收发，消息资源测试需要借助消息服务器提供的工具，如 Open MQ 的命令行工具中的 imqobjmgr 等。

# 9.22. OpenRASP
OpenRASP 是百度安全推出的一款免费、开源的应用运行时自我保护产品，TongWeb 支持基于其对自身和应用进行安全加固。

# 支持的 OpenRASP 版本
1.3.8

# 操作步骤
1. 从官方渠道获取 “rasp.zip”。
2. 将 rasp.zip 解压到 “${tongweb.base}/rasp” 目录。
3. 配置启动参数。
您可以通过如下任一种方式配置启动参数。
◦ 方式1：进入 “基础配置” $>$ “启动参数”，添加如下启动参数。
```batch
-javaagent:\$\{tongweb.base\}/rasp/rasp.jar
```
◦ 方式2：进入 “${tongweb.base}/conf” 目录，打开 “tongweb.xml”，添加如下配置。
```xml
<arg name="-javaagent:\$\{tongweb.home\}/rsp/rasp.jar"/>
```
4. 重启 TongWeb 服务器即可。

# 9.23. PinPoint
PinPoint 是一个APM（Application performance management）工具，相对于其他 APM 工具（如 ZipKin）有一个强大的优势，就是应用程序无需修改一行代码就能直接使用。
TongWeb 支持 PinPoint 工具，可通过 PinPoint 监控 TongWeb 的 Servlet 调用、类加载、内存使用、线程使用以及调用时间等。

# 9.23.1. 支持版本
• PinPoint 1.8.x
• PinPoint 2.0.x
• PinPoint 2.4.0

# 9.23.2. 下载并安装 PinPoint 相关组件
1. 前往官网下载 PinPoint 工具（pinpoint-agent-2.4.0）。
2. 安装 PinPoint 各组件。
hbase、pinpoint-agent-2.4.0、Pinpoint Collector、Pinpoint Web 及 JDK。
具体安装及启动可参考：
https://pinpoint-apm.github.io/pinpoint/installation.html
https://pinpoint-apm.github.io/pinpoint/quickstart.html

# 9.23.3. 下载 tongweb-pinpoint.jar 插件
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “扩展支持” $>$ “支持列表”，进入扩展支持列表页面。
4. 在 Pinpoint 所在行的操作列，单击 “下载”，即可下载如下 jar 包。
```txt
tongweb-pinpoint.jar
```

# 9.23.4. 使用说明
1. 将在 TongWeb 管理控制台下载的 “tongweb-pinpoint.jar” 插件拷贝至 “pinpoint-agent-2.4.0” 安装目录 “plugin” 下。
2. 修改 “pinpoint-agent-2.4.0/profiles” 目录下的 release 或者 local 中的 “pinpoint.config”。
添加如下配置信息。
profiler.tongweb.enabled=true  
profiler.tongweb/bootstrapsmain  $\equiv$  com.tongweb.main.TongWebMain  
profiler.tongweb.hidepinpointheader  $\equiv$  true  
profiler.tongweb.excludurl  $\equiv$  profiler.tongweb.tracerequestparam  $\equiv$  true

# 3. 配置启动参数。
您可以通过如下任一种方式配置启动参数。
◦ 方式1：登录控制台 > “基础配置” > “启动参数”，添加如下启动参数。
```gitattributes
-javaagent:/opt/pinpoint-agent-2.4.0/pinpoint-bootstrap-2.4.0.jar  
-Dpinpoint(agentId=TongWeb-pinpoint-agentId  
-Dpinpoint.applicationName=applicationName
```
▪ applicationName：请替换为实际应用的名称。
▪ 应用名称只能是[a-zA-Z0-9]、“.”、“-”、“_”组成并且长度不能大于24个字符。
◦ 方式2：打开 TongWeb 的 “${tongweb.base}/conf/tongweb.xml” 文件。
添加如下配置信息。
<arg name  $=$  "-javaagent:/opt/pinpont-agent-2.4.0/pinpont-bootstrap-2.4.0.jar"/> <arg name  $=$  "-Dpinpoint(agentId=TongWeb-pinpont-agentId"/> <arg name  $=$  "-Dpinpoint.applicationName  $\equiv$  applicationName"/>
▪ applicationName：请替换为实际应用的名称。
▪ 应用名称只能是[a-zA-Z0-9]、“.”、“-”、“_”组成并且长度不能大于24个字符。
4. 重启 TongWeb 服务器使配置生效。
5. 启动 PinPoint 各组件及 TongWeb。
6. 访问 PinPoint Web 页面，即可查看监控信息。

# 9.24. Prometheus
此扩展基于 TongWeb 内部服务向 Prometheus 提供监控指标数据。
关于如何使用 Prometheus 服务，请参见Prometheus 监控。

# 9.25. Redis
将应用的 Session 存储到外部 Redis 服务器，以获得会话高可用能力。

# 9.25.1. 前置条件
已搭建 Redis 服务。

# 9.25.2. 下载并存放依赖包
1. 进入 Redis 官网下载如下依赖包。
◦ lettuce-core-6.2.3.RELEASE.jar
◦ netty-buffer-4.1.89.Final.jar
◦ netty-codec-4.1.89.Final.jar
◦ netty-common-4.1.89.Final.jar
◦ netty-handler-4.1.89.Final.jar
◦ netty-resolver-4.1.89.Final.jar
◦ netty-transport-4.1.89.Final.jar
◦ reactive-streams-1.0.4.jar
◦ reactor-core-3.4.27.jar
2. 将下载的依赖包放置于 “${tongweb.base}/lib” 目录下。

# 9.25.3. 创建外部会话服务器(Redis)
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择 “资源管理” $>$ “会话服务器”，进入会话服务器列表页面。
4. 单击 “创建”，进入创建会话服务器页面。
5. 输入会话服务器名称。
6. 打开 “使用外部会话服务器” 开关，并选择 “Redis”。

# 会话服务器／创建☆
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/76592a687f00a58efe7aea6625f0470146b92c6aed91d91a7889276ba382a4b9.jpg)
7. 配置 Redis 服务器相关参数。
◦ 连接模式：请根据您的 Redis 服务器的连接模式进行选择。
◦ 服务器地址：连接 Redis 服务器的IP地址和端口号。
◦ 用户名：连接 Redis 服务器的用户名。
◦ 密码：连接 Redis 服务器的密码。
◦ 其他参数：请根据实际环境填写。
8. 配置完成后，单击 “添加”，完成外部会话服务器(Redis)的创建操作。
若界面弹出“会话服务器添加成功”提示信息，则说明外部会话服务器(Redis)创建成功。

# 9.25.4. 应用外部会话服务器(Redis)
1. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
2. 单击部署或者已部署应用的应用名，进入应用详细信息页面。
3. 单击 “会话与 Cookie”，进入会话与 Cookie 页签。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/dfa124a4c43ce74606a6fb1cb63089e82e1f261fefe44f36101bbbcaa97e1cd8.jpg)
4. 在 “会话服务器” 下拉列表中，选择已创建的外部会话服务器(Redis)。
5. 其他参数，请根据需要进行配置。
6. 完成应用的部署或者更新，即可应用外部会话服务器(Redis)。

# 9.26. SNMP
通过 SNMP 管理端获取 TongWeb 的监控数据。
关于SNMP服务如何使用，请参见SNMP服务。

# 9.27. SkyWalking
SkyWalking 是分布式系统的应用程序性能监视工具，包括了分布式追踪，性能指标分析和服务依赖分析等。

# 9.27.1. 获取安装包
从官网分别下载如下安装包。
• apache-skywalking-apm-9.3.0.tar.gz
• apache-skywalking-java-agent-8.14.0.tgz
下载路径：
• https://www.apache.org/dyn/closer.cgi/skywalking/9.3.0/apache-skywalking-apm-9.3.0.tar.gz
• https://www.apache.org/dyn/closer.cgi/skywalking/java-agent/8.14.0/apache-skywalking-java-agent-8.14.0.tgz

# 9.27.2. 部署 SkyWalking

# 1. 存放从官网下载的安装包
a. 新建 skywalking 文件夹。
b. 将从官网下载的两个安装包解压，并存放到新建的 skywalking 文件夹，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/5af31efb218c3b7bf0c95c7247dc14b57264f912e728ff45824ca8d60a6f153f.jpg)


# 2. 下载并存放 tongweb-skywalking.jar
a. 登录 TongWeb 管理控制台。
b. 单击“集中管理”，进入集中管理页面。
c. 选择“扩展支持”>“支持列表”，进入支持列表页面。
d. 单击“SkyWalking”所在行的“下载”，弹出选择要下载的文件窗口。
e. 勾选“tongweb-skywalking.jar”，并单击“确定”，下载以 “SkyWalking.zip” 命名的文件。
f. 下载完成后，将 “SkyWalking.zip” 解压。
g. 将解压后的 “tongweb-skywalking.jar” 文件存放在 skywalking\skywalking-agent\plugins 目录下，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d84e5beff88bf9708568c2bce5d8a70c81122dc4413c2b2abd150b70b30096c9.jpg)


# 3. 配置 TongWeb 启动参数
您可以通过如下两种方式配置启动参数。配置完成后，需要重启 TongWeb 服务器，使配置生效。
◦ 进入“基础配置”>“启动参数”，添加如下启动参数。
指定 “skywalking-agent.jar”的位置。
以“D:/skywalking/skywalking-agent/skywalking-agent.jar”为例，请根据实际路径修改。
```txt
-javaagent:D:/skywalking/skywalking-agent/skywalking-agent.jar
```
◦ 打开“${tongweb.base}/conf/tongweb.xml”文件，添加如下启动参数。
```txt
<arg name="--javaagent:D:/skywalking/skywalking-agent/skywalking-agent.jar"/>
```

# 4. 启动本地 H2 数据库
支持H2、MySQL、ElasticSearch 数据库，以 “H2” 为例说明。

# 5. 修改 SkyWalking 配置文件
a. 进入 “skywalking\apache-skywalking-apm-bin\config” 目录。
b. 打开 “application.yml” 文件。
c. 修改为 H2 的 jdbcUrl 以及用户名，如下所示。
```yaml
h2: properties: jdbcUrl: \$\{SW_STORAGE_H2_URL:h2数据库的jdbcUrl;DB_CLOSE_DELAY=-1\} dataSource.user: \$\{SW_STORAGE_H2_USER:用户名\}
```
d. 修改完成后，保存并退出。

# 6. 修改服务名称
a. 进入 “skywalking\skywalking-agent\config” 目录。
b. 打开 “agent.config” 文件。
c. 将 “Your_ApplicationName” 修改为 “TongWeb”。
d. 修改完成后，保存并退出。

# 7. 修改组件名称
a. 进入 “skywalking\apache-skywalking-apm-bin\config” 目录。
b. 打开 “component-libraries.yml” 文件。
c. 添加如下信息。
```yaml
TongWeb: id: 141 languages: Java
```
注意:
要与 “component-libraries.yml” 中其它配置格式保持一致。
d. 配置完成后，保存并退出。

# 8. 修改 skyWalking 控制台端口号（避免8080端口冲突）
a. 进入 “skywalking\apache-skywalking-apm-bin\webapp” 目录。
b. 打开 “application.yaml” 文件。
c. 将 “serverPort: $\$ 1$ {SW_SERVER_PORT:-8080}” 中的 “8080” 修改为 “9010”。
注意：
您也可以根据需要将 skyWalking 控制台端口修改为其它端口号。

# 9. 启动 SkyWalking 并访问控制台
a. 分别执行 “skyWalking\apache-skywalking-apm-bin\bin” 目录下的 oapService.bat 和webappService.bat 。
b. 启动成功后，访问SkyWalking控制台，访问地址如下所示。
http://localhost:9010

# 10. 部署并访问应用
a. 登录 TongWeb 管理控制台。
b. 选择 “应用管理”>“应用”，进入应用列表页面。
c. 部署任意应用，并访问应用。

# 11. 查看 skyWalking 控制台
a. 访问 SkyWalking 控制台。
b. 在左侧菜单栏中，选择“普通服务”>“服务”，进入服务列表页面。
c. 单击表格中的服务名称，并单击“Trace”，则可查看到访问部署到 TongWeb 上应用生成的访问日志，表示 SkyWalking 在 TongWeb 适配成功。

# 9.28. SpringBootAdmin
Spring Boot Admin 提供了对单个 Spring Boot 应用的监控，信息包含应用状态、内存、线程、堆栈等，比较全面的监控了 Spring Boot 应用的整个生命周期，可以有效地帮助用户解决众多服务的健康检查、指标监控问题、配置管理、日志聚合问题、异常排查问题等。

# 步骤1：创建服务器端

# 1. 配置依赖
a. 创建新的 Spring Boot 项目。
b. 在新建的项目中，添加 Spring Boot Admin 服务器端的依赖 JAR 包。
spring-boot-admin-starter-server

# 2. 配置启动端口
a. 打开系统配置文件 “application.properties”。
b. 配置服务端的启动端口为 $" 8 0 0 0 "$ 。
server.port=8000

# 3. 启动 Admin 服务器
使用 @EnableAdminServer 注解启动 Admin 服务器。

# 4. 运行验证
访问如下地址，可以看到应用数为 “1”，状态为全部在线。
http://localhost:8000

# 步骤2：创建客户端

# 1. 配置依赖
a. 创建新的 Spring Boot 项目。
b. 在新建的项目中，添加 Spring Boot Admin 客户端的依赖 JAR 包。
spring-boot-admin-starter-client
2. 配置客户端 “application.properties”。
```txt
server.port=8001  
spring.application.name=Admin  
Clientspring.boot_admin.client.url=http://localhost:8000  
management endpoints.web.exposure include=*
```
3. 运行验证
重新访问如下地址，可以看到应用数为 “2”，状态为全部在线。
```txt
http://localhost:8000
```

# 步骤3：客户端部署到 TongWeb
1. 把客户端 JAR 包部署到 TongWeb。
2. 运行验证。
再次访问如下地址，同样可以看到应用数为 “2”，状态为全部在线。
```txt
http://localhost:8000
```

# 9.29. SpringSession
支持 Spring Session，为分布式场景中的 Session 共享提供解决方案。
兼容基于 Spring Session 开发的应用程序，应用不需要做任何针对 Session 共享相关的改变，即可实现分布式场景（含异构系统）下的 Session 共享。

# 9.30. TongAPM_V1.0
TongWeb 应用性能监控工具（Application Performance Management，APM）能够获取大量精准的监控信息，迅速定位应用的性能瓶颈，协助开发/运维人员优化应用性能。
TongWeb 为应用提供基础运行环境，并且需要确保其性能稳定，因此提供了代码级的应用性能诊断和分析工具 TongAPM，TongAPM 属于 TongWeb 内置功能。
本章介绍 TongAPM 的安装配置以及使用 TongAPM 进行慢请求分析、类方法分析、线程剖析、JDBC 分析、内存分析等。

# 9.30.1. 获取安装包
请联系东方通相关人员获取 TongAPM 安装包。
TongAPM 由客户端 tongapm.jar 和管理控制台 tongapm.war 两部分组成。
tongapm.war 不能单独部署使用，必须结合 tongapm.jar 一起使用。

# 9.30.2. 安装 TongAPM

# 1. 放 “tongapm.jar” 文件
a. 进入 “${tongweb.home}/lib” 目录。
b. 创建一个以 “apm” 命名的文件夹。
c. 将 “tongapm.jar” 放在 “apm” 目录下。

# 2. 配置启动参数
您可以通过如下两种方式配置启动参数。配置完成后，需要重启 TongWeb 服务器，使配置生效。
◦ 方式1：进入 TongWeb 的 “基础配置” $>$ “启动参数”，分别创建如下两个启动参数。
▪ -Xbootclasspath/a:${tongweb_home}/lib/apm/tongapm.jar
▪ -javaagent:${tongweb_home}/lib/apm/tongapm.jar
◦ 方式2：打开 TongWeb 的 “${tongweb.base}/conf/tongweb.xml” 文件，添加如下启动参数。
```txt
<arg name="-Xbootklasspath/a:\$\{tongweb.base\}/lib/apm/tongapm.jar" > <arg name="-javaagent:\$\{tongweb.base\}/lib/apm/tongapm.jar" >
```

# 3. 打开 “启用 Validator” 开关
进入 “基础配置” > “全局配置” $>$ “服务器”，打开 “启用 Validator” 开关。

# 4. 部署 “tongapm.war” 应用包
a. 登录 TongWeb 管理控制台。
b. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
c. 单击 “部署”，部署 “tongapm.war” 应用。
▪ 单击 “资源加载” 页签，将 “强制从应用加载的类” 配置为 “javax.ws.rs.ex.RuntimeDelegate”。
▪ 开启 “Web 兼容模式”。

# 应用/部署☆
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/be801d2af118fa4cab53f2825b07430d9b9463a7e9e48a4d1286ce402d5aa9ea.jpg)
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f4fd6d1a0298234a6c87fd834a73caadb04fbaa2f37d025864e6da8b23aa9fda.jpg)
若不开启 “Web 兼容模式”，可选择 “基础配置” $>$ “全局配置”，开启 “轻量模式” 达到同样效果。若选择开启 “轻量模式”，需要在部署 “tongapm.war” 应用前开启 “轻量模式” 并重启 TongWeb 服
务器，否则会报错。
d. 配置完成后，单击 “添加”，完成 “tongapm.war” 包的部署。

# 9.30.3. 访问 TongAPM 控制台
TongAPM 安装完成后，即可访问 TongAPM 控制台。
1. 登录 TongWeb 管理控制台。
2. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
3. 单击部署的 “tongapm.war” 应用所在行的“链接”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d187895bab10118a573c3f256f511e9e3ef254291b6d44d878a0d875a5047555.jpg)
4. 单击应用/链接页面生成的访问链接，即可进入TongAPM控制台。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/cb41f0054169296dc459795836be00bc53eb530a15a1dfa3885f66b80f8ca445.jpg)


# 9.30.4. APM使用说明

# 9.30.4.1. APM配置
在TongAPM应用性能管理控制台中，单击“APM配置”，进入APM配置界面，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/0a4441992bce0bfc8b48be359e8cceb114e8c35c73ef0e160e069947d7777b6c.jpg)
APM配置参数说明，如下所示。
<table><tr><td>分类</td><td>参数</td><td>参数说明</td></tr><tr><td rowspan="3">慢请求分析配置</td><td>慢请求分析</td><td>默认开启慢请求分析功能，关闭重启后将无法使用慢请求分析功能。</td></tr><tr><td>慢请求追踪阈值</td><td>处理时间超过此阈值的请求会被追踪，单位为毫秒，默认为20。</td></tr><tr><td>慢请求追踪数量</td><td>同一个URL慢请求追踪的最大数量，默认为20。</td></tr><tr><td rowspan="7">类方法分析配置</td><td>类方法分析</td><td>类方法分析功能开关。只有开启该功能后,才能在类方法分析页面看到类方法分析结果,否则类方法分析页面将没有结果显示,配置改变后需要重启服务器以生效。</td></tr><tr><td>只统计的包</td><td>只对这些包下的类进行分析,多个包以英文分隔。如果只统计的包没有配置,则统计所有包下的类。配置改变后需要重启服务器以生效。</td></tr><tr><td>不统计的包</td><td>不对这些包下的类进行分析,是指在只统计的包范围内要排除的包或子包,多个包以英文逗号分隔。配置改变后需要重启服务器以生效。不统计的包优先级高于只统计的包。例如只统计的包配置了com.tongweb,如果要排除com.tongweb下的util包,则可以在“不统计的包”中配置com.tongweb.util。</td></tr><tr><td>是否持久化</td><td>开启后,持久化到文件,默认开启。</td></tr><tr><td>持久化目录</td><td>持久化文件所存放的目录。</td></tr><tr><td>轮转大小</td><td>每个持久化文件的大小,默认为10M。</td></tr><tr><td>清理策略</td><td>默认为30天;当存在存放时间超过设置的天数时,即被清理。</td></tr><tr><td rowspan="5">JDBC</td><td>JDBC分析</td><td>默认开启JDBC分析功能,开启后可查看可疑的数据库连接泄漏等。</td></tr><tr><td>是否持久化</td><td>开启后,持久化到文件,默认开启。</td></tr><tr><td>持久化目录</td><td>持久化文件所存放的目录。</td></tr><tr><td>轮转大小</td><td>每个持久化文件的大小,默认为10M。</td></tr><tr><td>清理策略</td><td>默认为30天;当存在存放时间超过设置的天数时,即被清理。</td></tr><tr><td rowspan="3">内存分析</td><td>潜在内存泄露</td><td>默认开启潜在内存泄露功能,该功能用于分析可能存在内存泄漏的Java集合对象,如ArrayList、 HashMap、HashSet等对象。</td></tr><tr><td>泄露检测阈值</td><td>集合长度超过此阈值的会被视为可能存在内存泄漏问题,默认为1000。</td></tr><tr><td>大对象分析</td><td>默认开启大对象分析功能开关,该功能可分析占用内存较大的对象,可用以辅助分析应用内存相关问题。</td></tr></table>

# 9.30.4.2. 慢请求分析
慢请求分析可用于定位平均响应时间较长的请求URL，并根据设置的处理时间和请求数量的阈值对其进行慢请求追踪，通过对单次请求的过程分解做进一步的定位和分析。

# 慢请求分析
在该页面中显示了应用请求按请求平均响应时间从高到低排序，也可以按照请求次数进行排序。
若请求响应时间均未达到APM配置中的慢请求追踪阈值，则追踪一列的按钮为灰色且显示“不可追踪”。
1. 访问TongAPM控制台。
2. 在左侧导航栏中，单击“慢请求分析”，进入“慢请求分析”页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/0bf6312b42face66e9328b6703ff17453bedc8ab23a5ec9bfecb41a4583e2188.jpg)
慢请求分析参数说明，如下所示。
◦ 过滤请求：修改“过滤请求”后只显示包含了输入值的结果，此功能可方便快速定位需要查看的结果。
◦ 排序方式：分为“平均响应时间”和“请求次数”，默认显示前20条记录。
◦ 停止分析：表示停止请求分析功能并清除历史数据。单击“停止分析”按钮后自动转换为“启动分析”按钮，单击“启动分析”后会重新开始进行请求分析。
◦ 刷新：单击“刷新”按钮后，可以按当前页面选择条件展示统计的最新分析结果。
◦ 显示行数：调整“显示行数”的值可控制每页展示的记录数。

# 慢请求跟踪
慢请求追踪功能可以提供更细粒度的模块调用过程，更加精准地定位应用瓶颈，并且能针对单次请求的应用过程进行分解。
在慢请求分析结果页面，单击关注的URL或者对应的追踪按钮，即可跳转到该URL对应的慢请求追踪列表。
该列表展示了此URL请求中，响应时间大于设置的阈值时间的请求及其耗时。
该列表中最大数量为慢请求追踪数量配置的最大值，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/badb1cda1a24b0e0b6d903fccd3ddd38e2ce2d4a385e35e97586d311b08d8ec7.jpg)


# 9.30.4.3. 类分析方法
展示了类方法平均执行时间的排序结果，也可以按照执行次数进行排序。
1. 访问TongAPM控制台。
2. 在左侧导航栏中，单击“类方法分析”，进入类方法分析页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/2dbc091a74df90acdbe396b79edf7c5ee14e8b7283e27c5e18aa1f6de861b349.jpg)
类方法分析参数说明，如下所示。
◦ 过滤方法：修改“过滤方法”后只显示包含了输入值的结果，此功能可方便快速定位需要查看的结果。
◦ 排序方式：分为“平均执行时间”和“执行次数”，默认显示前20条记录。
◦ 停止分析：表示停止类方法分析功能并清除历史数据。单击“停止分析”按钮后自动转换为“启动分析”按钮。单击“启动分析”按钮后会重新进行类方法分析。
◦ 刷新：单击“刷新”按钮后，可展示按当前页面选择条件统计的最新分析结果。
◦ 显示行数：调整“显示行数”的值可控制每页展示的记录数。

# 9.30.4.4. 线程剖析
在不影响用户体验的情况下，线程剖析以非常低的系统开销采集线程状态，线程剖析完成后，显示代码消耗的时间和比例。

# 剖析功能
1. 访问 TongAPM 控制台。

# 2. 在左侧导航栏中，单击“线程剖析”，出现“线程剖析”主页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7d1b67cccc3e73990c542232b2fd506275f24e1caaf1912ea5fb10b90b64ffa7.jpg)
◦ 在“开始线程剖析”区域，选择“持续时长”后，单击“开始剖析”按钮，开始一次线程剖析活动。当该活动持续的时长达到设置的“持续时长”后将自动停止。
◦ 单击“停止剖析”按钮可立即停止本次剖析活动。
◦ 当剖析活动停止后，本次剖析结果会出现在“线程剖析列表”区域。
◦ 线程剖析结果按时间排序，最近的剖析结果排在最上方。
◦ 对于不再需要的历史剖析结果，可勾选对应的单选框并单击“删除”按钮将其删除。

# 展示功能
在线程剖析主页面的“线程剖析列表”区域，单击某次的剖析结果时间，可进入该次线程剖析的“剖析结果”页面，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1f72f4910489f0ae45c17dfe955b1e72648fe0b5beb7e6e4d247872d84fc2349.jpg)
剖析结果页面展示了在该剖析时间段内，系统内线程栈运行的时间统计信息，具体包括运行时间、运行时间比例、类名、方法名、源码行号等信息。

# 9.30.4.5. JDBC分析
JDBC是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问。通过JDBC分析可以
对SQL的耗时进行查询和JDBC泄漏进行监测。

# TOP SQL
可监控SQL执行时间，并通过TOP SQL的方式展示耗时最长的SQL语句。
1. 访问TongAPM控制台。
2. 在左侧导航栏中，选择“JDBC”>“TOP SQL”，进入TOP SQL页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b7887852ae23d236e028b80756f38812187adc9d9c91d32e8f6fa983dde30935.jpg)
TOP SQL参数说明，如下所示。
◦ SQL排序类型：分为“SQL平均耗时”或“SQL总耗时”两种方式，分别对当前应用的SQL进行统计和查询，查询数量最大支持100个。
◦ 堆栈信息：对应SQL同时支持堆栈信息的查询，通过“查看堆栈”能够对SQL的执行进行代码级定位。

# JDBC资源泄漏
TongAPM 支持对 TongWeb数据源中的 JDBC 连接和 Statement 泄露进行监测，数据源包括主流数据库如Oracle、MySQL、Microsoft SQL Server2000、DB2、Sybase、Informix。
1. 访问TongAPM控制台。
2. 在左侧导航栏中，选择“JDBC”>“JDBC资源泄漏”，进入JDBC资源泄漏页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/84d8d391a62732e18f6e0c8f54e479378566169b7be1d51971137328a4d145eb.jpg)
“JDBC连接泄露监控量”区域以柱状图方式进行展示，监控量包括当前的JDBC连接、连接泄露、Statement泄露。
“堆栈信息”区域分别展示JDBC连接泄露和Statement泄露的堆栈信息。
3. 单击“+”，可查看对应资源泄露的详细堆栈信息。

# 9.30.4.6. 内存分析
Java内存溢出是一个比较复杂的问题，通常需要借助专业的内存分析工具分析内存dump，再结合程序自身的逻辑进行逐步分析。
TongAPM的内存泄露分析功能能够针对多数情况的内存泄露进行实时监控，并给出可能的潜在内存泄露分析以及大对象分析。

# 潜在内存泄露分析
开启APM后，可以监控应用服务器的内存状态，判断是否存在潜在内存泄露风险。
1. 访问TongAPM控制台。
2. 在左侧导航栏中，选择“内存分析”>“潜在内存泄露”，进入“潜在内存泄露”页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f42385a2e960ec6600137fe04f2258820214610041eecad96b8418bd0402fba2.jpg)
潜在内存泄露页面以列表形式展示，展示信息包括潜在内存泄露对象类名、内存占用、内存占比、主要内部对象类名、长度、堆栈信息。
对应的泄露对象同时支持堆栈信息的查询，通过单击相应的“查看堆栈”，能够对潜在内存泄露位置进行代码级的定位。

# 大对象分析
TongAPM的大对象分析功能可以持续监控JVM中大对象实例数和占用内存持续增长的类实例信息，该功能为内存泄露分析提供了辅助分析决策。

# 注意：
该功能依赖于jmap命令，要正常使用该功能需要确保jmap命令能够正常执行。
1. 访问TongAPM控制台。
2. 在左侧导航栏中，选择“内存分析”>“大对象分析”，进入大对象分析页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1e35c8c44d974b0ae83e1197d390f57871aeea2d91c3355aa9c6efa0854fa781.jpg)
该页面展示了当前占用内存1MB以上，并且正在持续增长的类实例的相关信息，包括对象的类名、实例数、占用内存和内存占比。
由于在实际使用过程中，JDK相关的类实例变化波动较大，部分JDK的类实例数和内存占用也会在一段时间内持续增长，TongAPM提供了对JDK相关类的过滤功能。
3. 单击下拉列表，选择“过滤JDK相关类”后， 将在默认情况下进行过滤，则不再显示过滤掉的JDK的类实例信息。

# 9.30.4.7. 类加载分析工具

# 查看类加载器树
可查看类加载器树、类加载器信息，包含描述、类型、已加载类、类列表、加载路径等信息。
1. 访问 TongAPM 控制台。
2. 在左侧导航栏中，选择“类加载分析工具”>“类加载器树”，进入类加载器树页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c0e662d583dfa05acdc37d09ac815748b4b34b8be6d55a0c1ad15da8e441fc45.jpg)


# 类资源分析
用于分析具体类的加载与分布情况。可以是已部署的应用或者直接上传应用进行类资源分析。
1. 访问 TongAPM 控制台。
2. 在左侧导航栏中，选择“类加载分析工具”>“类资源分析”，进入类资源分析页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ea1053b9a2f1bb4baf1a398c36cc84b5aab6c759493dd97188900606735e5877.jpg)
配置参数说明，如下所示。
在下拉列表中，选择已部署的应用或者上传应用进行类资源分析。

# ◦ 已部署的应用
类全名称：输入类全名称，例如：String类的类全名称为java.lang.String。

# ◦ 上传应用
▪ 上传文件：单击“选择文件”，上传“jar”、“war”或者“ear”类型的应用文件。
▪ 类全名称：输入类全名称，例如：String类的类全名称为java.lang.String。
3. 单击“分析”，在页面下方可查看类资源的分析报告。
包含加载明细（类加载器、加载位置）、分布明细等。

# 类冲突检测
用于检测整个应用的类加载冲突情况，并可以生成本次检测的报告。可以是已部署的应用或者直接上传应用进行类冲突检测。
1. 访问 TongAPM 控制台。
2. 在左侧导航栏中，选择 “类加载分析工具” > “类冲突检测”，进入类冲突检测页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/03c254192289f72c67025fa2d6fb415f9132914b938a23c87dc944a1ce9c69c7.jpg)
3. 在下拉列表中，选择已部署的应用或者上传应用进行类冲突检测。
4. （可选）勾选“开启”生成报告，默认为“关闭”。
开启后在服务器 “${tongweb.home}/logs/cla” 目录下将会生成本次检测的报告文件。
5. 单击“检测”，在页面下方可查看类冲突检测报告。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d0ade18afe731840d9eb949d89d2c89080be046f9d620be533d7d5509fd89e49.jpg)


# 9.31. TongAPM_V2.0
通过 TongAPM v2.0 管理端获取 TongWeb 的监控数据。

# 9.31.1. 前置条件
已获取如下 TongAPM2.0 的安装包。
• tong-monitor-aem-bin.tar.gz
• TongAPM-console.tar.gz
• monitor-agent.tar.gz

# 9.31.2. 环境要求
JDK11 及以上版本。

# 9.31.3. 配置并启动 OAP-Server

# 9.31.3.1. 步骤1：创建一个数据库
OAP-Server 存储支持 MySQL 和 ElasticSearch。
如下以 “MySQL” 数据库为例进行说明。
1. 使用数据库连接工具，连接已搭建的 MySQL 数据库。
2. 新建一个数据库。
◦ 数据库名称可以使用提供的默认名称 “tongapm”。
◦ 用户也可以根据需要自定义数据库名称。

# 9.31.3.2. 步骤2：配置数据库信息
若使用 ElasticSearch，关于 ElasticSearch 数据库的配置，请参见《TongAPM_V2.0产品安装手册》。
1. 将 “tong-monitor-aem-bin-{n}.tar.gz” 安装包上传至待部署 OAP-Server 的服务器。
2. 解压 “tong-monitor-aem-bin-{n}.tar.gz” 安装包。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/300ecc53ab7e904eec620f3a25532cdc6235331254b1de46cf1922e6c20b06e1.jpg)
OAP-Server 为免安装版本，解压即安装。
3. 进入 “tong-monitor-aem-bin/config” 目录。
4. 打开 “application.yml” 文件。
5. 将数据库的 url、username 以及 password 修改为新建的数据库信息。
◦ url：需要配置 步骤1 新建的数据库 IP、Port 及数据库名称（如默认 “tongapm”）。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/0e6c900021708f04b6492a057ac32c48fec8d167cc2e8828c03dfae90e7ff1d0.jpg)
若是自定义数据库名称，需要根据实际填写。
◦ username：连接数据库的用户名。
◦ password：连接数据库的密码。
h2: driver:  $\S$  {MN STORAGE_H2 DRIVER:org.h2.jdbcx.JdbcDataSource} url:  $\S$  {MN STORAGE_H2 URL:jdbc:h2:mem:monitor-bpa-db;DB_CLOSE_DELAY=-1} user:  $\S$  {MN STORAGE_H2 USER:sa} metadataQueryMaxsize:  $\S$  {MN STORAGE_H2 QUERY MAX SIZE:5000} maxSizeOfArrayColumn:  $\S$  {MN STORAGE_MAX_SIZE_OF_ARRAYCOLUMN:28} numOfSearchableValuesPerTag:  $\S$  {MN STORAGE_NUM_OF_SEARCHABLE VALUES_PER_TAG:2} maxSizeOfBatchSql:  $\S$  {MN STORAGE_MAX_SIZE_OF Batch SQL:100} asyncBatchPersistentPoolingSize: $\S$  {MN STORAGEASYNC BatchPersistentPOOL_SIZE:1} mysql: properties: jdbcurl:  $\S$  {MN_JDBCURL:"jdbc:mysql://192.168. :3306/tongapm?rewriteBatchedStatements=true&useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true } &serverTimezone=GMTX<287> dataSource.user:  $\S$  {MN_DATA_SOURCE_USER:root} dataSource.password:  $\S$  {MN DATA SOURCE PASSWORD:root} dataSource.cachePreStms: $\S$  {MN DATA SOURCE_CACHE_PREP_STMS:true} dataSource.preStmCacheSize: $\S$  {MN_DATA_SOURCE_PREP_STMT_CACHE_SQL_SIZE:250} dataSource.preStmCacheSqlLimit: $\S$  {MN_DATA_SOURCE_PREP_STMT_CACHE_SQL_LIMIT:2048} dataSource.dataServerPreStms: $\S$  {MN DATA SOURCE USE_SERVER_PREP STMS:true}

# 9.31.3.3. 步骤3：初始化数据库并启动 OAP-Server

# • Windows 平台
1. 进入 “tong-monitor-aem-bin/bin” 目录。
2. 执行如下命令，启动 OAP-Server。
bpaService.bat
若提示信息出现 “successfully” 字样，则说明启动 OAP-Server 成功。
注意：
执行如下命令，可停止 OAP-Server。
bpaServiceStop.bat

# • Linux 平台
1. 进入 “tong-monitor-aem-bin/bin” 目录。
2. 执行如下命令，启动 OAP-Server。
sh bpaService.sh
若提示信息出现 “successfully” 字样，则说明启动 OAP-Server 成功。
注意：
执行如下命令，可停止 OAP-Server。
sh bpaServiceStop.sh

# 9.31.4. 配置并启动 TongAPM Console

# 9.31.4.1. 步骤1：创建一个数据库
1. 使用数据库连接工具，连接已搭建的 MySQL 数据库。
2. 新建一个数据库。
◦ 数据库名称可以使用提供的默认名称 “aem-console”。
◦ 用户也可以根据需要自定义数据库名称。

# 9.31.4.2. 步骤2：配置数据库信息
1. 将 “TongAPM-console-{n}.tar.gz” 安装包上传至待部署 TongAPM Console 的服务器。
2. 解压 “TongAPM-console-{n}.tar.gz” 安装包，解压后目录为 “console”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/455ee38500cf53992972b2382488e032df1ac3ed52ea571bcfe14f6415178957.jpg)
TongAPM Console 为免安装版本，解压即安装。
3. 进入 TongAPM Console 安装目录 “console/lib/admin”。
4. 打开 “application-druid.yml” 文件。
5. 将数据库的 url、username 以及 password 修改为新建的数据库信息。
◦ url：需要配置 步骤1 新建的数据库 IP、Port 及数据库名称（如默认 “aem-console”）。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/cb2d6895c5537b10dcf3aaa025614684a325108fd0d5ed72d6cc6b66e6bff67a.jpg)
▪ 若是自定义数据库名称，需要根据实际填写。
▪ console 默认使用 HTTPS 访问。若没有配置 SSL，则需要将 “useSSL=true” 修改为“useSSL=false”。
◦ username：连接数据库的用户名。
◦ password：连接数据库的密码。
```yaml
数据源配置  
spring:  
  datasource:  
    type: com.alibaba.druid,pool.DruidDataSource  
    driverClassName: com.mysql.cj,jdbc.Driver  
    druid:  
        # 主库数据源  
        master:  
            url:jdbc:mysql://192.168.0.83:3306/aem-console?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8  
        username: root  
        password: 123456  
        master:  
            url:$({DB_url:jdb:c:\\mysql:/192.168, ;3306/aem-console;useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false}sallowMultiQueries=true&serverTimezone=GMT%2B8)  
        username:$({DB_USER:root})  
        password:$({DB_PWD:root})  
        #从库数据源  
        slave:  
            #从数据源开关/默认关闭  
            enabled: false  
            url:  
                username:  
                password:  
                #初始连接数  
                initiaISize:5
```

# 9.31.4.3. 步骤3：初始化数据库
1. 进入 “console/bin” 目录。
2. 运行 “consoleInit.[bat|sh]” 脚本，初始化 TongAPM Console 数据库。
3. 根据提示信息，自定义登录管理控制台的账户。
◦ 初始化管理员账户名：如 “admin”。
◦ 初始化管理员账户密码：如 “qazWSX@123”。
说明：
密码要求最小长度 8-20 位，由数字、字符、字母大小写其中三种组成。

# 9.31.4.4. 步骤4：启动 TongAPM Console

# • Windows 平台
1. 进入 TongAPM Console 安装目录 “console/bin”。
2. 执行如下命令，启动 TongAPM Console。
```batch
console.bat start
```
若提示信息出现 “Start console-admin.jar success” 字样，则说明启动 Console 成功。

# 注意：
▪ 执行如下命令，可停止 TongAPM Console。
```txt
console.bat stop
```
▪ 执行如下命令，可重启 TongAPM Console。
```txt
console.bat restart
```
▪ 执行如下命令，可查看 TongAPM Console 运行中状态。
```txt
console.bat status
```

# • Linux 平台
1. 进入 TongAPM Console 安装目录 “console/bin”。
2. 执行如下命令，启动 TongAPM Console。
```txt
sh console.sh start
```
若提示信息出现 “Start console-admin.jar success” 字样，则说明启动 TongAPM Console 成功。

# 注意：
▪ 执行如下命令，可停止 TongAPM Console。
```txt
sh console.sh stop
```
▪ 执行如下命令，可重启 TongAPM Console。
```batch
sh console.sh restart
```
▪ 执行如下命令，可查看 TongAPM Console 运行中状态。
```txt
sh console.sh status
```

# 9.31.5. 接入 TongWeb
将 “monitor-agent-{n}.tar.gz” 安装包中的 “monitor-agent.jar” 作为 TongWeb 的 Java Agent 参数传递给服务启动命令，以实现监控服务的性能和状态。

# 前置条件
已将 Agent 安装包 “monitor-agent-{n}.tar.gz” 与待监控的 TongWeb 放同一台主机上并解压。

# 配置说明
在启动参数中，指定 “monitor-agent.jar” 文件位置、当前应用的服务名、OAP-Server 地址等参数。
• 方式一：通过控制台添加启动参数。
进入 “基础配置” > “启动参数”，添加如下启动参数。
-javaagent:\$\{monitor-agent_HOME\}\monitor-agent.jar  $\equiv$  agent.service_name  $=$  monitor1,collector.backend_service  $\equiv$  127.0.0.1:11800,logging.dir  $\equiv$  .logs,logging.file_name  $\equiv$  monitor.log
 ${monitor-agent_HOME} 请替换为 monitor-agent 解压后的实际目录。
• 方式二：修改 TongWeb 的 tongweb.xml 文件。
a. 进入 “${tongweb.home}/domains/domain1/conf” 目录。
b. 打开 “tongweb.xml” 文件，添加如下启动参数。
```xml
<arg name="javaagent:\$\{monitor-agent_HOME\}\monitor-agent.jar=agent.service_name =monitor1,collector.backend_service=127.0.0.1:11800,logging.dir=.logs,logging.file_name=monitor.log"/>
```
 ${monitor-agent_HOME} 请替换为 monitor-agent 解压后的实际目录。
c. 修改完成后，保存退出。

# 9.31.6. 访问 TongAPM 控制台
1. 在浏览器地址栏中，输入如下地址，进入 TongAPM 控制台登录页面。
```txt
http://IP:8083/tongApm
```

# 说明：
◦ IP ：TongAPM Console 所在 IP 地址。
◦ Port：TongAPM Console 端口号，默认为 “8083”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/4c773ba8309472caaa6f577565ac49fd06278023d17b7e8598c85a08023a0048.jpg)
若需要修改默认端口号，可进入 “console/lib/admin” 目录，打开 “application.yml” 文件进行修改。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c79bed56e2bb656bdc7c4377ac2cc734763719573179167e6bd855bddab68b36.jpg)
2. 输入初始化数据库时，自定义的用户名和密码，并输入验证码。
例如：自定义的用户名和密码，如下所示。
◦ 管理员用户名：admin
◦ 管理员初始密码：qazWSX@123
3. 输入完成后，单击 “登录”，即可进入 TongAPM 控制台界面。
在概览页面，可查看到接入的 TongWeb 服务。
有关 TongAPM_2.0 的更多功能详情，请参考 TongAPM_2.0 系列手册。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/850e7c05eb82a660702262f62590e1a594d6110824f948915dce4936a4813717.jpg)


# 9.32. TongEjbCallChain
TongEjbCallChain 调用链分析工具，调用链跟踪系统用于对特定功能、模块、分布式服务，进行调用关系、性能跟踪。通过跟踪记录，统计调用关系。

# 9.32.1. 获取安装包
请向技术支持人员获取 TongEjbCallChain 安装包。
调用链系统由Agent端 “tong-agent.zip” 和服务端 “storage-file-plugin-7.0.war”。
• “tong-agent.zip” 可以解压至任何目录。为了方便下文描述，使用 “tong-agent” 指代 “tong-agent.zip” 的解压目录。
• “storage-file-plugin-7.0.war” 可以部署在任何 TongWeb 中。

# 注意：
若 Agent 中定义了 TongWeb 的 HTTP 请求拦截，且数据上报采用 HTTP 协议，则在当前 TongWeb 上不能部署 storage-file-plugin-7.0.war，需要部署到其他 TongWeb 中。
避免出现 HTTP 请求被 Agent 拦截后，将数据以 HTTP 形式发送 TongWeb 中，此次 HTTP 请求又被Agent 拦截，又以 HTTP 形式发送至 TW 被 Agent 拦截，出现拦截死循环。

# 9.32.2. 部署结构图
使用三个 TongWeb，组成了集成调用链后的结构。
Agent 结合 TongWeb 部署结构图，如下所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/fe038df4824fa4e4c15f1c46008d30d4d40ae9e277e9070acd3af9664155c4af.jpg)
<table><tr><td>组件</td><td>组件说明</td></tr><tr><td>TongWeb-1</td><td>部署 storage-file-plugin-7.0.war, 用于接收数据, 提供 UI 展示。</td></tr><tr><td>TongWeb-2</td><td>启动参数中, 加入 “-javaagent:/tong-agent/tong-agent.jar” 配置, 对经过 TongWeb-2 和 TongWeb-3 的所有 HTTP、JNDI、EJB 业务进行监测。</td></tr><tr><td>TongWeb-3</td><td>启动参数中，加入“-javaagent:/tong-agent/tong-agent.jar”配置，对经过 TongWeb-2 和 TongWeb-3 的所有 HTTP、JNDI、EJB 业务进行监测。</td></tr></table>

# 9.32.3. 部署操作
1. 部署 “storage-file-plugin-7.0.war”
a. 启动 TongWeb-1 服务器。
b. 部署 “storage-file-plugin-7.0.war”，并将访问前缀设置为“storage-file-plugin”。
2. 放 “tong-agent.zip”
a. 将 “tong-agent.zip”分别进入 TongWeb-2 和 TongWeb-3 的 $^ { \mathfrak { s } } \mathfrak {$ \Phi }$ {tongweb.home}/lib/” 目录。
b. 将 “tong-agent.zip”解压。
 下文中解压路径使用 “tong-agent” 指代，请根据实际路径进行替换。
3. 修改 “tong-agent/config/agent.config”配置
a. 分别进入 TongWeb-2 和 TongWeb-3 的 “${tongweb.home}/lib/tong-agent/config/” 目录。
b. 打开 “agent.config”文件。
c. 参照如下提示信息修改配置。
```txt
#当前部署tong-agent的设备IP地址，在UI中展示，请根据需要将Your_IP替换为实际IP地址
agent.ip=$\{TW_agent_IP:Your_IP\}
#当前部署tong-agent的设备名称，在UI中展示，请根据需要将Your_AppearanceName替换为实际应用名称
agent.service_name=$\{TW_agent_NAME:Your_AppearanceName\}
TongWeb1服务器IP地址，注意：需要手动添加该参数
service.ip=127.0.0.1
TongWeb-1的服务器端口，部署storage-file-plugin-7.0.war包的服务器对外提供服务的端口
service.port=8088
#服务端，用于接收数据的应用名称，默认storage-file-plugin
service.app=storage-file-plugin
#全系统唯一标识，可配置为任意值，但TongWeb-2和TongWeb-3的值不能相同
service.service_id=1
#Agent在系统中的分配名称，用于生成唯一ID（可配置为任意值，但TongWeb-2和TongWeb-
3的值不能相同
service.service_instance_id=99981
```

# 4. 添加启动参数
您可以通过如下任一种方式添加启动参数。配置完成后，重启 TongWeb 服务器，使配置生效。
◦ 方式1：通过控制台添加启动参数。
进入 “基础配置” > “启动参数”，添加如下启动参数。
-javaagent:${tongweb.base}/lib/tong-agent/tong-agent.jar
◦ 方式2：修改 TongWeb 的 tongweb.xml 文件。
a. 分别进入 TongWeb-2 和 TongWeb-3 的 “${tongweb.home}/domains/domain1/conf” 目录。
b. 打开 “tongweb.xml” 文件，添加如下启动参数。
<arg name="-javaagent:${tongweb.base}/lib/tong-agent/tong-agent.jar"/>
c. 修改完成后，保存退出。

# 5. 部署并访问 EJB 用例
将您需要进行EJB调用链分析的用例部署到 TongWeb-2 和 TongWeb-3 服务器。
a. 分别启动 TongWeb-2 和 TongWeb-3 服务器。
b. 分别在 TongWeb-2 和 TongWeb-3 服务器上部署EJB用例。
c. 登录 TongWeb-2 和 TongWeb-3 管理控制台，选择 “EJB 容器” $>$ “EJB http”，开启 “EJB http 协议”。
d. 访问部署EJB用例。

# 6. 访问 TongWeb-1的 storage-file-plugin 应用
a. 登录 TongWeb-1 管理控制台。
b. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
c. 单击部署的 “storage-file-plugin-7.0”应用所在行的“链接”。
d. 单击生成的 URL 链接，即可查看调用链控制台。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b03663fe285279a13c41f412dafca37ba01d8a6405b7265a64f9f9a9353329ca.jpg)


# 9.32.4. 调用链跟踪
收集复杂系统内部和分布式系统的行为信息，为业务统计、资源消耗、性能分析、异常定位，提供数据支持。
数据存储在部署“storage-file-plugin.war”应用的 TongWeb 根目录
“${tongweb.home}/domains/domain1/storage/<日期 $>$ /log.data”中,提供 TongWeb 业务模块调用关系的
概览和业务追踪详情 UI 展示。

# 9.32.4.1. 业务追踪展示
展示一次操作的调用过程，详细跟踪每一次用户请求所经过的节点。

# 业务追踪|概览
1189.39.15849343025790001
1079.40.15849342965260001
1079.36.15849346040910003
1079.39.15849346021060003
1079.36.15849342936400001
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/018add7e2ba0c144b9f06c0632507a3a42b453c53a177966ef17ded5307eaa68.jpg)
• 每个节点名称由IP $^ +$ 执行顺序 $^ +$ 业务类型组成。
IP为agent.config中配置的agent.ip对应。
执行顺序从0开始依次递增，执行顺序编号和程序中执行的业务逻辑一致。
• 左侧菜单为全网分布式跟踪 ID，由应用实例编号[service.service_instance_id]+ 线程编号 $^ +$ 时间戳 $^ +$ 线程自增序列([0-999])组成。
实例编号和 agent.config 中配置的对应属性取值相同。
• 上图所示为用户发送一个 HTTP 请求至IP为 168.1.11.8 的 TongWeb 上，HTTP内部执行了多次JNDI调用和EJB调用，其中步骤编号为6的EJB调用上，又远程调用了IP为168.1.13.205的 TongWeb 中的 JNDI和 EJB 服务，以此类推。
业务追踪展示了业务执行的详细过程和经过的服务点。

# 9.32.4.2. 概览展示
展示各个分布式系统之间或者系统内部模块的调用情况，查看系统和系统之间核心监测模块的调用关系如下图所示。

# 业务追踪|概览
1189.39.15849343025790001
1079.40.15849342965260001
1079.36.15849346040910003
1079.39.15849346021060003
1079.36.15849342936400001

# 系统拓扑图
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/fa11aca7d2bca933107e57e59748506508b6304589a231741d35e70ad0be1186.jpg)
• 各个节点的名称由 service.service_instance_id $^ +$ “:”+业务类型 组成。
service.service_instance_id和agent.config中对应的属性配置取值相同，为应用实例编号，标识是哪个Agent监测。
• 箭头所指方向为指向调用，譬如所示为 $1 1 9 9 { \cdot } \mathsf { J N D } | > 1 0 5 2 6 9 { \cdot } \mathsf { J N D } |$ ，含义为Agent的service_instance_id为1199的JNDI客户端，调用了 service_instance_id为105269的JNDI的服务。
• 概览展示各个TongWeb 之间业务的调用关系。TongWeb 的标识由应用实例编号[service_instance_id]确定。

# 9.33. TongFlowControl
TongFlowControl 是面向分布式服务架构的流量监控工具，是 TongWeb 基于 QPS/并发数和调用关系的流量控制功能，可在 TongFlowControl 控制台进行实时监控和流量策略配置。

# 9.33.1. 获取安装包
请联系东方通相关人员获取 TongFlowControl 安装包。
包含如下文件：
• flowcontrol-console.jar
• flowcontrol-core.jar
• flowcontrol-datasource-extension.jar
• flowcontrol-json.jar
• flowcontrol-parameter-flow-control.jar
• flowcontrol-transport-common.jar
• flowcontrol-transport-simple-http.jar
• flowcontrol-web-servlet.jar
• flowcontrol.war
• startflowcontrol.bat
• startflowcontrol.sh

# 9.33.2. 部署结构图
TongFlowControl 部署结构如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/0fb3d901c137c869d0a82db6577194ca4ec5e54def5057c8eabd0e671cf5018d.jpg)


# 9.33.3. 部署 TongFlowControl

# 1. 放 “TongFlowControl 安装包”
a. 在 $^ { * } \$ 8$ {tongweb.home}” 目录中创建 “/flowcontrol/client” 和 “/flowcontrol/service” 目录。
b. 将如下 jar 包放在 “/flowcontrol/service” 目录。
flowcontrol-console.jar
c. 将如下 jar 包放在 “/flowcontrol/client” 目录。
▪ flowcontrol-core.jar
▪ flowcontrol-datasource-extension.jar
▪ flowcontrol-json.jar
▪ flowcontrol-parameter-flow-control.jar
▪ flowcontrol-transport-common.jar
▪ flowcontrol-transport-simple-http.jar
▪ flowcontrol-web-servlet.jar
d. 将 TongFlowControl 启动脚本放入 “${tongweb.home}/bin” 目录。
▪ Windows
将 “startflowcontrol.bat” 放入 “${tongweb.home}/bin/windows” 目录。
▪ Linux
将 “startflowcontrol.sh” 放入 “${tongweb.home}/bin” 目录。

# 2. 配置 TongWeb 启动参数
您可以通过如下两种方式配置启动参数。配置完成后，重启 TongWeb 服务器，使配置生效。
◦ 方式1：修改 TongWeb 的 “${tongweb.base}/conf/tongweb.xml” 文件，添加如下启动参数。
<arg name  $=$  "-DenableFlowcontrol=true"/>   
<arg name  $=$  "-Dcsp.flowcontrol api.port=8061"/>   
<arg name  $=$  "-Dcsp.flowcontroldashboard.server=127.0.0.1:8060"/>
◦ 方式2：登录控制台 $>$ 基础配置 $>$ 启动参数，添加如下启动参数，并重启 TongWeb 服务器。
▪ -DenableFlowcontrol=true
▪ -Dcsp.flowcontrol.api.port=8061
▪ -Dcsp.flowcontrol.dashboard.serve $\mathbf { \equiv }$ 127.0.0.1:8060

# 3. 创建类库
类路径为： $\$ 1$ {tongweb.home}/flowcontrol/client

# 4. 部署 flowcontrol.war
a. 登录 TongWeb 管理控制台。
b. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
c. 单击 “部署”，部署 “flowcontrol.war”。
d. 勾选步骤3创建的类库，其他参数采用默认值。
e. 配置完成后，单击 “添加”，完成 “flowcontrol.war” 部署。

# 5. 启动 FlowControl 客户端
◦ Windows
a. 进入 “${tongweb.home}/bin/windows” 目录。
b. 双击 “startflowcontrol.bat”，启动脚本。
◦ Linux
a. 进入 “${tongweb.home}/bin” 目录。
b. 执行如下命令，启动脚本。
```javascript
./startflowcontrol.sh
```
6. 访问 FlowControl。
```txt
http://ip:8060
```
默认用户名/密码为：flowcontrol/flowcontrol

# 9.33.4. 访问 TongFlowControl 控制台
1. 访问已部署的FlowControl应用（以flowcontrol.war为例），触发TongFlowControl客户端建立连接。
2. 在浏览器地址栏中，输入“http://<TongWebIP>:8060”，按“Enter”，即可访问FlowControl客户端。
◦ TongWebIP：TongWeb 所在主机的IP地址。
◦ 默认用户名：flowcontrol
◦ 初始密码：flowcontrol
3. 访问“http://<TongWebIP>:8060/#/dashboard/identity/flowcontrol”。
TongFlowControl 控制台可自动发现 Web 接口相关资源，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/bd4c0f1a5ecf9a70db11b43a7d350d0c11d1e099a38da3d2ff5ca50d3536697c.jpg)


# 9.33.5. TongFlowControl使用说明

# 9.33.5.1. 查看实时监控
1. 在左侧导航栏中，单击“实时监控”，进入实时监控页面。
2. 通过 TongWeb 管理控制台访问已部署的 flowcontol 应用，触发 FC 客户端建立连接（以“flowcontrol.war”应用为例）。
3. 在flowcontrol实时监控页面，查看监控数据。
请求QPS、拒绝请求QPS、异常请求QPS、响应时间可以在监控页面查看，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1c72d403c40034bd20befb685ea4a924971f401e1f31acea4f41a161c5ab5045.jpg)
通过簇点链路，过滤查看并发数，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/558ba6894c1a12dbd9bee96a65d0b37168d6e12f956ece6db128a5345d4bf5b8.jpg)


# 9.33.5.2. 流控规则
支持通过应用Web接口的QPS、并发数等指标对应用请求进行限流，限流包括快速失败、预热启动、排队等待等。
选取一个资源，进一步进行设置流控规则。
如下以“test2.jsp”资源为例说明。
1. 访问 TongWeb 部署的 “flowcontrol.war” 应用。
例如：http://<TongWebIP>:8088/flowcontrol/test2.jsp
2. 在左侧导航栏中，选择“簇点链路”，找到“test2.jsp”资源。
3. 单击“流控”，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1c56265524feb78da6c7b5d5ac8a0e7befd53983475f78a2c091ad1ecdb9696d.jpg)
4. 单击“簇点链路”，选择对应资源名，单击“流控”，为该资源添加流控规则。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/8ead89d7474fa51fbcc7d007992a969164e35fdd73d72d08dc41823ba34a7aa1.jpg)
参数说明，如下表所示。
<table><tr><td>参数</td><td>参数说明</td></tr><tr><td>资源名</td><td>唯一名称，默认是请求路径，可自定义。</td></tr><tr><td>针对来源</td><td>指定对某个微服务进行限流，默认指default，表示不区分来源，全部限制。</td></tr><tr><td rowspan="2">阈值类型</td><td>QPS（每秒请求数量）/单机阈值：当调用该接口的QPS达到阈值的时候，进行限流。</td></tr><tr><td>线程数：当调用该接口的线程数达到阈值的时候，进行限流。</td></tr><tr><td>流控模式</td><td>直接，若选择的是默认简单配置而言，则规则和处理方式对应的默认项。</td></tr><tr><td>流控效果</td><td>快速失败，若选择的是默认简单配置而言，则规则和处理方式对应的默认项。</td></tr></table>

# 场景1：QPS流控设置
“阈值类型”选择“QPS”，单机阈值设置为“2”，单击“新增”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/96383d164df23842bf0d872cfc8f5b85865eb1fd111d03aced7736c63dd96718.jpg)
创建完成后，进入到流控规则列表，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/12978741f0ebb0c6a08a0b1fec604b244daa7273da796e054e8c1cf06bdb2155.jpg)
当QPS阈值设置为“2”时，该请求路径，每秒只允许2个请求。当超出会使用流控效果，简单配置的流控效果是快速失败。
配置完成，快速访问多次“http://<TongWebIP>:8088/flowcontrol/test2.jsp”资源，页面会出现 Blocked byFlowControl(flow limiting)，证明流控规则生效。

# 场景2：线程数流控设置
“阈值类型”选择“并发线程数”，单机阈值设置为“2”，单击“新增”。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b4a09443a8f103d099985578baaa05011bf2921284c293acd1c1993e7f917bda.jpg)
当并发数阈值为“2”时，这个请求路径只允许两个线程访问，否则触发流控。
可以通过jmeter之类的测试工具进行测试。将并发数线程数设置为“2”。压测后再通过浏览器访问，页面直接就会出现被限制的提示。

# 9.33.5.3. 高级流控规则

# 流控模式
flowcontrol共有如下两种流控模式。
• 直接（默认）
接口达到限流条件时，开启限流。
• 关联
当关联的资源达到限流条件时，开启限流 （适合做应用让步）。
关联流控模式指的是：当指定接口关联的接口达到限流条件时，开启对指定接口开启限流。

# 流控模式（关联）
流控模式的关联可以使得其它的请求服务达到阈值，从而触发流控。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/5cf20fee090d9d570d015a2a29e20e920a327663442411a2dfe09cd237a11f50.jpg)
配置说明，如下所示。
1. 设置“/image/tongweb.png”为“/test2.jsp”关联资源。
2. 用jmeter对“/image/tongweb.png”压测。
3. 压测过程中，通过浏览器访问“test2.jsp”。
可查看到，test2.jsp被限制访问。

# 流控效果
• 快速失败（默认）
直接失败，抛出异常限制提示，不做任何额外的处理，是最简单的效果。
• Warm Up
从开始阈值到最大QPS阈值会有一个缓冲阶段，一开始的阈值是最大QPS阈值的1/3，然后慢慢增长，直到最大阈值，适用于将突然增大的流量转换为缓步增长的场景。
1F实时监控
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3e3f0bd105c5eed1abe8eea17a487e8606ce2352b18dfcde5ff581348c60c7ea.jpg)
若立即结束，则可以看到拒绝 qps 如果开启了 Warm Up 有个缓步下降的过程。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ff980410cc3283fd20aafdb0887fd239696e119f778c8cd494d11c3d50f794ba.jpg)


# • 排队等待
让请求以均匀的速度通过，单机阈值为每秒通过数量，其余的排队等待。您可以设置一个超时时间，若请求超过超时时间还未处理，则会被丢弃。
使用jmeter压测test2.jsp，可以观察到浏览器访问达到流控阈值，并开始排队，超过超时时间还没执行则失败，否则就可以正常访问。

# 9.33.5.4. 熔断规则
支持通过应用Web接口的慢请求比例、异常比例、异常数等阈值，熔断Web接口请求。

# 配置熔断规则
1. 登录FlowControl控制台。
2. 在左侧导航栏中，选择“熔断规则”，进入熔断规则页面。
3. 单击“新增熔断规则”，配置熔断规则信息。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ed23cb6f025de158c24cc524247184bdead854d42b8a19391c8a764c1e4db6f7.jpg)
参数说明，如下表所示。
<table><tr><td>参数</td><td>参数说明</td></tr><tr><td>资源名</td><td>资源的名称,唯一标识。</td></tr><tr><td>熔断策略</td><td>·慢调用比例
    当调用的时间(响应的实际时间) &gt; 设置的RT的时间,这个调用称为慢调用。
    慢调用比例表示在所有调用中,慢调用占有实际的比例=慢调用次数/调用次数。
    ·最大RT: RT表示响应时间,指系统对请求做出响应的时间。单位:毫秒。
    ·比例阈值: 慢调用的比例,根据需要进行设定。比例阈值=慢调用次数/调用次数。取值范围“[0.0, 1.0]”。设定的比例阈值内调用次数的响应时间大于设定的RT时间时,触发熔断。
    ·异常比例
        异常比率的阈值范围是 [0.0, 1.0],代表 0% - 100%。0.4 表示错误率达到了百分之40时,触发熔断。
    ·异常数
        异常的个数。</td></tr><tr><td>熔断时长</td><td>熔断的时间,单位:秒。熔断时间内应用不可用。</td></tr><tr><td>最小请求数</td><td>设置的调用最小请求数。表示1秒内的请求个数。</td></tr><tr><td>统计时长</td><td>统计的时长,单位:毫秒。</td></tr></table>
4. 配置完成后，单击“新增”，即可完成熔断规则的新增。

# 配置示例（慢调用）
选择“/test1.jsp”资源，对该资源进行熔断设置。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f0a262d5528fd6ac5411868238cdbc3a42413c71d96cac62ca91ba7da96e0234.jpg)
test1.jsp载入时，Thread.sleep睡了3秒，根据熔断配置推测：

# 熔断条件
在统计时长10000毫秒（10秒）内，若发送到“/test1.jsp”的请求数大于“5”，并且在这些请求中，所有请求的响应时长（比例阈值为1，表示所有请求均为慢调用）都大于1000毫秒（设置的最大RT值）时，进入熔断状态。

# 查看效果
使用jmeter 压测，浏览器访问即可看到控流效果。

# 9.34. TongNCS
TongNCS 是构建云原生应用的动态服务发现、配置管理和服务管理平台。

# 9.34.1. 支持的版本
2.0.1 及以上版本。

# 9.34.2. 搭建 TongNCS 环境
请参照 《TongNCS_V2.0安装部署手册》 搭建 TongNCS 环境。

# 9.34.3. 下载 jar 包及依赖
请联系东方通相关人员获取 TongNCS 的 java 客户端 jar 包以及所有的依赖。
如下以 2.0.1 版本 jar 包清单为例说明。
• commons-codec-1.15.jar
• commons-logging-1.2.jar
• httpasyncclient-4.1.3.jar
• httpclient-4.5.3.jar
• httpcore-4.4.6.jar
• httpcore-nio-4.4.6.jar
• jackson-annotations-2.12.7.jar
• jackson-core-2.12.6.jar
• jackson-databind-2.12.7.1.jar
• logback-classic-1.2.3.jar
• logback-core-1.2.3.jar
• simpleclient_tracer_common-0.12.0.jar
• simpleclient_tracer_otel_agent-0.12.0.jar
• simpleclient_tracer_otel-0.12.0.jar
• simpleclient-0.12.0.jar
• slf4j-api-1.7.25.jar
• snakeyaml-2.0.jar
• tongncs-auth-plugin-2.0.1.jar
• tongncs-client-2.0.1.jar
• tongncs-encryption-plugin-2.0.1.jar

# 9.34.4. 使用说明
关于 TongNCS 用于发现 TongWeb 实例或共享配置的使用方式，请参见注册中心。

# 9.35. TongWeb-MQ
TongWeb 自带的消息服务器。

# 9.35.1. 获取安装包
请联系东方通相关人员获取 TongWeb-MQ 安装包（tongweb-mq-1.0.0.zip），并将其放至“${tongweb.home}/lib/mq” 目录中。

# 9.35.2. 启动消息服务器
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “资源配置” $>$ “消息服务器”，进入消息服务器页面。
4. 单击 “创建”，创建消息服务器。
参数说明，如下所示。
◦ 名称：输入消息服务器的名称。
◦ 自启动：选择是否随节点启动。
◦ 所在节点：消息服务器所在的节点。
◦ 端口：消息服务器的端口。
5. 配置完成后，单击 “添加”，完成消息服务器的添加操作。
6. 单击已添加消息服务器所在行的 “启动”，启动消息服务器。

# 9.35.3. 修改适配器应用（tmqjmsra.rar）
1. 打开适配器应用的 “tmqjmsra.rar/META-INF/ra.xml” 文件。
tmqjms.rar 适配器位置：${tongweb.home}/version*/examples/
2. 将 “mq://localhost:7676/” 中的 IP 和 port，修改为消息服务器的 IP 和 port。

# 9.35.4. 部署适配器（tmqjmsra.rar）
1. 登录 TongWeb 管理控制台。
2. 在左侧导航栏中，选择 “应用管理” $>$ “应用”，进入应用列表页面。
3. 单击 “部署”，将 IP 和 port 修改后的 tmqjmsra.rar 适配器部署在 TongWeb 控制台。

# 9.35.5. 部署测试用例
1. 登录 TongWeb 管理控制台。
2. 选择 “EJB 容器” $>$ “JCA连接池”，创建连接池。
名称填 “testc”，连接定义选择 “javax.jms.ConnectionFactory”。
3. 选择 “EJB 容器” $>$ “JCA托管对象”，创建 JCA 托管对象。
◦ 创建一个名为 “testd” 的 JCA 托管对象，资源类型选择 “javax.jms.Queue”。
◦ 创建一个名为 “testa” 的 JCA 托管对象，资源类型选择 “javax.jms.Topic”。
4. 部署 “jmsExample.war” 应用。
jmsExample.war 应用路径：${tongweb.home}/version*/examples/
5. 访问 “jmsExample.war” 应用。
单击"JMS Examples">"/MessageSend"。
若输出 "testc: OK! testd: OK! send message …… send message successfully !"，则代表验证成功。

# 9.36. TongWebSession
提供 TongWeb Session 的开发依赖包，基于此开发包可开发异构系统间的 Session 共享应用。
TongWeb Session 支持基于 Redis 和 Hazelcast 的 Session 共享实现，可用于异构系统间会话高可用场景。

# 9.36.1. 下载 TongWeb Session 依赖包
1. 进入 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 选择 “扩展支持” $>$ “支持列表”，进入支持列表页面。
4. 单击 TongWebSession 所在行的 “下载”，即可下载依赖包 “TongWebSession.zip”。

# 9.36.2. 解压并添加到应用的类路径
1. 解压下载的 “TongWebSession.zip”。
解压后文件 “tongweb-session.jar”。
2. 将 “tongweb-session.jar” 放在应用的类路径。

# 9.36.3. 添加 Redis 或 Hazelcast 客户端工具包依赖
在工程中，添加 Redis（io.lettuce:lettuce-core:6.*） 或 Hazelcast（com.hazelcast:hazelcast:5.*）的客户端工具包依赖。

# 9.36.4. 添加 Filter
请参考用例 “${tongweb.home}\version*\examples\ 下的 twSessionRedisExample.war 或twSessionHzExample.war” 为应用添加一个 Filter，即完成安装。

# 9.37. TrustedAndSecure
可信安全管理是一种安全管理系统，其主要功能包括对指定的工作目录、服务程序或运行脚本进行授权访问和执行，以及对操作系统或组件的配置文件进行防篡改保护。此外，它还能对违反安全策略的行为进行审计，以确保信息系统和数据的安全性和可信度。

# 前置条件
• 已获取可信安全管理模块安装包 “trusted.zip”。
• 已获取授权文件 “lic_xx.resp”。

# 操作步骤

# 1. 解压可信模块安装包
将 “trusted.zip” 解压到 “${tongweb.home}” 目录下，并保留 “trusted” 目录。

# 2. 安装可信模块
a. 进入 “${tongweb.home}/trusted” 目录。
b. 执行如下命令，安装可信模块。
trusted 目录下的可信模块安装包以 “SYY_DFT-Kylin_Linux_Advanced_Server_release_V10-
tipterminal-1.0.5658-28827_beta.ky10.x86_64.rpm” 为例。
```batch
rpm -ivh SYY_DFT-Kylin_Linux_Ancanced Servers_release_V10-tipterminal-1.0.5658-28827_beta.ky10.x86_64.rpm --nodeps
```
若提示信息出现 “success” 字样，则说明安装可信模块成功。

# 3. 修改 console.xml
a. 进入 “${tongweb.base}/conf” 目录。
b. 打开 “console.xml” 文件。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c7d070b627088865a45e9485bb21ef9e177909096f466784bcda78e530e4c651.jpg)
主配置文件 “console.xml” 具备防篡改限制，在运行期间禁止对其进行修改。若需要修改并使其生效，请确保 TongWeb 服务器处于停止状态，然后再进行修改。
c. 在 <console> 标签下添加 “enabledTrustedManager="true"”，如下所示。
```txt
<console enabledTrustedManager="true">
```

# 4. 部署 tongapm.war 应用

# 5. 访问部署的 TongAPM 应用

# 6. 导入授权文件
a. 单击 “可信 license 信息”。
b. 导入授权文件 “lic_xx.resp”。

# 9.38. Tuxedo
通过 JCA 连接 Tuxedo 服务器。
1. 根据Tuxedo服务配置好Tuxedo服务器提供的资源适配器（com.oracle.tuxedo.TuxedoAdapter.rar，请自行从官方渠道获取）并在 TongWeb 上部署。
2. 在 TongWeb 上创建需要的连接池和托管对象，创建过程中选择上一步的资源适配器，并填入必要的属性信息。
3. 启动 Tuxedo 资源，保证所需服务启动，进行相关测试。

# 9.39. Westone
支持卫士通密码机对密钥文件进行加密。
若使用卫士通密码机，将卫士通的如下 SDK 依赖包手动放置到 “${tongweb.home}/lib” 目录，并通过修改卫士通的配置文件 “hsminfo.properties” 来配置连接信息。
• logback-classic-1.2.3.jar
• logback-core-1.2.3.jar
• mina-core-2.0.5.jar
• wst-bcprov-1.0.5.jar
• wst-common-util.jar
• wst-crypto-1.0.8.13.jar
• wst-hsm-api-1.0.8.13.jar
• wst-jce-util-1.0.8.13.jar
• wst-slf4j-api.jar

# 9.40. Zabbix
Zabbix 可以基于 TongWeb 提供的监视接口进行资源监视、预警。

# 9.40.1. 注意事项
TongWeb 提供的监视模板仅包含部分 TongWeb 监视项，且未设置触发器，如有需要，请自行扩展。

# 9.40.2. 前置条件
已搭建 Zabbix 服务器。

# 9.40.3. 配置 TongWeb
1. 将 zabbix-server 所在服务器的 IP 添加到 TongWeb 控制台的信任 IP 列表
a. 进入 TongWeb 管理控制台。
b. 单击“集中管理”，进入集中管理页面。
c. 选择“安全配置”>“控制台安全”，进入控制台安全页面。
d. 将 zabbix-server 所在服务器的 IP 添加到“信任IP”文本框中。
e. 单击“更新”，完成信任 IP 的添加操作。
2. 关闭 TongWeb 控制台的 CSRF 功能
a. 进入 “${tongweb.base}/conf” 目录。
b. 打开 “tongweb.xml” 文件。
c. 将 console 应用的“csrfPrevention”参数设置为“false”。
d. 修改完成后，保存并退出。

# 9.40.4. 配置 Zabbix
1. 下载 TongWeb 监视模板
a. 进入 TongWeb 管理控制台。
b. 单击“集中管理”，进入集中管理页面。
c. 选择“扩展支持”>“支持列表”，进入支持列表页面。
d. 单击 Zabbix 所在行的“下载”，下载 TongWeb 监视模板。
下载的文件是以“Zabbix.zip”命名的压缩包。
2. 将下载的 TongWeb 监视模板导入到 Zabbix
a. 将下载的 TongWeb 监视模板解压，解压后为 “tongweb_monitor_templates.xml”文件。
b. 进入 Zabbix 控制台。
c. 在左侧菜单栏中，选择“配置” $> ^ { \prime }$ “模板”，进入模板页面。
d. 单击右上角的“导入”，进入导入模板页面。
e. 单击“选择文件”，选择解压后的 “tongweb_monitor_templates.xml”文件。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/4cf78c0aeea12a5c706a731be39afb60f2f0be14b4093dc6896fd8292ade78a1.jpg)
f. 单击“导入”，即可导入 TongWeb 监视模板。
若页面弹出“已成功导入”提示信息，则说明导入成功。

# 3. 创建 TongWeb 主机
a. 进入 Zabbix 控制台。
b. 在左侧菜单栏中，选择“配置”>“主机”，进入主机页面。
c. 单击右上角的“创建主机”，进入创建主机页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/91755961359413a2f2df435bad78cfc51b083ceeea0e6f401a694d6a06e7e82b.jpg)
d. 配置 TongWeb 主机信息。
▪ 主机：在主机页签，设置 v 主机的名称。
▪ 模板：在模板页签，选择链接新模板，选择 “Template TongWeb by HTTP”（默认在“Templates”主机群组）。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7b116882b35d197f15c5491e169a6a426a02c976af6b5334ff070a3164b811a7.jpg)
▪ 宏：在宏页签，将宏中的配置修改为需要监视的 TongWeb 的 IP、Port、用户名及密码。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/6e163d0d8a33fc61efdbbd9aa52b8fa56aded0d28612663c4ff0e46884d95b66.jpg)
▪ 其他参数：请根据实际环境填写。
e. 配置完成后，单击“添加”，即完成 TongWeb 主机的创建操作。

# 9.40.5. 查看监视和预警
1. 进入 Zabbix 控制台。
2. 在左侧菜单栏中，选择“监测”>“主机”，进入主机列表页面。
3. 单击目标主机所在行的“最新数据”、“问题”、“图形”或者“聚合图形”，即可查看相关监视信息。

# 9.41. Zookeeper
Zookeeper 是一个分布式的、开源的程序协调服务，用于统一配置管理、统一命名服务、分布式锁、集群管理。

# 9.41.1. 支持的版本
3.5 及以上的版本。

# 9.41.2. 搭建 Zookeeper 环境
请参照官网文档搭建 Zookeeper 环境。

# 9.41.3. 下载 jar 包及依赖
请通过 Zookeeper 官方渠道下载对应的 apache curator 版本的 jar 包以及依赖包。
如下以 curator 5.5.0 版本 jar 包清单为例说明。
• audience-annotations-0.12.0.jar
• checker-qual-3.12.0.jar
• curator-client-5.5.0.jar
• curator-framework-5.5.0.jar
• curator-recipes-5.5.0.jar
• curator-x-discovery-5.5.0.jar
• error_prone_annotations-2.11.0.jar
• failureaccess-1.0.1.jar
• guava-31.1-jre.jar
• j2objc-annotations-1.3.jar
• jackson-annotations-2.10.0.jar
• jackson-core-2.10.0.jar
• jackson-databind-2.10.0.jar
• jsr305-3.0.2.jar
• listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
• netty-buffer-4.1.76.Final.jar
• netty-codec-4.1.76.Final.jar
• netty-common-4.1.76.Final.jar
• netty-handler-4.1.76.Final.jar
• netty-resolver-4.1.76.Final.jar
• netty-transport-4.1.76.Final.jar
• netty-transport-classes-epoll-4.1.76.Final.jar
• netty-transport-native-epoll-4.1.76.Final.jar
• netty-transport-native-unix-common-4.1.76.Final.jar
• slf4j-api-1.7.25.jar
• zookeeper-3.7.1.jar
• zookeeper-jute-3.7.1.jar

# 9.41.4. 使用说明
关于 ZooKeeper 用于发现 TongWeb 实例或共享配置的使用方式，请参见注册中心。

# 10. 智能问答
TongWeb 支持对接 TongLMM 智能问答。
TongLMM 是基于东方通对 AI 大模型技术的深入研究以及对企业应用大模型时面临痛点的全面理解，并凭借在消息技术、数据处理技术、向量数据库应用技术以及自然语言处理技术等多个领域的长期研究与实践经验，推出的新一代大模型驱动的 AI Agent-大模型中间件 TongLMM 产品。
TongLMM 是建立大模型与应用之间的桥梁，凭借大模型中间件，用户在信息检索、信息推荐、智能运维、问答助手等多种大模型应用场景可快速使用大模型能力，使大模型更加便捷高效地为应用软件赋能。

# 10.1. 开启智能问答
在使用智能问答前，需要在 “启动参数” 中配置智能问答相关的必要参数，才能成功开启智能问答功能，从而为用户提供智能问答服务。

# 前置条件
已联系 TongLMM 相关人员获取如下信息：
• appId：TongLMM 的应用 ID。
• clientId：TongLMM 的客户端 ID。
• keySecret：TongLMM 的密钥。
• url：TongLMM 的 IP 和端口号。
• username：登录 TongLMM 的用户名。

# 操作步骤
1. 登录 TongWeb 控制台。
2. 单击页面右上角的 “ ”，进入启动参数页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/78555d422aad5361b029fa80b611220b86d97119ade97d3744c727ee654d54a3.jpg)
3. 在启用参数页面，单击 “创建”，依次添加如下参数。
如下是一个配置示例，具体值请根据获取的实际 TongLMM 信息替换。
```txt
-Dtonglmm.applld=43c3ca64-c882-4bc8-b2a6-50a4fc02cd7f  
-Dtonglmm.clientId=1086  
-Dtonglmm.keySecret=wGysfuCozrvwgknXKlcOdOKMo8xhlqa29nhleAGf9xOJegaGdhHnzDY9+acxmuXDBwE  
MrVmwldwgfojYyYxiBTsHwd53rkWHyPy7b3LInM=  
-Dtonglmm.url=10.10.92.82:8083  
-Dtonglmm username=173interface20240826172457470341
```
4. 配置完成后，重启 TongWeb 控制台。
5. 再次进入 TongWeb 控制台，单击控制台右上角的 “ ”，即可进入 TongLMM 智能客服页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/45328d087131dd7d3cca4fd1c5b92171459e782743bcf621e07fcacbe8ba3542.jpg)


# 说明：
如果智能问答开启失败，点击 “确定” 前往新窗口开启。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/35d27d0d6c33019a3ee0b042f790bf56e09e3223458fffd5027181529fd9a019.jpg)


# 10.2. 关闭智能问答
进入智能问答页面后，点击左侧菜单栏不生效。您需要关闭智能问答，才能正常切换到对应菜单栏。

# 前置条件
已开启智能问答。

# 操作步骤
方式一：
在 TongWeb 控制台，再次单击控制台右上角的 “ ”，即可关闭 TongLMM 智能问答。
方式二：
控制台登录超时后，再次登录到 TongWeb 控制台，自动关闭智能问答。
方式三：
在 “启动参数” 中，删除与 TongLMM 对接配置的参数，即可取消与 TongLMM 对接，关闭智能问答功能。

# 11. 示例应用
进入 “集中管理” $>$ “扩展支持” $>$ “示例应用”，可查看所有的示例及说明。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/78ba4838022a5241bc6ad1918b3d22b797610390bcc363498671f4670d09d729.jpg)
关于示例应用程序包，详见 “${tongweb.home}/version*/examples”，该路径下包含示例说明文件 “*-readme.txt”。

# 12. 常见配置场景

# 12.1. 关闭 console 控制台的部署
1. 打开 “${tongweb.base/conf/tongweb.xml” 文件。
2. 在<applications><app/></applications>字段下，添加“state="STOPPED"属性，即可关闭 console 控制台的部署，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/bb0d5dcf1b22d28adf5d6cb72998febd4c5cb34e1a1df257a862e473ecdb1eeb.jpg)
3. 添加完成后，启动 TongWeb 服务器。
4. 在浏览器地址栏中，输入访问 TongWeb 控制台的地址，访问失败。

# 12.2. 开放端口
TongWeb 端口开启访问规则。

# • 基本原则
对外用户访问只暴露应用访问端口，其它端口为内部进程通信端口。只需对内放开，不需对外暴露。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/f9ba4e39844d2e0dce8fad7e00218ffb7f33eb62dd99440252e4e7328130c8e3.jpg)
如下为默认端口，若端口已修改，请根据实际情况开放端口。
<table><tr><td>服务程序</td><td>功能</td><td>默认端口</td><td>端口作用</td></tr><tr><td rowspan="4">TongWeb</td><td rowspan="4">提供服务的核心进程</td><td>8088</td><td>默认应用访问端口</td></tr><tr><td>9060</td><td>默认控制台端口</td></tr><tr><td>7200</td><td>JMX端口，默认关闭</td></tr><tr><td>5200</td><td>EJB w3远程端口，默认关闭</td></tr><tr><td>TongWeb-MQ</td><td>消息服务器</td><td>7676</td><td>JMS服务端口</td></tr><tr><td>TongDataGrid</td><td>内存会话服务器</td><td>5701</td><td>session复制端口</td></tr><tr><td>TongHttpServer</td><td>负载均衡器</td><td>8080</td><td>默认负载对外访问端口</td></tr></table>

# • 使用场景
◦ 场景一：TongWeb 单机
▪ 对外用户访问需要开启 8088 应用端口或自定义的应用端口。
▪ 内部局域网访问的情况下要开通 9060 控制台端口，要能访问 TongWeb 管理控制台。
◦ 场景二：THS 集群
▪ 对外用户访问需要开启 THS 默认 8080 应用端口或自定义的应用端口。
▪ 对内要开启 TongWeb 的 HTTP 8088 应用端口，使 THS 能够访问 TongWeb。
▪ THS 开启HA的情况下，THS 服务器要开启 vrrp 协议。
◦ 场景三：集群 $^ +$ session 复制
▪ 对外用户访问需要开启负载的应用端口。
▪ 对内要开启 TongWeb 的 http 8088 应用端口，使负载能够访问 TongWeb。
▪ TongDataGrid 的 5701 端口内部开放，使 TongWeb 能够访问。
▪ 各个 TongDataGrid 节点之间也需要通过该端口互备数据。

# 12.3. 应用与端口启动顺序
您可以通过开启或者关闭“延迟启动通道”的方式改变应用与端口的启动顺序。
开启后，TongWeb 在启动时，会优先启动应用，应用启动完成后，再启动端口，否则优先启动端口。
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择 “基础配置” $>$ “全局配置”，进入全局配置的 “服务器” 页面。
4. 开启 “延迟启动通道”，即可在 TongWeb 启动时，优先启动应用，应用启动完成后，再启动端口。
注意：
开启该功能可保证当有请求进入系统后，所有的应用是就绪状态。
但可能会引入一个现象，当部署了多个应用，在最后一个应用部署完成前所有的应用都将无法对外提供服务。

# 12.4. 应用配置优先级
web.xml $>$ tongweb-web.xml $>$ 用户输入（控制台、命令行、REST 等方式） $>$ 默认参数
• 用户可以在应用内部放置一个 tongweb-web.xml 事先定下来所有的业务参数，以方便部署时无需再输入。
• 在部署完成后，再次通过控制台或其它接口编辑应用配置时，它的优先级也不变。
• 若这个属性在 tongweb-web.xml 中已经定义，其值是只读的，编辑不生效。
• 若需要编辑这个属性，需要删除 tongweb-web.xml 中定义的这个属性。

# 12.5. 本机 TongWeb 开机自启
安装 TongWeb 后，若您需要本机开机时自动启动 TongWeb，您可以通过控制台界面，或者使用admin.sh 的方式开启开机自启服务。

# 约束说明
仅Linux系统支持本机开机自启。

# 12.5.1. 通过控制台开启
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择 “基础配置” $>$ “启动策略”，进入启动策略页面。
4. 开启“开机自启”即可。
开启“开机自启”后，下次主机开机后，系统自动启动 TongWeb 服务。

# 12.5.2. 通过 admin 脚本开启

# 安装自启动服务
1. 进入 TongWeb 安装目录 “${tongweb.home}/bin”。
2. 执行如下命令，安装本机自启动服务。
./admin.sh systemd install

# 卸载自启动服务
1. 进入 TongWeb 安装目录 “${tongweb.home}/bin”。
2. 执行如下命令，卸载本机自启动服务。
./admin.sh systemd uninstall

# 12.6. 日志路径
日志路径：${tongweb.base}/logs
TongWeb 日志文件说明，如下表所示。
<table><tr><td>文件名称</td><td>文件说明</td></tr><tr><td>access</td><td>访问日志。启用访问日志后，即可生成访问日志文件。默认为“关闭”。
进入TongWeb管理控制台&gt;“日志管理”&gt;“访问日志配置”页面，启用访问日志。</td></tr><tr><td>audit</td><td>审计日志。用于跟踪记录用户对服务器进行的操作。仅安全审计员可查看和配置审计日志。</td></tr><tr><td>gc</td><td>gc垃圾回收日志。默认为“关闭”。若需要 GC 垃圾回收日志，可通过如下方式进行配置。1.进入 TongWeb 管理控制台 &gt; “基础配置” &gt; “JVM 配置” &gt; “GC 策略”页面。2.开启“记录 GC 日志”，并设置“ GC 日志文件”路径即可。默认路径为“logs/gc/gc.log”。</td></tr><tr><td>jvm</td><td>进程 JVM 相关的日志。启用记录 JVM 日志后，系统才会传给 JVM 加载，生成 JVM 日志文件。默认为“开启”。若需要关闭，可通过如下方式进行配置。1.进入 TongWeb 管理控制台 &gt; “基础配置” &gt; “JVM 配置” &gt; “JVM 日志”页面。2.关闭“记录 JVM 日志”即可。关闭“记录 JVM 日志”后，日志将不记录到日志文件中。</td></tr><tr><td>server</td><td>服务器运行期间产生的系统日志。</td></tr><tr><td>sessionha</td><td>部署应用时，在“会话与Cookie”页签中，选择会话服务器后，即开启会话高可用。会话相关日志输出到独立的“${tongweb.base}/logs/sessionha”日志目录。</td></tr></table>

# 12.7. 不同实例配置不同JDK版本
当不同的应用需要使用不同JDK版本时，您可以通过创建不同的实例，为实例配置不同的JDK版本的方式实现。

# 前置条件
已安装不同版本的JDK。

# 步骤1：创建实例
为该应用创建额外的实例。
1. 登录 TongWeb 管理控制台。
2. 在控制台左上角单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理” $>$ “实例”，进入实例页面。
4. 单击 “创建实例”，进入创建实例页面。
5. 根据需要配置实例相关参数。
6. 单击 “添加”，完成实例的创建操作。

# 步骤2：启动实例
1. 在左侧导航栏中，选择 “服务管理” $>$ “实例”，进入实例页面。
2. 单击目标实例所在行的 “启动”，启动实例。

# 步骤3：配置JDK版本
为额外创建的实例配置不同的JDK版本。
1. 实例启动完成后，单击目标实例所在行的“管理”，进入目标实例管理页面。
2. 在左侧导航栏中，选择“基础配置”>“JVM配置”>“环境变量”，进入环境变量页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/c2390956628e01883d4efa8d15077356a09e751101b1af2f926ee08a8fbb69d7.jpg)
3. 配置实例的不同java路径及环境变量。
4. 配置完成后，单击“更新”，即完成不同 JDK 版本的配置。

# 步骤4：重启该实例
重启该实例，使配置生效。
1. 在控制台左上角单击 “集中管理”，进入集中管理页面。
2. 在左侧导航栏中，选择 “服务管理” $>$ “实例”，进入实例页面。
3. 单击目标实例所在行的 “停止”，停止实例。
4. 停止后，单击目标实例所在行的“启动”，启动该实例。

# 步骤5：查看该实例JDK版本
1. 该实例启动完成后，单击该实例所在行的“管理”，进入该实例的首页。
2. 在首页，可查看java路径已切换为配置的不同的Java路径。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7d2f365d9943cab62364771e0a8b386ed3e73dc00c8050f0087c22f81e811927.jpg)


# 12.8. 调整线程池

# 12.8.1. 调整最大线程数

# 原因分析：
线程的大小对性能影响比较大，如果线程池的最大工作线程数设置太小，将导致请求处于等待状态，增加响应时间。
若如果线程池的最大工作线程数设置太大，过多的线程增加了线程切换的开销，也将影响性能。
因此，线程池的最大工作线程数高于正在处理请求的线程高峰5%左右是比较理想的。

# 调整方法：
用系统正式运营时的最大并发用户数进行压力测试，测试 dump 应用服务器运行时的堆栈，查看其中 http-worker 线程的状态。根据线程的状态来判断是否应该增加处理请求的线程池的线程数。
• 若所有线程状态为活跃线程数，说明线程池中所有线程都处于忙碌状态，应该增加线程池的线程数。
• 若工作线程超过当前配置的线程池的最大工作线程数的 $5 \%$ ，则应该减少线程池的最大工作线程数。
在 “管理控制台” $>$ “Web容器” $>$ “通道”，在目标通道所在行的 “监视”，查看活跃线程数和总线程数。
可根据这个监视量的值调整工作线程池的最大工作线程数。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/a386b0146b070112f1d7ec59972ace889628dcfd3c9a6ecb6b024d2001b653f8.jpg)
1. 进入 TongWeb 管理控制台。
2. 在左侧导航栏中，选择 “Web容器” $>$ “通道”，进入通道页面。
3. 单击目标通道名，进入通道编辑页面。
4. 在 “线程” 页签下，配置“最大线程数”，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/cbb57efe4ae2efd1201a64190e79bc52349b18a66f323907d19df6afde3737b2.jpg)


# 12.8.2. 调整最小线程数
系统正式运营时，一般 $60 \%$ 以上的时间用户数都远远小于最大并发用户数。 因此，可以用估计的大多数情况下的并发用户数进行压力测试，看看需要多少工作线程。
按照高于所需线程数的 $5 \%$ 的策略调整工作线程池的最小工作线程数。
1. 进入 TongWeb 管理控制台。
2. 在左侧导航栏中，选择 “Web容器” $>$ “通道”，进入通道页面。
3. 单击目标通道名，进入通道编辑页面。
4. 在 “线程” 页签下，配置 “最小备用线程数”，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/54536ba9cd81725041534f1c706117befb5909203ed6fd6dae9380c615673e81.jpg)


# 12.9. 引用数据源
采用 java:comp/env/jdbc/testdb方式引用数据源。
1. 配置数据源jdbc/testdb。
2. 代码 dataSource $=$ (DataSource) initialContext.lookup("java:comp/env/jdbc/testdb");
3. 应用 web.xml 中配置信息，如下所示。
```txt
<resource-ref>   
<description>jdbc/testdb</description>   
<res-ref-name>jdbc/testdb</res-ref-name>   
<res-type>javax.sql.DataSource</res-type>   
<res-auth>Container</res-auth>   
</resource-ref>
```

# 12.10. JavaEE8全局编码
JavaEE8 规范里全局编码 “request-character-encoding”，以 web.xml 优先，控制台次之。
```xml
<web-app xmlns="http://xmlns.jcp.org/XML/ns/javaee" xmlns:xi="http://www.w3.org/2001/XMLSchema-instance" xsi: schemaLocation="http://xmlns.jcp.org/XML/ns/javaee/web-app_4_0.xsd" version="4.0">
    <display-name>web</display-name>
    <request-character-encoding>GBK</request-character-encoding>
    <response-character-encoding>GBK</response-character-encoding>
</web-app>
```

# 12.11. 开启“禁止System退出”
应用代码执行System.exit则会有如下日志输出。
2022-06-07 16:27:26 [INFO] - Waiting for [1] instance(s) to be deallocated for Servlet [TestServlet] 2022-06-07
16:27:26 [WARN] - The web application [webtest] is still processing a request that has yet to finish. This is very
```txt
likely to create a memory leak. You can control the time allowed for requests to finish by using the unloadDelay attribute of the standard Context implementation. Stack trace of request processing thread:[java.lang.Object.wait(Native Method)]   
java.lang.Thread.join(Thread.java:1257) java.lang.Thread.join(Thread.java:1331)   
java.lang.ApplicationShutdownHooks.runHooks(ApplicationShutdownHooks.java:107)   
java.lang.ApplicationShutdownHooks$1.run(ApplicationShutdownHooks.java:46)   
java.lang.Shutdown.runHooks(Shutdown.java:123) java.lang.Shutdown(sequence(Shutdown.java:170)   
java.lang.Shutdown.export(Shutdown.java:216)   
java.lang.Runtime_exitRuntime.java:109)   
java.lang.System.exit(System.java:971) com.tong.TestServlet.doGet(TestServlet.java:38)   
javax servlet.http HttpServlet.service(HttpServlet.java:503)
```
进入“安全管理”>“安全策略”>“启停安全”，开启“System退出检测”和“禁止System退出”，日志提示信息如下所示。
```txt
[INFO] - System exit request has been denied.
```

# 12.12. jstack 使用技巧
打 jstack 小技巧，不用 ssh 登录上去，不用执行本地 jstack 命令，通过 TongWeb 控制台即可完成。
第一步：建立一个采集模块，勾选 ”jstack“。
第二步：创建快照文件，选择第一步建立的采集模板。
第三步：下载到本机分析。
详细操作步骤，如下所示。
1. 进入 TongWeb 管理控制台。
2. 切换到目标实例。
3. 选择 “诊断管理” $>$ “采集模板”，进入采集模板页面。
4. 设置采集模板名称，并勾选分析工具 “jstack”，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/7b472e7ff22d5de4fc05265d0bf388df49e6877eb1a9f5b9c522d1b177bdb608.jpg)
5. 基于创建的采集模板打快照。
a. 选择 “诊断管理” $>$ “快照文件”，进入快照文件页面。
b. 单击 “打快照”，进入打快照页面。
c. 选择步骤 4 创建的采集模板，如下图所示。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1b3bcde5cf4a4bb74a792b9bd728e74733e7d22861cb80d0c88fba4532a8c0a4.jpg)
d. 单击“打快照”，完成打快照操作。
6. 下载快照文件到本机进行分析。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d18cd16529e126dd809622bcd403763ccbdd79819c70248c5f0a08e0ad88c836.jpg)


# 12.13. 调整资源缓存

# 问题描述
应用部署时“开启资源缓存，最大缓存大小，可缓存的单文件大小上限， 缓存时长”报大小不够。

# 日志报错
```txt
2022-06-14 12:16:39 [WARN] - Unable to add the resource at [/WEB-INF/classes/org/oasis_open/docs/wsrf/np_2/jaxb.properties] to the cache for web application [cxf] because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache 2022-06-14 12:16:39 [WARN] - Unable to add the resource at [/WEB-INF/classes/org/oasis_open/docs/wsrf/np_2/jaxb.properties] to the cache for web application [cxf] because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache
```

# 解决方案
查看应用的监视项的“资源缓存量”。
1. 进入 TongWeb 管理控制台。
2. 切换到目标实例。
3. 选择 “应用管理” $>$ “应用”，进入应用/列表页面。
4. 单击目标实例所在行的 “监视”，进入监视页面。
? 中断的线程数
资源缓存量（KB)
请求处理总数
0

 请求处理总时间 (毫秒)
0

平均请求处理时间 (毫秒)
0

错误请求处理总数
启动时间
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/a2b42794d668c6c925fa3d16d22c4de3a84e5fa1c2f13beee321321b8bf26557.jpg)
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/0163f618c5f27aef1d799d35dd899f86b639ff3d7b97c7046c922b16035feb9d.jpg)
14:07:29
③ 启动耗时(毫秒)
1326
5. 查看资源缓存量是否够用，对缓存进行调整。
注意：
切记盲目调大，典型毛病“999999999”。

# 12.14. 开启“使用老版Cookie处理器”
“使用老版Cookie处理器”默认“关闭”。

# 问题现象
对cookie 新版本标准而言，不能直接使用逗号这种特殊符号作为cookie的内容。 例如：空格、方括号、圆括号、等于号（=）、逗号、双引号、斜杠、问号、 $@$ 、冒号、分号都不能作为Cookie的内容。
若遇到如下用法时出错，则开启 “使用老版 Cookie 处理器 ”。
```javascript
Cookie cookie = new Cookie("testCookie", "test");  
cookie.setDomain ".test.com";  
cookie.setPath("/");  
cookie.setMaxAge(36000);  
response.addCookie_cookie);
```
报错信息，如下所示。
```txt
2022-06-14 11:07:31 [WARN] - java.lang.IllegalArgumentException: An invalid domain [.test.com] was specified for this cookie  
2022-06-14 11:07:31 [WARN] - at com.tongweb.web.util(http.Rfc6265CookieProcessor.validDomain (Rfc6265CookieProcessor.java:202)  
2022-06-14 11:07:31 [WARN] - at com.tongweb.web.util(http.Rfc6265CookieProcessor_generateHeader (Rfc6265CookieProcessor.java:137)  
2022-06-14 11:07:31 [WARN] - at com.tongweb.serverconnector.Response_generationCookieString( Response.java:960)  
2022-06-14 11:07:31 [WARN] - at com.tongweb.serverconnector.Response.addCookie(Response.java:912)  
2022-06-14 11:07:31 [WARN] - at com.tongweb.serverconnector.ResponseFacade.addCookie
```
```txt
(ResponseFacade.java:369)  
2022-06-14 11:07:31 [WARN] - at com.tong.TestServlet.doGet(TestServlet.java:44)
```

# 解决方案
1. 进入 “应用管理” $>$ “应用”，进入应用列表页面。
2. 单击已部署应用的应用名，进入应用详细信息页面。
3. 单击 “会话与Cookie”，进入会话与Cookie配置信息页面。
4. 开启“使用老版Cookie处理器”即可解决问题。

# 12.15. 关闭“Strict Quote Escaping”
“Strict Quote Escaping”默认开启。

# 问题现象
```txt
<aa:sayHello address="aaaazzzzz" name="%=String.valueOf("aa")%>"></aa:sayHello>
```
如上写法，会导致如下错误，关闭“Strict Quote Escaping”即可。
```csv
2022-06-14 11:24:55 [WARN] - com.tongweb.jasper.JasperException: /index2.jsp (line: [11], column: [45])
Attribute value [String.valueOf("aa")] is quoted with [""] which must be escaped when used within the value
2022-06-14 11:24:55 [WARN] - at com.tongweb.jasper.compile.DefaultErrorHandler,jspError
(DefaultErrorHandler.java:26)
2022-06-14 11:24:55 [WARN] - at com.tongweb.jasper.compile.ErrorDispatcherdispatch(ErrorDispatcher
.java:276)
2022-06-14 11:24:55 [WARN] - at com.tongweb.jasper.compile.ErrorDispatcherDispatch(ErrorDispatcher
.java:82)
2022-06-14 11:24:55 [WARN] - at com.tongweb.jasper.compilederaςographsAttributeValue(Parser.java:287)
2022-06-14 11:24:55 [WARN] - at com.tongweb.jasper.compilederaςographsAttribute(Parser.java:231)
```

# 解决方案（关闭“Strict Quote Escaping”）
1. 进入 “应用管理” $>$ “应用”，进入应用列表页面。
2. 单击已部署应用的应用名，进入应用详细信息页面。
3. 单击 “JSP”，进入JSP配置信息页面。
4. 关闭 “Strict Quote Escaping” 即可解决问题。

# 12.16. 开启“允许跨应用访问”
当调用其它应用上下文时需要开启“允许跨应用访问”，否则报空指针异常。

# 调用上下文
```javascript
request.getServletContext().getContext("/aaa").getServletNames();
```

# 报错信息
```txt
2022-06-14 11:55:47 [WARN] - java.lang.Null Exception  
2022-06-14 11:55:47 [WARN] - at com.tong.TestServlet.doGet(TestServlet.java:40)  
2022-06-14 11:55:47 [WARN] - at javax.swing(http://HttpServlet.service( HttpServlet.java:503)  
2022-06-14 11:55:47 [WARN] - at javax.swing(http://HttpServlet.service( HttpServlet.java:590)
```

# 解决方案（开启“允许跨应用访问”）
1. 进入 “应用管理” $>$ “应用”，进入应用列表页面。
2. 单击已部署应用的应用名，进入应用详细信息页面。
3. 单击 “安全”，进入安全配置信息页面。
4. 开启 “允许跨应用访问”，并单击“更新”即可。

# 12.17. 路径/参数中使用未编码字符

# 报错日志信息：
```txt
2022-06-14 10:16:24 [INFO] - Error parsing HTTP request header  
Note: further occurrences of HTTP request parsing errors will be logged at DEBUG level.  
java.lang.IllegalArgumentException: Invalid character found in the request target [/dbpool/?aa=|ddd]]. The valid characters are defined in RFC 7230 and RFC 3986  
at com.tongweb.coyote(http11 Http11InputBuffer.parseRequestLine( Http11InputBuffer.java:470)  
at com.tongweb.coyote(http11 Http11Processor.service( Http11Processor.java:212)
```

# 解决方案：
在目标 HTTP 通道中，开启“路径中允许使用的未编码字符”和“参数中允许使用的未编码字符”，并配置“" <> [ \ ] ^ ` { | }”。
操作步骤，如下所示。
1. 登录管理控制台。
2. 切换到目标实例。
3. 在左侧菜单栏中，选择 “Web 容器” $>$ “通道”，进入通道列表页面。
4. 单击目标通道的通道名，进入通道详细信息页面。
5. 单击 “HTTP 属性” 页签，打开 “路径中允许使用的未编码字符” 和 “参数中允许使用的未编码字符” 开关。
通道
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/581529ba024ee678bc10731bafdc5c76c70d97b38bbdc2c9b515c498535c6bf2.jpg)
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/b4b536baa521d18841a217503b902caa9111dd082b1fefde0993f3093cbf801e.jpg)
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/5eb138bb8e7c3546f83ac0ce68eb981f3e8d6f601ff8eca92209ead3a8b467ea.jpg)


# 12.18. 部署应用时超时日志信息
部署应用时的 “慢线程检测”、“阻塞阈值” 用于处理超时的线程。
超时提示日志，如下所示。
```clojure
2022-06-14 17:01:32 [WARN] - Thread [TW-0.0.0.0-8088-33] (id=[278]) has been active for [3,391] milliseconds (since [6/14/22 5:01 PM]) to serve the same request for [ http://192.168.0.8:8088/webtest/TestServlet] and may be stuck (configured threshold for this StuckThreadDetectionValve is [3] seconds). There is/are [1] thread(s) in total that are monitored by this Valve and may be stuck. java.langThrowable at java.lang.Thread.sleep(Native Method) at com.tong.TestServlet.doGet(TestServlet.java:43) at javax.swing(http://httpServlet.service( HttpServlet.java:503) at javax.swing(http://httpServlet.service( HttpServlet.java:590) at com.tongweb.server.core.ApplicationFilterChain-enterApp(ApplicationFilterChain.java:379) at com.tongweb.server.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:229) at com.tongweb.server.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:155) at com.tongweb.web.websocket.server.WsFilter.doFilter(WsFilter.java:37) at com.tongweb.server.core.ApplicationFilterChain/internalDoFilter(ApplicationFilterCh)
```

# 12.19. 数据源statement未关闭日志
```txt
2022-06-17 10:28:54 [WARN] - Statement created, but was not closed at: java.langThrowable: Statement created at stack at com.tongweb.web-jdbc.pool.interceptor.StatementFinalizer\\(StatementEntry.<init >(StatementFinalizer.java:86) at com.tongweb.web-jdbc.pool.interceptor.StatementFinalizer
```
```txt
.createStatement(StatementFinalizer.java:32) at com.tongweb.web-jdbc.pool.interceptor  
.AbstractCreateStatementInterceptor.invoke(AbstractCreateStatementInterceptor.java:61) at com.tongweb.web-jdbc.pool.JdbcInterceptor.invoke(JdbcInterceptor.java:84) at com.tongweb.web-jdbc.pool.interceptor.AbstractCreateStatementInterceptor.invoke(AbstractCreateStatementInterceptor.java:59) at com.tongweb.web-jdbc.pool.JdbcInterceptor.invoke(JdbcInterceptor.java:84) at com.tongweb.web-jdbc.pool.ConnectionFacade.invoke(ConnectionFacade.java:61) at com.sunproxy.$Proxy44.createStatement  
 Unknown Source) at com.tong.TestServlet.doGet(TestServlet.java:52)
```

# 12.20. 数据源连接泄漏日志
```txt
2022-06-17 10:56:59 [WARN] - Connection has been abandoned PooledConnection[com.mysql.cj.jpeg]  
.ConnectionImpl@60e048ce]:java.lang.Exception at com.tongweb.web.jpeg.ConnectionPool  
.getThreadDump(ConnectionPool.java:1139) at com.tongweb.web.jpeg.ConnectionPool  
.borrowConnection(ConnectionPool.java:787) at com.tongweb.web.jpeg.ConnectionPool  
.borrowConnection(ConnectionPool.java:628) at com.tongweb.web.jpeg.ConnectionPool  
.getConnection(ConnectionPool.java:170) at com.tongweb.web.jpeg.DataSourceProxy.getConnection  
(DataSourceProxy.java:116) at com.tong.TestServlet.doGet(TestServlet.java:50) at javax.swing(http://HttpServlet.service(HttpServlet.java:503)
```

# 12.21. 数据源连接满日志
```txt
2022-06-17 11:00:13 [WARN] - java.sql.QLException: [TW-0.0.0.0-8088-15] Timeout: Pool empty. Unable to fetch a connection in 10 seconds, none available[size:10; busy:10; idle:0; lastwait:10000]. 2022-06-17 11:00 :13 [WARN] - at com.tongweb.web-jdbc.pool.ConnectionPool.borrowConnection(ConnectionPool.java:679)   
2022-06-17 11:00:13 [WARN] - at com.tongweb.web-jdbc.pool.ConnectionPool.getConnection   
(ConnectionPool.java:170)   
2022-06-17 11:00:13 [WARN] - at com.tongweb.web-jdbc.pool.DataSourceProxy.getConnection   
(DataSourceProxy.java:116)   
2022-06-17 11:00:13 [WARN] - at com.tong.TestServlet.doGet(TestServlet.java:50)
```

# 12.22. 请求处理队列满
```txt
2022-06-27 12:33:26 [WARN] - Executor rejected socket [com.tongweb.web.util.net.  
NioEndpoint$NioSocketWrapper@617c0e76:com.tongweb.web.util.net.SecureNioChannel@58fc21bd:java.nio.c  
hannels_SOCKETChannel[connected local=/127.0.0.1:9060 remote=/127.0.0.1:64921]] for processing java.util  
 concurrent-RejectedExecutionException: Queue capacity is full at com.tongweb.web.util threads  
ThreadPoolExecutor.execute( ThreadPoolExecutor.java:148) at com.tongweb.web.util threads  
ThreadPoolExecutor execute( ThreadPoolExecutor.java:119) at com.tongweb.web.util.net.  
AbstractEndpoint(processSocket( AbstractEndpoint.java:1119) at com.tongweb.web.util.net.  
NioEndpoint$Poller timeout(NioEndpoint.java:1008) at com.tongweb.web.util.net.NioEndpoint$Poller.run  
(NioEndpoint.java:797) at java.lang.Thread.run( Thread.java:750)  
2022-06-27 12:33:26 [WARN] - Executor rejected socket [com.tongweb.web.util.net.
```
NioEndpoint$NioSocketWrapper@386d2a30:com.tongweb.web.util.net.SecureNioChannel@3ed9f9ec:java.nio.c
hannels.SocketChannel[connected local=/127.0.0.1:9060 remote=/127.0.0.1:53068]] for processing java.util
.concurrent.RejectedExecutionException: Queue capacity is full at com.tongweb.web.util.threads
.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:148) at com.tongweb.web.util.threads
.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:119) at com.tongweb.web.util.net
.AbstractEndpoint.processSocket(AbstractEndpoint.java:1119) at com.tongweb.web.util.net.
NioEndpoint$Poller.timeout(NioEndpoint.java:1008) at com.tongweb.web.util.net.NioEndpoint$Poller.run
(NioEndpoint.java:797) at java.lang.Thread.run(Thread.java:750)

# 13. license 授权管理
管理 TongWeb 服务器的授权许可信息。

# 13.1. 查看授权信息
本章节介绍如何查看授权信息。

# 前置条件
已获取系统管理员账号和密码。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “产品授权”，进入产品授权页面。
4. 在产品授权页面，您可以查看产品授权信息。
包含授权产品、授权版本、版本类型、授权客户、授权类型、授权期限、授权IP、授权节点数等信息。

# 13.2. 更新授权信息
更新授权信息后，license 自动同步到所有节点。
更新授权信息时，您也可以根据需要指定授权文件的存放目录。

# 前置条件
• 已获取系统管理员账号和密码。
• 已获取授权文件。

# 约束说明
• 请确认上传授权文件的客户端所在IP被信任。
若不被信任，无法上传授权文件。设置信任IP，请参见控制台安全。
• 若需要选择上传升级包文件的方式，需要开启文件上传功能。
控制台默认禁用文件上传功能。如何开启文件上传功能，请参见禁用文件上传。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击“集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择“系统管理”>“产品授权”>“更新”，进入产品授权的“更新”页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/1a97e8d46bffaf994ed3089f0eadae214efa53a8d263c709c644cf3ad48eb37d.jpg)
4. 上传或者指定授权文件在服务器上的位置。
◦ 上传文件
▪ 授权文件必须是 “*.dat” 文件。
▪ 控制台默认关闭上传文件功能。若需要开启，请参见禁用文件上传。
◦ 服务器文件
服务器上授权文件的位置，授权文件是“*.dat”文件。
5. （可选）指定授权文件目录。
◦ 若为空，则表示使用 TongWeb 的安装目录。
◦ 若指定为相对路径，则是相对于 TongWeb 的安装目录，即 $\$ 1$ {tongweb.home}。
◦ 若指定的目录不存在，则仍然使用 TongWeb 的安装目录。
6. 单击 “更新”，更新授权信息。
若界面弹出“产品授权更新成功”提示信息，则说明产品授权信息更新成功。

# 13.3. 设置授权检查时间
用户可根据需要设置检查产品授权过期的时间点。
不同实例的业务作用不同，可能需要不同的通知策略，通知人员也可能不同，因此，需要前往指定实例进行配置。
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择 “基础配置” > “全局配置” > “授权”，进入全局配置的“授权”页面。
4. 设置检查的时间点。

# 授权检查时间：
license 过期检查的时间点，例如：设置为 6 表示 06:00。
5. 设置完成后，单击 “更新”，完成授权检查时间的操作。

# 13.4. 设置授权到期提醒
用户可根据需要设置授权到期提前提醒的天数，同时可设置提醒的方式，包含邮件和短信。
不同实例的业务作用不同，可能需要不同的通知策略，通知人员也可能不同，因此，需要前往指定实例进行配置。
授权到期提醒默认“关闭”。
前置条件 - 若使用邮件方式发送到期提醒，需要提前 创建 JavaMail 资源。 - 若使用短信方式发送到期提醒，需要提前 创建短信服务。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 切换到目标实例。
3. 在左侧导航栏中，选择“基础配置”>“全局配置” > “授权”，进入全局配置的“授权”页面。
4. 根据需要设置提前的时间以及发送方式。
5. 配置完成后，单击 “更新”，完成授权到期时间提醒的配置操作。

# 13.5. 推送到授权中心
“推送到授权中心” 是将更新的授权文件推送到授权中心，以自动下发至其它 TongWeb。
在 “默认实例” 的 “全局配置” 模块打开 “启用授权中心”，并选择 “注册中心” 将授权文件推送到授权中心。

# 准备工作
• 已搭建注册中心。
• 已获取注册中心服务器地址、用户名和密码等信息。

# 13.5.1. 步骤1：准备两个 TongWeb 实例
如：TongWebA 和 TongWebB。
如下操作以 “将 TongWebA 的授权文件更新到 TongWebB” 为例说明。

# 13.5.2. 步骤2：配置 TongWeb A
将 TongWebA 的授权文件推送到注册中心。
1. 添加 “注册中心”
a. 登录 TongWebA 控制台。
b. 切换到默认实例。
c. 在左侧导航栏中，选择 “资源管理” $>$ “注册中心”，进入注册中心页面。
d. 单击 “创建”，进入创建注册中心页面。
e. 填写注册中心连接信息。
▪ 名称：注册中心的名称。
▪ 服务提供商：根据搭建的注册中心，选择指定服务提供商，如 “Nacos”。
▪ 服务地址：填写为注册中心服务器的地址，如 “192.168.1.1:8848”。
▪ 用户名：登录注册中心的用户名。
▪ 密码：登录注册中心的用户密码。
▪ 标识符：请根据需要填写，如：tw。
f. 单击 “添加”，即可完成注册中心的添加操作。
2. 打开 “启用授权中心”
a. 在左侧导航栏中，选择 “基础配置” $>$ “全局配置” $>$ “授权”，进入全局配置的“授权”页面。
b. 打开 “启用授权中心” 开关。
c. 在 “授权中心” 下拉菜单中，选择添加的注册中心。
d. 配置完成后，单击 “更新”，完成启动授权中心的配置操作。
3. 打开 “推送到授权中心”
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d747c05128314b29be6ed298c13984c9ddee2d520375955d957aae6e8339d7e8.jpg)
打开 “推送到授权中心” 后，单击一次 ”更新“ 推送一次。
a. 单击控制台左上角的 “集中管理”，进入集中管理页面。
b. 在左侧导航栏中，选择 “系统管理” $>$ “产品授权” $>$ “更新”，进入产品授权的“更新”页面。
c. 设置 “授权文件目录”。
打开 “推送到授权中心” 后，即可将该目录下的授权文件推送到授权中心。
d. 打开 “推送到授权中心” 开关。
e. 配置完成后，单击 “更新”，完成产品授权的更新操作。
即可将授权文件推送到授权中心，以自动下发至其它 TongWeb。

# 13.5.3. 步骤3：配置 TongWeb B
配置 TongWebB 从注册中心拉取 TongWebA 的授权文件。
1. 添加注册中心
参照 TongWebA 在 TongWebB 添加注册中心。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/60eb74e44e2faa7f84421baffb843677f691b3de96e0e1b2e4a11e582d6b0739.jpg)
TongWebA 和 TongWebB 注册中心配置信息相同。
2. 打开 “启用授权中心”
开启后，TongWebB 实例即可实时从授权中心获取最新的授权文件，并更新到本地。
a. 登录 TongWebB 控制台。
b. 切换到目标实例。
c. 在左侧导航栏中，选择 “基础配置” $>$ “全局配置” $>$ “授权”，进入全局配置的 “授权” 页面。
d. 打开 “启用授权中心” 开关。
e. 在 “授权中心” 下拉菜单中，选择添加的注册中心。
f. 配置完成后，单击 “更新”，完成启动授权中心的配置操作。

# 13.5.4. 步骤4：验证拉取效果
1. 更新 TongWebA 的授权文件。
2. 进入 TongWebA 的 “集中管理” $>$ “系统管理” $>$ “产品授权” $>$ “更新”，进入更新页面。
3. 打开 “推送到授权中心”，并单击 “更新”，将 TongWebA 更新后的授权文件推送到注册中心。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/36bf720135421f58f9d0385ef10dc8958ab09399dcb4604c599bb5e79a97b0cd.jpg)
打开 “推送到授权中心” 后，单击一次 ”更新“ 推送一次。
4. 进入 TongWebB 可查看到授权文件已更新。

# 14. 产品升级管理

# 14.1. 常规版本

# 14.1.1. 产品升级
本章节介绍如何升级 TongWeb ，包含主 TongWeb 实例（默认实例 domain1）、集群环境（包含集群中受管理的节点和实例）的升级操作以及不受管的独立节点或实例。旨在指导用户将主 TongWeb、集群内所有 TongWeb 以及独立的节点或实例统一升级到新版本 。

# 14.1.1.1. 升级影响
产品升级不对系统账号、应用配置等产生影响。

# 14.1.1.2. 升级主 TongWeb
本章节介绍如何升级主 TongWeb 实例（默认实例 domain1）。

# 前置条件
已获取有效的产品升级包，该升级包以 “version” 开头命名且为 “.zip” 类型文件。

# 注意事项
升级主 TongWeb 需要重启 TongWeb 服务器才能生效，请选择应用访问流量低的时间段进行升级。

# 方式1：在线升级
若需要选择上传升级包文件的方式，需要满足如下两个条件。
• 请确认浏览器所在 IP 为信任 IP。
关于如何设置信任 IP，请参见控制台安全。
• 控制台默认禁用文件上传功能，需要开启文件上传功能。
关于如何开启文件上传功能，请参见禁用文件上传。
操作步骤，如下所示。

# 1. 上传升级包
a. 登录 TongWeb 管理控制台。
b. 单击控制台左上角的 “集中管理”，进入集中管理页面。
c. 在左侧导航栏中，选择 “系统管理” $>$ “产品升级”，进入产品升级列表页面。
d. 单击 “升级”，进入产品升级页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/513597dcc14ed629ef7fd29a687ae08ce88a2d4c83a00c3bfbab8ff088cf7269.jpg)
e. 上传文件或者设置产品 “.zip” 包在服务器上的位置。
上传文件：控制台默认关闭上传文件功能。若需要开启，请参见禁用文件上传。
f. 单击 “升级”，将产品升级包上传到 “${tongweb.home}/” 目录下。
在产品升级列表中，可查看到上传的产品版本。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/d4796942a77c8429ecce8235ec34da81a5d097b7f8b0f3c4863d2f3d682e4367.jpg)
2. 重启 TongWeb 服务器，即可将主 TongWeb 升级到最新版本。

# 说明：
在 “默认实例” $>$ “基础配置” $>$ “全局配置” $>$ “服务器” 中，用户可选择 “切换实例版本”，运行指定的实例版本。
◦ “切换实例版本” 默认为 “最新版本”，若需要升级到最新版本，重启 TongWeb 服务器即可。
◦ 若需要运行指定的实例版本，请在 “切换实例版本” 下拉列表中，选择所需版本，然后重启 TongWeb服务器即可。
3. 查看升级后的生效版本。
进入 “集中管理” > “系统管理” > “产品升级” 页面，可查看生效的版本。
“生效中” 为 “IN_USE”，表示生效的版本。

# 方式2：手动升级
用户可手动将 “version*.zip” 升级包拷贝到 “${tongweb.home}/” 目录下，重启 TongWeb 服务器，即可实现自动升级。
1. 停止 TongWeb 服务器。
2. 将获取的升级包 “version*.zip” 放入 “${tongweb.home}” 目录。
3. 重新启动 TongWeb 服务器，即可升级到最新版本。
4. 登录管理控制台，进入 “集中管理” $>$ “系统管理” $>$ “产品升级” 查看生效的版本。
“生效中” 为 “IN_USE”，表示生效的版本。

# 注意：
在 TongWeb 8.0.84 至 TongWeb 8.0.9.01 版本范围内，步骤 1 和步骤 2 的执行顺序不可调换。这是因为该版本升级过程中涉及到 “.pid” 文件的位置变动，一旦调换顺序，极有可能导致升级过程中服务停止失败。

# 14.1.1.3. 升级集群（节点、实例）
在完成主 TongWeb 升级操作后，系统并不会自动对集群环境（包含集群中受管理的节点和实例）进行统一升级。此时，需要用户手动对集群进行同步升级，具体包含手动对集群内的各节点和实例进行重启升级操作，以此确保整个集群的 TongWeb 均使用统一的版本。

# 注意事项
在完成主 TongWeb 升级操作后，首先需要对集群中的节点或实例执行 “重启升级” 操作，待节点和实例升级就绪后，再对集群的主 TongWeb 进行 “重启” ，否则会导致远程调用 “重启” 失败。

# 操作步骤
升级集群会将集群所管理的实例一并升级。
1. 通过 “集中管理” $>$ “系统管理” $>$ “产品升级”，上传新版本压缩包；
2. 通过 “集中管理” $>$ “服务管理” $>$ “节点” 列表页面，依次单击 “重启升级”；
3. 通过 “集中管理” $>$ “服务管理” $>$ “集群” 列表页面，依次单击 “升级”；
4. 通过 “集中管理” $>$ “服务管理” $>$ “实例” 列表页面，依次单击 “重启升级”；
5. 重启集中管理控制台实例自身。

# 14.1.1.4. 升级独立节点
在完成主 TongWeb 和集群的升级操作后，用户还可以手动对不在集群管理的独立节点进行升级，以此确保使用统一的 TongWeb 版本。

# 前置条件
已 升级主 TongWeb。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击控制台左上角的 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理”，单击指定节点所在行的 “重启升级”，升级指定的节点版本。
4. 升级完成后，可查看指定节点的版本升级为新版本。

# 14.1.1.5. 升级独立实例
在完成主 TongWeb 和集群的 升级操作后，用户还可以手动对 不在集群管理的 独立实例进行升级，以此确保使用统一的 TongWeb 版本。
注：若在升级前创建的本地实例没有启动，上传升级包后，启动本地实例，则启动的实例版本为升级后的版本。

# 前置条件
已 升级主 TongWeb。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击控制台左上角的 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理”，单击指定实例所在行的 “重启升级”，升级指定的实例版本。
4. 升级完成后，可查看指定实例的版本升级为新版本。

# 14.1.2. 查看版本发布说明
用户可根据需要查看产品版本对应的发布说明。

# 前置条件
已获取系统管理员账号和密码。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击控制台左上角的 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “产品升级”，进入产品升级列表页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/58f98bcd983e865dd60557b91c19cc964c6f6ec971c9f76e98f36d565af9e813.jpg)
4. 单击目标版本所在行的 “发布说明”，进入发布说明页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/664d67b2a539c6db1223e09ac72af671c07ff2d988fb018d109b83600288fbcb.jpg)
5. 用户可查看发布说明中的产品版本、构建日期、状态以及发布说明等。

# 14.1.3. 下载升级包
用户可以下载升级包，以便在其他环境中进行升级。

# 前置条件
已获取系统管理员账号和密码。

# 操作步骤
1. 登录 TongWeb 管理控制台。
2. 单击控制台左上角的 “集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “系统管理” $>$ “产品升级”，进入产品升级列表页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/697d1e9a378b6bf265b36725ddcdb04c0c0adf101ed8f99779572d4667b503bb.jpg)
4. 单击目标版本所在行的 “下载”，弹出选择下载文件窗口。
5. 勾选待下载的文件，并单击 “确定”，即可下载升级包。

# 14.1.4. 版本回退
您可以根据需要进行手动版本回退。

# 14.1.4.1. 前提条件
“${tongweb.home}” 目录下老版本的 “version*.zip” 或者 “version*” 目录及文件没有删除和损坏。

# 14.1.4.2. 回退主 TongWeb
回退主 TongWeb 时，系统不对集群管理的节点、实例进行统一回退。
• 关于如何回退节点，详见回退节点。
• 关于如何回退集群管理的实例，详见 回退集群实例。

# 方式1：通过控制台回退主 TongWeb 版本
1. 登录 TongWeb 管理控制台。
2. 单击控制台左上角的 “默认实例”，进入默认实例页面。
3. 在左侧导航栏中，选择 “基础配置” $>$ “全局配置”，进入全局配置的 “服务器” 页面。
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/3552bd4018851ab65c5e2001b6bf728df42f4c9dde3bb17a192573de1588353f.jpg)
4. 在 “切换实例版本” 下拉列表中，选择需要回退的版本。
5. 单击 “更新”，弹出全局配置更新成功提示信息。
6. 重启 TongWeb 服务器，使配置生效。
TongWeb 重启时，使用旧版本的 TongWeb 进行启动。
进入 “集中管理” > “系统管理” $>$ “产品升级” 可查看生效的版本。“生效中” 为 “IN_USE”，表示生效的版本。

# 方式2：手动删除升级版本的目录及文件
1. 停止 TongWeb 服务器。
2. 进入 “${tongweb.home}” 目录。
3. 删除升级版本的 “version*.zip” 和 “version*” 目录及文件。
4. 重新启动 TongWeb 服务器。
TongWeb 重新启动时，会使用老版本的 “version*.zip” 或者 “version*” 目录及文件进行启动。
若 “${tongweb.home}” 目录下存在多个 “version*.zip” 或者 “version*” 目录及文件，系统会根据版本号选择较大的版本启动 TongWeb 服务器。
5. 登录管理控制台，进入 “集中管理” > “系统管理” > “产品升级” 查看生效的版本。
“生效中” 为 “IN_USE”，表示生效的版本。

# 14.1.4.3. 回退节点
用户可通过控制台回退节点或者通过手动删除新版本 TongWeb 的 “version*.zip” 和 “version*” 目录及文件的方式回退节点。

# 注意事项
主 TongWeb 版本回退后，建议对集群节点进行同步回退，使用统一版本。

# 方式1：通过控制台回退节点
在 “全局配置” 页面，通过选择指定实例版本的方式，回退节点。
1. 登录 TongWeb 管理控制台。
2. 单击控制台左上角的 “集中管理”，进入集中管理页面。
3. 在左侧菜单栏中，选择 “服务管理” $>$ “节点”，进入节点列表页面。
4. 单击目标节点所在行的 “管理”，进入节点管理页面。
5. 在左侧菜单栏中，选择 “基础配置” $>$ “全局配置”，进入全局配置的 “服务器” 页面。
6. 在 “切换实例版本” 下拉列表中，选择指定的回退版本。
7. 单击 “更新”，并进入 “集中管理” $>$ “服务管理” $>$ “节点”，重启指定节点，即可回退到指定版本。

# 方式2：手动回退节点
1. 停止节点运行的 TongWeb 服务器。
2. 进入 “${tongweb.home}” 目录。
3. 删除升级版本的 “version*.zip” 和 “version*” 目录及文件。
4. 重新启动 TongWeb 服务器。
TongWeb 重新启动时，会使用老版本的 “version*.zip” 或者 “version*” 目录及文件进行启动。
5. 登录管理控制台，进入 “集中管理” $>$ “服务管理” > “节点”，可查看节点的版本。

# 14.1.4.4. 回退集群实例
主 TongWeb 版本回退后，系统不对集群管理的实例进行统一回退。
若需要回退集群管理的实例，在控制台界面对集群进行 “升级” 或对实例进行 “重启升级”。

# 注意事项
主 TongWeb 版本回退后，建议对集群实例进行同步回退，使用统一版本。

# 前置条件
已将主 TongWeb 版本回退。

# 操作步骤
用户可根据需要回退指定实例的版本。
1. 登录 TongWeb 管理控制台。
2. 单击“集中管理”，进入集中管理页面。
3. 在左侧导航栏中，选择 “服务管理”，单击指定集群所在行进行 “升级” 或者实例所在行的 “重启升级”，回退指定的集群或者实例版本。
4. 回退完成后，可查看指定集群或者实例的版本回退为老版本。

# 14.2. 特殊版本

# 14.2.1. TongWeb 8.0.6.X 升级到 8.0.7.X
由于 TongWeb 8.0.6.X 到 TongWeb 8.0.7.X 版本通信加密方式发生改变。
本章节介绍如何将主 TongWeb 和集群（节点、实例）一并升级。

# 14.2.1.1. 升级前准备
执行升级操作后，系统会自动备份 conf 和 secure 文件。
备份路径为：“${tongweb.base}/data/upgradebackup”。
为了保证升级后，数据不丢失，建议对必要文件进行手动备份。

# 14.2.1.2. 升级过程
1. 在主 TongWeb 中，进入 “集中管理” $>$ “系统管理” $>$ “产品升级” 页面，上传升级包（version*.zip）。
2. 进入 “服务管理” $>$ “节点” 页面，升级所有节点。
3. 重启主 TongWeb。
4. 进入 “集中管理” $>$ “服务管理” $>$ “集群” 页面，升级所有集群。
注：升级集群时，系统会将集群管理的实例，一并升级。
5. 在实例列表页面，升级所有的独立实例。
不在集群管理范围的独立实例，需要手动单独升级：在实例列表的目标实例所在行，单击 “重启升级”，即可将独立实例升级。

# 注意事项
若需要升级单独的 TongWeb（仅启动一个 TongWeb 实例且不使用集中管理），需要手动将最新的version*.zip 包放在实例的 “${tongweb.home}” 目录下，然后重启实例。

# 14.2.1.3. TongWeb 8.0.7.X 回退到 TongWeb 8.0.6.X
由于 TongWeb 8.0.6.X 到 TongWeb 8.0.7.X 版本通信加密方式发生改变。
从 TongWeb 8.0.7.X 回退到 TongWeb 8.0.6.X 前，需要先将配置文件进行回退。

# 注意事项
若不回退配置文件，与密码相关的模块，会出现无法使用等问题。

# 前置条件
“${tongweb.home}” 目录下老版本的 “version*.zip” 或者 “version*” 目录及文件没有删除和损坏。

# 操作步骤

# 1. 回退配置文件
将主 TongWeb（集中管理）、节点、实例的配置文件全部手动回退。
a. 关闭所有 TongWeb 相关进程。
b. 进入 “${tongweb.base}” 目录。
c. 将系统自动备份在 “${tongweb.base}/data/upgradebackup” 目录下的 conf 和 secure 文件回退。

# 2. 回退节点、集群以及实例
a. 删除升级版本的 “version*.zip” 和 “version*” 目录及文件。
b. 重新启动 TongWeb 服务器。
c. 在控制台界面对节点、集群以及实例进行重启即可。

# 说明：
若需要回退单独的 TongWeb（仅启动一个 TongWeb 实例且不使用集中管理），请参照如下操作回退：
i. 将系统自动备份到 “${tongweb.base}/data/upgradebackup” 目录的配置文件回退。
ii. 将最新版本的 “version*.zip” 和 “version*” 目录及文件删除，然后重启实例即可。

# 14.2.2. TongWeb 8.0.7.X 升级到 8.0.9.04
由于 TongWeb 8.0.7.X 升级到 TongWeb 8.0.9.04 版本通信加密方式发生改变。
本章节介绍如何将主 TongWeb 和集群（节点、实例）一并升级。

# 14.2.2.1. 升级前准备
执行升级操作后，系统会自动备份 conf 和 secure 文件。
备份路径为：“${tongweb.base}/data/upgradebackup”。
为了保证升级后，数据不丢失，建议对必要文件进行手动备份。

# 14.2.2.2. 升级过程
1. 在主 TongWeb 中，进入 “集中管理” $>$ “系统管理” $>$ “产品升级” 页面，上传升级包（version*.zip）。

# 注意：
此时，不能重启主 TongWeb。
2. 进入 “服务管理” $>$ “实例” 页面，勾选所有实例，并单击列表上方的 “停止”，停止所有实例。
3. 进入 “服务管理” $>$ “节点” 页面，单击节点所在行的 “重启升级”，将所有节点重启升级。

# 注意：
在单击节点的 “重启升级” 后，页面弹出 “节点启动失败” 提示信息，刷新页面后呈现该节点为未启动状态，然而实际上节点仍处于启动状态，只是此时已与主 TongWeb 服务器断开连接。
4. 重启主 TongWeb。

# 说明：
重启主 TongWeb 后，进入 “集中管理” $>$ “服务管理” $>$ “节点”，可查看到节点处于启动状态。
5. 进入 “集中管理” > “服务管理” > “集群” 页面，单击集群所在行的 “启动”，启动所有集群。

# 说明：
启动集群时，系统会将集群管理的实例，一并升级。
6. 进入 “集中管理” $>$ “服务管理” > “实例” 页面，启动所有的独立实例。
不在集群管理范围的独立实例，需要手动单独启动：单击目标实例所在行的 “启动”，即可将独立实例升级。

# 注意事项
若需要升级单独的 TongWeb（仅启动一个 TongWeb 实例且不使用集中管理），需要手动将最新的version*.zip 包放在实例的 “${tongweb.home}” 目录下，然后重启实例。

# 14.2.2.3. TongWeb 8.0.9.04 回退到 TongWeb 8.0.7.X
由于 TongWeb 8.0.7.X 升级到 8.0.9.04 版本通信加密方式发生改变。
从 TongWeb 8.0.9.04 回退到 TongWeb 8.0.7.X 前，需要先将配置文件进行回退。

# 注意事项
若不回退配置文件，与密码相关的模块，会出现无法使用等问题。

# 前置条件
“${tongweb.home}”目录下老版本的“version*.zip”或者“version*”目录及文件没有删除和损坏。

# 操作步骤

# 1. 回退配置文件
将主 TongWeb、节点、实例的配置文件全部手动回退。
a. 关闭所有 TongWeb 相关进程。
b. 进入 “${tongweb.base}” 目录。
c. 将系统自动备份在 “${tongweb.base}/data/upgradebackup” 目录下的 conf 和 secure 文件回退。

# 2. 回退节点、集群以及实例
a. 删除升级版本的 “version*.zip” 和 “version*” 目录及文件。
b. 重新启动 TongWeb 服务器。
c. 在控制台界面对节点、集群以及实例进行重启即可。

# 说明：
若需要回退单独的 TongWeb（仅启动一个 TongWeb 实例且不使用集中管理），请参照如下操作回退：
i. 将系统自动备份到 “${tongweb.base}/data/upgradebackup” 目录的配置文件回退。
ii. 将最新版本的 “version*.zip” 和 “version*” 目录及文件删除，然后重启实例即可。

# 附录 A: 应用配置文件
在应用中可以配合 Java EE 应用中标准描述文件 web.xml 、ejb-jar.xml 等文件，通过配置 TongWeb 的自定义部署描述文件，进一步地自定义应用。
在 Web 应用中可以配置 web.xml 和 tongweb.xml。
在含有 EJB 的应用中可以配置 ejb-jar.xml、tongweb-ejb-jar.xml 或 persistence.xml。
A.1. ejb-jar.xml
<table><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>ejb-jar</td><td>EJB部署描述符的根元素，包含ejb-jar文件的可选描述、可选显示名称、可选小图标文件名、可选大图标文件名、所有包含的企业bean的必需结构信息、可选应用程序集描述符以及ejb.jar的ejb客户端jar文件的可选名称。</td></tr><tr><td>description</td><td>ejb-jar文件的描述性说明。</td></tr><tr><td>display-name</td><td>ejb-jar文件显示的名称。</td></tr><tr><td>small-icon</td><td>小图标(16x16)的名称，这个名称是在ejb-jar文件的相对路经。
文件必须是.jpg或者是gif格式，文件名必须以“.jpg”或者“.gif”为后缀。
图标可以被工具使用。</td></tr><tr><td>large-icon</td><td>大图标(32x32)的名称，这个名称是在ejb-jar文件的相对路经。
文件必须是.jpg或者是gif格式。文件名必须以“.jpg”或者“.gif”为后缀。
图标可以被工具使用。</td></tr><tr><td>enterprise-beans</td><td>该元素包含一个或多个企业bean的声明。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>session</td><td>该元素声明一个会话bean。</td></tr><tr><td>description</td><td>简短的描述。</td></tr><tr><td>display-name</td><td>会话bean通过工具将显示的名称。</td></tr><tr><td>small-icon</td><td>小图标(16x16)的名称,这个名称是在ejb-jar文件的相对路经。文件必须是.jpg或者是gif格式。文件名必须以“.jpg”或者“.gif”为后缀。图标可以被工具使用。</td></tr><tr><td>large-icon</td><td>大图标(32x32)的名称,这个名称是在ejb-jar文件的相对路经。文件必须是.jpg或者是gif格式。文件名必须以“.jpg”或者“.gif”为后缀。图标可以被工具使用。</td></tr><tr><td>ejb-name</td><td>企业bean的名称,由ejb-jar文件的编写者命名,这个名称在同一个ejb-jar文件中必须是唯一的。企业bean的代码不依赖于它,并与它隔离。所以企业bean的名称可以在应用装配的过程中改变,而不会影响企业bean的功能。在发布描述器中ejb-name与应用发布者即将分配给企业bean的home接口的JNDI的名称,没有结构性的关系。名称必须定义的有意义。</td></tr><tr><td>home</td><td>企业bean的具有完全限定名(具有完整的包名)的home接口。</td></tr><tr><td>remote</td><td>企业bean的具有完全限定名(具有完整的包名)的remote接口。</td></tr><tr><td>ejb-class</td><td>企业bean实现类的完全限定名(具有完整的包名)。</td></tr><tr><td>session-type</td><td>描述会话bean是否是有状态的会话,或者无状态会话。会话型元素必须是Stateful/Stateless其中之一。</td></tr><tr><td>transaction-type</td><td>制定是事务类型,必须是Bean/Container其中之一。</td></tr><tr><td>transaction-scope</td><td>指定企业bean是否要求在其方法中必须使用分布式事务,以确定是否可以使用本地事务优化。必须是Local/Distributed其中之一。该元素是可选的,如果未指定,则容器必须使用分布式事务。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>env-entry</td><td>企业bean的环境条目的声明。该声明由可选的描述,环境条目的名称,以及可选值组成。</td></tr><tr><td>description</td><td>简短描述。</td></tr><tr><td>env-entry-name</td><td>企业bean的环境条目名称。</td></tr><tr><td>env-entry-type</td><td>具有完全限制的企业bean代码期望得到的Java类型值。合法值:java.lang.Boolean,java.lang.String,java.lang.Integer,java.lang.Double,java.lang.Byte,java.lang.Short,java.lang.Long,java.lang Float。env-entry-value企业bean的环境条目的值。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>ejb-ref</td><td>用于引用到另一个企业bean的home声明。该声明是一个可选描述:在引用的企业bean代码中使用EJB引用名称,被引用企业bean的预期类型,被引用企业bean的预期home和remote接口以及一个可选的ejb-link信息。可选的ejb-link元素用来指定引用的企业bean,它通常用在包含组装应用程序的ejb-jar.xml文件。</td></tr><tr><td>description</td><td>简短描述。</td></tr><tr><td>ejb-ref-name</td><td>EJB引用的名称。EJB参照是企业bean环境中的一条条目。建议名称的前缀是“EJB/”。</td></tr><tr><td>ejb-ref-type</td><td>被引用的企业bean的类型。必须是Entity/Session其中之一。</td></tr><tr><td>home</td><td>企业bean的home接口的完全限定名称。</td></tr><tr><td>remote</td><td>企业bean的远程接口的完全限定名称。</td></tr><tr><td>ejb-link</td><td>指定EJB引用链接到在ejb-jar文件中的另一个企业Bean。该元素的值必须是在同一个ejb-jar文件中的企业bean,或者在同一个应用程序单元的另一个ejb-jar文件中ejb-name定义的企业bean。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>security-role-ref</td><td>在企业bean代码中安全角色引用的声明。该声明包含一个可选的描述,在代码中使用的安全角色名称,并定义安全角色的可选链接。该元素的值必须是作为参数传递给EJBContext.isCallerInRole(字符串角色名)方法的字符串。role-link元素的值必须是在该元素中定义的安全角色之一的名称。</td></tr><tr><td>description</td><td>简短的描述。</td></tr><tr><td>role-name</td><td>安全角色的名称。</td></tr><tr><td>role-link</td><td>已经定义的安全角色的连接。role-link元素的值必须是在security-role元素中定义过。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>security-identity</td><td>指定调用者的安全标识是否用于输入调用bean的方法执行,或者是否使用特定的run-as-identity。</td></tr><tr><td>description</td><td>简短的描述。</td></tr><tr><td>use-caller-identity</td><td>指定调用者的安全标识,可以用作对企业bean的方法执行的安全标识。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>run-as-specified-identity</td><td>指定run-as-identity将用于企业bean的方法的执行。</td></tr><tr><td>description</td><td>简短的描述。</td></tr><tr><td>role-name</td><td>安全角色的名称。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>resource-ref</td><td>企业bean对外部资源的引用的声明。它由可选的描述、资源工厂引用名称、企业bean代码所期望的资源工厂类型的指示和认证类型 (bean或者container) 组成。</td></tr><tr><td>description</td><td>简短的描述。</td></tr><tr><td>res-ref-name</td><td>资源工厂引用的名称。</td></tr><tr><td>res-type</td><td>数据源的类型。类型由数据源期望实现的Java接口(或类)指定。</td></tr><tr><td>res-auth</td><td>定义是由企业bean的代码作为资源管理器，还是由容器作为资源管理器。发布者可以对容器提供支持，这个元素的值必须是Application和Container中的一个。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>resource-env-ref</td><td>企业bean对与企业bean环境中的资源相关联的受管理对象的引用的声明。它由可选的描述、资源环境引用名称和企业bean代码期望的资源环境引用类型的指示组成。用于实体、消息驱动和会话。示例：jms/StockQueue javax.jms.queue。</td></tr><tr><td>description</td><td>简短的描述。</td></tr><tr><td>resource-env-ref-name</td><td>资源环境引用的名称。值是企业bean代码中使用的环境条目名称。</td></tr><tr><td>resource-env-ref-type</td><td>资源环境引用的类型。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>entity</td><td>描述entity bean。</td></tr><tr><td>description</td><td>简短的描述。</td></tr><tr><td>display-name</td><td>通过工具将显示和被引用的名称。</td></tr><tr><td>small-icon</td><td>小图标(16 x 16)的名称，这个名称是在ejb-jar文件的相对路经。文件必须是jpg或者是gif格式，文件名必须以“.jpg”或者“.gif”为后缀。图标可以被工具使用。</td></tr><tr><td>large-icon</td><td>大图标(32 x 32)的名称，这个名称是在ejb-jar文件的相对路经。文件必须是jpg或者是gif格式，文件名必须以“.jpg”或者“.gif”为后缀。图标可以被工具使用。</td></tr><tr><td>home</td><td>企业bean的具有完全限定名(具有完整的包名)的home接口。</td></tr><tr><td>remote</td><td>企业bean的具有完全限定名(具有完整的包名)的remote接口。</td></tr><tr><td>ejb-class</td><td>企业bean实现类的完全限定名(具有完整的包名)。</td></tr><tr><td>persistence-type</td><td>指定entity bean的持久性管理的类型,必须是Bean / Container其中之一。</td></tr><tr><td>prim-key-class</td><td>指定具有完全限定的entity bean的主键类的名称。
如果主键类的定义依赖发布时间,主键类元素的值应该是java.lang.Object。</td></tr><tr><td>reentrant</td><td>指定一个实体bean是否可重入。
该元素必须是True或False。</td></tr><tr><td>CMP-version</td><td>指定容器管理持久性的实体bean的版本。
合法值为1.x和2.x，默认值是2.x。</td></tr><tr><td>abstract-schema-name</td><td>指定与cmp-version 2.x实体bean对应的抽象模式名(表名),用在EJB QL 查询。
例如,实体bean类是com.acme-commerce.OrderBean,命名为OrderBeanTable。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>cmp-field</td><td>描述容器管理的字段,包括可选的字段描述和字段的名称。</td></tr><tr><td>description</td><td>简短描述。</td></tr><tr><td>field-name</td><td>指定容器管理的字段的名。
名称必须是企业bean的公共字段或者是它的超类中的公共字段。</td></tr><tr><td>primkey-field</td><td>指定容器管理的Bean的主键字段。
必须是在cmp-field元素中声明过的,类型必须和主键类一样。
如果主键映射为多个容器管理的字段(也就是说是一个复合主键),则没必要使用这个元素。
在这种情况下,主键类的字段必须是公共的,它们的名称必须与包含主键的entity bean的字段名相符合。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>query</td><td>指定查找器或选择查询。包含查询的可选描述、使用finder或select方法的规范以及EJB QL查询字符串或查询规范。</td></tr><tr><td>description</td><td>简短描述。</td></tr><tr><td>query-spec</td><td>指定finder或select查询,包含查询语义的精确描述。query-spec元素只用于指定那些在EJB QL中无法捕获语义的查询。</td></tr><tr><td>ejb-qI</td><td>定义finder或select的EJB QL查找器或选择查询字符串。此元素在查询元素的范围内定义,指定使用查询的查找程序或select方法,指定查询的实体bean的有效EJB QL查询字符串。若没有指定ejb-qI元素,则必须使用query-spec元素来指定查询的语义。</td></tr><tr><td>query-method</td><td>为finder或select查询指定方法。</td></tr><tr><td>method-name</td><td>包含企业bean的方法或使用星号(*)字符的名称。使用星号时表示企业bean的remote和home接口中的所有方法。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>method-params</td><td>包含方法参数的完全限定的Java类名的列表。</td></tr><tr><td>method-param</td><td>方法参数的完全限定的Java类名。</td></tr><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>message-driven</td><td>声明了一个消息驱动bean。</td></tr><tr><td>description</td><td>简短描述。</td></tr><tr><td>display-name</td><td>通过工具将显示和被引用的名称。</td></tr><tr><td>small-icon</td><td>小图标(16 x 16)的名称,这个名称是在ejb-jar文件的相对路经。文件必须是.jpg或者是gif格式,文件名必须以“.jpg”或者“.gif”为后缀。图标可以被工具使用。</td></tr><tr><td>large-icon</td><td>大图标(32 x 32)的名称,这个名称是在ejb-jar文件的相对路经。文件必须是.jpg或者是gif格式,文件名必须以“.jpg”或者“.gif”为后缀。图标可以被工具使用。</td></tr><tr><td>home</td><td>企业bean的具有完全限定名(具有完整的包名)的home接口。</td></tr><tr><td>remote</td><td>企业bean的具有完全限定名(具有完整的包名)的remote接口。</td></tr><tr><td>ejb-class</td><td>企业bean实现类的完全限定名(具有完整的包名)。</td></tr><tr><td>transaction-type</td><td>制定是事务类型，必须是Bean/Container其中之一。</td></tr><tr><td>transaction-scope</td><td>指定企业bean是否要求在其方法中必须使用分布式事务，以确定是否可以使用本地事务优化。
必须是 Local/Distributed 其中之一。
该元素是可选的，若未指定，则容器必须使用分布式事务。</td></tr><tr><td>jms-message selector</td><td>指定jms消息选择器，用于确定消息驱动bean将接收哪些消息。</td></tr><tr><td>jms-acknowledge-mode</td><td>指定jms AUTO_ACKNOWLEDGE或DUPS_OK_ACKNOWLEDGE消息确认语义，应用于使用bean管理的事务划分的消息驱动bean的onMessage消息。
必须 auto-acknowledge/dups-ok-acknowledge 之一。</td></tr><tr><td>message-driven-destination</td><td>消息驱动的目的地元，向部署人员提供关于消息驱动bean是用于队列还是主题的建议。
声明包括message驱动bean的预期目的地的类型。
若消息驱动bean被分配给主题，则应使用持久订阅还是非持久订阅的可选声明。</td></tr><tr><td>jms-destination-type</td><td>jms目的地的类型，例如： javax.jms.queue。</td></tr></table>

# A.2. tongweb-ejb-jar.xml
tongweb-ejb-jar.xml 是一个 EJB 的自定义配置文件，可以定义多个 ejb-deployment 节点。
每个 ejb-deployment 节点的内容都代表着一个 EJB，可以在这个自定义部署描述文件 “定制” 每一个 EJB的内容。
tongweb-ejb-jar.xml 主要是为了兼容 TongWeb7，便于应用迁移，代码如下所示。
```txt
...
< Tongweb-ejb.jar>
    <ejb-deployment ejb-name="" //ejb的名称
        <jindi name=""" ininterface=""/>></jindi> //JNDI全局资源
</ejb-deployment>
< Tongweb-ejb.jar>
...
```
tongweb-ejb-jar.xml 定义的具体属性描述，如下表所示。
• ejb-deployment 节点属性说明
<table><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>ejb-name</td><td>ejb名称，对应标准部署描述符文件（ejb.jar.xml）中的ejb-name元素。</td></tr></table>
• Jndi 属性说明
<table><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>name</td><td>定义 ejb 的接口的全局 jndi 名。</td></tr><tr><td>interface</td><td>·ejb2 中设置 home 接口名。
·ejb3 中设置 local 或者 remote 接口名。
·无接口的 ejb 直接使用 ejb 类名。</td></tr></table>
A.3. persistence.xml
<table><tr><td>元素/属性名</td><td>说明</td></tr><tr><td>persistence</td><td>持久化配置的根元素。</td></tr><tr><td>persistence-unit</td><td>(可选)数据持久化单元,包含name属性用于定义持久化单元的名称(name必选,空值也合法);transaction-type指定事务类型。</td></tr><tr><td>description</td><td>简短描述。</td></tr><tr><td>provider</td><td>(可选) javax.persistence.PersistenceProvider接口的一个实现类。</td></tr><tr><td>jta-data-source</td><td>(可选)持久化提供商使用的JTA数据源的全局JNDI名称。</td></tr><tr><td>non-jta-data-source</td><td>(可选)持久化提供商使用的non-JTA数据源的全局JNDI名称。</td></tr><tr><td>mapping-file</td><td>(可选)声明orm.xml所在位置。</td></tr><tr><td>jar-file</td><td>(可选)以包含persistence.xml的jar文件为基准的相对路径,添加额外的jar文件。</td></tr><tr><td>class</td><td>(可选)显式列出实体类,在Java SE环境中应该显式列出。</td></tr><tr><td>exclude-unlisted-classes</td><td>(可选)声明是否扫描jar文件中标注了@Entity的类加入到上下文。若不扫描,则设置成“true”。</td></tr><tr><td>properties</td><td>(可选)厂商专有属性列表。</td></tr><tr><td>property</td><td>厂商专有属性(可选),包含name和value属性。</td></tr></table>
附录 B: ServerMBean modelName
<table><tr><td>modelName</td><td>说明</td></tr><tr><td>App</td><td>应用</td></tr><tr><td>AppBackup</td><td>应用备份</td></tr><tr><td>AppRecycle</td><td>应用回收</td></tr><tr><td>AppTemplate</td><td>应用模板</td></tr><tr><td>AppUpdate</td><td>应用增量</td></tr><tr><td>Connector</td><td>通道</td></tr><tr><td>Host</td><td>虚拟主机</td></tr><tr><td>Realm</td><td>安全域</td></tr><tr><td>RealmUser</td><td>安全域用户</td></tr><tr><td>DataSource</td><td>数据源</td></tr><tr><td>FailoverDatasource</td><td>数据源集群</td></tr><tr><td>SessionHa</td><td>会话服务器</td></tr><tr><td>Lib</td><td>公共类库</td></tr><tr><td>JcaConnectionPool</td><td>JCA 连接池</td></tr><tr><td>JcaAdminObject</td><td>JCA 托管对象</td></tr><tr><td>JavaMail</td><td>JavaMail 资源</td></tr><tr><td>Sms</td><td>短信服务</td></tr><tr><td>ThreadPool</td><td>线程池</td></tr><tr><td>WorkManager</td><td>工作管理器</td></tr><tr><td>JNDIResource</td><td>JNDI 资源</td></tr><tr><td>AppDataSource</td><td>应用数据源</td></tr><tr><td>OperatingSystem</td><td>操作系统</td></tr><tr><td>Jvm</td><td>JVM</td></tr><tr><td>DeadlockedThread</td><td>死锁线程</td></tr><tr><td>BlockedThread</td><td>阻塞线程</td></tr><tr><td>BusyThread</td><td>忙碌线程</td></tr><tr><td>CombinedMonitor</td><td>组合监视</td></tr><tr><td>DaemonMonitor</td><td>守护监视</td></tr><tr><td>SnapshotTemplate</td><td>采集模板</td></tr><tr><td>SnapshotFile</td><td>快照文件</td></tr><tr><td>ThresholdStrategy</td><td>预警策略</td></tr><tr><td>StartupArgs</td><td>启动参数</td></tr><tr><td>OSGiBundle</td><td>OSGi 应用</td></tr></table>

# 附录 C: 控制台配置参数说明

# C.1. 应用管理

# C.1.1. 应用
持久化位置：conf/tongweb.xml:tongweb>server>applications>app
Table 5. 应用的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>应用名</td><td>应用的名称。为空时，使用应用文件的名称。</td></tr><tr><td>autoDeploy</td><td>自动部署</td><td>表示该应用是否是自动部署的。</td></tr><tr><td>appFrom</td><td>应用来源</td><td>部署的应用可以从客户端上传，也可以从服务器端指定的位置读取。注：出于安全考虑，TongWeb 出厂设置禁用了文件上传功能，您可在“控制台安全”模块了解详情和进行相关的配置操作。</td></tr><tr><td>filename</td><td>部署路径</td><td>服务器上应用程序的位置，通常是应用的程序包，如*.war *.ear 等 Java EE 标准类型的文件。注意：在集群环境中，请确保每个实例所在的服务器上都需放置所需的文件。</td></tr><tr><td>unpackDir</td><td>解压目录</td><td>在部署位于服务器上的 *.war 或 *.ear 文件时，指定该文件的解压目录。若配置为空，则解压到文件所在目录。</td></tr><tr><td>fromUpload</td><td>上传应用</td><td>上传一个应用文件到服务器，文件须是 *.war *.ear 等 Java EE 标准类型的文件，否则可能会导致部署失败。</td></tr><tr><td>appTemplate</td><td>应用模板</td><td>指定应用模板后，将会使用应用模板里的参数来部署应用，部署应用时指定的其他参数将会被忽略。注：若没有指定应用模板，则会尝试使用“全局配置”里的“全局应用模板”；若应用同时配置了自定义描述文件 tongweb-web.xml，则会优先使用 tongweb-web.xml 里面的配置参数。</td></tr><tr><td>springBootCompatible</td><td>SpringBoot 兼容</td><td>兼容基于 Tomcat、Jetty、Undertow 嵌入式版本开发的 SpringBoot 应用 jar。</td></tr><tr><td>contextRoot</td><td>访问前缀</td><td>指定访问此应用Web资源的根路径；若未设置，则使用应用文件的名称。注：该功能仅支持Web类型（如*.war）的应用。</td></tr><tr><td>host</td><td>虚拟主机</td><td>应用所部署到的虚拟主机，应用可共用虚拟主机提供的资源和管理控制。</td></tr><tr><td>startupPriority</td><td>启动优先级</td><td>用以约束应用的启动顺序，在服务器启动时，该值越小越优先启动。</td></tr><tr><td>refRealm</td><td>安全域</td><td>应用安全域，应用指定的安全域优先级高于虚拟主机指定的安全域；但若虚拟主机同时开启了“单点登录（SSO）”，则优先级低于虚拟主机的安全域。</td></tr></table>
Table 6. 应用的【资源加载】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>dependentApp</td><td>依赖应用</td><td>指定当前应用依赖的应用,在加载时,依赖的应用的类加载器将作为本应用类加载器的父级类加载器。</td></tr><tr><td>delegateFirst</td><td>父优先</td><td>应用的类加载顺序,父优先表示优先从服务器类路径中加载,否则优先从应用类路径中加载。</td></tr><tr><td>useEjbStandaloneLoader</td><td>使用 EJB 独立类加载器</td><td>对于 *.ear 类型的应用,当其根目录存在多个 ejb 的 jar 文件时,是否为每个 jar 文件使用独立的类加载器进行加载。注:使用 EJB 独立类加载器,通常可解决不同 ejb jar 文件中存在相同的资源而引发的资源冲突等问题。</td></tr><tr><td>forcedLoad</td><td>强制从应用加载的类</td><td>一些 JEE 规范的实现即使在关闭了父优先的情况下,仍然会从服务器类路径中加载。为了规避这个问题,在此处可指定需要强制从应用的类路径下加载的类的前缀,如 javax.ws.rs.。配置多个前缀以英文逗号分隔。注:其优先级低于“强制从 TongWeb 加载的类”。</td></tr><tr><td>forcedSkip</td><td>强制从 TongWeb 加载的类</td><td>关闭了父优先时,也可指定需要强制从TongWeb服务器的类路径下加载的类的前缀。配置多个前缀以英文逗号分隔。</td></tr><tr><td>webSocketEnabled</td><td>使用TongWeb WebSocket</td><td>设置是否使用TongWeb 服务器提供的WebSocket 功能，WebSocket 是 Java/Jakarta EE 规范定义的技术，但并不是所有的应用都需要，若应用自带了 WebSocket 的功能实现或TongWeb 提供的 WebSocket 实现对应用的运行环境造成了干扰，可尝试关闭此功能。</td></tr><tr><td>webModuleOnly</td><td>Web 兼容模式</td><td>以 Web 兼容模式加载该应用，若该应用是基于 Tomcat 等 Web 容器开发，则可以尝试打开此开关以获得更好的兼容性。开启此模式后，EJB 等企业级技术实现将不再支持，同时尝试从应用自身加载JSF、JavaMail、WebService、Xml 等企业级技术实现。</td></tr><tr><td>applplModules</td><td>加载应用实现</td><td>若应用自带 JavaEE 规范的实现，可指定从应用中加载这些实现，而不使用TongWeb 服务器的实现。</td></tr><tr><td>refLib</td><td>添加类库</td><td>给应用附加依赖库，附加的依赖库会和应用自身的类库（WEB-INF/lib、WEB-INF/classes）合并到一起由应用类加载器加载。注：若不同应用选择相同类库，类库中的类在各个应用内是彼此隔离的，应用之间不会共享类对象，如果多个应用需要在内存中共享类对象，可考虑使用“全局配置”中的“应用共享类加载器”。</td></tr><tr><td>priorityJars</td><td>加载顺序</td><td>指定需要优先加载的 jar 的文件名，指定的文件名可以是 jar 的全名称或部分名称。注：jar 的搜索范围包括应用内的“WEB-INF/lib”目录和给应用添加的所有类库。</td></tr><tr><td>reloadable</td><td>热加载</td><td>开启后，服务器会周期性（由服务器“基础配置”&gt;“全局配置”的定时任务周期指定）检测应用的 class 等文件；若发生变化，则自动全量重新加载。注：若在“性能”页签下开启资源缓存，则该功能无效。</td></tr><tr><td>addWebinfClassesResources</td><td>加载 WEB-INF 资源</td><td>开启后，服务器将“/WEB-INF/classes”视为一个解压的 JAR 资源，并会加载应用的“/WEB-INF/classes/META-INF/resources”目录下的资源。</td></tr><tr><td>loadManifestClassPath</td><td>加载 Class-Path 资源</td><td>开启后，将会根据应用根目录下的 META-INF/MANIFEST.MF 文件（Class-Path 参数）来加载更多的 jar 等文件到应用中。</td></tr><tr><td>manifestClassPathBase</td><td>Class-Path 相对目录</td><td>指定加载 Class-Path 资源时的相对目录，将会在此目录下查找和加载 Class-Path 中指定的 jar 等文件。</td></tr></table>
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>absoluteOrdering</td><td>web-fragment 绝对路径</td><td>开启该功能后，TongWeb 会将解析到的 web-fragment片段以绝对路径排序，以避免 web-fragment 因名称重复引起的冲突问题。</td></tr><tr><td>showLoadedClasses</td><td>跟踪已加载类</td><td>开启该功能后，您可以在类加载结构中查看应用已经加载过的类资源，以利于排查相关问题等。注：仅支持Web应用。</td></tr><tr><td>customClassLoader</td><td>自定义类加载器</td><td>自定义类加载器全类名，通过继承com.tongweb.ee.server.TongWebWebappClassLoader（所在 jar: ${tongweb.home}/version*/modules/ejb/tongweb-ejb.jar）用户可以自定义类加载行为。自定义类需要提供一个无参和一个java.lang.ClassLoader 参数的构造方法。注：需要在 TongWeb 启动前将包含自定义类加载器的 jar 放到 ${tongweb.base}/lib 目录下。</td></tr><tr><td>customClass</td><td>Class 自定义解析</td><td>指定一个自定义解析类的全类名，以在解析应用的类文件时执行自定义解析操作。该类需实现com.tongweb.ext.classfile.ClassCustom 接口（所在 jar: ${tongweb.home}/version*/tongweb-web.jar）。注：需在 TongWeb 启动之前，将包含 Class 自定义解析类所在的 jar 文件放置到 ${tongweb.base}/lib 下。</td></tr><tr><td>docBases</td><td>虚拟目录</td><td>设置应用的虚拟目录，可以将应用文件夹之外的jsp、html 等资源文件加载到应用内部，作为应用的一部分。虚拟目录中的资源加载优先级高于应用文件夹本身。配置内容格式为 key=value，多个目录以英文逗号分隔。key 为资源请求路径的前缀，必须以 / 开头，value为绝对路径的真实存在的目录。示例：/page=/opt，/opt目录中存在 jsp/a.jsp，此时资源的访问路径为：http://ip:port/app/page/jsp/a.jsp。</td></tr><tr><td>archiveIndexStrategy</td><td>资源加载策略</td><td>设置加载应用的类库等资源所使用的索引策略。SIMPLE：在应用启动时，为资源文件创建索引。BLOOM：使用布隆过滤器来优化索引。PURGED：使用布隆过滤器来加速归档文件的查找，并在运行时可以进行清除操作。</td></tr><tr><td>sessionCookieName</td><td>会话的Cookie名</td><td>指定应用会话的Cookie名称。注：若应用的web.xml中同样设置了该属性，则优先使用web.xml中的值。若以上两处都没有设置，则使用默认的JSESSIONID作为名称。</td></tr><tr><td>useLegacyCookieProcessor</td><td>使用老版Cookie处理器</td><td>使用老版Cookie处理器，是基于RFC6265、RFC2109、RFC2616的，开启后可兼容基于Tomcat 8以前版本开发的应用。</td></tr><tr><td>allowEqualsInValue</td><td>Cookie Equal Signs</td><td>如果是true，则在解析未加引号的Cookie值时允许使用等号字符。如果是false，当遇到等号时，包含等号的Cookie值将被终止，并且剩余的Cookie值将被删除。</td></tr><tr><td>allowHttpSepsInV0</td><td>HTTP分隔符</td><td>如果是true，则允许在Cookie名称和值中使用HTTP分隔符。</td></tr><tr><td>useHttpOnly</td><td>Cookie HttpOnly</td><td>会话Cookie是否使用HttpOnly标志。</td></tr><tr><td>sameSiteCookies</td><td>Cookie SameSite</td><td>设置Cookie的SameSite属性。Unset：不要设置SameSiteCookie属性；None：Cookie始终在跨站点请求中发送；Lax：Cookie仅在同站点请求和跨站点顶级导航GET请求上发送；Strict：防止浏览器在所有跨站点请求中发送cookie。</td></tr><tr><td>maxActiveSessions</td><td>最大会话数</td><td>限制该应用同时在线的最大会话数，以防止会话过大导致系统瘫痪。设置为“-1”表示不限制。</td></tr><tr><td>sessionTimeout</td><td>会话超时时间</td><td>设置应用会话(Session)的超时时间（单位：分钟）。</td></tr><tr><td>localPersistence</td><td>本地持久化</td><td>开启后，应用在停止时会将当前内存中的会话持久化存储到本地，如文件系统，并在启动后重新载入内存。本地持久化为异步进行，受“全局配置”中“定时任务周期”影响，若TongWeb进程被强杀（如执行了forcestop脚本）则最多会丢失最近一个“定时任务周期”内写入的会话数据。</td></tr><tr><td>refSessionHa</td><td>会话服务器</td><td>选择应用要连接的会话服务器，将应用的Session存储到会话服务器。其优先级高于虚拟主机设置的会话服务器；但若虚拟主机同时开启了“Session共享”则优先级低于虚拟主机的会话服务器。注：当由于网络等原因导致会话服务器不可用时，应用的Session仍会在本地内存中存取，不会中断应用的业务处理。</td></tr><tr><td>disableSessionInvalida date</td><td>禁用会话注销</td><td>开启后，应用调用session invalidate时会话不再销毁，后续依靠自动过期机制销毁会话。</td></tr></table>
Table 7. 应用的【会话与Cookie】
Table 8. 应用的【JSP】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>jspDevelopment</td><td>开启 JSP 开发模式</td><td>开启 JSP 开发模式后，当有 JSP 文件更新时，这些文件会在 5 秒左右的时间内重新加载以生效。注意：若开启了资源缓存，生效时间会在资源的缓存时长之后。</td></tr><tr><td>mappedFile</td><td>Mapped File</td><td>在 JSP 翻译成 Servlet 时，是否为 JSP 文件中的每个HTML 文本行生成“out.print()”，若关闭，则将来自多行的 HTML 文本连接起来一起输出到一个“out.print()”中。此功能的主要用途是简化调试。</td></tr><tr><td>quoteAttributeEL</td><td>Quote Attribute EL</td><td>指定当在 JSP 属性值中使用 EL（Expression Language）时，JSP.1.6 中描述的属性引用规则是否应适用于表达式。</td></tr><tr><td>strictQuoteEscaping</td><td>Strict QuoteEscaping</td><td>JSP.1.6 是否严格适用于使用 scriptlet 表达式定义的属性。</td></tr><tr><td>strictWhiteSpace</td><td>Strict White Space</td><td>是否严格对属性名称前的空白进行校验，如果为 false，则放宽要求，这样缺少空白就不会导致错误。</td></tr><tr><td>enablePooling</td><td>使用标签池</td><td>是否使用标签池处理 JSP 标签。</td></tr><tr><td>jspPrecompile</td><td>JSP 预编译</td><td>开启后，在应用部署成功时立即进行 JSP 编译，不开启则在 JSP 首次被访问时才进行编译。注：JSP 预编译是异步进行的，不会影响部署流程。</td></tr><tr><td>jspPrecompileThreadCount</td><td>预编译线程数</td><td>指定预编译的线程数。为了提高 JSP 预编译的效率，预编译采用多线程模式，可以同时编译多个 JSP 文件。</td></tr></table>
Table 9. 应用的【编码】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>requestCharacterEncoding</td><td>应用请求编码</td><td>应用程序的默认 HTTP 请求编码。</td></tr><tr><td>responseCharacterEncoding</td><td>应用响应编码</td><td>应用程序的默认 HTTP 响应体编码。</td></tr><tr><td>javaEncoding</td><td>JSP 文件编码</td><td>指定 JSP 文件编码。</td></tr><tr><td>fileEncoding</td><td>静态文件编码</td><td>使用指定的编码解析应用的文件资源，如“*.html”等静态资源，可用于解决文件编码和 Jvm 默认编码不一致引起的乱码问题。</td></tr></table>
Table 10. 应用的【性能】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>slowThreadEnabled</td><td>慢线程检测</td><td>慢线程检测功能可探测执行超时的请求，并能够自动中断执行的线程，以提高资源的利用效率。</td></tr><tr><td>threshold</td><td>阻塞阈值</td><td>线程处理应用业务的时间（从接收到客户端的请求开始计算）超过该阈值（单位：毫秒）后将会记录一条慢线程检测告警日志。注：此值建议不要小于“全局配置”模块里的“定时任务周期”参数值，否则发现慢线程会不及时。</td></tr><tr><td>interruptThreadThreshold</td><td>中断阈值</td><td>线程处理应用业务的时间超过该阈值（单位：毫秒）后将被尝试中断，该时间从接收到客户端的请求开始计算，其值不支持小于阻塞阈值。0表示不中断。</td></tr><tr><td>cachingAllowed</td><td>开启资源缓存</td><td>缓存应用的资源文件，以提高应用服务的响应效率。注：“热加载”与“资源缓存”同时开启时，文件删除后会出现文件找不到异常，请合理开启两个选项！</td></tr><tr><td>cacheMaxSize</td><td>最大缓存大小</td><td>缓存的最大允许缓存大小（KB）。</td></tr><tr><td>cacheObjectMaxSize</td><td>可缓存的单文件大小上限</td><td>缓存中允许单个文件的最大值（KB），超出该大小的文件不进行缓存。</td></tr><tr><td>cacheTtl</td><td>缓存时长</td><td>缓存条目的过期时间（秒），0表示在应用配置更新之前永不过期。</td></tr><tr><td>forceCache</td><td>强制缓存</td><td>开启后，会将.class、jar等二进制文件也进行缓存，否则只会缓存.html、.js等文本类资源。</td></tr><tr><td>expiresFilterEnabled</td><td>客户端资源缓存</td><td>为HTTP响应添加Expires和Cache-Control头信息，以此控制客户端对资源的缓存行为。</td></tr><tr><td>ExpiresFilterInitPara m</td><td>缓存时间规则</td><td>配置资源的缓存时间规则，如ExpiresDefault、ExpiresByType等。</td></tr><tr><td>expireFilterUrlPatterns</td><td>资源匹配规则</td><td>设置对哪些资源进行客户端缓存控制。</td></tr><tr><td>preloadResource</td><td>资源预加载</td><td>开启后，首次部署应用时会将需要加载的资源存储到 ${tongweb.base}/app_resource_cache_index 目录下，在下次启动或重新部署时会进行异步预先加载，以加快应用的部署速度。</td></tr><tr><td>preCompress</td><td>资源预压缩</td><td>对静态资源进行预先压缩（默认使用 Gzip 压缩），以获得最佳性能。注：此功能开启后将忽略通道的压缩配置。</td></tr><tr><td>forcedContainerHandling</td><td>强制从 TongWeb 加载的静态资源</td><td>应用中的某些静态资源被应用内部的三方框架处理时，可能会有性能方面的影响，此时可以通过指定其强制从 TongWeb 加载以提升部分性能。</td></tr><tr><td>staticUrlPatterns</td><td>URL 模式</td><td>指定哪些静态资源URL，强制由容器处理，具体写法参考应用web.xml中的写法，*号用-来替换，多个用英文逗号隔开。</td></tr></table>
Table 11. 应用的【安全】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enableCORSAccess</td><td>允许跨域访问</td><td>通过为资源实现W3C的CORS（跨域资源共享）规范来启用客户端跨域请求。</td></tr><tr><td>corsAllowedOrigins</td><td>允许的源</td><td>设置允许跨域访问的源，配置多个源使用英文逗号分隔，例如http://www.xxx.com, http://www.zzz.com。注：设置为“*”表示所有源都允许。</td></tr><tr><td>corsAllowedMethods</td><td>允许的方法</td><td>允许跨域访问的方法，默认支持GET, POST, HEAD, OPTIONS。配置多个方法以英文逗号分隔，例如GET, POST, HEAD, OPTIONS。</td></tr><tr><td>corsAllowedHeaders</td><td>允许的 HTTP 头</td><td>允许的 HTTP 头，XMLHttpRequest 对象的getResponseHeader() 方法拿到的基本字段，默认支持Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers，配置多个 HTTP 头以英文逗号分隔。</td></tr><tr><td>corsExposedHeaders</td><td>暴露 HTTP 头</td><td>通过 Access-Control-Expose-Headers 暴露指定的 HTTP 头,Access-Control-Expose-Headers 标头指示哪些标头可以安全地公开给 CORS API 规范的 API。注:配置多个 HTTP 头以英文逗号分隔。</td></tr><tr><td>corsSupportCredentials</td><td>支持凭证</td><td>CORS 请求默认不发送 Cookie 和 HTTP 认证信息。若需要把 Cookie 发到服务器,则设置为 “true”,默认为 “false”。</td></tr><tr><td>corsPreflightMaxAge</td><td>预检请求的有效期</td><td>用来指定本次预检请求的有效期(单位:秒)。在此期间,不用发出另一条预检请求,默认值 1800 秒。</td></tr><tr><td>requestParametersLastValidation</td><td>参数防丢失</td><td>开启该功能后,若请求参数解析期间出现故障(如请求参数个数超过了设置的阈值或 POST 数据的大小超过了设置的阈值等),系统将拒绝请求,以确保客户端提交的参数值不会丢失。</td></tr><tr><td>XSSFilterEnabled</td><td>XSS 攻击拦截</td><td>拦截可疑的 XSS 攻击请求,通常是含有 script、&lt;、&gt; 等特殊标记的请求,以 403 响应码返回到客户端。</td></tr><tr><td>csrFPrevention</td><td>CSRF 防护</td><td>注意:请谨慎打开此功能,否则可能导致应用无法访问! ! 为 Web 应用提供基本的 CSRF 防护支持,该功能需要应用自身予以配合:调用HttpServletResponse#printencodeRedirectURL(String)和HttpServletResponse#printencodeURL(String) 方法(每执行一次则产生一个新的令牌,当 CSRF 令牌缓存数设置为 0 时,一个会话只产生一个令牌)编码 URL 后发送到客户端,其目的是要发送回服务器的URL都带有csrf_token参数以认证身份。编码后的 URL 示例:/myservlet/myres?param=val&amp;csrf_token=...。TongWeb 的 CSRF 防护同时可以阻挡重放攻击,只要不将 CSRF 令牌缓存数设置为 0 即可。</td></tr><tr><td>csrFCacheSize</td><td>CSRF 令牌缓存数</td><td>CSRF 令牌会随着客户端请求而更新,CSRF 令牌缓存数表示保留最新的令牌个数,这同时也表示允许的客户端并发数。0 表示不限制。</td></tr><tr><td>tokenValidTimes</td><td>CSRF令牌有效次</td><td>提供CSRF令牌循环使用支持,使用次数超出有效次后会自动失效,可用于资源需要重复访问而不支持及时更新CSRF令牌等场景。注意:1. CSRF令牌允许循环使用时,将无法阻挡重放攻击;2.该功能仅在“CSRF令牌缓存数”不为0时有效。</td></tr><tr><td>csrftEntryPoints</td><td>CSRF免防入口</td><td>开启CSRF防护后,可选设置一些免防入口(应用URL),如登录资源,以跳过防护检查。设置多个入口时,使用英文逗号分隔。</td></tr><tr><td>httpHeaderToken</td><td>REST支持</td><td>开启了CSRF防护的应用,将无法使用REST接口,原因是REST接口无法通过URL传递令牌,开启“REST支持”可解决该问题。开启“REST支持”需要应用自身予以配合:1.客户端须首先请求免防资源,服务器通过响应头返回令牌;2.客户端请求其它资源须通过请求头(名为:csrftoken)回传服务器令牌,以通过服务器的安全认证。</td></tr><tr><td>secretLevel</td><td>应用密级</td><td>设置本应用的保密等级,此保密等级将用于应用数据网络传输、主体数据存取、客体请求访问等过程的加密处理。</td></tr><tr><td>threadPoolPolicy</td><td>业务安全规则</td><td>1(单线程池):使用通道内置的线程池处理所有业务;2(双线程池):符合规则的业务由线程池处理,其它业务由通道内置的线程池处理;3(三线程池):符合规则的业务由线程池处理,其它业务由其它线程池处理。线程池不会作用的范围:由服务器处理的静态资源、支持异步Servlet处理的业务。注意:对于使用了异步Filter的业务,请谨慎或不要使用线程池功能。注意:若业务处理时间过长(如超过30秒),则建议增大线程超时阈值,否则可能导致请求失败!</td></tr><tr><td>threadPool</td><td>线程池</td><td>线程池功能可将指定的业务交给指定的线程池来处理,可支持应用根据业务的重要性、优先级等方面约束系统资源的使用。该功能一般适用于并且只建议应用于比较耗时的业务操作,例如长事务、远程服务调用等。</td></tr><tr><td>threadPoolTimeout</td><td>线程超时阈值</td><td>业务处理时长达到该阈值后,响应结果将即刻发送回客户端,而不再等待线程处理结束,这会提高整体的响应效率,但可能导致客户端没有获取到最终的处理结果。单位是毫秒,0表示使用通道的异步请求的默认超时。</td></tr><tr><td>taskRule</td><td>匹配规则</td><td>指定需要线程池执行的业务的匹配规则,其格式须是匹配URL的正则表达式。不指定则表示可接受所有业务。注:业务的匹配规则是基于请求的Servlet路径,而不包含应用的访问名。</td></tr><tr><td>exclusionRule</td><td>排除规则</td><td>指定需要线程池从匹配规则中要排除的业务规则,其格式须是匹配URL的正则表达式。不指定则表示不排除。注:业务的匹配规则是基于请求的Servlet路径,而不包含应用的访问名。</td></tr><tr><td>otherThreadPool</td><td>其它线程池</td><td>当使用三线程池策略时,符合规则的业务由线程池处理,其它业务由其它线程池处理。</td></tr><tr><td>otherThreadPoolTimeout</td><td>其它线程超时阈值</td><td>其它业务处理时长达到该阈值后,响应结果将即刻发送回客户端,而不再等待线程处理结束,这会提高整体的响应效率,但可能导致客户端没有获取到最终的处理结果。单位是毫秒,0表示使用通道的异步请求的默认超时。</td></tr><tr><td>semaphoreEnabled</td><td>并发安全控制</td><td>出于安全等考虑,控制访问应用的并发量。</td></tr><tr><td>concurrency</td><td>限制最大并发</td><td>允许的最大并发访问量。</td></tr><tr><td>block</td><td>阻塞等待</td><td>当应用达到最大并发访问量时,是否阻塞等待访问应用。若不等待,请求会被终止,并记录一条日志。</td></tr><tr><td>interruptible</td><td>允许中断阻塞</td><td>当请求线程在阻塞等待访问应用时,是否允许被中断,若被中断则请求会被终止,并记录一条日志。</td></tr><tr><td>restrictedPorts</td><td>限定访问端口</td><td>限定访问端口后,只有指定的端口可以访问本应用,其它端口的访问会被拒绝,不指定则表示不限制。可用于支持系统应用、重要应用、普通应用的端口隔离式的安全访问,并可通过设置不同端口的资源大小来约束不同应用的业务处理效率。注意:该功能只适用于Web应用,对于远程访问的EJB应用无效,如需限制远程EJB的访问,则可在"EJB http协议"模块进行相关设置。</td></tr><tr><td>crossContext</td><td>允许跨应用访问</td><td>指定是否允许调用ServletContext.getContext("/appName")方法访问此服务器中其他Web应用程序的上下文。</td></tr><tr><td>unloadDelay</td><td>卸载等待</td><td>卸载应用时，若存在请求未处理完毕，则等待一段时间（单位：秒），超时后会强制卸载，此时会给出线程泄漏的警告日志。</td></tr><tr><td>allowLinking</td><td>允许链接文件</td><td>是否允许使用软链接访问应用的资源文件。</td></tr><tr><td>clearReferences</td><td>内存泄漏检测</td><td>在应用停止时，检查并尝试回收与应用相关联的可能导致内存泄漏的JDBC驱动、线程、线程局部变量（ThreadLocal）、Java序列化对象缓存、RMI目标对象等资源。</td></tr><tr><td>enableRecycling</td><td>应用回收</td><td>启用后，应用卸载时将备份到回收站，可在应用回收列表查看。</td></tr></table>
Table 12. 应用的【SHTML】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>shtmlEnabled</td><td>支持 shtml</td><td>shtml 是在 html 静态页面中使用指令以分块动态生成内容。</td></tr><tr><td>virtualWebappRelativeve</td><td>相对应用目录</td><td>shtml 里的指令路径是否按相对于应用的根目录处理。</td></tr><tr><td>allowExec</td><td>允许执行命令</td><td>是否允许在 shtml 里执行本地命令，取决于具体的应用。请谨开启，这可能会带来一定的风险。</td></tr><tr><td>expires</td><td>过期时间</td><td>设置 shtml 页面在 http 协议响应头里的过期时间（单位：秒），0 表示不设置。</td></tr><tr><td>urlPatterns</td><td>URL 类型</td><td>指定对哪些类型的 URL 请求进行 shtml 处理，多种类型以英文逗号分隔，建议的配置为“.shtml,.html”。</td></tr></table>
Table 13. 应用的【其它】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>webAppVersion</td><td>应用版本</td><td>指定应用的版本，访问前缀相同的应用以版本号区分形成多版本应用，当应用有多个版本时，访问时按版本号字典排序排在最后的应用对外提供服务。若存在会话在老版本的应用上尚未处理完毕，则继续使用老版本应用的服务。注：该功能仅支持Web类型（如*.war）的应用。</td></tr><tr><td>useRelativeRedirects</td><td>使用相对地址重定向</td><td>打开此开关后,应用在重定向的时候会使用相对路径,否则使用绝对路径。注:该开关在 HTTP/1.0 下无效,可搭配“强制使用相对地址重定向”来尝试解决问题。</td></tr><tr><td>forceUseRelativeRedircts</td><td>强制使用相对地址重定向</td><td>打开此开关后,即使在 HTTP/1.0 协议中,也可以使用相对地址进行重定向。</td></tr><tr><td>allowCasualMultipartParsing</td><td>强制解析 Multipart请求</td><td>即使目标 Servlet 未指定 @MulitpartConfig 注解或没有在 web.xml 中配置 &lt;multipart-config&gt; 元素,也允许解析 multipart/form-data 请求。</td></tr><tr><td>allowOverride Conte ntType</td><td>允许覆写ContentType</td><td>当响应头的 ContentType 已设置时,是否允许对其进行重写修改。</td></tr><tr><td>enableStatelessPool Monitor</td><td>监视无状态会话 Bean</td><td>开启后,可监视到应用中包含到所有无状态会话 Bean 的实例池使用情况,当应用中包含的无状态会话 Bean 数量太多时不建议开启。</td></tr><tr><td>jarScannerImpl</td><td>自定义 jar 扫描器</td><td>可以通过设置自定义 jar 扫描器,来自主决定 jar 包内 Class 文件的扫描操作,例如 Liferay Portal 应用通常需要进行这个设置。</td></tr><tr><td>useDirectionalScanni ng</td><td>使用定向扫描</td><td>使用定向扫描时,TongWeb 会从指定的文件中获悉需要扫描的 jar 和 class 文件,而不再全局扫描应用,这通常可提升应用的加载效率。</td></tr><tr><td>servletAnnotationDe clarificationFile</td><td>Servlet 注解声明文件</td><td>指向应用中的一个 Properties 文件,以 / 开头,如“/WEB-INF/classes/annotation.properties”,在该文件中指定标注了 Servlet Web 注解(@WebServlet、@WebFilter、@WebListener)的类名及其所在的文件,格式:com/app/MyClass1.class=test1.jar;com/app/MyClass2.class=classes,若以“.jar”结尾,则可省略路径和jar文件名上的版本号部分。</td></tr><tr><td>applicationPropertiesFile</td><td>SpringBoot 主资源文件</td><td>指定 SpringBoot 主资源文件在应用中的位置,以 / 开头,如“/WEB-INF/classes/application.properties”,TongWeb 将从中获取 “spring.mainsources” 参数的类名,并尝试从 /WEB-INF/classes 目录扫描其上标注的Servlet Web 注解。</td></tr><tr><td>raPros</td><td>Connector 应用属性</td><td>Connector 应用的属性列表。</td></tr><tr><td>pkgCompatible</td><td>命名空间兼容</td><td>开启后，可支持同时部署 javax 和 jakarta 命名空间的应用。特别注意：对于目录部署的应用，在应用的命名空间和当前 TongWeb 的命名空间不一致时，应用的相关文件可能会被修改，请谨慎使用。</td></tr><tr><td>addResponseHeader</td><td>附加响应头</td><td>该功能允许服务器在HTTP响应中附加自定义头部信息。优先级：应用的优先级高于通道，通道优先级高于全局配置。</td></tr></table>

# C.1.2. 应用模板
持久化位置：conf/tongweb.xml:tongweb>server>apptemplates>apptemplate
Table 14. 应用模板的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>模板名</td><td>指定应用模板的名称，唯一标识，便于识别该模板的用途。</td></tr><tr><td>springBootCompatible</td><td>SpringBoot 兼容</td><td>兼容基于 Tomcat、Jetty、Undertow 嵌入式版本开发的 SpringBoot 应用 jar。</td></tr><tr><td>autoDeploy</td><td>自动部署</td><td>表示该应用是否是自动部署的。</td></tr><tr><td>host</td><td>虚拟主机</td><td>应用所部署到的虚拟主机，可共用虚拟主机提供的资源和管理控制。</td></tr><tr><td>startupPriority</td><td>启动优先级</td><td>用以约束应用的启动顺序，在服务器启动时，该值越小越优先启动。</td></tr><tr><td>refRealm</td><td>安全域</td><td>应用安全域，应用指定的安全域优先级高于虚拟主机指定的安全域；但若虚拟主机同时开启了“单点登录（SSO）”，则优先级低于虚拟主机的安全域。</td></tr><tr><td>unpackDir</td><td>解压目录</td><td>在部署位于服务器上的 *.war 或 *.ear 文件时，指定该文件的解压目录。若配置为空，则解压到文件所在目录。</td></tr></table>
Table 15. 应用模板的【资源加载】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>dependentApp</td><td>依赖应用</td><td>指定当前应用依赖的应用，在加载时，依赖的应用的类加载器将作为本应用类加载器的父级类加载器。</td></tr><tr><td>delegateFirst</td><td>父优先</td><td>应用的类加载顺序，父优先表示优先从服务器类路径中加载，否则优先从应用类路径中加载。</td></tr><tr><td>useEjbStandaloneLoader</td><td>使用 EJB 独立类加载器</td><td>对于 *.ear 类型的应用，当其根目录存在多个 ejb 的 jar 文件时，是否为每个 jar 文件使用独立的类加载器进行加载。注：使用 EJB 独立类加载器，通常可解决不同 ejb jar 文件中存在相同的资源而引发的资源冲突等问题。</td></tr><tr><td>forcedLoad</td><td>强制从应用加载的类</td><td>一些 JEE 规范的实现即使在关闭了父优先的情况下，仍然会从服务器类路径中加载。为了规避这个问题，在此处可指定需要强制从应用的类路径下加载的类的前缀，如 javax.ws.rs.。配置多个前缀以英文逗号分隔。注：其优先级低于“强制从 TongWeb 加载的类”。</td></tr><tr><td>forcedSkip</td><td>强制从 TongWeb 加载的类</td><td>关闭了父优先时，也可指定需要强制从 TongWeb 服务器的类路径下加载的类的前缀。配置多个前缀以英文逗号分隔。</td></tr><tr><td>webSocketEnabled</td><td>使用 TongWeb WebSocket</td><td>设置是否使用 TongWeb 服务器提供的 WebSocket 功能，WebSocket 是 Java/Jakarta EE 规范定义的技术，但并不是所有的应用都需要，若应用自带了 WebSocket 的功能实现或 TongWeb 提供的 WebSocket 实现对应用的运行环境造成了干扰，可尝试关闭此功能。</td></tr><tr><td>webModuleOnly</td><td>Web 兼容模式</td><td>以 Web 兼容模式加载该应用，若该应用是基于 Tomcat 等 Web 容器开发，则可以尝试打开此开关以获得更好的兼容性。开启此模式后，EJB 等企业级技术实现将不再支持，同时尝试从应用自身加载JSF、JavaMail、WebService、Xml 等企业级技术实现。</td></tr><tr><td>applImplModules</td><td>加载应用实现</td><td>若应用自带 JavaEE 规范的实现，可指定从应用中加载这些实现，而不使用 TongWeb 服务器的实现。</td></tr><tr><td>refLib</td><td>添加类库</td><td>给应用附加依赖库，附加的依赖库会和应用自身的类库（WEB-INF/lib、WEB-INF/classes）合并到一起由应用类加载器加载。注：若不同应用选择相同类库，类库中的类在各个应用内是彼此隔离的，应用之间不会共享类对象，如果多个应用需要在内存中共享类对象，可考虑使用“全局配置”中的“应用共享类加载器”。</td></tr><tr><td>priorityJars</td><td>加载顺序</td><td>指定需要优先加载的jar的文件名,指定的文件名可以是jar的全名称或部分名称。注:jar的搜索范围包括应用内的“WEB-INF/lib”目录和给应用添加的所有类库。</td></tr><tr><td>reloadable</td><td>热加载</td><td>开启后,服务器会周期性(由服务器“基础配置”&gt;“全局配置”的定时任务周期指定)检测应用的class等文件;若发生变化,则自动全量重新加载。注:若在“性能”页签下开启资源缓存,则该功能无效。</td></tr><tr><td>addWebinfClassesRe sources</td><td>加载WEB-INF资源</td><td>开启后,服务器将“/WEB-INF/classes”视为一个解压的JAR资源,并会加载应用的“/WEB-INF/classes/META-INF/resources”目录下的资源。</td></tr><tr><td>loadManifestClassPa th</td><td>加载Class-Path资源</td><td>开启后,将会根据应用根目录下的META-INF/MANIFEST.MF文件(Class-Path参数)来加载更多的jar等文件到应用中。</td></tr><tr><td>manifestClassPathBa se</td><td>Class-Path相对目录</td><td>指定加载Class-Path资源时的相对目录,将会在此目录下查找和加载Class-Path中指定的jar等文件。</td></tr><tr><td>absoluteOrdering</td><td>web-fragment绝对路径</td><td>开启该功能后,TongWeb会将解析到的web-fragment片段以绝对路径排序,以避免web-fragment因名称重复引起的冲突问题。</td></tr><tr><td>showLoadedClasses</td><td>跟踪已加载类</td><td>开启该功能后,您可以在类加载结构中查看应用已经加载过的类资源,以利于排查相关问题等。注:仅支持Web应用。</td></tr><tr><td>customClassLoader</td><td>自定义类加载器</td><td>自定义类加载器全类名,通过继承com.tongweb.ee.server.TongWebWebappClassLoader(所在jar: ${tongweb.home}/version*/modules/ejb/tongweb-ejb.jar)用户可以自定义类加载行为。自定义类需要提供一个无参和一个java.lang.ClassLoader参数的构造方法。注:需要在TongWeb启动前将包含自定义类加载器的jar放到${tongweb.base}/lib目录下。</td></tr><tr><td>customClass</td><td>Class 自定义解析</td><td>指定一个自定义解析类的全类名，以在解析应用的类文件时执行自定义解析操作。该类需实现com.tongweb.ext.classfile.ClassCustom 接口（所在 jar: ${tongweb.home}/version*/tongweb-web.jar）。注：需在 TongWeb 启动之前，将包含 Class 自定义解析类所在的 jar 文件放置到 ${tongweb.base}/lib 下。</td></tr><tr><td>docBases</td><td>虚拟目录</td><td>设置应用的虚拟目录，可以将应用文件夹之外的jsp、html 等资源文件加载到应用内部，作为应用的一部分。虚拟目录中的资源加载优先级高于应用文件夹本身。配置内容格式为 key=value，多个目录以英文逗号分隔。key 为资源请求路径的前缀，必须以 / 开头，value为绝对路径的真实存在的目录。示例：/page=/opt，/opt目录中存在 jsp/a.jsp，此时资源的访问路径为：http://ip:port/app/page/jsp/a.jsp。</td></tr><tr><td>archiveIndexStrategy</td><td>资源加载策略</td><td>设置加载应用的类库等资源所使用的索引策略。SIMPLE：在应用启动时，为资源文件创建索引。BLOOM：使用布隆过滤器来优化索引。PURGED：使用布隆过滤器来加速归档文件的查找，并在运行时可以进行清除操作。</td></tr></table>
Table 16. 应用模板的【会话与Cookie】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>sessionCookieName</td><td>会话的Cookie名</td><td>指定应用会话的Cookie名称。注：若应用的web.xml中同样设置了该属性，则优先使用web.xml中的值。若以上两处都没有设置，则使用默认的JSESSIONID作为名称。</td></tr><tr><td>useLegacyCookieProcessor</td><td>使用老版Cookie处理器</td><td>使用老版Cookie处理器，是基于RFC6265、RFC2109、RFC2616的，开启后可兼容基于Tomcat 8以前版本开发的应用。</td></tr><tr><td>allowEqualsInValue</td><td>Cookie Equal Signs</td><td>如果是true，则在解析未加引号的Cookie值时允许使用等号字符。如果是false，当遇到等号时，包含等号的Cookie值将被终止，并且剩余的Cookie值将被删除。</td></tr><tr><td>allowHttpSepsInV0</td><td>HTTP分隔符</td><td>如果是true，则允许在Cookie名称和值中使用HTTP分隔符。</td></tr><tr><td>useHttpOnly</td><td>Cookie HttpOnly</td><td>会话Cookie是否使用 HttpOnly标志。</td></tr><tr><td>sameSiteCookies</td><td>Cookie SameSite</td><td>设置Cookie的SameSite属性。Unset:不要设置SameSiteCookie属性;None:Cookie始终在跨站点请求中发送;Lax:Cookie仅在同站点请求和跨站点顶级导航GET请求上发送;Strict:防止浏览器在所有跨站点请求中发送cookie。</td></tr><tr><td>maxActiveSessions</td><td>最大会话数</td><td>限制该应用同时在线的最大会话数,以防止会话过大导致系统瘫痪。设置为“-1”表示不限制。</td></tr><tr><td>sessionTimeout</td><td>会话超时时间</td><td>设置应用会话(Session)的超时时间(单位:分钟)。</td></tr><tr><td>localPersistence</td><td>本地持久化</td><td>开启后,应用在停止时会将当前内存中的会话持久化存储到本地,如文件系统,并在启动后重新载入内存。本地持久化为异步进行,受“全局配置”中“定时任务周期”影响,若TongWeb进程被强杀(如执行了forcestop脚本)则最多会丢失最近一个“定时任务周期”内写入的会话数据。</td></tr><tr><td>refSessionHa</td><td>会话服务器</td><td>选择应用要连接的会话服务器,将应用的Session存储到会话服务器。其优先级高于虚拟主机设置的会话服务器;但若虚拟主机同时开启了“Session共享”则优先级低于虚拟主机的会话服务器。注:当由于网络等原因导致会话服务器不可用时,应用的Session仍会在本地内存中存取,不会中断应用的业务处理。</td></tr><tr><td>disableSessionInvalid date</td><td>禁用会话注销</td><td>开启后,应用调用session invalidate时会话不再销毁,后续依靠自动过期机制销毁会话。</td></tr></table>
Table 17. 应用模板的【JSP】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>jspDevelopment</td><td>开启 JSP 开发模式</td><td>开启 JSP 开发模式后，当有 JSP 文件更新时，这些文件会在 5 秒左右的时间内重新加载以生效。注意：若开启了资源缓存，生效时间会在资源的缓存时长之后。</td></tr><tr><td>mappedFile</td><td>Mapped File</td><td>在 JSP 翻译成 Servlet 时，是否为 JSP 文件中的每个HTML 文本行生成“out.print()”，若关闭，则将来自多行的 HTML 文本连接起来一起输出到一个“out.print()”中。此功能的主要用途是简化调试。</td></tr><tr><td>quoteAttributeEL</td><td>Quote Attribute EL</td><td>指定当在JSP属性值中使用EL(Expression Language)时,JSP.1.6中描述的属性引用规则是否应适用于表达式。</td></tr><tr><td>strictQuoteEscaping</td><td>Strict QuoteEscaping</td><td>JSP.1.6是否严格适用于使用scriptlet表达式定义的属性。</td></tr><tr><td>strictWhiteSpace</td><td>Strict White Space</td><td>是否严格对属性名称前的空白进行校验,如果为false,则放宽要求,这样缺少空白就不会导致错误。</td></tr><tr><td>enablePooling</td><td>使用标签池</td><td>是否使用标签池处理JSP标签。</td></tr><tr><td>jspPrecompile</td><td>JSP预编译</td><td>开启后,在应用部署成功时立即进行JSP编译,不开启则在JSP首次被访问时才进行编译。注:JSP预编译是异步进行的,不会影响部署流程。</td></tr><tr><td>jspPrecompileThreadCount</td><td>预编译线程数</td><td>指定预编译的线程数。为了提高JSP预编译的效率,预编译采用多线程模式,可以同时编译多个JSP文件。</td></tr></table>
Table 18. 应用模板的【编码】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>requestCharacterEncoding</td><td>应用请求编码</td><td>应用程序的默认 HTTP 请求编码。</td></tr><tr><td>responseCharacterEncoding</td><td>应用响应编码</td><td>应用程序的默认 HTTP 响应体编码。</td></tr><tr><td>javaEncoding</td><td>JSP 文件编码</td><td>指定 JSP 文件编码。</td></tr><tr><td>fileEncoding</td><td>静态文件编码</td><td>使用指定的编码解析应用的文件资源，如“*.html”等静态资源，可用于解决文件编码和 Jvm 默认编码不一致引起的乱码问题。</td></tr></table>
Table 19. 应用模板的【性能】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>slowThreadEnabled</td><td>慢线程检测</td><td>慢线程检测功能可探测执行超时的请求，并能够自动中断执行的线程，以提高资源的利用效率。</td></tr><tr><td>threshold</td><td>阻塞阈值</td><td>线程处理应用业务的时间（从接收到客户端的请求开始计算）超过该阈值（单位：毫秒）后将会记录一条慢线程检测告警日志。注：此值建议不要小于“全局配置”模块里的“定时任务周期”参数值，否则发现慢线程会不及时。</td></tr><tr><td>interruptThreadThreshold</td><td>中断阈值</td><td>线程处理应用业务的时间超过该阈值（单位：毫秒）后将被尝试中断，该时间从接收到客户端的请求开始计算，其值不支持小于阻塞阈值。0表示不中断。</td></tr><tr><td>cachingAllowed</td><td>开启资源缓存</td><td>缓存应用的资源文件，以提高应用服务的响应效率。注：“热加载”与“资源缓存”同时开启时，文件删除后会出现文件找不到异常，请合理开启两个选项！</td></tr><tr><td>cacheMaxSize</td><td>最大缓存大小</td><td>缓存的最大允许缓存大小（KB）。</td></tr><tr><td>cacheObjectMaxSize</td><td>可缓存的单文件大小上限</td><td>缓存中允许单个文件的最大值（KB），超出该大小的文件不进行缓存。</td></tr><tr><td>cacheTtl</td><td>缓存时长</td><td>缓存条目的过期时间（秒），0表示在应用配置更新之前永不过期。</td></tr><tr><td>forceCache</td><td>强制缓存</td><td>开启后，会将.class、.jar等二进制文件也进行缓存，否则只会缓存.html、.js等文本类资源。</td></tr><tr><td>expireFilterEnabled</td><td>客户端资源缓存</td><td>为HTTP响应添加Expires和Cache-Control头信息，以此控制客户端对资源的缓存行为。</td></tr><tr><td>expireFilterInitPara m</td><td>缓存时间规则</td><td>配置资源的缓存时间规则，如ExpiresDefault、ExpiresByType等。</td></tr><tr><td>expireFilterUrlPa tte r ns</td><td>资源匹配规则</td><td>设置对哪些资源进行客户端缓存控制。</td></tr><tr><td>preloadResource</td><td>资源预加载</td><td>开启后，首次部署应用时会将需要加载的资源存储到${tongweb.base}/appResource_cache_index目录下，在下次启动或重新部署时会进行异步预先加载，以加快应用的部署速度。</td></tr><tr><td>preCompress</td><td>资源预压缩</td><td>对静态资源进行预先压缩（默认使用Gzip压缩），以获得最佳性能。注：此功能开启后将忽略通道的压缩配置。</td></tr><tr><td>forcedContainerHandling</td><td>强制从TongWeb加载的静态资源</td><td>应用中的某些静态资源被应用内部的三方框架处理时，可能会有性能方面的影响，此时可以通过指定其强制从TongWeb加载以提升部分性能。</td></tr><tr><td>staticUrlPatterns</td><td>URL模式</td><td>指定哪些静态资源URL，强制由容器处理，具体写法参考应用web.xml中的写法，*号用-来替换，多个用英文逗号隔开。</td></tr></table>
Table 20. 应用模板的【安全】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enableCORSAccess</td><td>允许跨域访问</td><td>通过为资源实现 W3C 的 CORS（跨域资源共享）规范来启用客户端跨域请求。</td></tr><tr><td>corsAllowedOrigins</td><td>允许的源</td><td>设置允许跨域访问的源，配置多个源使用英文逗号分隔，例如 http://www.xxx.com, http://www.zzz.com。注：设置为“*”表示所有源都允许。</td></tr><tr><td>corsAllowedMethods</td><td>允许的方法</td><td>允许跨域访问的方法，默认支持GET,POST,HEAD,OPTIONS。配置多个方法以英文逗号分隔，例如 GET,POST,HEAD,OPTIONS。</td></tr><tr><td>corsAllowedHeaders</td><td>允许的 HTTP 头</td><td>允许的 HTTP 头，XMLHttpRequest 对象的getResponseHeader() 方法拿到的基本字段，默认支持Origin,Accept,X-Requested-With,Content-Type,Access-Control-Request-Method,Access-Control-Request-Headers，配置多个 HTTP 头以英文逗号分隔。</td></tr><tr><td>corsExposedHeaders</td><td>暴露 HTTP 头</td><td>通过 Access-Control-Expose-Headers 暴露指定的HTTP 头，Access-Control-Expose-Headers 标头指示哪些标头可以安全地公开给 CORS API 规范的 API。注：配置多个 HTTP 头以英文逗号分隔。</td></tr><tr><td>corsSupportCredentials</td><td>支持凭证</td><td>CORS 请求默认不发送 Cookie 和 HTTP 认证信息。若需要把 Cookie 发到服务器，则设置为“true”，默认为“false”。</td></tr><tr><td>corsPreflightMaxAge</td><td>预检请求的有效期</td><td>用来指定本次预检请求的有效期（单位：秒）。在此期间，不用发出另一条预检请求，默认值 1800 秒。</td></tr><tr><td>requestParametersL ostValidation</td><td>参数防丢失</td><td>开启该功能后,若请求参数解析期间出现故障(如请求参数个数超过了设置的阈值或POST数据的大小超过了设置的阈值等),系统将拒绝请求,以确保客户端提交的参数值不会丢失。</td></tr><tr><td>XSSFilterEnabled</td><td>XSS攻击拦截</td><td>拦截可疑的XSS攻击请求,通常是含有script、&lt;、&gt;等特殊标记的请求,以403响应码返回到客户端。</td></tr><tr><td>csrFPrevention</td><td>CSRF防护</td><td>注意:请谨慎打开此功能,否则可能导致应用无法访问!!为Web应用提供基本的CSRF防护支持,该功能需要应用自身予以配合:调用HttpServletResponse#printencodeRedirectURL(String)和HttpServletResponse#printencodeURL(String)方法(每执行一次则产生一个新的令牌,当CSRF令牌缓存数设置为0时,一个会话只产生一个令牌)编码URL后发送到客户端,其目的是要发送回服务器的URL都带有csrftoken参数以认证身份。编码后的URL示例:/myservlet/myres?param=val&amp;csrftoken=...。TongWeb的CSRF防护同时可以阻挡重放攻击,只要不将CSRF令牌缓存数设置为0即可。</td></tr><tr><td>csrFCacheSize</td><td>CSRF令牌缓存数</td><td>CSRF令牌会随着客户端请求而更新,CSRF令牌缓存数表示保留最新的令牌个数,这同时也表示允许的客户端并发数。0表示不限制。</td></tr><tr><td>tokenValidTimes</td><td>CSRF令牌有效次</td><td>提供CSRF令牌循环使用支持,使用次数超出有效次后会自动失效,可用于资源需要重复访问而不支持及时更新CSRF令牌等场景。注意:1. CSRF令牌允许循环使用时,将无法阻挡重放攻击;2. 该功能仅在“CSRF令牌缓存数”不为0时有效。</td></tr><tr><td>csrFEntryPoints</td><td>CSRF免防入口</td><td>开启CSRF防护后,可选设置一些免防入口(应用URL),如登录资源,以跳过防护检查。设置多个入口时,使用英文逗号分隔。</td></tr><tr><td>httpHeaderToken</td><td>REST支持</td><td>开启了CSRF防护的应用，将无法使用REST接口，原因是REST接口无法通过URL传递令牌，开启“REST支持”可解决该问题。开启“REST支持”需要应用自身予以配合：1.客户端须首先请求免防资源，服务器通过响应头返回令牌；2.客户端请求其它资源须通过请求头（名为：csrftoken）回传服务器令牌，以通过服务器的安全认证。</td></tr><tr><td>secretLevel</td><td>应用密级</td><td>设置本应用的保密等级，此保密等级将用于应用数据网络传输、主体数据存取、客体请求访问等过程的加密处理。</td></tr><tr><td>threadPoolPolicy</td><td>业务安全规则</td><td>1（单线程池）：使用通道内置的线程池处理所有业务；2（双线程池）：符合规则的业务由线程池处理，其它业务由通道内置的线程池处理；3（三线程池）：符合规则的业务由线程池处理，其它业务由其它线程池处理。线程池不会作用的范围：由服务器处理的静态资源、支持异步Servlet处理的业务。注意：对于使用了异步Filter的业务，请谨慎或不要使用线程池功能。注意：若业务处理时间过长（如超过30秒），则建议增大线程超时阈值，否则可能导致请求失败！</td></tr><tr><td>threadPool</td><td>线程池</td><td>线程池功能可将指定的业务交给指定的线程池来处理，可支持应用根据业务的重要性、优先级等方面约束系统资源的使用。该功能一般适用于并且只建议应用于比较耗时的业务操作，例如长事务、远程服务调用等。</td></tr><tr><td>threadPoolTimeout</td><td>线程超时阈值</td><td>业务处理时长达到该阈值后，响应结果将即刻发送回客户端，而不再等待线程处理结束，这会提高整体的响应效率，但可能导致客户端没有获取到最终的处理结果。单位是毫秒，0表示使用通道的异步请求的默认超时。</td></tr><tr><td>taskRule</td><td>匹配规则</td><td>指定需要线程池执行的业务的匹配规则，其格式须是匹配URL的正则表达式。不指定则表示可接受所有业务。注：业务的匹配规则是基于请求的Servlet路径，而不包含应用的访问名。</td></tr><tr><td>exclusionRule</td><td>排除规则</td><td>指定需要线程池从匹配规则中要排除的业务规则，其格式须是匹配URL的正则表达式。不指定则表示不排除。注：业务的匹配规则是基于请求的Servlet路径，而不包含应用的访问名。</td></tr><tr><td>otherThreadPool</td><td>其它线程池</td><td>当使用三线程池策略时,符合规则的业务由线程池处理,其它业务由其它线程池处理。</td></tr><tr><td>otherThreadPoolTimeout</td><td>其它线程超时阈值</td><td>其它业务处理时长达到该阈值后,响应结果将即刻发送回客户端,而不再等待线程处理结束,这会提高整体的响应效率,但可能导致客户端没有获取到最终的处理结果。单位是毫秒,0表示使用通道的异步请求的默认超时。</td></tr><tr><td>semaphoreEnabled</td><td>并发安全控制</td><td>出于安全等考虑,控制访问应用的并发量。</td></tr><tr><td>concurrency</td><td>限制最大并发</td><td>允许的最大并发访问量。</td></tr><tr><td>block</td><td>阻塞等待</td><td>当应用达到最大并发访问量时,是否阻塞等待访问应用。若不等待,请求会被终止,并记录一条日志。</td></tr><tr><td>interruptible</td><td>允许中断阻塞</td><td>当请求线程在阻塞等待访问应用时,是否允许被中断,若被中断则请求会被终止,并记录一条日志。</td></tr><tr><td>restrictedPorts</td><td>限定访问端口</td><td>限定访问端口后,只有指定的端口可以访问本应用,其它端口的访问会被拒绝,不指定则表示不限制。可用于支持系统应用、重要应用、普通应用的端口隔离式的安全访问,并可通过设置不同端口的资源大小来约束不同应用的业务处理效率。注意:该功能只适用于Web应用,对于远程访问的EJB应用无效,如需限制远程EJB的访问,则可在"EJB http协议"模块进行相关设置。</td></tr><tr><td>crossContext</td><td>允许跨应用访问</td><td>指定是否允许调用ServletContext.getCTX("/appName")方法访问此服务器中其他Web应用程序的上下文。</td></tr><tr><td>unloadDelay</td><td>卸载等待</td><td>卸载应用时,若存在请求未处理完毕,则等待一段时间(单位:秒),超时后会强制卸载,此时会给出线程泄漏的警告日志。</td></tr><tr><td>allowLinking</td><td>允许链接文件</td><td>是否允许使用软链接访问应用的资源文件。</td></tr><tr><td>clearReferences</td><td>内存泄漏检测</td><td>在应用停止时,检查并尝试回收与应用相关联的可能导致内存泄漏的JDBC驱动、线程、线程局部变量(ThreadLocal)、Java序列化对象缓存、RMI目标对象等资源。</td></tr><tr><td>enableRecycling</td><td>应用回收</td><td>启用后,应用卸载时将备份到回收站,可在应用回收列表查看。</td></tr></table>
Table 21. 应用模板的【SHTML】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>shtmlEnabled</td><td>支持 shtm1</td><td>shtm1是在html静态页面中使用指令以分块动态生成内容。</td></tr><tr><td>virtualWebappRelativeve</td><td>相对应用目录</td><td>shtm1里的指令路径是否按相对于应用的根目录处理。</td></tr><tr><td>allowExec</td><td>允许执行命令</td><td>是否允许在 shtm1里执行本地命令，取决于具体的应用。请谨开启，这可能会带来一定的风险。</td></tr><tr><td>expires</td><td>过期时间</td><td>设置 shtm1页面在 http 协议响应头里的过期时间（单位：秒），0表示不设置。</td></tr><tr><td>urlPatterns</td><td>URL 类型</td><td>指定对哪些类型的 URL 请求进行 shtm1 处理，多种类型以英文逗号分隔，建议的配置为“.htm1,.html”。</td></tr></table>
Table 22. 应用模板的【其它】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>useRelativeRedirects</td><td>使用相对地址重定向</td><td>打开此开关后,应用在重定向的时候会使用相对路径,否则使用绝对路径。注:该开关在 HTTP/1.0 下无效,可搭配“强制使用相对地址重定向”来尝试解决问题。</td></tr><tr><td>forceUseRelativeRedirections</td><td>强制使用相对地址重定向</td><td>打开此开关后,即使在 HTTP/1.0 协议中,也可以使用相对地址进行重定向。</td></tr><tr><td>allowCasualMultipartParsing</td><td>强制解析 Multipart请求</td><td>即使目标 Servlet 未指定 @MulitpartConfig 注解或没有在 web.xml 中配置 &lt;multipart-config&gt; 元素,也允许解析 multipart/form-data 请求。</td></tr><tr><td>allowOverrideContentType</td><td>允许覆写ContentType</td><td>当响应头的ContentType 已设置时,是否允许对其进行重写修改。</td></tr><tr><td>enableStatelessPoolMonitor</td><td>监视无状态会话 Bean</td><td>开启后,可监视到应用中包含到所有无状态会话 Bean 的实例池使用情况,当应用中包含的无状态会话 Bean 数量太多时不建议开启。</td></tr><tr><td>jarScannerImpl</td><td>自定义 jar 扫描器</td><td>可以通过设置自定义 jar 扫描器,来自主决定 jar 包内Class 文件的扫描操作,例如 Liferay Portal 应用通常需要进行这个设置。</td></tr><tr><td>useDirectionalScanni ng</td><td>使用定向扫描</td><td>使用定向扫描时，TongWeb会从指定的文件中获悉需要扫描的jar和class文件，而不再全局扫描应用，这通常可提升应用的加载效率。</td></tr><tr><td>&lt;servletAnnotationDe- clarificationFile</td><td>Servlet注解声明文件</td><td>指向应用中的一个Properties文件，以/开头，如“/WEB-INF/classes/annotation.properties”，在该文件中指定标注了Servlet Web 注解(@Servlet、@WebFilter、@WebListener)的类名及其所在的文件，格式：com/app/MyClass1.class=test1.jar；com/app/MyClass2.class=classes，若以“.jar”结尾，则可省略路径和jar文件名上的版本号部分。</td></tr><tr><td>applicationPropertie sFile</td><td>SpringBoot主资源文件</td><td>指定 SpringBoot 主资源文件在应用中的位置，以/开头，如“/WEB-INF/classes/application.properties”，TongWeb将从中获取“spring.mainsources”参数的类名，并尝试从/TWEB-INF/classes目录扫描其上标注的Servlet Web注解。</td></tr><tr><td>raPros</td><td>Connector应用属性</td><td>Connector 应用的属性列表。</td></tr><tr><td>addResponseHeader</td><td>附加响应头</td><td>该功能允许服务器在HTTP响应中附加自定义头部信息。优先级：应用的优先级高于通道，通道优先级高于全局配置。</td></tr><tr><td>pkgCompatible</td><td>命名空间兼容</td><td>开启后，可支持同时部署 javax 和 jakarta 命名空间的应用。</td></tr></table>

# C.1.3. 应用增量
Table 23. 应用增量的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>指定这次更新的名称，便于后续管理。</td></tr><tr><td>app</td><td>目标应用</td><td>要进行增量更新的目标应用。</td></tr><tr><td>fileFrom</td><td>增量包来源</td><td>应用的增量更新文件包可以从客户端上传，也可以从服务器端指定的位置读取。注：出于安全考虑，TongWeb 出厂设置禁用了文件上传功能，您可在“控制台安全”模块了解详情和进行相关的配置操作。</td></tr><tr><td>fromServer</td><td>增量包位置</td><td>指定增量包文件的绝对路径。</td></tr><tr><td>fromUpload</td><td>上传增量包</td><td>上传增量包文件到服务器。</td></tr></table>

# C.1.4. 应用备份
持久化位置：conf/tongweb.xml:tongweb>server>app-backups>app-backup
Table 24. 应用备份的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>app</td><td>备份应用</td><td>指定要备份的应用。</td></tr><tr><td>backupInfo</td><td>备份说明</td><td>对本次备份进行备注说明，以便了解本次备份的目的，同时便于找到要恢复的应用版本。</td></tr></table>

# C.1.5. 应用回收
无

# C.1.6. 应用迁移
Table 25. 应用迁移的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>serverType</td><td>应用服务器类型</td><td>应用服务器类型，目前支持 Tomcat、TongWeb7（可在迁移配置中设置是否允许多端口迁移）、Weblogic、WebSphere、Nginx。</td></tr><tr><td>originServerPath</td><td>应用服务器路径</td><td>指定要进行应用迁移的应用服务器的路径。</td></tr><tr><td>appMigration</td><td>是否拷贝应用</td><td>指定迁移过程中是否拷贝应用文件，若不拷贝则只迁移数据源等服务器配置参数，不会部署应用程序。</td></tr><tr><td>connMigration</td><td>是否迁移通道</td><td>指定迁移过程中是否迁移通道。</td></tr></table>

# C.1.7. 迁移配置
Table 26. 迁移配置的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>allowMultiPort</td><td>允许多端口迁移</td><td>在应用迁移过程中，若原应用服务器TongWeb7存在多个端口，是否允许其迁移。</td></tr></table>

# C.2. Web 容器

# C.2.1. 通道
您可以根据需要创建 HTTP 通道或者 AJP 通道，HTTP 通道和 AJP 通道配置参数有所不同，请根据实际情况配置。
持久化位置：conf/tongweb.xml:tongweb>server>service>connector
Table 27. 通道的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>通道名</td><td>通道的名称。</td></tr><tr><td>protocol</td><td>协议</td><td>本通道支持的网络层协议。</td></tr><tr><td>ioMode</td><td>IO 模式</td><td>配置通道的 IO 模式，如 NIO、NIO2。</td></tr><tr><td>address</td><td>IP</td><td>监听网络请求的 IP 地址。注：若设置了全局IP，则优先使用全局IP。</td></tr><tr><td>port</td><td>端口</td><td>设置监听网络请求的端口，此端口须是平台允许使用的端口（如不会被防火墙拦截等）。</td></tr><tr><td>redirectPort</td><td>重定向端口</td><td>用于非 SSL 到 SSL 重定向的重定向端口。</td></tr><tr><td>secret</td><td>AJP 协议密钥</td><td>设置 AJP 协议传输加密密钥。安全起见，建议设置以开启 AJP 协议传输加密。开启 AJP 协议加密后，AJP 协议内容会加密传输，这需要 Apache 等负载均衡器的支持。</td></tr><tr><td>allowedRequestAttributesPattern</td><td>允许的请求属性</td><td>指定 AJP 协议允许的请求属性，格式为正则表达式。</td></tr><tr><td>useVirtualThreads</td><td>使用虚拟线程</td><td>虚拟线程是由Java 21版本中实现的一种轻量级线程，它主要解决的问题是减少I/O密集型任务的阻塞。虚拟线程并没有增加实际的CPU可用线程，而是增加了线程的利用率，所以在面对CPU密集型任务时，如数学计算等，它与传统线程没有区别。因此，如果您的需求中存在大量I/O等待导致性能瓶颈，那么可以考虑使用虚拟线程。此外，使用虚拟线程，如果效果不理想，也可以尝试它的优化参数：-Djdk.virtualThreadScheduler.parallaxism=xxx、-Djdk.virtualThreadScheduler.maxPoolSize=xxx、-Djdk.virtualThreadScheduler.minRunnable=xxx。</td></tr><tr><td>useSelfTuned</td><td>使用自调节线程</td><td>开启后，TongWeb会根据业务请求处理的速率自主调节线程池的大小，以持续优化处理效率和系统资源的使用率。</td></tr><tr><td>maxThreads</td><td>最大线程数</td><td>线程池中用于处理网络请求的最大的线程数。注：当使用自调节线程时，此值为自调节允许同时创建的最大线程数。</td></tr><tr><td>minSpareThreads</td><td>最小备用线程数</td><td>线程池中用于处理网络请求的最小的备用线程数，即线程池中最少存在的线程数。</td></tr><tr><td>threadKeepAliveTime</td><td>空闲回收时间</td><td>当线程池里的空闲线程数大于“最小备用线程数”时，线程空闲的时间超过该时间后将被回收。单位：秒。</td></tr><tr><td>queueSize</td><td>任务队列大小</td><td>设置用于保存任务并移交给工作线程的队列的大小。</td></tr><tr><td>threadPriority</td><td>优先级</td><td>指定此线程的优先级。</td></tr></table>
Table 28. 通道的【线程】
Table 29. 通道的【HTTP 属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>allowMethods</td><td>支持 HTTP 方法</td><td>设置该通道支持的 HTTP 方法，当客户端使用不支持的方法时将得到一个 405 的响应码。</td></tr><tr><td>maxHeaderCount</td><td>最大请求头数</td><td>允许的请求头个数的最大值，若一个请求包含的请求头大于指定的最大值，则此请求将被拒绝。</td></tr><tr><td>maxHttpHeaderSize</td><td>最大请求头信息大小</td><td>HTTP 消息头的最大值(单位：字节)。</td></tr><tr><td>maxCookieCount</td><td>最大 Cookie 数</td><td>设置请求中允许的最大 Cookie 数，小于“0”表示不限制。</td></tr><tr><td>maxParameterCount</td><td>最大参数个数</td><td>服务器将自动解析的最大参数数（GET加POST）。小于“0”表示不限制。</td></tr><tr><td>maxPartCount</td><td>分段表单最大段数</td><td>限制分段表单（如"multipart/form-data"）的最大分段个数。分段表单最常见的表现是文件上传类表单，在文件上传表单场景下，这里限制的是文本类表单参数和二进制文件类表单参数的总和。注：该参数的作用等同于Tomcat的maxPartCount参数，其值为-1表示不限制。</td></tr><tr><td>maxPartHeaderSize</td><td>分段表单每段最大请求头</td><td>限制分段表单（如"multipart/form-data"）中每段的最大请求头大小（单位：字节）。注：该参数的作用等同于Tomcat的maxPartHeaderSize参数，其值为-1表示不限制。</td></tr><tr><td>sendReasonPhrase</td><td>附加原因短语</td><td>开启后，TongWeb将在HTTP响应中添加HTTP Reason Phrase（原因短语）。</td></tr><tr><td>relaxedPathCharsEnable</td><td>路径中允许使用未编码字符</td><td>URI请求路径中允许使用的未编码的字符。允许填写的字符包括："&lt;&gt;[\]^`{}。</td></tr><tr><td>relaxedPathChars</td><td>未编码字符</td><td>URI请求路径中允许使用的未编码的字符。</td></tr><tr><td>relaxedQueryCharsEnable</td><td>参数中允许使用未编码字符</td><td>URI请求参数中允许使用的未编码的字符。允许填写的字符包括："&lt;&gt;[\]^`{}。</td></tr><tr><td>relaxedQueryChars</td><td>未编码字符</td><td>URI请求参数中允许使用的未编码的字符。</td></tr><tr><td>skipCharsValidate</td><td>跳过特殊字符校验</td><td>当请求参数中包含了未遵从RFC7230、RFC3986规定的特殊字符时，是否跳过校验，跳过校验后该请求会交给应用处理，否则请求将会被中断。</td></tr><tr><td>maxPostSize</td><td>最大POST字节</td><td>将由容器自动解析的POST的最大字节，“-1”表示不限制。</td></tr><tr><td>maxSwallowSize</td><td>上传文件溢值</td><td>若上传文件大小超过“最大POST字节”并且超过了此溢值，则中断当前的连接（即响应头里会添加“Connection:close”），未超过则不会中断。</td></tr><tr><td>parseBodyMethods</td><td>以POST方式解析方法</td><td>指定一些HTTP方法，在解析正文时将这些方法的请求视为POST请求。可用以支持一些RESTFul PUT无法向后端传递参数的场景。</td></tr><tr><td>maxSavePostSize</td><td>认证时 POST 缓存</td><td>指定 FORM or CLIENT-CERT 认证期间，服务器缓存的 POST 请求的最大字节数（单位：字节）。</td></tr><tr><td>useKeepAliveResponseHeader</td><td>Keep-Alive 响应头</td><td>在使用长连接时，是否在响应头中添加 Keep-Alive。</td></tr><tr><td>keepAliveTimeout</td><td>长连接超时</td><td>长连接建立后，在这个时间内没有新的请求进来，则断开连接。</td></tr><tr><td>maxKeepAliveReques</td><td>长连接服务阈值</td><td>长连接建立后，当其接收的请求数达到此阈值后，则断开连接。</td></tr><tr><td>maxTrailerSize</td><td>尾部标头总长度</td><td>尾部标头的最大大小（以字节为单位），“-1”表示不限制。</td></tr><tr><td>addResponseHeader</td><td>附加响应头</td><td>该功能允许服务器在HTTP响应中附加自定义头部信息。优先级：应用的优先级高于通道，通道优先级高于全局配置。</td></tr></table>
Table 30. 通道的【TCP 属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>connectionTimeout</td><td>连接超时时间</td><td>读写网络的连接超时时间，单位：毫秒。</td></tr><tr><td>tcpNoDelay</td><td>开启 TCP_NO_DELAY</td><td>设置网络连接的 TCP_NO_DELAY 属性。</td></tr><tr><td>acceptCount</td><td>等待队列大小</td><td>连接等待队列的长度，是操作系统 Socket 连接的配置参数；当处理请求的线程数不够用时，请求被放到等待队列中，等待队列满后的请求将被拒绝。</td></tr><tr><td>maxConnections</td><td>最大连接数</td><td>TongWeb 能够同时接受和处理的最大连接数。</td></tr><tr><td>enableLookups</td><td>允许 DNS 反向查找</td><td>开启后，调用 request.getRemoteHost() 会进行 DNS 查询得到远程客户端的实际主机名；不开启，则得到 IP 地址。</td></tr></table>
Table 31. 通道的【压缩】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>compression</td><td>压缩级别</td><td>压缩级别，on：表示开启，off：表示关闭，force：表示任何情况都开启。</td></tr><tr><td>compressionMinSize</td><td>压缩阈值</td><td>压缩所需的最小内容长度，以字节为单位，以触发压缩。</td></tr><tr><td>noCompressionUserAgents</td><td>免压缩客户端</td><td>不应用压缩的客户端代理字符串的正则表达式,如“.*.Safari.*.*,*Firefox.*”。</td></tr><tr><td>compressibleMimeType</td><td>可压缩类型</td><td>指定需要压缩的 MIME-TYPE 列表,多个类型以英文逗号分隔。</td></tr><tr><td>ignoreHeader</td><td>强制压缩</td><td>当请求头中未指定压缩算法时,开启此强制压缩,可对资源进行压缩处理。适用于动态资源需要压缩的场景。</td></tr></table>
Table 32. 通道的【安全】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>secure</td><td>Cookie Secure</td><td>设置Cookie的Secure属性，打开后设置为“true”，关闭则设置为“false”。当设置为“true”时，只有在HTTPS协议下浏览器才可以传递此Cookie，HTTP协议则不传递。注：此连接器开启SSL后，本项设置自动为“true”，不可更改。</td></tr><tr><td>SSLEnabled</td><td>开启SSL</td><td>开启后，使用SSL/TLS加密网络数据，访问协议将变为HTTPS。注：若要使用HTTP/2.0协议，则需首先开启SSL。</td></tr><tr><td>httpRedirect</td><td>HTTP重定向</td><td>开启后，如果使用HTTP访问则重定向至HTTPS。</td></tr><tr><td>http2Enabled</td><td>支持HTTP/2</td><td>是否支持HTTP 2.0协议。</td></tr><tr><td>gmEnabled</td><td>国密认证</td><td>开启国密SSL加密认证，开启后，此通道将支持使用国密算法SM2、SM3、SM4进行SSL加密通信。</td></tr><tr><td>sslEnabledProtocols</td><td>启用协议</td><td>指定启用的SSL/TLS协议，不指定将根据运行环境自动配置。考虑安全问题，不建议启用SSLv3和SSLv2Hello。</td></tr><tr><td>ciphers</td><td>启用密码套件</td><td>密码套件决定了SSL/TLS通信过程中使用的加密算法，可根据不同的业务需求设置使用不同的加密算法，以英文逗号分隔可设置等多个。注：不设置表示不限制。</td></tr><tr><td>useServerCipherSuit esOrder</td><td>使用服务端密码顺序</td><td>启用后会强制使用服务器端的的密码顺序，而不是允许客户端来选择。</td></tr><tr><td>refKeyStore</td><td>服务器证书</td><td>选择已导入服务器的SSL证书。</td></tr><tr><td>keystoreFile</td><td>服务器证书路径</td><td>存放服务器证书 keystore 文件的路径。证书支持的类型: JKS, PKCS11 或 PKCS12。</td></tr><tr><td>keystorePass</td><td>服务器证书密码</td><td>指定 keystore 证书的密码。</td></tr><tr><td>clientAuth</td><td>客户端认证</td><td>true: 必须有客户端证书才可以访问; false: 不验证是否有客户端证书; want: 会检查客户端证书,若没有也可以继续访问。</td></tr><tr><td>trustManagerClassName</td><td>自定义信任管理器</td><td>用于验证客户端证书的自定义信任管理器类的名称。该类必须有一个零参数构造函数,并且还必须实现 javax.net.css.X509TrustManager 接口。设置此属性,并且是可用的,则可能忽略信任证书相关设置。</td></tr><tr><td>refTrustStore</td><td>信任证书</td><td>选择已导入服务器的 SSL 信任证书。</td></tr><tr><td>truststoreFile</td><td>信任证书路径</td><td>存放服务器证书 truststore 文件的路径。证书支持的类型: JKS, PKCS11 或 PKCS12。</td></tr><tr><td>truststorePass</td><td>信任证书密码</td><td>指定 truststore 证书的密码。</td></tr><tr><td>refGmEnc</td><td>加密证书</td><td>选择已导入服务器的加密证书。</td></tr><tr><td>gmEncFile</td><td>加密证书路径</td><td>加密证书路径。</td></tr><tr><td>gmEncPass</td><td>加密证书密码</td><td>加密证书密码。</td></tr><tr><td>refGmSign</td><td>签名证书</td><td>选择已导入服务器的签名证书。</td></tr><tr><td>gmSignFile</td><td>签名证书路径</td><td>签名证书路径。</td></tr><tr><td>gmSignPass</td><td>签名证书密码</td><td>签名证书密码。</td></tr><tr><td>enableKAE</td><td>KAE 加速</td><td>设置是否使用 KAE 加速引擎。</td></tr></table>
Table 33. 通道的【其它】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>useSendfile</td><td>启用 Send File</td><td>是否启用 Send File 功能。启用后大于 Send File 阈值的文件将通过 Send File 的方式发送到客户端（注意：此方式发送的文件不支持使用压缩功能），小于阈值的文件则不会。</td></tr></table>
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>sendFileSize</td><td>Send File 阈值</td><td>当通道启用 Send File 功能时,大于此阈值的文件将通过 Send File 的方式发送到客户端,单位为 KB。</td></tr><tr><td>asyncTimeout</td><td>异步请求的默认超时</td><td>当使用异步 Servlet 时,设置异步处理机制(AsyncContext)的默认超时时间,单位是毫秒。该参数可以被应用主动调用 AsyncContext 的setTimeout(long timeout) 方法所覆盖。</td></tr><tr><td>URIEncoding</td><td>URI 编码</td><td>使用指定的编码解析 URI中的参数。</td></tr><tr><td>useBodyEncodingFo rURI</td><td>URI 使用 Content-Type 解码</td><td>开启后,URI 中的参数可以使用 Content-Type 中指定的编码。</td></tr><tr><td>xpoweredBy</td><td>开启 X-Powered-By</td><td>开启 X-Powered-By 后,响应头会添加和服务器有关的信息。</td></tr><tr><td>enableProxyServerC onfiguration</td><td>开启代理服务器配置</td><td>开启后,可以配置代理服务器的名称和端口。</td></tr><tr><td>proxyName</td><td>代理服务器的名称</td><td>指定代理服务器名称,调用 request.getServerName(   ) 将返回该值给应用。</td></tr><tr><td>proxyPort</td><td>代理服务器端口</td><td>指定代理服务器端口,调用 request.getServerPort(   ) 将返回该值给应用。</td></tr><tr><td>useNetworkMonitor</td><td>启用网络数据监控</td><td>开启后将监视此通道的当前连接数、请求处理总数、错误请求处理总数、请求处理总时间、接收的字节数、发送的字节数等信息,这可能会有些许的性能消耗。</td></tr><tr><td>slowTime</td><td>慢请求阈值</td><td>单次请求被判断为慢速请求的处理时间阈值(单位: 秒),超过阈值则记录慢请求次数,设置为 0 表示不监视慢请求数量。</td></tr><tr><td>resetMonitorData</td><td>归零网络监控数据</td><td>设置是否需要在指定的周期时间内清理累积的监控数据。</td></tr><tr><td>resetMonitorDataPer i od</td><td>归零周期</td><td>累积的监控数据超过此周期(单位: 秒)后进行自动归零。</td></tr></table>

# C.2.2. 虚拟主机
持久化位置：conf/tongweb.xml:tongweb>server>service>container>host
Table 34. 虚拟主机的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>主机名</td><td>虚拟主机的名称,可作为访问该虚拟主机的域名。注意:避免使用 IP 地址;若使用 IP 地址,则通过此 IP 地址就只能访问此虚拟主机下的应用,可能导致控制台无法访问。</td></tr><tr><td>aliases</td><td>别名</td><td>虚拟主机的别名,别名和主机名一样可作为访问该虚拟主机的域名。多个别名以英文逗号分隔。注意:避免使用 IP地址,若使用 IP 地址,则通过此 IP 就只能访问此虚拟主机下的应用,可能导致控制台无法访问。</td></tr><tr><td>refRealm</td><td>默认安全域</td><td>此处设置的安全域可作用于所有部署在此虚拟主机上的应用,其优先级低于应用自身设置的安全域。若此虚拟主机同时开启了“单点登录(SSO)”,则优先级高于应用设置的安全域。</td></tr><tr><td>refSessionHa</td><td>会话服务器</td><td>选择应用要连接的会话服务器,将应用的 Session 存储到会话服务器。此处设置的会话服务器可作用于所有部署在此虚拟主机上的应用,其优先级低于应用自身设置的会话服务器。若此虚拟主机同时开启了“Session 共享”,则优先级高于应用设置的会话服务器。</td></tr><tr><td>addValve</td><td>自定义 Valve</td><td>自定义 Valve 的全类名,自定义的 Valve 会添加到虚拟主机的 pipeline(valve 链)里,访问应用时执行自定义的操作。自定义的 Valve 需继承com.tongweb.server.valves.ValveBase 类(所在 jar : ${tongweb.home}/version*/tongweb-web.jar);在重写 invoke 方法时,需要确保调用“getNext().invoke(request, response)”;在重写其它方法时,需要确保调用对应的 super 方法。多个自定义 Valve 需以英文逗号分隔。注:需在 TongWeb 启动之前,将包含自定义 Valve 的 jar 文件放置到${tongweb.base}/lib 下。</td></tr><tr><td>customErrorPage</td><td>自定义错误页面</td><td>自定义错误页面,数据格式为 code=path,其中 code 指定错误状态码,path 指定自定义错误页面的绝对路径,也可以是相对于 TongWeb 安装目录或域目录的相对路径,多个自定义错误页面需以英文逗号分隔。</td></tr><tr><td>useJsonReport</td><td>使用 Json 报告</td><td>开启此选项后,任何导致 HTTP 错误状态码的请求都将收到一个包含错误信息的 JSON 数据格式的响应。若未开启,服务器将继续使用默认的 HTML 数据格式的页面响应。</td></tr><tr><td>ssoEnabled</td><td>单点登录</td><td>是否开启单点登录，默认关闭。开启后，同一虚拟主机下使用相同安全域的应用可以实现多点登录，即登录一次访问多个应用。注：若要启用单点登录功能，则需要首先设置默认安全域。</td></tr><tr><td>sessionShareEnable d</td><td>Session共享</td><td>是否开启应用间的 Session 共享功能。开启后，同一虚拟主机下的应用可以实现 Session 数据共享。</td></tr><tr><td>rewriteEnabled</td><td>启用URL 重写</td><td>支持 URL 重写和请求转发，能够在请求到达 Servlet 容器之前对 URL 进行修改，类似于 Apache HTTP 服务器中的 mod rewrite 模块。</td></tr><tr><td>rewriteConfigFile</td><td>URL 重写规则文件</td><td>指定 URL 重写功能使用的规则文件。</td></tr></table>

# C.2.3. 数据源
持久化位置：conf/tongweb.xml:tongweb>server>Resources>Resource
Table 35. 数据源的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>数据源名</td><td>数据源的名称。</td></tr><tr><td>aliases</td><td>绑定 JNDI 名</td><td>数据源的别名会被用作其绑定到 JNDI 资源树上的名字，一个数据源可以逗号分隔指定多个别名。</td></tr><tr><td>dataSourceTemplate</td><td>数据源模板</td><td>指定数据源模板后，将会使用数据源模板里的参数来创建数据源。注：在表单页面切换数据源模板后，表单页面内的数据将会被覆盖更新。</td></tr><tr><td>jdbcUrITemplate</td><td>数据库连接方式</td><td>可选使用 TongWeb 预置的 JDBC 模板（可通过“Jdbc 模板”模块添加新的模板）连接数据库，使用 JDBC 模板可省去输入 JDBC 的 URL、驱动类等信息，由 TongWeb 根据输入的数据库服务器 IP、端口、数据库名等信息自动组装这些信息。注：为空表示不使用模板，而使用 JDBC 标准方式。</td></tr><tr><td>ip</td><td>数据库 IP</td><td>连接数据库的 IP 地址，支持使用 localhost 域名。</td></tr><tr><td>port</td><td>数据库端口</td><td>连接数据库的端口。</td></tr><tr><td>dbname</td><td>数据库名称</td><td>数据库名称。</td></tr><tr><td>JdbcUrl</td><td>连接URL</td><td>数据库连接URL。</td></tr><tr><td>JdbcDriver</td><td>驱动类</td><td>数据库驱动类的全名称。</td></tr><tr><td>UserName</td><td>用户名</td><td>登录数据库的用户名。</td></tr><tr><td>Password</td><td>密码</td><td>登录数据库的用户密码。</td></tr><tr><td>klasspath</td><td>驱动包位置</td><td>设置数据库驱动类所在的Jar文件的绝对路径，多个路径以英文逗号分隔。若在启动之前（注：启动后再放无效）已经将文件放置到了${tongweb.base}/lib下，则可以不设置。注意：在集群环境中，请确保每个实例所在的服务器上都需放置所需的文件。</td></tr><tr><td>refLib</td><td>驱动包类库</td><td>添加数据库驱动类所在的类库，如果同时设置了“驱动包位置”，那么将一起生效，且“驱动包位置”比“驱动包类库”更优先加载。</td></tr></table>
Table 36. 数据源的【连接参数】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>connectionProperties</td><td>连接属性</td><td>当驱动类型为Driver时，Driver连接数据库所需要的连接参数。根据需要进行填写，格式要求是 propertyName=PropertyValue，多个参数以英文逗号分隔。注意：数据库的用户名和密码参数不需要在这里填写。</td></tr><tr><td>clientInfo</td><td>客户端信息</td><td>设置 JDBC 连接的客户端信息，其值格式为key=value的键值对，多个键值对以英文逗号分隔。</td></tr><tr><td>defaultCatalog</td><td>Catalog</td><td>设置给定的目录名称，以便在此连接对象的数据库中选择一个子空间来工作。若驱动程序不支持目录，则它将默默地忽略这个请求。</td></tr><tr><td>initSQL</td><td>初始化 SQL</td><td>指定一个存放 SQL 语句的文件的名称，可在每次建立数据库物理连接以后执行其中的 SQL，以完成相应的数据库初始化操作。出于安全考虑，该文件须位于${tongweb.base}/conf/jdbc 目录，且其类型限定为 *.txt 和 *.sql。</td></tr><tr><td>maxActive</td><td>最大连接数</td><td>连接池可分配的最大活动连接数。</td></tr><tr><td>initialSize</td><td>初始连接数</td><td>连接池建立时初始创建的连接数。</td></tr><tr><td>minIdle</td><td>最小空闲数</td><td>连接池始终维持一定数量的数据库连接，以供应用所需，其数量至少是此处设置的最小空闲数。</td></tr><tr><td>maxIdle</td><td>最大空闲数</td><td>连接池中保留的空闲连接的最大数量，若达到了此数，会释放多余的数据库物理连接。</td></tr><tr><td>minEvictableIdleTimeeMillis</td><td>空闲容忍时间</td><td>连接池在其空闲连接数超出最小空闲数后，会对超出的空闲连接进行空闲时间检查，若其空闲时间超过了此处设置的空闲容忍时间（单位：毫秒），则会释放对应的数据库物理连接。</td></tr><tr><td>batchSize</td><td>单批次创建数</td><td>连接池创建数据库连接数量可分批次进行，以减小对数据库的压力。此处设置连接池单批次创建连接的最大个数，注：设置为0表示不限制，即不启用此功能。</td></tr><tr><td>batchInterval</td><td>批次间隔</td><td>连接池创建数据库连接是分批次进行，可设置批次间的间隔时间（单位：秒）。注：此选项在“单批次创建数”大于0时有效。</td></tr><tr><td>usingLIFOQueue</td><td>连接后进先出</td><td>开启后，连接池中的连接将以后进先出顺序提供给客户端线程，即后创建和后回池的连接优先被客户端线程获取使用。</td></tr><tr><td>fair</td><td>线程公平等待</td><td>在连接池为空时，客户端线程会等待池中有连接可用，打开此功能后，先等待的线程会优先获得连接，否则顺序会不确定（但会有更好的性能），注：此功能通常适用于需要严格顺序的场景，但会有一定的性能损失。</td></tr><tr><td>maxWait</td><td>等待超时</td><td>客户端最多等待连接可用的时间（单位：毫秒），超时后，会得到连接池抛出的SQLEXception。设置为0表示不等待，此时若无可用连接，客户端会立即得到SQLEXception。</td></tr><tr><td>threadBinding</td><td>线程绑定</td><td>开启后，通过此数据源获取的连接将会绑定到当前工作的 HTTP 线程上。在当前 HTTP 请求处理完成之前，多次从该数据源获取连接将会是之前绑定的同一个。在 HTTP 请求处理完成之后，绑定的连接自动从线程上解绑。注：若该数据源会参与多种数据库事务，请谨慎开启本功能。注：打开“支持 JTA”后不支持此设置。</td></tr><tr><td>instantRecycling</td><td>即时回收</td><td>在业务请求处理结束后，立即检查并将未关闭的连接对象回收至连接池内，以供继续复用。</td></tr></table>
Table 37. 数据源的【连接池】
Table 38. 数据源的【健康管理】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>maxAge</td><td>检查连接寿命</td><td>设置连接对象在池中的最大存活时间,即连接的寿命。连接池会周期性地检查底层物理连接的建立时长,当发现超出设置的时长(单位:毫秒)后,底层物理连接将会被销毁并重新建立。“0”表示不进行此检查处理,但若在获取连接时验证失败,仍然会去重新建立失效的连接。</td></tr><tr><td>removeAbandoned</td><td>检查连接泄漏</td><td>开启检查连接泄漏功能后,若一个连接的使用时间超过泄漏超时时间且池的使用比例达到泄漏判定比例,则可选打印泄漏警告日志或强制关闭该连接。</td></tr><tr><td>removeAbandonedTimeout</td><td>泄漏判定时间</td><td>连接被判定为“泄漏”的条件之一为连接的使用时长,单位是秒。满足该条件并且满足“泄漏判定比例”,才被认定为“泄漏”。</td></tr><tr><td>abandonWhenPerce ntageFull</td><td>泄漏判定比例</td><td>连接被判定为“泄漏”的条件之一为当前连接池的使用比例(即使用中的连接数与池最大连接数的比值)大于该比例,单位是百分比。满足该条件并且满足“泄漏判定时间”,才被认定为“泄漏”。</td></tr><tr><td>logAbandoned</td><td>泄漏时记录日志</td><td>在检测到泄漏连接时,打印客户端获取连接的调用栈日志。注:开启后会记录连接被应用使用时的调用栈,会对性能造成一定的影响。</td></tr><tr><td>abandonedConnection</td><td>泄漏时关闭连接</td><td>在检测到泄漏连接时,是否强制关闭连接。</td></tr><tr><td>testOnConnect</td><td>创建连接时验证</td><td>在创建连接时进行数据库连接有效性验证,失效后立即回收。</td></tr></table>
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>testOnBorrow</td><td>获取连接时验证</td><td>在从池中获取连接时进行数据库连接有效性验证,失效后立即回收。</td></tr><tr><td>testOnReturn</td><td>归还连接时验证</td><td>在连接返回到池之时进行数据库连接有效性验证,失效后立即回收。</td></tr><tr><td>testWhileIdle</td><td>空闲时验证</td><td>对未使用的连接进行数据库连接有效性验证,失效后立即回收。注:若处于空闲中的连接正在进行验证(开启了“空闲时验证”),则会被同时计入“空闲连接数”和“验证中连接数”两个指标,此时“活跃连接数”、“空闲连接数”和“验证中连接数”三者之和会比“连接池大小”多1。</td></tr><tr><td>clearPolicy</td><td>失效清理策略</td><td>当检测到有连接失效后,有两种可选的清理方式,当前检测连接:仅回收当前检测到的失效连接;所有空闲连接:立即回收池中所有的空闲连接。</td></tr><tr><td>timeBetweenEvictionRunsMillis</td><td>检查周期</td><td>周期性进行空闲连接验证、泄漏连接关闭和空闲连接池大小调整的时间间隔(单位:毫秒)。</td></tr><tr><td>connectionVerificationMode</td><td>验证方式</td><td>连接验证的方式,包括Connection.isValid方式和table验证。当选择table验证时,需要填写一个用于测试的数据库表名,若填写表名则测试语句为SELECT 1 FROM [表名],若填写表名为空则测试语句为SELECT 1。</td></tr><tr><td>tableName</td><td>测试连接表名</td><td>填写一个用于测试的数据库表名,若填写表名则测试语句为SELECT 1 FROM [表名],若填写表名为空则测试语句为SELECT 1。</td></tr><tr><td>validationQueryTimeout</td><td>验证超时</td><td>连接验证查询失败前的超时时间(单位:秒),“0”表示由数据库驱动决定。</td></tr><tr><td>validationInterval</td><td>验证间隔</td><td>为避免频繁的验证,在指定的间隔时间内最多进行一次验证。单位:毫秒。</td></tr><tr><td>logValidationErrors</td><td>记录验证失败日志</td><td>在验证失败后记录错误日志。</td></tr><tr><td>customInterceptor</td><td>SQL拦截器</td><td>SQL拦截器用于拦截 SQL 语句的执行过程,以便进行必要的业务操作。此处设置 SQL 拦截器的全类名(需继承自com.tongweb.web-jdbc.pool.interceptor.AbstractCreateStatementInterceptor),以英文逗号分隔可设置多个,并需要在 TongWeb 启动前将包含这些类的 jar 放到${tongweb.base}/lib 或 ${tongweb.home}/lib 目录下。此外,设置 SQL 拦截器也可使用编程的方式:将从 JNDI 获取到的 TongWeb 数据源对象,强转为com.tongweb.web-jdbc.pool.DataSource 对象,再调用其 addJdbcInterceptor 方法即可实现。注:上述依赖类可从 ${tongweb.home}/version*tongweb-web.jar 获取。</td></tr><tr><td>enableStatementEnhancer</td><td>语句设置</td><td>对新创建的语句进行默认设置,包括 SQL 超时、Fetch-Size 等。</td></tr><tr><td>queryTimeout</td><td>SQL 超时</td><td>指定语句执行的超时时间,单位为秒。若超过这个时间,就会抛出一个 SQLTimeoutException,适用于execute、executeQuery 和 executeUpdate 方法。“0”表示使用 JDBC 驱动程序的默认值。</td></tr><tr><td>fetchSize</td><td>Fetch-Size</td><td>给 JDBC 驱动程序一个提示,当该语句生成的结果集对象需要更多的行时,应该从数据库中获取的行数。若指定的值为“0”,则该提示将被忽略。</td></tr><tr><td>enableStatementCsache</td><td>缓存语句</td><td>语句缓存可通过复用对象等方式提升 SQL 执行性能。</td></tr><tr><td>prepared</td><td>缓存PreparedStatement</td><td>对创建的 PreparedStatement 实例进行缓存。</td></tr><tr><td>callable</td><td>缓存CallableStatement</td><td>对创建的 CallableStatement 实例进行缓存。</td></tr><tr><td>max</td><td>单连接的最大缓存数</td><td>每个连接缓存语句的最大数量。</td></tr><tr><td>enableStatementFinalizer</td><td>自动关闭语句</td><td>追踪与连接相关的语句,并在 Connection.close() 时将其关闭。对于那些使用完连接但没有关闭相关语句的应用是非常有用的。</td></tr><tr><td>trace</td><td>跟踪语句堆栈</td><td>启用/禁用对未关闭语句的堆栈跟踪。启用后,若语句没有关闭,则通过日志记录其创建的堆栈,以便于排查程序问题。</td></tr><tr><td>releaseOnError</td><td>SQL错误时回收</td><td>在执行 SQL 遇到错误时,立即回收当前连接。</td></tr><tr><td>enableSlowQueryReport</td><td>监视慢 SQL</td><td>追踪 SQL 执行的时间,当对 execute/executeQuery或executeBatch 的调用成功并超过时间阈值时,记录缓慢的 SQL。</td></tr><tr><td>threshold</td><td>测量阈值</td><td>以毫秒为单位的阈值。若查询的速度比这个快,则不记录该 SQL。</td></tr><tr><td>maxQueries</td><td>最大 SQL 记录量</td><td>存储的最大 SQL 数量。</td></tr><tr><td>logSlow</td><td>记录较慢的 SQL</td><td>启用/禁用记录慢 SQL 日志,日志会记录在独立的 logs/sq 目录以方便排查业务问题。</td></tr><tr><td>sqlForParamPrintRegex</td><td>记录 SQL 参数</td><td>在记录较慢的 SQL 时,是否一起记录数据参数(可能包含密码、ID、金额等敏感数据,请谨慎考虑),若需要记录则在此处输入哪些 SQL 需要记录,格式为正则表达式。注:出于安全考虑,不建议使用此功能。</td></tr><tr><td>logFailed</td><td>记录失败 SQL</td><td>启用/禁用记录失败 SQL 日志,日志会记录在独立的 logs/sq 目录以方便排查业务问题。</td></tr></table>
Table 39. 数据源的【语句管理】
Table 40. 数据源的【事务】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>JtaManaged</td><td>支持 JTA</td><td>若计划将此数据源应用于 EJB 事务或者用户管理的 JTA 事务，则需要开启 JTA 支持。开启 JTA 支持要求驱动类型为 XA 类型，且自动提交会被强制关闭。注：打开“线程绑定”后不支持此设置。</td></tr><tr><td>defaultAutoCommit</td><td>自动提交</td><td>连接创建时的默认自动提交状态。若支持 JTA，则会被强制关闭。</td></tr><tr><td>defaultTransactionIsolation</td><td>事务隔离级别</td><td>指定默认的事务隔离级别。“-1”表示由数据库驱动决定，“1”表示读未提交，“2”表示读已提交，“4”表示可重复读，“8”表示串行化。</td></tr><tr><td>rollbackOnReturn</td><td>归还连接时回滚</td><td>当有连接返回池中（连接的 close 方法被调用）时，回滚任何未决的事务。该功能仅在“自动提交”关闭时生效。</td></tr><tr><td>commitOnReturn</td><td>归还连接时提交</td><td>当有连接返回池中（连接的 close 方法被调用）时，提交任何未决的事务。该功能仅在“自动提交”关闭时生效。</td></tr><tr><td>defaultReadOnly</td><td>只读模式</td><td>将此连接置于只读模式，作为对驱动程序的提示，以实现数据库优化。</td></tr></table>

# C.2.4. 数据源模板
持久化位置：conf/tongweb.xml:tongweb>server>datasourcetemplates>datasourcetemplate
Table 41. 数据源模板的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>数据源模板名</td><td>数据源模板的名称。</td></tr><tr><td>klasspath</td><td>驱动包位置</td><td>设置数据库驱动类所在的Jar文件的绝对路径，多个路径以英文逗号分隔。若在启动之前（注：启动后再放无效）已经将文件放置到了${tongweb.base}/lib下，则可以不设置。注意：在集群环境中，请确保每个实例所在的服务器上都需放置所需的文件。</td></tr><tr><td>refLib</td><td>驱动包类库</td><td>添加数据库驱动类所在的类库，如果同时设置了“驱动包位置”，那么将一起生效，且“驱动包位置”比“驱动包类库”更优先加载。</td></tr></table>
Table 42. 数据源模板的【连接参数】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>connectionProperties</td><td>连接属性</td><td>当驱动类型为Driver时，Driver连接数据库所需要的连接参数。根据需要进行填写，格式要求是 propertyName=_propertyValue，多个参数以英文逗号分隔。注意：数据库的用户名和密码参数不需要在这里填写。</td></tr><tr><td>clientInfo</td><td>客户端信息</td><td>设置 JDBC 连接的客户端信息，其值格式为key=value的键值对，多个键值对以英文逗号分隔。</td></tr><tr><td>defaultCatalog</td><td>Catalog</td><td>设置给定的目录名称，以便在此连接对象的数据库中选择一个子空间来工作。若驱动程序不支持目录，则它将默默地忽略这个请求。</td></tr><tr><td>initSQL</td><td>初始化 SQL</td><td>指定一个存放 SQL 语句的文件的名称，可在每次建立数据库物理连接以后执行其中的 SQL，以完成相应的数据库初始化操作。出于安全考虑，该文件须位于 ${tongweb.base}/conf/jdbc 目录，且其类型限定为 *.txt 和 *.sql。</td></tr></table>
Table 43. 数据源模板的【连接池】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>maxActive</td><td>最大连接数</td><td>连接池可分配的最大活动连接数。</td></tr><tr><td>initialSize</td><td>初始连接数</td><td>连接池建立时初始创建的连接数。</td></tr><tr><td>minIdle</td><td>最小空闲数</td><td>连接池始终维持一定数量的数据库连接，以供应用所需，其数量至少是此处设置的最小空闲数。</td></tr><tr><td>maxIdle</td><td>最大空闲数</td><td>连接池中保留的空闲连接的最大数量，若达到了此数，会释放多余的数据库物理连接。</td></tr><tr><td>minEvictableIdleTimeMillis</td><td>空闲容忍时间</td><td>连接池在其空闲连接数超出最小空闲数后，会对超出的空闲连接进行空闲时间检查，若其空闲时间超过了此处设置的空闲容忍时间（单位：毫秒），则会释放对应的数据库物理连接。</td></tr><tr><td>batchSize</td><td>单批次创建数</td><td>连接池创建数据库连接数量可分批次进行，以减小对数据库的压力。此处设置连接池单批次创建连接的最大个数，注：设置为0表示不限制，即不启用此功能。</td></tr><tr><td>batchInterval</td><td>批次间隔</td><td>连接池创建数据库连接是分批次进行，可设置批次间的间隔时间（单位：秒）。注：此选项在“单批次创建数”大于0时有效。</td></tr><tr><td>usingLIFOQueue</td><td>连接后进先出</td><td>开启后，连接池中的连接将以后进先出顺序提供给客户端线程，即后创建和后回池的连接优先被客户端线程获取使用。</td></tr><tr><td>fair</td><td>线程公平等待</td><td>在连接池为空时，客户端线程会等待池中有连接可用，打开此功能后，先等待的线程会优先获得连接，否则顺序会不确定（但会有更好的性能），注：此功能通常适用于需要严格顺序的场景，但会有一定的性能损失。</td></tr><tr><td>maxWait</td><td>等待超时</td><td>客户端最多等待连接可用的时间（单位：毫秒），超时后，会得到连接池抛出的SQlexception。设置为0表示不等待，此时若无可用连接，客户端会立即得到SQlexception。</td></tr><tr><td>threadBinding</td><td>线程绑定</td><td>开启后，通过此数据源获取的连接将会绑定到当前工作的HTTP线程上。在当前HTTP请求处理完成之前，多次从该数据源获取连接将会是之前绑定的同一个。在HTTP请求处理完成之后，绑定的连接自动从线程上解绑。注：若该数据源会参与多种数据库事务，请谨慎开启本功能。注：打开“支持JTA”后不支持此设置。</td></tr><tr><td>instantRecycling</td><td>即时回收</td><td>在业务请求处理结束后，立即检查并将未关闭的连接对象回收至连接池内，以供继续复用。</td></tr></table>
Table 44. 数据源模板的【健康管理】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>maxAge</td><td>检查连接寿命</td><td>设置连接对象在池中的最大存活时间,即连接的寿命。连接池会周期性地检查底层物理连接的建立时长,当发现超出设置的时长(单位:毫秒)后,底层物理连接将会被销毁并重新建立。“0”表示不进行此检查处理,但若在获取连接时验证失败,仍然会去重新建立失效的连接。</td></tr><tr><td>removeAbandoned</td><td>检查连接泄漏</td><td>开启检查连接泄漏功能后,若一个连接的使用时间超过泄漏超时时间且池的使用比例达到泄漏判定比例,则可选打印泄漏警告日志或强制关闭该连接。</td></tr><tr><td>removeAbandonedTimeout</td><td>泄漏判定时间</td><td>连接被判定为“泄漏”的条件之一为连接的使用时长,单位是秒。满足该条件并且满足“泄漏判定比例”,才被认定为“泄漏”。</td></tr><tr><td>abandonWhenPerce ntageFull</td><td>泄漏判定比例</td><td>连接被判定为“泄漏”的条件之一为当前连接池的使用比例(即使用中的连接数与池最大连接数的比值)大于该比例,单位是百分比。满足该条件并且满足“泄漏判定时间”,才被认定为“泄漏”。</td></tr><tr><td>logAbandoned</td><td>泄漏时记录日志</td><td>在检测到泄漏连接时,打印客户端获取连接的调用栈日志。注:开启后会记录连接被应用使用时的调用栈,会对性能造成一定的影响。</td></tr><tr><td>abandonedConnecti on</td><td>泄漏时关闭连接</td><td>在检测到泄漏连接时,是否强制关闭连接。</td></tr><tr><td>testOnConnect</td><td>创建连接时验证</td><td>在创建连接时进行数据库连接有效性验证,失效后立即回收。</td></tr><tr><td>testOnBorrow</td><td>获取连接时验证</td><td>在从池中获取连接时进行数据库连接有效性验证,失效后立即回收。</td></tr><tr><td>testOnReturn</td><td>归还连接时验证</td><td>在连接返回到池之时进行数据库连接有效性验证,失效后立即回收。</td></tr><tr><td>testWhileIdle</td><td>空闲时验证</td><td>对未使用的连接进行数据库连接有效性验证,失效后立即回收。注:若处于空闲中的连接正在进行验证(开启了“空闲时验证”),则会被同时计入“空闲连接数”和“验证中连接数”两个指标,此时“活跃连接数”、“空闲连接数”和“验证中连接数”三者之和会比“连接池大小”多1。</td></tr><tr><td>clearPolicy</td><td>失效清理策略</td><td>当检测到有连接失效后,有两种可选的清理方式,当前检测连接:仅回收当前检测到的失效连接;所有空闲连接:立即回收池中所有的空闲连接。</td></tr><tr><td>timeBetweenEvictio nRunsMillis</td><td>检查周期</td><td>周期性进行空闲连接验证、泄漏连接关闭和空闲连接池大小调整的时间间隔(单位:毫秒)。</td></tr><tr><td>connectionVerificationMode</td><td>验证方式</td><td>连接验证的方式,包括Connection.isValid方式和table验证。当选择table验证时,需要填写一个用于测试的数据库表名,若填写表名则测试语句为SELECT 1 FROM [表名],若填写表名为空则测试语句为SELECT 1。</td></tr><tr><td>tableName</td><td>测试连接表名</td><td>填写一个用于测试的数据库表名,若填写表名则测试语句为SELECT 1 FROM [表名],若填写表名为空则测试语句为SELECT 1。</td></tr><tr><td>validationQueryTime out</td><td>验证超时</td><td>连接验证查询失败前的超时时间(单位:秒),“0”表示由数据库驱动决定。</td></tr><tr><td>validationInterval</td><td>验证间隔</td><td>为避免频繁的验证,在指定的间隔时间内最多进行一次验证。单位:毫秒。</td></tr><tr><td>logValidationErrors</td><td>记录验证失败日志</td><td>在验证失败后记录错误日志。</td></tr></table>
Table 45. 数据源模板的【语句管理】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>customInterceptor</td><td>SQL拦截器</td><td>SQL拦截器用于拦截 SQL 语句的执行过程,以便进行必要的业务操作。此处设置 SQL拦截器的全类名(需继承自com.tongweb.web.jdbc.pool.interceptor.AbstractCreat eStatementInterceptor),以英文逗号分隔可设置多个,并需要在 TongWeb 启动前将包含这些类的 jar 放到${tongweb.base}/lib 或 ${tongweb.home}/lib 目录下。此外,设置 SQL 拦截器也可使用编程的方式:将从 JNDI 获取到的 TongWeb 数据源对象,强转为com.tongweb.web.jdbc.pool.DataSource 对象,再调用其 addJdbcInterceptor 方法即可实现。注:上述依赖类可从 ${tongweb.home}/version*/tongweb-web.jar 获取。</td></tr><tr><td>enableStatementEnhancer</td><td>语句设置</td><td>对新创建的语句进行默认设置,包括 SQL 超时、Fetch-Size 等。</td></tr><tr><td>queryTimeout</td><td>SQL超时</td><td>指定语句执行的超时时间,单位为秒。若超过这个时间,就会抛出一个SJLIMITException,适用于execute、executeQuery 和 executeUpdate 方法。“0”表示使用 JDBC 驱动程序的默认值。</td></tr><tr><td>fetchSize</td><td>Fetch-Size</td><td>给 JDBC 驱动程序一个提示,当该语句生成的结果集对象需要更多的行时,应该从数据库中获取的行数。若指定的值为“0”,则该提示将被忽略。</td></tr><tr><td>enableStatementCs a he</td><td>缓存语句</td><td>语句缓存可通过复用对象等方式提升 SQL 执行性能。</td></tr><tr><td>prepared</td><td>缓存PreparedStatement</td><td>对创建的 PreparedStatement 实例进行缓存。</td></tr><tr><td>callable</td><td>缓存CallableStatement</td><td>对创建的 CallableStatement 实例进行缓存。</td></tr><tr><td>max</td><td>单连接的最大缓存数</td><td>每个连接缓存语句的最大数量。</td></tr><tr><td>enableStatementFinalizer</td><td>自动关闭语句</td><td>追踪与连接相关的语句，并在Connection.close()时将其关闭。对于那些使用完连接但没有关闭相关语句的应用是非常有用的。</td></tr><tr><td>trace</td><td>跟踪语句堆栈</td><td>启用/禁用对未关闭语句的堆栈跟踪。启用后，若语句没有关闭，则通过日志记录其创建的堆栈，以便于排查程序问题。</td></tr><tr><td>releaseOnError</td><td>SQL错误时回收</td><td>在执行 SQL 遇到错误时，立即回收当前连接。</td></tr><tr><td>enableSlowQueryReport</td><td>监视慢 SQL</td><td>追踪 SQL 执行的时间，当对 execute/executeQuery或executeBatch 的调用成功并超过时间阈值时，记录缓慢的 SQL。</td></tr><tr><td>threshold</td><td>测量阈值</td><td>以毫秒为单位的阈值。若查询的速度比这个快，则不记录该 SQL。</td></tr><tr><td>maxQueries</td><td>最大 SQL 记录量</td><td>存储的最大 SQL 数量。</td></tr><tr><td>logSlow</td><td>记录较慢的 SQL</td><td>启用/禁用记录慢 SQL 日志，日志会记录在独立的 logs/sqI 目录以方便排查业务问题。</td></tr><tr><td>sqlForParamPrintRegex</td><td>记录 SQL 参数</td><td>在记录较慢的 SQL 时，是否一起记录数据参数（可能包含密码、ID、金额等敏感数据，请谨慎考虑），若需要记录则在此处输入哪些 SQL 需要记录，格式为正则表达式。注：出于安全考虑，不建议使用此功能。</td></tr><tr><td>logFailed</td><td>记录失败 SQL</td><td>启用/禁用记录失败 SQL 日志，日志会记录在独立的 logs/sqI 目录以方便排查业务问题。</td></tr></table>
Table 46. 数据源模板的【事务】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>JtaManaged</td><td>支持 JTA</td><td>若计划将此数据源应用于 EJB 事务或者用户管理的 JTA 事务，则需要开启 JTA 支持。开启 JTA 支持要求驱动类型为 XA 类型，且自动提交会被强制关闭。注：打开“线程绑定”后不支持此设置。</td></tr><tr><td>defaultAutoCommit</td><td>自动提交</td><td>连接创建时的默认自动提交状态。若支持 JTA，则会被强制关闭。</td></tr><tr><td>defaultTransactionIsolation</td><td>事务隔离级别</td><td>指定默认的事务隔离级别。“-1”表示由数据库驱动决定,“1”表示读未提交,“2”表示读已提交,“4”表示可重复读,“8”表示串行化。</td></tr><tr><td>rollbackOnReturn</td><td>归还连接时回滚</td><td>当有连接返回池中(连接的close 方法被调用)时,回滚任何未决的事务。该功能仅在“自动提交”关闭时生效。</td></tr><tr><td>commitOnReturn</td><td>归还连接时提交</td><td>当有连接返回池中(连接的close 方法被调用)时,提交任何未决的事务。该功能仅在“自动提交”关闭时生效。</td></tr><tr><td>defaultReadOnly</td><td>只读模式</td><td>将此连接置于只读模式,作为对驱动程序的提示,以实现数据库优化。</td></tr></table>

# C.2.5. Jdbc 模板
持久化位置：conf/console.xml:console>jdbcurltemplates>jdbcurltemplate
Table 47. Jdbc 模板的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>模板名称</td><td>设置此 Jdbc 模板的名称，为便于识别该模板，请尽量避开与“数据源”模块的“数据库连接方式”重名。</td></tr><tr><td>ipv4</td><td>IPv4 版本</td><td>指定该模板包含的 IP 地址的版本信息（IPv4 或者 IPv6），开启时表示 IPv4 地址，否则是 IPv6。</td></tr><tr><td>driver</td><td>驱动类</td><td>连接数据库的驱动类的全名称。</td></tr><tr><td>url</td><td>连接 URL</td><td>连接数据库的 JDBC URL，其中的 IP、端口以及数据库名请用 %s 替代，示例：jdbc:mysql://%s:%s/%s。</td></tr></table>

# C.2.6. 数据源集群
持久化位置：conf/tongweb.xml:tongweb>server>Resources>Resource
Table 48. 数据源集群的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>数据源集群的名称。</td></tr><tr><td>aliases</td><td>绑定 JNDI 名</td><td>对象的别名会被用作其绑定到 JNDI 资源树上的名字，一个对象可以逗号分隔指定多个别名。</td></tr><tr><td>datasourceNames</td><td>数据源列表</td><td>指定在数据源集群中包含的数据源。若没有选项，则需首先建立所需要的数据源。</td></tr><tr><td>strategy</td><td>调度策略</td><td>获取数据库连接时的调度策略，default：从列表的第一个开始，始终使用这一个，直到其不可用后切换为下一个；round-robin：从列表的第一个开始，本次使用这一个，下次切换为下一个；random：每次都从列表中随机选择一个使用；</td></tr></table>

# C.2.7. 安全域
持久化位置：conf/tongweb.xml:tongweb>server>realms>realm
Table 49. 安全域的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>安全域的名称。</td></tr><tr><td>lockOut</td><td>失败锁定</td><td>用户连续认证失败后被锁定。</td></tr><tr><td>failureCount</td><td>失败锁定次数</td><td>用户连续认证失败后被锁定的次数。</td></tr><tr><td>lockOutTime</td><td>锁定时长</td><td>用户在多次认证失败后被锁定的时间（秒）。</td></tr><tr><td>cacheSize</td><td>最大缓存数</td><td>缓存中保留的认证失败的用户数量。</td></tr><tr><td>cacheRemovalWarningTime</td><td>最小缓存时间</td><td>若一个用户被锁定超过这个时间（以秒为单位），且此时缓存达到了最大缓存数，则该用户可能会被解除锁定，此时会记录一条警告日志。</td></tr><tr><td>type</td><td>安全域类型</td><td>FILE 类型从本地文件读取用户和角色，文件位于\$\{tongweb.base\}/conf/realms 目录下；DATA_SOURCE 是通过指定的数据源从数据库中读取用户和角色。</td></tr><tr><td>dataSourceName</td><td>数据源名称</td><td>从数据库中读取用户及角色所采用的数据源，安全域类型为 DATA_SOURCE 时，该属性有效。</td></tr><tr><td>userTable</td><td>用户表</td><td>保存用户数据的表，安全域类型为 DATA_SOURCE 时，该属性有效。</td></tr><tr><td>userNameCol</td><td>用户名列</td><td>用户表中存放用户姓名的列，安全域类型为DATA_SOURCE 时，该属性有效。</td></tr><tr><td>userCredCol</td><td>用户密码列</td><td>用户表中保存用户密码的列,安全域类型为DATA_SOURCE时,该属性有效。</td></tr><tr><td>userRoleTable</td><td>角色表</td><td>保存用户和角色之间关系的表,安全域类型为DATA_SOURCE时,该属性有效。</td></tr><tr><td>-roleNameCol</td><td>角色名列</td><td>在用户角色表中命名一个角色的列,安全域类型为DATA_SOURCE时,该属性有效。</td></tr><tr><td>ip</td><td>LDAP服务器IP</td><td>指定LDAP服务器的IP地址。</td></tr><tr><td>port</td><td>LDAP服务器端口</td><td>指定LDAP服务器的监听端口。</td></tr><tr><td>connectionName</td><td>用户名</td><td>连接LDAP服务的用户名。</td></tr><tr><td>connectionPassword</td><td>连接密码</td><td>连接LDAP服务的密码。</td></tr><tr><td>userBase</td><td>用户基本域</td><td>指定在LDAP服务中查找用户的元素,如:ou=people,dc=mycompany,dc=com。</td></tr><tr><td>uid</td><td>用户属性的名称</td><td>指定在LDAP服务中用户属性的名称,如:uid。</td></tr><tr><td>userRoleName</td><td>用户角色属性名称</td><td>当用户中定义了代表角色的属性时需要填写,如:memberOf。</td></tr><tr><td>roleBase</td><td>角色基本域</td><td>指定在LDAP服务中查找角色的元素,如:ou=groups,dc=mycompany,dc=com。</td></tr><tr><td>-roleName</td><td>角色属性的名称</td><td>指定在LDAP服务中角色属性的名称,如:cn。</td></tr><tr><td>roleSearch</td><td>角色对应用户属性</td><td>指定在LDAP服务中角色对应的用户属性名称,如:uniqueMember。</td></tr><tr><td>loginModuleName</td><td>LoginModule 实现类</td><td>指定应用程序使用的JAAS登录模块全类名,需要实现javax.security.auth spi LoginModule接口。在TongWeb启动之前(注:启动后再放无效)需要将jar文件放置到${tongweb.base}/lib下。</td></tr><tr><td>userClassNames</td><td>用户Principal 实现类</td><td>指定用于表示用户的java.security.Principal实现类类名,以英文逗号分隔可设置多个,若设置多个,则以第一个作为javax.service.http.HttpServletRequest.getPrincipal()的返回值。在TongWeb启动之前(注:启动后再放无效)需要将jar文件放置到${tongweb.base}/lib下。</td></tr><tr><td>roleClassNames</td><td>角色 Principal 实现类</td><td>指定用于表示角色的 java.security.Principal 实现类类名。在 TongWeb 启动之前（注：启动后再放无效）需要将 jar 文件放置到 ${tongweb.base}/lib 下。</td></tr><tr><td>controlFlag</td><td>控制标志</td><td>设置 JAAS 登录模块的控制标志。</td></tr><tr><td>options</td><td>JAAS 参数</td><td>设置 JAAS 登录模块的附加参数。</td></tr></table>

# C.2.8. 安全域用户
持久化位置：conf/realms/security-realm.xml:users>user
Table 50. 安全域用户的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>clientCert</td><td>是客户端证书用户</td><td>若应用设置了 SSL 客户端认证，则需要在此处指定该用户为客户端证书用户，以在应用权限验证时获取客户端证书的角色。</td></tr><tr><td>name</td><td>用户名</td><td>用户的登录名，若是客户端证书用户，需遵循格式：CN=?，OU=?，O=?，L=?，ST=?，C=?；若在“全局配置”&gt;“服务器”中设置了“证书解析类”，则须遵循对应的格式要求。</td></tr><tr><td>password</td><td>密码</td><td>用户的登录密码。</td></tr><tr><td>roles</td><td>角色</td><td>用户的角色，多个角色以英文逗号分隔。</td></tr><tr><td>realmfile</td><td>安全域</td><td>所属的安全域名称。</td></tr></table>

# C.3. EJB 容器

# C.3.1. 无状态 EJB
持久化位置：conf/tongweb.xml:tongweb>server>ServiceJar>ServiceProvider
Table 51. 无状态 EJB的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>AccessTimeout</td><td>等待超时（秒）</td><td>从池中获取实例 Bean 等待的超时时间。</td></tr><tr><td>MaxSize</td><td>最大实例数</td><td>池中实例 Bean 的最大个数。</td></tr><tr><td>MinSize</td><td>最小实例数</td><td>池中实例Bean的初始值和最小个数。注：该值为0时，即表示延迟加载。</td></tr><tr><td>StrictPooling</td><td>池满等到</td><td>池中正在使用的实例Bean超过最大实例数时，有请求申请实例时是否要等待池空闲。</td></tr><tr><td>MaxAge</td><td>实例超时时间（小时）</td><td>实例Bean在池中允许存活的最大时间，0表示无限制。</td></tr><tr><td>ReplaceAged</td><td>实例超时替换</td><td>池中实例Bean存活时间超过“实例超时时间”后是否替换或删除。</td></tr><tr><td>ReplaceFlushed</td><td>刷新</td><td>调用池的刷新操作时，是否更新池中的实例Bean。</td></tr><tr><td>MaxAgeOffset</td><td>延迟参数</td><td>多个实例Bean同时创建时，避免实例Bean同时退休，可指定实例按时间比例来延迟退休。</td></tr><tr><td>IdleTimeout</td><td>空闲超时时间（分钟）</td><td>实例Bean的空闲时间超过该时间，就从实例池中删除该实例，0表示没有空闲超时时间。</td></tr><tr><td>GarbageCollection</td><td>实例垃圾回收</td><td>若开启，则池中的实例在JVM中以软引用方式保存，当JVM内存紧张就会回收池中实例。</td></tr><tr><td>SweepInterval</td><td>扫描频率（分钟）</td><td>对实例池进行扫描的周期。</td></tr><tr><td>CallbackThreads</td><td>线程数</td><td>替换池中实例所使用的线程池的线程数。</td></tr><tr><td>CloseTimeout</td><td>关闭超时时间（分钟）</td><td>关闭池操作的超时时间。</td></tr></table>

# C.3.2. 有状态 EJB
持久化位置：conf/tongweb.xml:tongweb>server>ServiceJar>ServiceProvider
Table 52. 有状态 EJB的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>AccessTimeout</td><td>等待超时（秒）</td><td>从池中获取实例 Bean 等待的超时时间。</td></tr><tr><td>TimeOut</td><td>空闲超时时间（分钟）</td><td>实例 Bean 在两次调用间能够等待的最大时间。</td></tr><tr><td>Frequency</td><td>扫描频率</td><td>扫描实例 Bean 缓存是否存在空闲的频率，单位为“秒”。</td></tr><tr><td>Capacity</td><td>缓存最大容量</td><td>Bean 容器中允许缓存的最大实例数。</td></tr><tr><td>BulkPassivate</td><td>钝化实例数</td><td>每次进行钝化处理的实例 Bean 数量。</td></tr><tr><td>refSessionHa</td><td>会话服务器</td><td>选择有状态 EJB 要连接的会话服务器，将有状态 EJB 的会话信息存储到会话服务器，以支持有状态 EJB 的会话高可用能力。若没有会话服务器可选，可在“资源管理”&gt;“会话服务器”中，创建会话服务器。</td></tr></table>

# C.3.3. 单例 EJB
持久化位置：conf/tongweb.xml:tongweb>server>ServiceJar>ServiceProvider
Table 53. 单例 EJB的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>AccessTimeout</td><td>等待超时（秒）</td><td>从池中获取实例等待的超时时间。</td></tr></table>

# C.3.4. 消息驱动 Bean
持久化位置：conf/tongweb.xml:tongweb>server>ServiceJar>ServiceProvider
Table 54. 消息驱动 Bean的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>Pool</td><td>使用实例池</td><td>是否使用实例池。</td></tr><tr><td>AccessTimeout</td><td>等待超时（秒）</td><td>从池中获取实例等待的超时时间。</td></tr><tr><td>CloseTimeout</td><td>关闭超时时间（分钟）</td><td>关闭池操作的超时时间。</td></tr><tr><td>InstanceLimit</td><td>实例数</td><td>消息驱动 Bean 的实例数。</td></tr></table>

# C.3.5. JTA 事务
持久化位置：conf/tongweb.xml:tongweb>server>ServiceJar>ServiceProvider
Table 55. JTA 事务的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>defaultTransactionTimeout</td><td>默认事务超时</td><td>如果没有在应用程序里显示地指定 JTA 事务超时时间，那么 JTA 事务将使用此默认超时时间（单位：秒）。</td></tr><tr><td>allowNonXaDS</td><td>允许 非XA 事务分支</td><td>在同一个 JTA 事务里，允许加入非 XA 事务分支的个数；0 表示不允许，1 表示最多允许一个，2 表示不限制。</td></tr><tr><td>tmJoinEnabled</td><td>合并事务分支</td><td>当多个事务分支指向同一个数据库时，是否需要根据数据库驱动的探测状态归并入一个分支。</td></tr></table>

# C.3.6. EJB http 协议
持久化位置：conf/tongweb.xml:tongweb
Table 56. EJB http协议的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>ejbHttpEnabled</td><td>EJB http协议</td><td>启用EJB http协议，启用后可通过除“管理端口”之外的所有 HTTP 通道（如系统默认的访问 web 应用的8088端口）访问远程 EJB 服务。</td></tr><tr><td>ejbHttpRestrictedPorts</td><td>限定访问端口</td><td>限定远程访问 EJB 服务的端口，只有指定的端口才允许访问，其它端口的访问将会被拒绝，不指定则表示所有端口均不允许访问。</td></tr></table>

# C.3.7. EJB w3 协议
持久化位置：conf/tongweb.xml:tongweb>server>enterprise>serverservices>serverservice
Table 57. EJB w3协议的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用</td><td>若不需要处理 EJB 或受限于防火墙不能开放对应的端口，则可以不启用此专有协议。</td></tr><tr><td>bind</td><td>绑定 IP</td><td>指定该 EJB 协议绑定的 IP 地址。</td></tr><tr><td>port</td><td>端口号</td><td>指定该 EJB 协议绑定的端口。</td></tr><tr><td>only_from</td><td>允许的客户端</td><td>设置允许连接本服务的客户端 IP 地址，多个 IP 地址以英文逗号分隔；不设置，则表示不限制客户端 IP。</td></tr><tr><td>timeout</td><td>连接超时</td><td>与客户端建立连接的超时时间，单位为毫秒。</td></tr><tr><td>backlog</td><td>连接队列</td><td>传入连接队列的请求的最大长度。</td></tr><tr><td>forceSocketClose</td><td>自动关闭</td><td>Socket被忘记关闭时，自动关闭Socket。</td></tr><tr><td>socketReadTimeout</td><td>读超时时间</td><td>Socket读超时时间，单位（秒）。对与此Socket相关的输入流读取调用将只阻塞这个时间。</td></tr><tr><td>keepAliveTime</td><td>会话超时</td><td>与客户端的会话超时时间（单位：秒），当客户端与服务器没有任何通信的时长超过该值后，客户端连接将被强制终止。</td></tr></table>
Table 58. EJB w3协议的【连接参数】
Table 59. EJB w3协议的【线程】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>threadsCore</td><td>最小备用线程数</td><td>线程池中用于处理网络请求的最小的备用线程数，即线程池中最少存在的线程数。</td></tr><tr><td>threads</td><td>最大线程数</td><td>线程池中用于处理网络请求的最大的线程数。</td></tr><tr><td>queue</td><td>最大等待数量</td><td>暂存待执行任务的队列长度。</td></tr></table>
Table 60. EJB w3协议的【其它】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>iiop</td><td>兼容 IIOP 协议</td><td>开启兼容 IIOP 协议后，可支持使用 IIOP 协议连接 EJB 服务，如 iiop://IP:5200。</td></tr></table>

# C.3.8. JCA 连接池
持久化位置：conf/tongweb.xml:tongweb>server>Resources>Resource
Table 61. JCA 连接池的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>连接池名称</td><td>JCA 连接池的名称。</td></tr><tr><td>aliases</td><td>绑定 JNDI 名</td><td>对象的别名会被用作其绑定到 JNDI 资源树上的名字，一个对象可以逗号分隔指定多个别名。</td></tr><tr><td>ResourceAdapter</td><td>资源适配器</td><td>已部署的资源适配器的名称，rar类型的Connector应用，用于和外部企业信息系统（Enterprise Information Systems，EIS）连接。</td></tr><tr><td>connectionDefinition</td><td>连接定义</td><td>连接池的连接接口定义，取决于资源适配器的ra.xml。</td></tr><tr><td>minSize</td><td>最小连接数</td><td>连接池的初始化连接数。</td></tr><tr><td>maxSize</td><td>最大连接数</td><td>连接池的最大连接数。</td></tr><tr><td>blockingTimeoutMilli seconds</td><td>等待超时</td><td>从连接池中获取连接的最长等待时间（单位：毫秒）。</td></tr><tr><td>idleTimeoutMinutes</td><td>空闲超时</td><td>连接的空闲超时时间（单位：分钟）。</td></tr><tr><td>selectOneAssumeMa tch</td><td>连接匹配</td><td>获取连接时由资源适配器进行匹配。</td></tr><tr><td>otherProperties</td><td>其他属性</td><td>适配器提供的特有的属性键值对，格式key=value，多个属性以英文逗号分隔。</td></tr></table>

# C.3.9. JCA 托管对象
持久化位置：conf/tongweb.xml:tongweb>server>Resources>Resource
Table 62. JCA 托管对象的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>托管对象名称</td><td>托管对象资源的名称。</td></tr><tr><td>aliases</td><td>绑定 JNDI 名</td><td>对象的别名会被用作其绑定到 JNDI 资源树上的名字，一个对象可以逗号分隔指定多个别名。</td></tr><tr><td>ResourceAdapter</td><td>资源适配器</td><td>已部署的资源适配器的名称，rar类型的Connector应用，用于和外部企业信息系统EIS连接。</td></tr><tr><td>resourceType</td><td>资源类型</td><td>资源类型，取决于资源适配器的 ra.xml。</td></tr><tr><td>otherProperties</td><td>其他属性</td><td>适配器提供的特有的属性键值对，格式 key=value，多个属性以逗号分隔。</td></tr></table>

# C.3.10. JavaMail 资源
持久化位置：conf/tongweb.xml:tongweb>server>Resources>Resource
Table 63. JavaMail 资源的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>JavaMail资源的名称。</td></tr><tr><td>aliases</td><td>绑定JNDI名</td><td>对象的别名会被用作其绑定到JNDI资源树上的名字，一个对象可以逗号分隔指定多个别名。</td></tr><tr><td>smtpHost</td><td>邮件服务器地址</td><td>邮件服务器地址，默认为smtp.163.com。</td></tr><tr><td>smtpPort</td><td>邮件服务器端口</td><td>邮件服务器发送端口，默认为25。</td></tr><tr><td>from</td><td>发件邮箱</td><td>邮件的From属性，连接邮件服务器后默认的邮件发送者的邮箱，必须是登录验证后的邮箱地址。若登录用户名使用的是邮箱地址，则该属性可以设置为相同的内容，发送邮件时则不用再设置邮件的From属性（使用匿名显示）。建议填写，否则容易发邮件失败。</td></tr><tr><td>user</td><td>登录用户名</td><td>连接邮件服务器时使用的默认用户名，用于登录验证邮件服务器。建议填写，否则容易发邮件失败。</td></tr><tr><td>password</td><td>登录密码</td><td>连接邮件服务器时使用的默认密码，用于登录验证邮件服务器。建议填写，否则容易发邮件失败。</td></tr><tr><td>debug</td><td>打印日志</td><td>是否打印详细日志信息。</td></tr><tr><td>otherProperties</td><td>其他属性</td><td>属性键值对，格式key=value，多个属性以英文逗号分隔，不符合规范的属性无法生效。</td></tr></table>

# C.3.11. 工作管理器
持久化位置：conf/tongweb.xml:tongweb>server>Resources>Resource
Table 64. 工作管理器的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识符，工作管理器名称。</td></tr><tr><td>aliases</td><td>绑定 JNDI 名</td><td>对象的别名会被用作其绑定到 JNDI 资源树上的名字，一个对象可以逗号分隔指定多个别名。</td></tr><tr><td>管理工作器线程池 Pool</td><td>工作管理器线程池</td><td>应用选择已创建的工作管理器线程池，通过调用线程运行应用创建的工作任务。这些线程是被服务器所管理，而不是应用创建，也无需由应用自身维护。</td></tr></table>

# C.4. 其它容器

# C.4.1. OSGi 服务
持久化位置：conf/tongweb.xml:tongweb>server>osgi
Table 65. OSGi 服务的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>osgiEnabled</td><td>启用</td><td>开启该功能后，TongWeb将运行一个OSGi容器，用以部署OSGi Bundle。</td></tr><tr><td>deployDir</td><td>部署目录</td><td>设置OSGi Bundle的部署目录，部署的OSGi Bundle将会保存到该目录下。注：出于安全考虑，TongWeb不会自动创建该目录，请确保该目录是存在且可读可写的。</td></tr><tr><td>autoDeploy</td><td>自动部署</td><td>开启该功能后，只需要将OSGi Bundle拷贝到部署目录下，即会自动部署该Bundle。</td></tr><tr><td>autoDeployPeriod</td><td>自动部署周期</td><td>设置每隔多久（单位：秒）扫描一次部署目录，检查是否有新的文件、更新的文件或删除的文件，以进行对应Bundle的部署、更新或卸载操作。</td></tr></table>

# C.4.2. OSGi 应用
持久化位置：conf/tongweb.xml:tongweb>server>osgi>apps>app
Table 66. OSGi 应用的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>fileFrom</td><td>文件来源</td><td>应用文件可以从客户端上传，也可以从服务器端指定的位置读取。注：出于安全考虑，TongWeb 出厂设置禁用了文件上传功能，您可在“控制台安全”模块了解详情和进行相关的配置操作。</td></tr><tr><td>fromServer</td><td>应用位置</td><td>指定服务器上应用文件的位置，须是 *.jar 类型的文件。</td></tr><tr><td>fromUpload</td><td>上传文件</td><td>上传一个应用文件到服务器，须是 *.jar 类型的文件。</td></tr></table>

# C.4.3. WebFlux 应用
持久化位置：conf/tongweb.xml:tongweb>server>webflux>apps>app
Table 67. WebFlux 应用的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>应用名</td><td>表示WebFlux应用的名称。</td></tr><tr><td>fromServer</td><td>应用位置</td><td>指定服务器上应用文件的位置，须是*.war类型的文件。</td></tr><tr><td>startClass</td><td>启动类</td><td>应用的启动类。如果为空，TongWeb将从应用内META-INF/MANIFEST.MF文件中获取，读取参数为Start-Class。</td></tr><tr><td>loadManifestClassPath</td><td>加载Class-Path资源</td><td>开启后，将会根据应用根目录下的META-INF/MANIFEST.MF文件（Class-Path参数）来加载更多的jar等文件到应用中。</td></tr><tr><td>manifestClassPathBase</td><td>Class-Path相对目录</td><td>指定加载Class-Path资源时的相对目录，将会在此目录下查找和加载Class-Path中指定的jar等文件。</td></tr></table>

# C.5. 资源管理

# C.5.1. 公共类库
持久化位置：conf/tongweb.xml:tongweb>server>libs>lib
Table 68. 公共类库的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>类库名称</td><td>类库名称可用于识别该类库的内容、用途等，方便管理。</td></tr><tr><td>description</td><td>描述</td><td>提供该类库的内容、用途等方面的信息。</td></tr><tr><td>libraries</td><td>类库路径</td><td>指定该类库包含的 jar/class 文件在服务器上的位置，可进行文件上传，上传的文件会保存到 ${tongweb.base}/data/upload。注：出于安全考虑，TongWeb 出厂设置禁用了文件上传功能，您可在“控制台安全”模块了解详情和进行相关的配置操作。</td></tr></table>

# C.5.2. 会话服务器
持久化位置：conf/tongweb.xml:tongweb>server>sessionhas>sessionha
Table 69. 会话服务器的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>会话服务器的名称，用以在应用部署或虚拟主机开启会话共享时绑定会话服务器。</td></tr><tr><td>useExternalSessionServer</td><td>使用外部会话服务器</td><td>会话服务器分为内部和外部两种，内部是指由TongWeb集中管理控制台创建的，外部是指不受TongWeb管理的会话服务器。外部会话服务器一般由人工自行建立或其它系统管理。</td></tr><tr><td>refSessionServer</td><td>TongDataGrid</td><td>选择由TongWeb集中管理控制台创建的TongDataGrid。</td></tr><tr><td>serverType</td><td>服务器类型</td><td>指定外部会话服务器的类型。</td></tr><tr><td>mode</td><td>连接模式</td><td>指定连接所使用的模式。</td></tr><tr><td>sentinelMasterId</td><td>哨兵主ID</td><td>在使用哨兵模式时，指定哨兵主的ID。</td></tr><tr><td>sentinelPassword</td><td>哨兵密码</td><td>在使用哨兵模式时，哨兵密码。</td></tr><tr><td>address</td><td>服务器地址</td><td>连接外部会话服务器的地址，使用英文逗号分隔可设置多个，请按照具体外部会话服务器的要求正确填写。</td></tr><tr><td>clusterName</td><td>认证名</td><td>连接会话服务器所需要的组名。</td></tr><tr><td>username</td><td>用户名</td><td>连接会话服务器所需要的用户名。</td></tr><tr><td>password</td><td>认证密码</td><td>连接远端外部会话服务器所需要的认证密码。</td></tr><tr><td>database</td><td>数据库ID</td><td>指定Redis使用的数据库ID号。</td></tr><tr><td>timeOut</td><td>通信超时</td><td>与会话服务器通信的超时时间（单位：毫秒）。</td></tr><tr><td>directCache</td><td>缓存直连</td><td>开启后，TongWeb将放弃在本地内存中存取Session数据，而全部从会话服务器中存取。若不开启，则优先使用本地内存，在本地内存中数据版本号低于Cookie中记录的号码时再从会话服务器同步。</td></tr><tr><td>useLock</td><td>启用分布式锁</td><td>开启后，同一个SessionID的数据，一次仅能被一个客户端请求访问，并发访问将会被强制等待，适用于同一个Session并发访问一致性的场景。注：仅对相同ID的Session加锁，不同的Session之间不会加锁，这类似数据库的行级锁。</td></tr><tr><td>deferredWrite</td><td>合并写入</td><td>开启后，在一次请求的处理过程中，对 Session 的多次写入不会立即写入到会话服务器，而是等到请求处理完毕后，合并到一起写入到会话服务器。</td></tr><tr><td>syncClean</td><td>被动清理</td><td>开启后，远程会话服务器上的 Session 信息过期或者销毁时，将同步清理本服务器上的 Session 信息。注：开启此功能会有微小的资源消耗，若不开启，Session 信息也会在超时后自动清理。</td></tr></table>

# C.5.3. 短信服务
持久化位置：conf/tongweb.xml:tongweb>server>smss>sms
Table 70. 短信服务的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>短信服务的名称。</td></tr><tr><td>implClass</td><td>实现类</td><td>需由用户提供的发送短信的实现类。该类需提供一个有参构造方法，参数依次是：接口地址（String）、认证 ID（String）、认证密钥（String）、附加参数（Map），以及一个名为 send 的实例方法，方法参数依次是：短信服务签名（String）、短信服务ID（String）、接收人手机号（String[]）、服务器信息（String[]），其中服务器信息参数值依次是：服务器IP、TongWeb 实例名、预警策略名、预警消息。注：需在 TongWeb 启动之前，将相关的 jar 文件文件放置到了 ${tongweb.base}/lib 下。</td></tr><tr><td>address</td><td>接口地址</td><td>短信服务的接口地址，非必需，根据短信平台的具体要求而定。</td></tr><tr><td>appld</td><td>认证 ID</td><td>短信平台提供的认证标识。</td></tr><tr><td>appKey</td><td>认证密钥</td><td>短信平台提供的认证密钥。</td></tr><tr><td>additional</td><td>附加参数</td><td>短信服务需要的附加参数，根据需要进行填写，格式要求为 propertyName=propertyValue，多个参数以英文逗号分隔。</td></tr></table>

# C.5.4. 线程池
持久化位置：conf/tongweb.xml:tongweb>server>threadpools>threadpool
Table 71. 线程池的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>线程池的名称，此名称将用于创建线程时给线程命名。</td></tr><tr><td>maxThreads</td><td>最大线程数</td><td>线程池中用于处理网络请求的最大的线程数。</td></tr><tr><td>minSpareThreads</td><td>最小备用线程数</td><td>线程池中用于处理网络请求的最小的备用线程数，即线程池中最少存在的线程数</td></tr><tr><td>keepAliveTime</td><td>空闲超时</td><td>当线程池里的空闲线程数大于“最小备用线程数”时，线程空闲的时间超过该时间后将被回收。单位：秒。</td></tr><tr><td>queueSize</td><td>任务队列大小</td><td>设置用于保存任务并移交给工作线程的队列的大小。</td></tr><tr><td>priority</td><td>优先级</td><td>指定此线程的优先级。</td></tr></table>

# C.5.5. JNDI 资源
持久化位置：conf/tongweb.xml:tongweb>server>Resources>Resource
Table 72. JNDI 资源的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识符，将资源绑定到 JNDI 上的名称。</td></tr><tr><td>aliases</td><td>绑定 JNDI 名</td><td>对象的别名会被用作其绑定到 JNDI 资源树上的名字，一个对象可以逗号分隔指定多个别名。</td></tr><tr><td>factoryClass</td><td>工厂类</td><td>指定创建资源对象的工厂类全名称，该工厂类须实现 javax.naming.spi.ObjectFactory 接口，编程时，将该接口的 getObjectInstance 方法的第一个参数强转为 javax.naming.Reference 类型，以此可获取到“资源类型”和“其它属性”的配置参数。若不设置则使用工厂类com.tongweb.naming.factory.GeneralBeanFactory。</td></tr><tr><td>resourceType</td><td>资源类型</td><td>指定要绑定的资源对象的类全名称，如：
: java.lang.Object。</td></tr><tr><td>otherProperties</td><td>其它属性</td><td>指定创建资源对象时需要的其它属性，格式 key=value，多个属性以英文逗号分隔。</td></tr><tr><td>klasspath</td><td>jar包位置</td><td>设置工厂类所在的Jar文件的绝对路径，多个路径以英文逗号分隔，如果在启动之前（注：启动后再放无效）已经将文件放置到了${tongweb.base}/lib下，则可以不设置。</td></tr></table>

# C.5.6. 注册中心
持久化位置：conf/tongweb.xml:tongweb>registrys>registry
Table 73. 注册中心的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>该组件的唯一标识。</td></tr><tr><td>registryServerType</td><td>服务提供商</td><td>指定提供该服务的产品类型。注意：当选择 ZooKeeper 时，请先在 Zookeeper 所在服务器手动创建 TongWeb 的节点“TongWeb”，并启用所有权限；若不创建 TongWeb 节点，系统会自动创建但不会设置权限，需要手动启用所有权限。当选择 Nacos 或 TongNCS 时，若 Nacos 或 TongNCS 后台管理控制台看不到 TongWeb 相关数据，可手动在后台管理控制台创建 TongWeb 的命名空间“TongWeb”</td></tr><tr><td>address</td><td>服务地址</td><td>指定服务器的连接地址。</td></tr><tr><td>aclToken</td><td>ACL 认证 Token</td><td>Consul 通过 ACL（Access Control List）机制进行身份验证和授权。</td></tr><tr><td>username</td><td>用户名</td><td>连接服务器所需要的用户名。</td></tr><tr><td>password</td><td>密码</td><td>连接服务器所需要的认证密码。</td></tr><tr><td>apolloPortalUrl</td><td>Apollo 门户地址</td><td>这是 Apollo 配置中心 Web 管理界面的服务地址。在通过 OpenAPI 进行操作时，需要指定此地址来连接到正确的 Portal 服务。通常格式为 http://{{portal-service-ip}}:{port}，其中默认端口常为 8070。</td></tr><tr><td>apolloToken</td><td>开放 API Token</td><td>调用 Apollo OpenAPI 时所需的认证令牌。它用于在程序（而非浏览器）中安全地访问 Apollo 的管理接口，例如读取配置、创建发布等。</td></tr><tr><td>appId</td><td>应用标识</td><td>Apollo中项目的唯一身份标识,在Apollo门户中创建项目时设定。Apollo客户端会根据这个ID来确定要拉取哪个应用的配置。此参数必须与Apollo门户上配置的完全一致。</td></tr><tr><td>clusterName</td><td>集群名称</td><td>用于在同一个环境中对应用实例进行逻辑分组。例如,您可以按数据中心(cluster1, cluster2)或按应用版本进行分集群配置。默认为default,如果无需分集群管理,使用默认值即可。</td></tr><tr><td>namespaceName</td><td>命名空间名称</td><td>Apollo配置的组织单元,相当于一个配置文件或配置模块。默认的命名空间是application。您可以创建多个命名空间(如redis.properties, message.yml)来对配置进行分门别类的管理。公共命名空间需要指定全名(如FX.apollo),私有命名空间直接写名称即可。</td></tr><tr><td>env</td><td>环境</td><td>指定您希望从哪个Apollo环境(如开发、测试、生产)获取配置。常见值有:DEV(开发),FAT(测试),UAT(用户验收测试),PRO(生产)。此参数决定了配置的来源环境。</td></tr><tr><td>ApolloOperator</td><td>Apollo操作用户</td><td>Apollo中用于标识操作来源的标记,通常是一个用户名或系统标识。</td></tr><tr><td>registryName</td><td>标识符</td><td>设置唯一标识符。</td></tr><tr><td>refLib</td><td>添加类库</td><td>附加依赖库。若没有类库可选,可在“公共类库”中,添加公共类库。</td></tr></table>

# C.6. 监视管理

# C.6.1. 概览
无

# C.6.2. 应用数据源
Table 74. 应用数据源的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>TongWeb 为此应用的数据源自动分配的 ID 号。</td></tr><tr><td>type</td><td>类型</td><td>TongWeb 探测到的数据源的类型。</td></tr><tr><td>packageName</td><td>类名</td><td>数据源类的全名称。</td></tr><tr><td>app</td><td>所属应用</td><td>数据源所在的应用。</td></tr></table>

# C.6.3. 操作系统
无

# C.6.4. JVM
无

# C.6.5. 组合监视
持久化位置：conf/tongweb.xml:tongweb>server>combinedmonitors>combinedmonitor
Table 75. 组合监视的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>monitors</td><td>监视信息</td><td>设置需要组合到一起进行监视的模块指标。</td></tr></table>

# C.6.6. 守护监视
持久化位置：conf/tongweb.xml:tongweb>server>daemonmonitors>daemonmonitor
Table 76. 守护监视的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>monitor</td><td>组合监视</td><td>指定一个组合监视，用以限定需要守护监视的系统指标范围，即指定监视的数据来源。注：以逗号分隔可指定多个。</td></tr><tr><td>startTime</td><td>开始时间</td><td>指定守护监视的开始时间。</td></tr><tr><td>endTime</td><td>结束时间</td><td>指定守护监视的结束时间。</td></tr><tr><td>interval</td><td>采集频率</td><td>设置在指定的时间内每间隔多久（单位：秒）进行一次对系统监视指标数据的采集。</td></tr><tr><td>totalCount</td><td>采集总次数</td><td>设置采集监视数据的总次数，达到后，将终止采集并结束本次守护监视。注：为0表示不限制采集次数。</td></tr><tr><td>fileName</td><td>文件名称</td><td>指定保存监视数据文件的名称。</td></tr><tr><td>filePath</td><td>文件路径</td><td>指定监视数据文件的存放目录。</td></tr><tr><td>rotationBySize</td><td>按大小轮转</td><td>当监视数据文件大小（单位：MB）达到该阈值时，将切割出一个新的监视数据文件。注：设置为0表示不启用此功能。</td></tr><tr><td>keepMaxDays</td><td>保留时长（天）</td><td>保留数据的时长（单位：天）。注：设置为0表示永久保存。</td></tr><tr><td>compression</td><td>文件压缩</td><td>是否开启监视数据文件压缩功能。开启后，对轮转后的监视数据文件进行压缩。</td></tr><tr><td>log</td><td>记录日志</td><td>当有采集动作发生时，是否在系统日志里记录一条信息。</td></tr><tr><td>enabled</td><td>是否启用</td><td>是否启用此守护监视。</td></tr></table>

# C.6.7. SNMP 服务
持久化位置：conf/tongweb.xml:tongweb>server>snmp
Table 77. SNMP 服务的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用</td><td>启用后，TongWeb会开启SNMP服务，监听客户端请求。</td></tr><tr><td>address</td><td>监听地址</td><td>SNMP服务的监听的IP地址，默认为“127.0.0.1”，即监听TongWeb所在的本机IP地址。若配置为“0.0.0.0”，则表示不限制，监听本机所有IP</td></tr><tr><td>port</td><td>监听端口</td><td>SNMP服务的监听端口。</td></tr><tr><td>engineID</td><td>引擎ID</td><td>设置当前SNMP服务的唯一标识。</td></tr><tr><td>securityName</td><td>认证名</td><td>用以识别客户端的身份。</td></tr><tr><td>authenticationPassphrase</td><td>认证密码</td><td>用以验证客户端的安全性。</td></tr><tr><td>authenticationProtocol</td><td>认证算法</td><td>设置验证密码采用的摘要算法。</td></tr></table>
Table 78. SNMP 服务的【身份认证】
Table 79. SNMP 服务的【数据安全】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>transportType</td><td>传输协议</td><td>指定数据在网络上的传输协议。</td></tr><tr><td>privacyProtocol</td><td>加密算法</td><td>设置数据加密采用的算法。</td></tr><tr><td>privacyPassphrase</td><td>加密密码</td><td>设置加密数据的密码。</td></tr></table>

# C.6.8. Prometheus 服务
持久化位置：conf/tongweb.xml:tongweb>server>prometheus
Table 80. Prometheus 服务的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用</td><td>启用后，TongWeb会主动或被动为Prometheus提供度量数据，方便通过Prometheus实现统一监控。</td></tr><tr><td>monitor</td><td>组合监视</td><td>指定一个组合监视，用以限定需要监视的系统指标范围。为空时，表示监视所有受管实例的系统默认指标。</td></tr><tr><td>monitorRegisteredInstances</td><td>监视注册实例</td><td>启用后，注册实例会主动或被动为Prometheus提供度量数据，并推送注册实例的信息，从而方便通过Prometheus实现统一监控。</td></tr><tr><td>reportMode</td><td>上报方式</td><td>数据上报支持拉取和推送两种方式。拉取方式由Prometheus主动发送请求拉取数据，默认地址：http://ip:{port}/metrics；推送方式由TongWeb定时将数据推送到指定的PushGateway端，再由Prometheus发送请求拉取数据。</td></tr><tr><td>address</td><td>监听地址</td><td>为接收Prometheus的拉取请求，TongWeb会开启一个本地监听服务，在这里指定监听服务的IP。</td></tr><tr><td>port</td><td>监听端口</td><td>为接收 Prometheus 的拉取请求，TongWeb 会开启一个本地监听服务，在这里指定监听服务的端口。</td></tr><tr><td>context</td><td>metrics地址</td><td>为接收 Prometheus 的拉取请求，TongWeb 会开启一个本地监听服务，在这里指定监听服务的 metrics 路径。可根据需要以逗号分隔设置多个。</td></tr><tr><td>authType</td><td>认证类型</td><td>设置数据拉取时的安全认证方式。</td></tr><tr><td>userName</td><td>用户名</td><td>接收 Prometheus 的拉取请求时需要认证的用户名。</td></tr><tr><td>password</td><td>密码</td><td>接收 Prometheus 的拉取请求时需要认证的密码。</td></tr><tr><td>pushGatewayAddress</td><td>PushGateway 地址</td><td>推送到 PushGateway 的地址。</td></tr><tr><td>interval</td><td>推送间隔</td><td>设置每间隔多少秒推送一次数据。</td></tr></table>

# C.6.9. OTLP 支持
持久化位置：conf/tongweb.xml:tongweb>server>otlp
Table 81. OTLP 支持的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用</td><td>启用后，TongWeb 可向外提供其监视功能的度量数据，方便用户实现统一监控。</td></tr><tr><td>monitor</td><td>组合监视</td><td>指定一个组合监视，用以限定需要监视的系统指标范围。</td></tr><tr><td>endpointAddress</td><td>接收数据的地址</td><td>将监控数据推送到支持 OTLP 地址。</td></tr><tr><td>interval</td><td>推送间隔（秒）</td><td>设置每间隔多少秒推送一次数据。</td></tr></table>

# C.7. 诊断管理

# C.7.1. 快照文件
Table 82. 快照文件的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>snapshotTemplate</td><td>采集模板</td><td>选择本次快照生成所依据的采集模板。</td></tr></table>

# C.7.2. 预警策略
持久化位置：conf/tongweb.xml:tongweb>server>thresholds>threshold
Table 83. 预警策略的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>预警策略的唯一标识。</td></tr><tr><td>enabled</td><td>是否启用</td><td>是否启用此预警策略。</td></tr><tr><td>interval</td><td>预警间隔</td><td>两次预警的时间间隔（单位：分钟）。在该时间段内最多进行一次预警以节省系统资源。</td></tr><tr><td>info</td><td>描述</td><td>对这个预警策略备注必要的说明信息。</td></tr></table>
Table 84. 预警策略的【触发条件】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>cpuThreshold</td><td>CPU负载</td><td>只有当CPU负载大于该阈值时（单位：百分比），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>memoryThreshold</td><td>内存使用率</td><td>只有当内存使用率大于该阈值时（单位：百分比），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>diskThreshold</td><td>硬盘使用率</td><td>只有当硬盘使用率大于该阈值时（单位：百分比），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>connectorThreshold</td><td>通道线程使用率</td><td>只有当通道线程使用率大于该阈值时（单位：百分比），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>connectorName</td><td>监控的通道</td><td>设置要监控的通道。</td></tr><tr><td>datasourceThreshold</td><td>数据源连接使用率</td><td>只有当数据源连接使用率大于该阈值时（单位：百分比），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>datasourceName</td><td>监控连接使用率的数据源</td><td>设置要监控连接使用率的数据源。</td></tr><tr><td>dsMaxConnThreshold</td><td>数据源最大连接数</td><td>只有当数据源最大连接数大于该阈值时，才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>maxConnDsName</td><td>监控最大连接数的数据源</td><td>设置要监控最大连接数的数据源。</td></tr><tr><td>appDatasourceThreshold</td><td>应用数据源连接使用率</td><td>只有当应用数据源连接使用率大于该阈值时(单位:百分比),才会触发指定的处理办法,0表示不开启此项监控。</td></tr><tr><td>appdatasourceName</td><td>监控连接使用率的应用数据源</td><td>设置要监控连接使用率的应用数据源。</td></tr><tr><td>appdsMaxConnThreshold</td><td>应用数据源最大连接数</td><td>只有当应用数据源最大连接数大于该阈值时,才会触发指定的处理办法,0表示不开启此项监控。</td></tr><tr><td>maxConnAppDsName</td><td>监控最大连接数的应用数据源</td><td>设置要监控最大连接数的应用数据源。</td></tr><tr><td>gcThreshold</td><td>FullGC平均时间</td><td>只有当FullGC平均时间大于该阈值时(单位:秒),才会触发指定的处理办法,0表示不开启此项监控。</td></tr><tr><td>gcConditionCount</td><td>FullGC次数条件</td><td>FullGC平均时间的附件条件,指定统计最近几次的FullGC,非必选,单位:次。当FullGC平均时间大于0且指定了FullGC次数条件后,只有最近N次的FullGC的平均时间大于等于FullGC平均时间的阈值才预警(N为指定的次数)。若不填或者小于等于0,则表示没有附件条件,只要FullGC总的平均时间大于等于设定阈值就预警。</td></tr><tr><td>gcConditionTime</td><td>FullGC时间条件</td><td>FullGC平均时间的附件条件,指定统计最近几分钟内的FullGC,非必选,单位:分钟。当FullGC时间大于0且指定了FullGC时间条件后,只有最近N分钟内的FullGC的平均时间大于等于FullGC平均时间的阈值才预警(N为指定的分钟数)。若不填或者小于等于0,则表示没有附件条件,只要FullGC总的平均时间大于等于设定阈值就预警。</td></tr><tr><td>gcCountThreshold</td><td>FullGC累计次数</td><td>只有FullGC累计次数大于该阈值时(单位:次),才会触发指定的处理办法,0表示不开启此项监控。</td></tr><tr><td>gcCountCondition</td><td>FullGC 时间条件</td><td>FullGC累计次数的附加条件，指定统计最近几分钟内的FullGC，非必选，单位：分钟。当FullGC累计次数大于0且指定了FullGC时间条件后，只有最近N分钟内的FullGC的次数大于等于FullGC累计次数的阈值才预警（N为指定的分钟数）。若不填或者小于等于0，则表示没有附件条件，只要FullGC总的次数大于等于设定阈值就预警。</td></tr><tr><td>gcTimeThreshold</td><td>FullGC 累计时间</td><td>只有FullGC累计时间大于该阈值时（单位：秒），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>gcTimeCondition</td><td>FullGC 时间条件</td><td>FullGC累计时间的附加条件，指定统计最近几分钟内的FullGC，非必选，单位：分钟。当FullGC累计时间大于0且指定了FullGC时间条件后，只有最近N分钟内的FullGC的累计时间大于等于该阈值才预警（N为指定的分钟数）。若不填或者小于等于0，则表示没有附件条件，只要FullGC累计时间大于等于设定阈值就预警。</td></tr><tr><td>threadCountThreshold</td><td>JVM 线程总数</td><td>只有当JVM线程总数大于该阈值时（单位：个），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>slowSQLThreshold</td><td>数据源慢 SQL 数</td><td>只有当慢SQL数大于该阈值时（单位：个），才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>slowSQLDsName</td><td>监控慢 SQL 数的数据源</td><td>设置要监控慢 SQL 数的数据源。</td></tr><tr><td>hungThreadThreshold</td><td>应用慢线程数</td><td>只有当应用慢线程数量大于该阈值时，才会触发指定的处理办法，0表示不开启此项监控。</td></tr><tr><td>appName</td><td>监控慢线程的应用</td><td>设置要监控慢线程的应用。</td></tr></table>
Table 85. 预警策略的【处理办法】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>snapshotTemplate</td><td>生成快照</td><td>选择已创建的采集模板，当预警策略中所有的预警条件的系统实际运行数据大于等于阈值时，会按照选中的采集模板生成指定内容的快照文件。</td></tr><tr><td>keepMaxFiles</td><td>保留文件个数</td><td>指定在清理该策略产生的快照文件时要保留的个数。</td></tr><tr><td>jmsEnable</td><td>发送JMS消息</td><td>满足触发条件后，是否通过JMS发送预警通知。</td></tr><tr><td>jmsConnectionPool</td><td>JCA 连接池</td><td>选择已创建的 JCA 连接池，用于发送 JMS 消息。</td></tr><tr><td>jmsAdminObject</td><td>JCA 托管对象</td><td>选择已创建的 JCA 托管对象，用于发送 JMS 消息。</td></tr><tr><td>javamailEnable</td><td>发送邮件</td><td>满足触发条件后，是否通过电子邮件发送预警通知。</td></tr><tr><td>from</td><td>发件人地址</td><td>选择已创建的 JAVA 资源，用于发送邮件。</td></tr><tr><td>to</td><td>收件人地址</td><td>指定接收预警通知的电子邮件地址。</td></tr><tr><td>smsEnable</td><td>发送短信</td><td>满足触发条件后，是否通过短信发送预警通知。</td></tr><tr><td>sms</td><td>短信服务</td><td>选择已创建的短信服务，用于发送短信。</td></tr><tr><td>smsSign</td><td>短信服务签名</td><td>发送短信时使用的签名，该签名通常会添加到短信内容的开头处，一般位于【】里面，具体需要在短信服务平台进行设定。</td></tr><tr><td>smsID</td><td>短信服务 ID</td><td>发送短信时使用的短信服务平台的模板 ID，具体需要在短信服务平台进行设定。</td></tr><tr><td>smsTel</td><td>接收人手机号</td><td>指定接收预警通知的手机号码，多个号码之间以英文逗号分隔。</td></tr><tr><td>responseCodeEnable</td><td>发送响应码</td><td>此预警处理办法会中断指定端口上的请求，并返回指定的 HTTP 响应码。</td></tr><tr><td>connectorNames</td><td>响应端口</td><td>指定在哪些端口上返回响应码。</td></tr><tr><td>responseCode</td><td>响应码</td><td>设置要返回到客户端的响应码。</td></tr><tr><td>responseContent</td><td>响应内容</td><td>设置需要通过 HTTP 消息体返回到客户端的信息。</td></tr><tr><td>responsePath</td><td>匹配路径</td><td>当请求的路径与匹配路径一致时才会发送响应码，为空则表示不校验请求路径，即所有请求路径都会发送响应码。</td></tr></table>

# C.7.3. 采集模板
持久化位置：conf/tongweb.xml:tongweb>server>snapshots>snapshot
Table 86. 采集模板的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>标识该采集模板的名称。</td></tr></table>
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>monits</td><td>监视信息</td><td>下拉框中包含TongWeb的全部监视信息，根据需要勾选不同类型的监视信息，这些信息将记录到生成的快照的监视文件monitor.xml中。</td></tr><tr><td>configInfo</td><td>配置信息</td><td>选中配置信息，会记录TongWeb域目录下conf子目录中所有的文件。若存在“bin/JAVA_HOME.txt”，也会记录该文件。</td></tr><tr><td>logInfo</td><td>日志</td><td>选中某日志，会记录TongWeb域目录下相应的日志文件。</td></tr><tr><td>tools</td><td>分析工具</td><td>选中的分析工具将生成对应的文件以反映某时刻TongWeb的运行状态。注：部分分析工具仅在Linux平台有效，如：coredump、top、lsof、netstat等。</td></tr><tr><td>info</td><td>描述</td><td>描述信息。</td></tr></table>

# C.7.4. 死锁线程
无

# C.7.5. 阻塞线程
无

# C.7.6. 忙碌线程
无

# C.7.7. 数据库连接
无

# C.7.8. 类加载结构
无

# C.7.9. 类资源分析
Table 87. 类资源分析的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>className</td><td>查找类</td><td>指定要查找的类的全名称，如：java.lang.Object。</td></tr><tr><td>app</td><td>查找范围</td><td>选定一个应用，在其中查找指定的类。</td></tr><tr><td>foundPath</td><td>分布位置</td><td>查找的类的所有分布的位置。</td></tr><tr><td>loadedPath</td><td>加载位置</td><td>查找的类的实际加载位置。</td></tr><tr><td>classLoader</td><td>加载器</td><td>实际加载的类加载器。</td></tr></table>

# C.7.10. JNDI 树
无

# C.8. 日志管理

# C.8.1. 系统日志
持久化位置：conf/tongweb.xml:tongweb>server>loggers>server
Table 88. 系统日志的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>logPattern</td><td>日志格式</td><td>日志内容的记录格式，包括时间戳、线程名、日志级别等。</td></tr><tr><td>enableConsoleLogging</td><td>启用控制台日志</td><td>启用后，系统将在控制台输出日志信息</td></tr><tr><td>takeoverJUL</td><td>接管 Java Logger</td><td>将使用 java.utillogging.Logger 打印的应用日志转入到TongWeb 日志模块统一处理，如存入 TongWeb 的server.log 日志文件等。不开启，则会丢弃这些应用日志。注：若应用已有 Java Logger 配置且需要使用自己的，则需修改 tongweb.xml，删除-Djava.utillogging/logmanager 参数。</td></tr><tr><td>takeoverSystemPrint</td><td>接管系统打印</td><td>将系统打印（System.out、System.err）的日志转入到日志模块统一处理。注：若不开启，则会丢弃这些日志。</td></tr><tr><td>printToConsoleOnly</td><td>应用日志仅输出到控制台</td><td>启用后,应用代码通过系统打印 (System.out、System.err)和JUL (java.utilloggingloggers)输出的日志将仅在控制台输出,而不再存入系统日志文件(即默认的server.log文件)。</td></tr><tr><td>enableAsynchronous Logging</td><td>开启异步日志</td><td>日志记录可以在单独的线程中执行,好处是应用程序本身不会被缓慢的IO操作阻塞,写入线程以低优先级运行并与应用程序一起自动关闭。</td></tr><tr><td>bufferQueueSize</td><td>缓冲队列大小</td><td>日志缓冲队列大小,单位为条数。缓冲队列所能容纳的日志字节大小的最大值为缓冲队列大小乘以每条日志的字节大小,可据此估计日志子系统所需要的内存峰值。</td></tr><tr><td>checkInterval</td><td>轮询间隔</td><td>开启异步日志后,TongWeb会周期性检测是否有需要输出的日志,此处可设置检测的频率,即每隔多久检测一次,单位:毫秒。</td></tr></table>
Table 89. 系统日志的【日志文件】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>baseFile</td><td>文件目录</td><td>将日志文件存放到指定的目录下。</td></tr><tr><td>loggerFileName</td><td>文件名称</td><td>指定日志文件的名称，日志文件将以此名称开头存储在指定目录下。</td></tr><tr><td>appendTypeDir</td><td>追加类型目录</td><td>启用后，将在指定的文件目录下增加一个server目录以存放日志文件。</td></tr><tr><td>rollingFile</td><td>日志文件轮转</td><td>将日志信息按文件大小或时间进行轮转，确保日志文件不会过大。</td></tr><tr><td>append</td><td>日志追加</td><td>启用日志追加模式，日志信息将追加到现有日志文件中而不是覆盖。</td></tr><tr><td>rotationDay</td><td>按天轮转</td><td>将每日未达到大小阈值的日志在零点切割到一个新文件中。</td></tr><tr><td>rotationBySize</td><td>按大小轮转</td><td>当日志文件大小（单位：MB）达到该阈值时，将切割出一个新的日志文件。注：设置为0表示不启用此功能。</td></tr><tr><td>keepMaxFiles</td><td>保留文件个数</td><td>指定在清理日志文件时，需保留文件的个数。</td></tr><tr><td>compression</td><td>日志文件压缩</td><td>是否开启日志文件压缩功能。开启后，对轮转后的日志文件进行压缩。</td></tr><tr><td>chunk</td><td>文件编码</td><td>指定日志文件的编码格式。</td></tr><tr><td>buffered</td><td>缓冲写入</td><td>是否开启文件缓冲写入功能。开启后，当持续记录的日志内容大小（单位：字节）之和达到缓冲大小时才一次性写入文件，而不是每条日志都立即写入文件（在服务器停止时会全部写入），这通常可以提高日志记录性能。关闭后，每条日志都立即写入文件。</td></tr><tr><td>bufferedSize</td><td>缓冲大小</td><td>缓冲写入的阈值，当持续记录的日志内容大小（单位：字节）之和达到此值时，一次性写入进文件。</td></tr><tr><td>enableThreadLogging</td><td>开启线程日志</td><td>开启线程日志后，系统日志在原有日志的基础上，会同步地单独保存到一个独立的文件中，该文件以输出日志的当前线程的ID或线程名命名。注意：线程日志文件不具备压缩、缓冲、压缩等能力，且会在下次重启服务器或编辑日志配置时自动清空，不建议在生产环境下使用。</td></tr></table>
Table 90. 系统日志的【日志级别】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>logLevel</td><td>默认日志级别</td><td>设置默认日志级别，只有在日志信息的严重程度等于或高于此级别时，才会记录日志。</td></tr><tr><td>julLogLevel</td><td>Java Logger 日志级别</td><td>设置 Java Logger 日志级别，只有在日志信息的严重程度等于或高于此级别时，才会记录日志。注：其值低于“默认日志级别”时会自动使用“默认日志级别”。</td></tr><tr><td>enabledModuleLogLevel</td><td>启用模块日志级别</td><td>按模块设置各自的日志级别，而不使用默认日志级别。</td></tr><tr><td>moduleLogLevelDatasource</td><td>数据源</td><td>设置数据源模块的日志级别，只有在数据源模块日志信息的严重程度等于或高于此级别时，才会记录日志。</td></tr><tr><td>moduleLogLevelEJB</td><td>EJB 容器</td><td>设置 EJB 容器模块的日志级别，只有在 EJB 容器模块日志信息的严重程度等于或高于此级别时，才会记录日志。</td></tr><tr><td>moduleLogLevelConnector</td><td>通道</td><td>设置通道模块的日志级别，只有在通道模块日志信息的严重程度等于或高于此级别时，才会记录日志。</td></tr><tr><td>moduleLogLevelWebContainer</td><td>Web 容器</td><td>设置 Web 容器模块的日志级别，只有在 Web 容器模块日志信息的严重程度等于或高于此级别时，才会记录日志。</td></tr><tr><td>moduleLogLevelJNDI</td><td>JNDI</td><td>设置 JNDI 模块的日志级别，只有在 JNDI 模块日志信息的严重程度等于或高于此级别时，才会记录日志。</td></tr></table>
Table 91. 系统日志的【在线日志】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>initialShowLogLines</td><td>初始加载行数</td><td>设置首次打开在线日志页面时加载的最新日志行数。</td></tr><tr><td>pullLogLines</td><td>日志刷新大小</td><td>设置浏览器每次从服务器拉取日志的最大行数。拉取太多日志可能造成网络和服务器压力，请根据实际情况设置。</td></tr><tr><td>maxShowLines</td><td>最大显示行数</td><td>当Web日志页面累积输出的日志过多时，可能会引起浏览器压力过大而无响应，设置最大显示行数可丢弃超出行数的部分以减轻浏览器压力，因此建议根据实际情况设置最大显示行数。</td></tr></table>

# C.8.2. 访问日志配置
持久化位置：conf/tongweb.xml:tongweb>server>loggers>access
Table 92. 访问日志配置的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>accessLogEnabled</td><td>启用访问日志</td><td>启用访问日志后，HTTP请求的时间、URI、响应码等信息可以被记录到日志文件里。</td></tr><tr><td>hosts</td><td>作用到虚拟主机</td><td>在指定的虚拟主机上开启访问日志。</td></tr><tr><td>customMode</td><td>使用自定义格式</td><td>使用自定义格式定义访问日志的内容记录格式，可方便从其它服务器移植。</td></tr><tr><td>customPattern</td><td>自定义格式</td><td>自定义访问日志的内容记录格式：%a - 远程IP地址; %A - 本地IP地址; %B - 发送的字节数,不包括HTTP头; %D - 处理请求的时间(以毫秒为单位); %T - 处理请求的时间(以秒为单位); %h - 远程主机名; %H - 请求协议; %m - 请求方法; %p - 本地端口; %q - 查询字符串; %r - 请求的首行内容; %s - 响应的HTTP状态代码; %S - 用户会话ID; %t - 日期和时间; %u - 远程用户身份验证; %U - 请求的URL路径; %v - 本地服务器名; %l - 处理请求的线程名称; %X - 连接的状态; %N - 应用的名称; %{XXX}i xxx代表传入的头(HTTP Request); %{XXX}c xxx代表传出的响应头(HTTP Response); %{XXX}r xxx代表ServletRequest属性名; %{XXX}s xxx代表HttpSession中的属性名。</td></tr><tr><td>presetPattern</td><td>日志内容</td><td>访问日志内容的组成部分。</td></tr><tr><td>requestHeader</td><td>记录请求头</td><td>在访问日志中记录指定的请求头的值。在这里设置请求头的名称,多个名称以英文逗号分隔。</td></tr><tr><td>responseHeader</td><td>记录响应头</td><td>在访问日志中记录指定的响应头的值。在这里设置响应头的名称,多个名称以英文逗号分隔。</td></tr><tr><td>cookie</td><td>记录Cookie</td><td>在访问日志中记录指定的Cookie的值。在这里设置Cookie的名称,多个名称以英文逗号分隔。</td></tr><tr><td>session</td><td>记录 Session</td><td>在访问日志中记录指定的 Session的值。在这里设置Session的名称,多个名称以英文逗号分隔。</td></tr></table>
Table 93. 访问日志配置的【日志文件】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>baseFile</td><td>文件目录</td><td>将日志文件存放到指定的目录下。</td></tr><tr><td>appendTypeDir</td><td>追加类型目录</td><td>启用后，将在指定的文件目录下增加一个access目录以存放日志文件。</td></tr><tr><td>rollingFile</td><td>日志文件轮转</td><td>将日志信息按文件大小或时间进行轮转，确保日志文件不会过大。</td></tr><tr><td>append</td><td>日志追加</td><td>启用日志追加模式，日志信息将追加到现有日志文件中而不是覆盖。</td></tr><tr><td>rotationDay</td><td>按天轮转</td><td>将每日未达到大小阈值的日志在零点切割到一个新文件中。</td></tr><tr><td>rotationBySize</td><td>按大小轮转</td><td>当日志文件大小（单位：MB）达到该阈值时，将切割出一个新的日志文件。注：设置为0表示不启用此功能。</td></tr><tr><td>keepMaxFiles</td><td>保留文件个数</td><td>指定在清理日志文件时，须保留文件的个数。</td></tr><tr><td>compression</td><td>日志文件压缩</td><td>是否开启日志文件压缩功能。开启后，对轮转后的日志文件进行压缩。</td></tr><tr><td>chunk</td><td>文件编码</td><td>指定日志文件的编码格式。</td></tr><tr><td>buffered</td><td>缓冲写入</td><td>是否开启文件缓冲写入功能。开启后，当持续记录的日志内容大小（单位：字节）之和达到缓冲大小时才一次性写入文件，而不是每条日志都立即写入文件（在服务器停止时会全部写入），这通常可以提高日志记录性能。关闭后，每条日志都立即写入文件。</td></tr><tr><td>bufferedSize</td><td>缓冲大小</td><td>缓冲写入的阈值，当持续记录的日志内容大小（单位：字节）之和达到此值时，一次性写入进文件。</td></tr></table>
Table 94. 访问日志配置的【在线日志】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>initialShowLogLines</td><td>初始加载行数</td><td>设置首次打开Web日志页面时加载的最新日志行数。</td></tr><tr><td>pullLogLines</td><td>日志刷新大小</td><td>设置浏览器每次从服务器拉取日志的最大行数。拉取太多日志可能造成网络和服务器压力，请根据实际情况设置。</td></tr><tr><td>maxShowLines</td><td>最大显示行数</td><td>当Web日志页面累积输出的日志过多时，可能会引起浏览器压力过大而无响应，设置最大显示行数可丢弃超出行数的部分以减轻浏览器压力，因此建议根据实际情况设置最大显示行数。</td></tr></table>

# C.8.3. ES 推送
持久化位置：conf/tongweb.xml:tongweb>server>logpush
Table 95. ES 推送的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用</td><td>设置是否要启用 TongWeb 的日志推送功能。</td></tr><tr><td>pushAddress</td><td>推送地址</td><td>设置连接远程日志服务器的url（支持的协议头信息为http://或https://），通常是一个REST接口（如Elasticsearch提供的REST接口）。</td></tr><tr><td>index</td><td>索引</td><td>服务器存放日志数据的索引。</td></tr><tr><td>username</td><td>用户名</td><td>指定连接远程日志服务器的身份信息。</td></tr><tr><td>password</td><td>密码</td><td>指定连接远程日志服务器的认证信息。</td></tr></table>

# C.8.4. Syslog 推送
持久化位置：conf/tongweb.xml:tongweb>server>syslog
Table 96. Syslog 推送的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enableSyslog</td><td>启用</td><td>设置是否要启用 Syslog 日志功能。</td></tr><tr><td>ip</td><td>服务器地址</td><td>设置 Syslog 服务器的IP，默认为本机。</td></tr><tr><td>port</td><td>端口</td><td>设置 Syslog 服务器的端口。</td></tr><tr><td>protocol</td><td>协议</td><td>设置向 Syslog 服务发送数据的协议。</td></tr><tr><td>encoding</td><td>编码</td><td>设置发送日志数据的编码类型。</td></tr><tr><td>tag</td><td>日志类型</td><td>设置要发送到 Syslog 的日志类型。</td></tr><tr><td>facility</td><td>设施</td><td>设置日志在 Syslog 中的类型。当日志类型为多个时，可以为每种类型指定一个设施。</td></tr></table>

# C.9. 安全管理

# C.9.1. 安全策略
持久化位置：conf/tongweb.xml:tongweb>server>security
Table 97. 安全策略的【文件防篡改】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>configProtection</td><td>服务器主配置文件防篡改</td><td>开启后，禁止在TongWeb运行期间对主配置文件tongweb.xml、console.xml、default-web.xml等进行修改。若被意外篡改，则自动进行恢复。</td></tr><tr><td>fileProtectionPattern</td><td>应用防篡改文件后缀</td><td>指定应用的防止篡改的文件的后缀。在应用部署后，对应用的所有原始文件进行周期性（由服务器“全局配置”&gt;“定时任务周期”指定）的检测。当发现文件被篡改后，尝试恢复到原文件。配置防篡改文件后缀，表示开启该功能；不配置，则不开启。防篡改文件后缀格式为.html,.png,.jpg等，多个后缀以英文逗号分隔。注意：同时开启热加载和防篡改功能，可能存在冲突，建议不要同时开启。</td></tr></table>
Table 98. 安全策略的【客户端拦截】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>filterRemoteHost</td><td>客户端主机名拦截</td><td>出于安全等考虑,拦截特定主机名的客户端请求,请求被拦截后将得到403响应码。注:本机访问不受限制。</td></tr><tr><td>allowHost</td><td>允许的主机名</td><td>指定允许的主机名,其值可为具体的主机名称或匹配主机名称的正则表达式。注:需要通道允许DNS反向查找。</td></tr><tr><td>denyHost</td><td>拒绝的主机名</td><td>指定拒绝的主机名,其值可为具体的主机名称或匹配主机名称的正则表达式。注:需要通道允许DNS反向查找,拒绝的主机名拦截优先于允许的主机名。</td></tr><tr><td>filterRemoteAddr</td><td>客户端IP拦截</td><td>出于安全等考虑,拦截特定IP的客户端请求,请求被拦截后将得到403响应码。注:本机访问不受限制。</td></tr><tr><td>allowAddr</td><td>允许的IP</td><td>指定允许的IP,其值可为具体的IP、匹配IP的正则表达式或通配符IP(如:168.1.2*,168.1.4.5-168.1.4.99)。</td></tr><tr><td>denyAddr</td><td>拒绝的IP</td><td>指定拒绝的IP,其值可为具体的IP、匹配IP的正则表达式或通配符IP(如:168.1.2*,168.1.4.5-168.1.4.99)。注:拒绝的IP拦截优先于允许的IP。</td></tr><tr><td>denySdos</td><td>SDOS攻击拦截</td><td>检测并拦截SDOS攻击。</td></tr><tr><td>sdosTimeThreshold</td><td>SDOS探测阈值(秒)</td><td>当一个请求的处理时间超过此SDOS探测阈值时,则将该请求判定为SDOS攻击。</td></tr><tr><td>sdosCountThreshold</td><td>SDOS 次数阈值</td><td>当一个客户端（通常是浏览器）发出的请求被判定为 SDOS 攻击的次数超过此 SDOS 次数阈值，则阻止该客户端 IP 地址的一切请求。</td></tr><tr><td>sdosUnblockPeriod</td><td>解除阻止周期（小时 ）</td><td>被阻止的客户端 IP 将在一个周期后自动解除。</td></tr></table>
Table 99. 安全策略的【协议头安全】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>hostHeaderFilter</td><td>Host Header拦截</td><td>开启 Host Header拦截后，将会从请求头“Host”中解析主机名和IP地址，只有符合规则的请求才可以访问本主机。注：本机访问不受限制。</td></tr><tr><td>allowHostHeader</td><td>允许的 Host</td><td>支持正则表达式，依照此规则对 Host 中的主机进行校验，如192.168.1.(0-9)*:9060|www.tw.com；未设置此规则，表示不进行该校验。注：“允许的 Host”校验的优先级低于“拒绝的 Host”。</td></tr><tr><td>denyHostHeader</td><td>拒绝的 Host</td><td>支持正则表达式，依照此规则对 Host 中的主机进行校验，如192.168.1.(0-9)*:9060；未设置此规则，表示不进行该校验。注：“允许的 Host”校验的优先级低于“拒绝的 Host”。</td></tr><tr><td>refererFilter</td><td>referer拦截</td><td>开启 referer拦截后，将会从请求头“referer”中解析主机名和IP地址。只有符合规则的请求才可以访问本主机。注：本机访问不受限制。</td></tr><tr><td>allowReferer</td><td>允许的 referer</td><td>指定允许访问本主机的域名或者IP，支持正则表达式。依照此规则对 referer 中的主机进行校验。未设置此规则，表示不进行该校验。注：“允许的 referer”校验的优先级低于“拒绝的 referer”。</td></tr><tr><td>denyReferer</td><td>拒绝的 referer</td><td>指定不允许访问本主机的域名或者IP，支持正则表达式。依照此规则对 referer 中的主机进行校验。未设置此规则，表示不进行该校验。注：“允许的 referer”校验的优先级低于“拒绝的 referer”。</td></tr><tr><td>responseHeader</td><td>响应头防护</td><td>可对响应头添加特定的消息，以通知浏览器进行必要的安全操作。</td></tr><tr><td>antiClickJackingEnabled</td><td>X-Frame-Options</td><td>站点可以通过确保网站没有被嵌入到别人的站点里面，从而避免点击劫持攻击。</td></tr><tr><td>antiClickJackingOption</td><td>X-Frame策略</td><td>DENY: 页面不允许在frame中展示; SAMEORIGIN: 页面可以在相同域名页面的frame中展示; ALLOW-FROM: 页面可以在指定来源的 frame 中展示。</td></tr><tr><td>antiClickJackingUri</td><td>指定来源</td><td>页面可以在指定来源的 frame 中展示，示例: http://ip:port 或者 http://ip:*。注: 若是多个地址，需要使用空格隔开。</td></tr><tr><td>hstsEnabled</td><td>Strict-Transport-Security</td><td>通知浏览器，网站禁止使用 HTTP 方式加载，浏览器应该自动把所有尝试使用 HTTP 的请求自动替换为 HTTPS 请求。</td></tr><tr><td>blockContentTypeSniffingEnabled</td><td>X-Content-Type-Options</td><td>禁止浏览器的类型猜测行为。</td></tr><tr><td>xssProtectionEnabled</td><td>X-XSS-Protection</td><td>当检测到跨站脚本攻击 (XSS)时，浏览器将停止加载页面。</td></tr></table>
Table 100. 安全策略的【支持 XFF】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>XForwardedFor</td><td>解析 XFF 头</td><td>X-Forwarded-For (XFF)是用来识别通过 HTTP 代理或负载均衡方式连接到 Web 服务器的客户端最原始的 IP 地址的 HTTP 请求头字段。开启该功能后,将基于代理或负载均衡器的请求头 X-Forwarded-For 来获得连接的原始 IP 地址。</td></tr><tr><td>internalProxies</td><td>内部代理</td><td>匹配内部代理的 IP 地址的正则表达式。若它们出现在remotelpHeader 标头中,则它们将被信任并且不会出现在 proxiesHeader 标头中。</td></tr><tr><td>trustedProxies</td><td>信任的代理</td><td>匹配受信任代理的 IP 地址的正则表达式。若它们出现在remotelpHeader 标头中,则它们将被信任并出现在proxiesHeader 标头中。</td></tr><tr><td>protocolHeader</td><td>协议信息请求头</td><td>包含协议信息的 HTTP 标头,通常命名为 X-Forwarded-Proto。若为空,则不会替换 Request 的scheme、secure、主机名和端口。</td></tr><tr><td>hostHeader</td><td>获取主机的请求头</td><td>从这个请求头取值，用以覆盖Request.getServerName()的返回值。若开启了“替换本地主机”，则同时覆盖Request.getLocalName()的返回值。</td></tr><tr><td>changeLocalName</td><td>替换本地主机</td><td>若开启，则从“获取主机的请求头”中取值，用以覆盖Request.getLocalName()的返回值。</td></tr><tr><td>portHeader</td><td>获取端口的请求头</td><td>从这个请求头取值，用以覆盖Request.getServerPort()的返回值。若开启了“替换本地端口”，则同时覆盖Request.getLocalPort()的返回值。对于http协议，若没有从“获取端口的请求头”中获取到值，则使用“缺省http端口”。</td></tr><tr><td>changeLocalPort</td><td>替换本地端口</td><td>若开启，则从“获取端口的请求头”中取值，用以覆盖Request.getLocalPort()的返回值。对于http协议，若没有从“获取端口的请求头”中获取到值，则使用“缺省http端口”。</td></tr><tr><td>httpServerPort</td><td>缺省http端口</td><td>对于http协议，若没有从“获取端口的请求头”中获取到值，则使用该缺省值。</td></tr><tr><td>httpsServerPort</td><td>缺省https端口</td><td>对于https协议，若没有从“获取端口的请求头”中获取到值，则使用该缺省值。</td></tr></table>
Table 101. 安全策略的【反爬虫】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enableCrawlerSessionManager</td><td>反爬虫管理</td><td>Web爬虫在爬取站点时会触发数千个会话的创建，这可能会导致大量内存消耗。此功能确保爬虫与单个会话相关联 - 就像普通用户一样 - 无论他们是否在请求中提供会话令牌。</td></tr><tr><td>sessionInactiveInterval</td><td>爬虫会话超时时间</td><td>指定爬虫会话的会话超时（单位：秒），通常应小于用户会话时间。</td></tr><tr><td>crawlerlps</td><td>识别爬虫IP</td><td>设置匹配IP的正则表达式或通配符IP（如：168.1.2*，168.1.4.5-168.1.4.99）来识别爬虫会话。</td></tr><tr><td>singleSession</td><td>启用单会话</td><td>启用单会话功能，开启后，每个IP只会创建一个会话。</td></tr><tr><td>crawlerUserAgents</td><td>识别爬虫User-Agent</td><td>设置匹配User-Agent的正则表达式来识别爬虫。</td></tr></table>
Table 102. 安全策略的【禁用时间段】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>filterTime</td><td>禁用时间段</td><td>设置禁止外部访问本服务器的时间段。注：本机访问不受限制。</td></tr><tr><td>filterTimeBegin</td><td>开始时间</td><td>指定的拦截规则在每日的该时间点（小时，24小时制）开始生效。</td></tr><tr><td>filterTimeEnd</td><td>结束时间</td><td>指定的拦截规则在每日的该时间点（小时，24小时制）结束生效。</td></tr><tr><td>repeat</td><td>重复规则</td><td>设置此拦截规则重复生效的规则。</td></tr></table>
Table 103. 安全策略的【启停安全】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabledRejectSystemExit</td><td>System退出检测</td><td>探测通过 System.exit()、Runtime.exit()、Runtime.halt()以及 Ctrl+C等方式停止 TongWeb 服务的行为，并记录相关的调用堆栈。</td></tr><tr><td>rejectSystemExit</td><td>禁止 System 退出</td><td>当 System 退出被检测到时，是否阻止该行为。注：使用停止脚本停止 TongWeb 的行为不受影响。</td></tr><tr><td>rejectStart</td><td>启动限制</td><td>对 TongWeb 的启动进行权限验证，验证通过后可正常启动 TongWeb，否则启动将会终止。</td></tr><tr><td>checkedOsUsers</td><td>禁止用户</td><td>指定不允许启动 TongWeb 的操作系统用户列表，多个用户以英文逗号分隔。</td></tr><tr><td>minimumUmask</td><td>最小 Umask</td><td>指定须为运行 TongWeb 的操作系统用户配置的最小 umask。若配置了该参数，则 TongWeb 会在启动之前去环境变量（参数名为"tongweb.umASK"）或-D 参数（参数名为"tongweb.umASK"）里检查操作系统用户的 umask（若两处都设置则以-D 参数为准），只有当其值与最小 umask 值作按位与操作得出的值仍为最小 umask 值时才允许启动。注：该配置格式为八进制，须是一个合法的 umask 值。</td></tr><tr><td>secureStop</td><td>安全停止</td><td>在调用 TongWeb 的停止脚本时进行密码验证，输入正确的系统管理员密码才可以停止 TongWeb 服务。</td></tr><tr><td>startdTimeout</td><td>后台启动超时</td><td>在使用 startd 脚本启动 TongWeb 时，若 startd 脚本的执行超过此时长后仍未结束，则会主动终止并立即退出，此后 TongWeb 进程可能仍在后台继续启动，请注意检查日志以获悉最终启动结果。</td></tr><tr><td>startdDiscardTimeout</td><td>后台启动放弃超时</td><td>在使用 startd 脚本启动 TongWeb 时，若因为端口冲突等原因最终不可能启动成功，通过设置此超时阈值，可及早终止等待。</td></tr></table>
Table 104. 安全策略的【其它】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>useJavaSerializer</td><td>Java原生序列化</td><td>是否使用 Java 原生的序列化工具，即 ObjectOutputStream/ObjectInputStream API。在遇到序列化相关问题时，可尝试打开该功能，打开后可能会影响集中管理、远程 EJB 等场景的性能。注：使用集中管理时，所有实例应该一起设置，或都打开，或都保持关闭。</td></tr><tr><td>whitelist</td><td>白名单</td><td>设置允许使用序列化和反序列化的 Java 类，其格式为 Java 类的全名称（包名加类名）或全名称的前缀部分（通常是包名）加通配符“”，以英文逗号分隔可设置多个，如 java.lang.,com.tongweb.*。注：该配置会影响 ejb 或其它需要序列化处理的功能，请在设置后进行充分的测试和验证。</td></tr><tr><td>rmiServerHostname</td><td>RMI 服务主机名</td><td>设置提供 RMI 服务的主机名，该主机名将被返回给 RMI 客户端用于访问远程对象。该参数最终会设置到 JVM 参数 -Djava.rmi.server hostname 上，效果与之相同。</td></tr></table>

# C.9.2. 密码安全
持久化位置：conf/tongweb.xml:tongweb>server>key
Table 105. 密码安全的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>inPrivate</td><td>无痕密钥</td><td>启用无痕密钥后，TongWeb 的密钥将不会以任何形式在文件系统上存储，以减少密钥泄漏的风险。首次启用无痕密钥，需要重启 TongWeb，并在启动时输入任意的启动密码，该启动密码必需妥善保管，并在后续每次启动TongWeb 时都要输入相同的启动密码。注：1.无痕密钥功能仅支持以 startserver 脚本启动的方式，并且目前不能支持集中管理；2.无痕密钥的开启和关闭，会引起之前已经存储的密码解密错误，此时需要进行密码重置：首先停止 TongWeb，然后删除${tongweb.base}/data/secure/secure，再启动TongWeb，若还有具体模块（如数据源）设置过密码也需单独重置。</td></tr><tr><td>encryptAlg</td><td>全局加密算法</td><td>切换全局有效的加密算法，后续创建数据源的数据库连接密码、通道的证书密码等将采用此算法进行加密存储。注意：此处切换算法，不会改变已加密的密码，若需要更新已加密的密码，请在对应的密码修改页面重新输入明文密码后保存，以使得新算法生效。</td></tr></table>

# C.9.3. 证书管理
持久化位置：conf/tongweb.xml:tongweb>server>keystores>keystore
Table 106. 证书管理的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>证书的唯一标识。</td></tr><tr><td>caType</td><td>类别</td><td>指定证书的类别。</td></tr><tr><td>storeType</td><td>格式</td><td>此证书的数据格式。</td></tr><tr><td>fileFrom</td><td>文件来源</td><td>证书文件可以从客户端上传，也可以从服务器端指定的位置读取。注：出于安全考虑，TongWeb 出厂设置禁用了文件上传功能，您可在“控制台安全”模块了解详情和进行相关的配置操作。</td></tr><tr><td>path</td><td>证书路径</td><td>服务器上证书文件的路径。</td></tr><tr><td>fromUpload</td><td>上传文件</td><td>上传一个证书文件到服务器。</td></tr><tr><td>keystorePass</td><td>证书密码</td><td>指定证书的密码。</td></tr><tr><td>alias</td><td>别名</td><td>证书中默认生效条目的别名。</td></tr><tr><td>algorithm</td><td>算法</td><td>证书中默认生效条目的签名算法。</td></tr><tr><td>keysize</td><td>密钥位大小</td><td>证书中默认生效条目的密钥位大小。</td></tr><tr><td>startDate</td><td>生效时间</td><td>证书中证书的生效时间。</td></tr><tr><td>endDate</td><td>失效时间</td><td>证书中证书的失效时间。</td></tr><tr><td>subject</td><td>证书主体</td><td>证书的使用者信息。</td></tr><tr><td>issuer</td><td>颁发者</td><td>证书的颁发者信息。</td></tr></table>

# C.9.4. 可信文件
无

# C.9.5. 巡检基线
Table 107. 巡检基线的【安全基线】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用基线检查</td><td>是否启用此基线检查，启用后，每次启动TongWeb 都会按照此基线配置项进行系统检查，并输出检查日志。</td></tr><tr><td>preventStartup</td><td>阻止启动</td><td>当“强制基线”类型的检查项目检查不通过时，自动终止系统启动。注：标红色（*）的为“强制基线”类型。</td></tr><tr><td>checkJvmHeapThreshold</td><td>JVM堆内存检查（MB）</td><td>检查-Xmx参数是否小于阈值。</td></tr><tr><td>checkDiskSpaceThreshold</td><td>磁盘空间检查（GB）</td><td>检查磁盘剩余空间是否小于阈值。</td></tr><tr><td>checkHotDeployment</td><td>热部署检查</td><td>检查是否禁用热部署功能。</td></tr><tr><td>checkAccessLog</td><td>访问日志检查</td><td>是否检查访问日志开启状态。</td></tr><tr><td>checkAppSecurity</td><td>应用安全检查</td><td>是否检查访问日志开启状态。</td></tr><tr><td>checkChangePwd</td><td>默认密码检查</td><td>是否检查默认密码已修改。</td></tr></table>
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>checkConfigProtection</td><td>文件防篡改检查</td><td>是否启用关键配置文件防篡改检测功能。</td></tr><tr><td>checkConsoleClose</td><td>控制台暴露检查</td><td>是否检查控制台访问已禁用。</td></tr><tr><td>checkEnableCrawlerSessionManager</td><td>反爬虫检查</td><td>是否检查反爬虫配置。</td></tr><tr><td>checkErrorPage</td><td>错误页面检查</td><td>是否检查自定义错误页面配置。</td></tr><tr><td>checkFileUpload</td><td>文件上传检查</td><td>是否检查远程文件上传已禁用。</td></tr><tr><td>checkFilterRemoteHost</td><td>客户端拦截检查</td><td>是否检查客户端拦截配置。</td></tr><tr><td>checkFilterTime</td><td>访问时段检查</td><td>是否检查禁用时间段配置。</td></tr><tr><td>checkInstallDir</td><td>安装用户检查</td><td>是否检查以普通用户安装。</td></tr><tr><td>checkOtp</td><td>动态密码检查</td><td>是否检查动态密码已启用。</td></tr><tr><td>checkPort</td><td>防火墙策略检查</td><td>是否检查控制台端口未暴露。</td></tr><tr><td>checkResponseHeader</td><td>协议头检查</td><td>是否检查协议头安全配置。</td></tr><tr><td>checkSecureStop</td><td>启停安全检查</td><td>是否检查启停安全配置。</td></tr><tr><td>checkSSL</td><td>SSL配置检查</td><td>是否检查SSL已启用。</td></tr><tr><td>checkTrustedIP</td><td>信任IP检查</td><td>是否检查信任IP列表配置。</td></tr><tr><td>checkUseJavaScaler</td><td>序列化安全检查</td><td>是否检查序列化安全配置。</td></tr><tr><td>checkXFF</td><td>XFF检查</td><td>是否检查X-Forwarded-For配置。</td></tr><tr><td>checkMaxPartCount</td><td>检查文件上传最大个数</td><td>是否检查文件上传最大个数的配置。该配置属于通道属性,用于限制单个HTTP请求中允许的最大文件上传数量。</td></tr><tr><td>checkMaxPartHeaderSize</td><td>检查文件上传最大请求头大小</td><td>是否检查文件上传最大请求头大小的配置。该配置属于通道属性,用于限制文件上传请求头的最大字节数。</td></tr><tr><td>checkSerializableWhitelist</td><td>检查序列化白名单</td><td>是否检查序列化白名单的安全配置。</td></tr></table>
Table 108. 巡检基线的【状态信息】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabledStatusCheck</td><td>启用状态信息检查</td><td>是否启用状态检查功能。启用后,系统将按照配置监控应用、数据源、通道等组件的运行状态。</td></tr><tr><td>checkAppStatus</td><td>应用检查</td><td>是否检查应用状态。该配置用于监控Java EE/Jakarta EE应用程序的运行状态。</td></tr><tr><td>checkAppDataSourceStatus</td><td>应用数据源检查</td><td>是否检查应用数据源状态。该配置用于监控应用自行创建和管理的数据源使用情况。</td></tr><tr><td>checkConnectorStatus</td><td>通道检查</td><td>是否检查通道状态。该配置用于监控网络通道的连接状态和请求处理能力。</td></tr><tr><td>checkDataSourceStatus</td><td>数据源检查</td><td>是否检查数据源状态。该配置用于监控TongWeb提供的数据源连接池运行状态。</td></tr><tr><td>checkEjbConnectionStatus</td><td>EJB w3协议检查</td><td>是否检查EJB w3协议状态。该配置用于监控远程EJB服务的专用协议连接状态。</td></tr><tr><td>checkHomeStatus</td><td>首页检查</td><td>是否检查首页状态。该配置用于监控TongWeb服务器主页的可访问性。</td></tr><tr><td>checkJcaConnectionPoolStatus</td><td>JCA 连接池检查</td><td>是否检查JCA连接池状态。该配置用于监控企业信息系统连接池的资源使用情况。</td></tr><tr><td>checkJtaStatus</td><td>JTA 事务检查</td><td>是否检查JTA事务状态。该配置用于监控分布式事务的处理状态和超时情况。</td></tr><tr><td>checkJvmStatus</td><td>JVM检查</td><td>是否检查JVM状态。该配置用于监控Java虚拟机的内存使用和运行状态。</td></tr><tr><td>checkOperatingSystemStatus</td><td>操作系统检查</td><td>是否检查操作系统状态。该配置用于监控底层操作系统的 基本运行信息。</td></tr><tr><td>checkServerLogStatus</td><td>系统日志检查</td><td>是否检查系统日志状态。该配置用于监控TongWeb服务器日志的记录状态。</td></tr><tr><td>checkThreadPoolStatus</td><td>线程池检查</td><td>是否检查线程池状态。该配置用于监控服务器管理的线程池资源使用情况。</td></tr><tr><td>enabledSystemCheck</td><td>启用系统信息检查</td><td>是否启用系统检查功能。启用后，系统将监控服务器日志、系统进程、网络连接等系统级信息。</td></tr><tr><td>checkServerLogs</td><td>Server日志检查</td><td>是否检查服务器日志。该配置用于监控和分析服务器运行日志。</td></tr><tr><td>checkSystemProcessStatus</td><td>系统进程检查</td><td>是否检查系统进程状态（top命令）。该配置用于监控系统资源使用情况。</td></tr><tr><td>checkFileOpenStatus</td><td>文件打开检查</td><td>是否检查文件打开状态（Isof命令）。该配置用于监控系统打开的文件和网络连接。</td></tr><tr><td>checkNetworkConnectionStatus</td><td>网络连接检查</td><td>是否检查网络连接状态（netstat命令）。该配置用于监控网络连接和端口状态。</td></tr><tr><td>checkJavaThreadStack</td><td>Java线程堆栈检查</td><td>是否检查Java线程堆栈（jstack命令）。该配置用于分析Java应用程序的线程状态。</td></tr></table>
Table 109. 巡检基线的【系统信息】
Table 110. 巡检基线的【预警信息】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabledAlertCheck</td><td>启用预警信息检查</td><td>是否启用预警检查功能。启用后，系统将监控堆转储、JVM致命错误等预警信息，并在异常时生成快照。</td></tr><tr><td>checkHeapDumpAler</td><td>堆转储文件检查</td><td>是否检查堆转储文件预警。该配置用于监控JVM堆内存溢出时的自动转储文件生成。</td></tr><tr><td>checkJvmFatalError Alert</td><td>JVM致命错误日志检查</td><td>是否检查JVM致命错误日志预警。该配置用于监控JVM运行时发生的致命错误日志记录。</td></tr><tr><td>checkAlertSnapshot</td><td>快照检查</td><td>是否检查预警快照。该配置用于在系统异常时自动生成系统状态快照用于问题分析。</td></tr></table>
Table 111. 巡检基线的【Python 脚本】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabledPythonScript s</td><td>启用Python脚本检查</td><td>是否启用Python脚本检查功能。启用后，系统将执行指定目录下的Python脚本，并将其返回的JSON结果集成到巡检报告中。注意：需要系统已安装Python并正确设置环境变量。</td></tr><tr><td>pythonScriptsDir</td><td>Python脚本目录</td><td>Python脚本文件所在目录路径。支持绝对路径和相对路径。相对路径将基于 ${tongweb_base}/data 目录解析。注意: 单个Python脚本文件大小不应超过10MB。</td></tr><tr><td>pythonScriptTimeout</td><td>脚本执行超时时间(秒)</td><td>Python脚本执行的超时时间,单位为秒。如果脚本执行超过此时间,将被强制终止。</td></tr></table>

# C.10. 基础配置

# C.10.1. 全局配置
持久化位置：conf/tongweb.xml:tongweb>server
Table 112. 全局配置的【服务器】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>instanceVersion</td><td>切换实例版本</td><td>指定当前实例的运行版本，默认为最新版本。注：此处显示的版本列表可在“产品升级”模块管理。</td></tr><tr><td>reversePkg</td><td>切换命名空间</td><td>开启后，TongWeb会在启动之初切换运行时的 Java/Jakarta EE 命名空间，如果当前是 javax，则会自动切换为 jakarta，反之亦然。</td></tr><tr><td>replaceWithEnv</td><td>从环境变量配置</td><td>在启动 TongWeb 之前，检测 tongweb.xml 中所有 ${xxx} 格式的参数，若对应的参数“xxx”在环境变量里可找到，则使用环境变量指定的值替换到 tongweb.xml 中。注：替换操作为一次性的，替换后不可恢复，这通常适用于容器云环境下动态配置 TongWeb 参数的场景。</td></tr><tr><td>globalp</td><td>全局 IP</td><td>设置全局 IP 后，所有 HTTP、HTTPS、AJP、EJB 等协议建立的端口都绑定到此 IP 上（各协议自行指定绑定到的 IP 会被忽略）。这对于减少多实例场景下系统端口冲突很有用，例如集中管理。</td></tr><tr><td>liteMode</td><td>轻量模式</td><td>以轻量模式运行 TongWeb，此模式会关闭 EJB、JCA 等服务，并尝试从应用自身加载 JSF、JavaMail、WebSocket、WebService、Xml 等技术实现。如果应用是基于 Tomcat 或其它 Servlet 容器开发的，则通常可以获得更好的兼容性。</td></tr><tr><td>webserviceEnabled</td><td>启用WebService</td><td>开启后,将加载TongWeb的WebService组件。注:请在确认需要使用TongWeb提供的WebService功能后开启。</td></tr><tr><td>compatibleWithJBos s</td><td>兼容JBoss</td><td>使用兼容JBoss客户端的wSDL格式。</td></tr><tr><td>jpaEnabled</td><td>启用JPA</td><td>开启后,将加载TongWeb内置的JPA组件。是否需要开启此功能,通常需要依据应用是否自带了Hibernate、Eclipselink等JPA实现来决定,若应用自带则不必开启,反之则需要开启。</td></tr><tr><td>tokenizerEnabled</td><td>启用Validator</td><td>关闭后,将不加载TongWeb内置的Validator组件。</td></tr><tr><td>jtaEnabled</td><td>启用JTA</td><td>关闭后,将不加载TongWeb内置的JTA组件。</td></tr><tr><td>supportedVendors</td><td>厂商兼容</td><td>指定需要兼容的其他厂商的自定义配置文件。WebLogic: weblogic-ejb-jar.xml; Glassfish: sun-application.xml,sun-application-client.xml,sun-web.xml,sun-ejb-jar.xml,sun-cmp-mappings.xml; Websphere: webservices.xml,XXXServicemapped.xml。</td></tr><tr><td>systemTempDir</td><td>系统临时目录</td><td>设置TongWeb进程的临时工作目录,用于缓存上传的文件、编译的JSP等。</td></tr><tr><td>backgroundTaskDelay</td><td>定时任务周期(秒)</td><td>设置TongWeb服务器内部一些定时任务的执行周期。注:此设置会影响应用会话有效性、应用自动部署、慢线程检测等周期性检测机制的敏感性。</td></tr><tr><td>utilityThreads</td><td>任务并行度</td><td>服务器内部任务执行的最大并发数,这些任务包括应用会话超时检测、文件自动部署检测、虚拟主机的并行部署应用、应用的并行启动组件等。</td></tr><tr><td>delayStartConnector</td><td>延迟启动通道</td><td>开启后,TongWeb在启动时会优先启动应用,应用启动完成后,再启动端口,否则会优先启动端口。注:开启该功能可保证当有请求进入系统后所有的应用都是就绪的,但可能会引入一个现象,即如果部署了多个应用,那么在最后一个应用部署完成前所有的应用都将无法对外提供服务。</td></tr><tr><td>ignoreApplicationStartupTime</td><td>忽略应用启动时间</td><td>开启该功能后,服务器启动时间不包含应用的启动时间。</td></tr><tr><td>gracefulStopAwaitMillis</td><td>优雅停机</td><td>若将此参数设置为大于0,则会在TongWeb服务器停止时,尝试等待正在进行中的客户端请求处理完毕,单位为毫秒。设置为0,表示关闭此功能。</td></tr><tr><td>gzipInputFilter</td><td>支持请求体压缩</td><td>开启该功能后,将对POST请求头中Content-Encoding设置为gzip的请求体进行GZIP解压缩。</td></tr><tr><td>serverHeader</td><td>服务器响应头</td><td>设置通过HTTP协议响应头返回到客户端的服务器名称。</td></tr><tr><td>addResponseHeader</td><td>附加响应头</td><td>该功能允许服务器在HTTP响应中附加自定义头部信息。优先级:应用的优先级高于通道,通道优先级高于全局配置。</td></tr><tr><td>jvmRoute</td><td>JVM Route</td><td>负载均衡场景下的服务实例标识,通常需要结合AJP协议使用。注:该值修改后,只能对后续部署的应用生效,修改前已经部署的应用需要进行编辑后才能生效。</td></tr><tr><td>listenerClassEnabled</td><td>扩展生命周期模块</td><td>是否启用TongWeb生命周期管理模块。</td></tr><tr><td>listenerClass</td><td>类名称</td><td>提供一个Java类的全名称(多个类以英文逗号分隔),用以监听TongWeb应用服务器的启动和停止事件。该Java类按需声明对应事件的Java方法(静态或成员方法均可,若是成员方法则需要同时声明一个无参构造方法),并打包为jar文件在TongWeb启动之前放入${tongweb.base}/lib。事件及其对应的方法(均是无参方法):启动之前:beforeStart;启动之后:afterStart;停止之前:beforeStop;停止之后:afterStop。</td></tr><tr><td>loadingFailedStopEnabled</td><td>加载失败时停止实例</td><td>在指定的生命周期管理模块加载失败(方法执行出现异常)时,指定是否要停止TongWeb实例。</td></tr><tr><td>x509UsernameRetrieverClassName</td><td>证书解析类</td><td>指定解析证书的实现类。若未指定,则使用TongWeb内置的X509SubjectDnRetriever,它是以证书的完整SubjectDN作为用户名。</td></tr><tr><td>websocketBlockingSendTimeout</td><td>WebSocket消息发送超时</td><td>设置以阻塞模式发送WebSocket消息的超时时间,单位:秒。注:此为TongWeb的WebSocket服务提供的默认设置,应用可依据WebSocket规范对此进行重置。</td></tr><tr><td>allowHostnameChar-s</td><td>主机名允许字符</td><td>允许主机名使用的特殊字符，如下划线“_”。</td></tr></table>
Table 113. 全局配置的【应用】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>autoDeploy</td><td>自动部署应用</td><td>开启该功能后,只需要将应用包拷贝到 ${tongweb.base}/autodeploy 目录(可通过“自动部署目录”指定为其它目录),即可自动部署该应用。注:若需要预设部署参数,可通过 tongweb-web.xml 自定义配置文件来实现,该文件需放置在应用的 WEB-INF/ 目录下(仅支持 web 应用),其内容格式同 tongweb.xml 的applications 的子节点 app。</td></tr><tr><td>autoRedeploy</td><td>自动更新</td><td>开启后,在检测到自动部署的应用包或文件夹有更新时,将会自动清理解压的目录,并使用新的应用包文件(.war、.ear等)重新解压。</td></tr><tr><td>startupDeploy</td><td>启动时部署</td><td>在 TongWeb 启动完成后,扫描自动部署目录,执行且仅执行一次应用自动部署。</td></tr><tr><td>createFlag</td><td>生成状态标签</td><td>开启该功能后,自动部署的应用将会生成对应的标签文件,成功:.deployed,失败:.failed,卸载*.unDeployed。</td></tr><tr><td>deployToDeployment</td><td>部署到 deployment</td><td>开启该功能后,自动部署的非文件夹类型应用将解压部署到 ${tongweb.base}/deployment 目录,关闭该功能将在原地解压部署。</td></tr><tr><td>autoDeployDir</td><td>自动部署目录</td><td>指定自动部署的目录。</td></tr><tr><td>appTemplate</td><td>全局应用模板</td><td>设置后,将会使用全局应用模板里的参数来部署应用,部署应用时指定的其他参数将会被忽略。注:若应用部署时,指定了其它应用模板,则会优先使用应用指定的其它模板;若应用同时配置了自定义描述文件 tongweb-web.xml,则会优先使用 tongweb-web.xml 里面的配置参数。</td></tr><tr><td>refLib</td><td>应用共享类加载器</td><td>扩展应用共享类加载器 (lib/app/* ) 的加载路径,通常适用于多个应用需要在内存中共享类对象的业务场景。</td></tr><tr><td>useParallel</td><td>并行部署应用</td><td>以并行的方式进行应用部署,可尝试提高多应用部署的效率,但应用部署期间的日志打印会出现交叉。注:最大并行数受限于“全局配置”配置的“任务并行度”。</td></tr><tr><td>serverFileSizeLimit</td><td>服务器文件大小限制</td><td>当文件来源为服务器文件时,出于安全考虑,限定了读取文件的大小(单位:MB)。注:设置为0表示不限制。</td></tr><tr><td>postDeploymentBackup</td><td>应用主动备份</td><td>开启后,应用会在部署之后主动进行一次备份,可以在“应用备份”模块里查看和管理应用的备份文件。</td></tr><tr><td>backupCount</td><td>应用备份数量</td><td>应用备份的最大数量,超过配置继续备份会清理较老的备份。配置为0,表示禁用备份。</td></tr><tr><td>backupDir</td><td>应用备份目录</td><td>应用备份目录(相对于${tongweb.base}的目录,若目录不存在,TongWeb将会自动创建),以将应用备份到此目录。此项不必填,若未指定,则备份当前生效的应用文件到${tongweb.base}/data/app/backup目录下。</td></tr><tr><td>jarsToScan</td><td>扫描jar文件</td><td>当jar的名称符合此模式时,则从该jar中扫描TLD、webfragments等信息。该模式可包含两个特殊字符:“*”表示0个或多个字符,“?”表示一个且只有一个字符。注:配置多个以英文逗号分隔,如tongweb*.jar,common*.jar。其优先级高于“跳过jar”</td></tr><tr><td>jarsToSkip</td><td>跳过扫描jar文件</td><td>当jar的名称符合此模式时,则不再从该jar中扫描TLD、webfragments等信息。该模式可包含两个特殊字符:“*”表示0个或多个字符,“?”表示一个且只有一个字符。注:配置多个以英文逗号分隔,如tongweb*.jar,common*.jar。</td></tr><tr><td>ignoreDeployError</td><td>忽略部署异常</td><td>忽略应用部署过程中的异常,此配置需自行确认该异常不影响应用业务,故可以选择忽略。目前包含:应用的web.xml中配置了Servlet,在加载应用时,若找不到该Servlet的Class文件的异常忽略;应用ServletContextListener的初始化异常忽略。</td></tr><tr><td>ignoreClientAbortException</td><td>忽略客户端异常</td><td>开启此功能后,在应用处理请求过程中,若遇到客户端异常,如连接断开,则忽略不处理,以避免非必要的异常处理和日志打印等。注意:应用须在确认忽略的异常不会对业务造成影响的前提下谨慎使用此功能。</td></tr><tr><td>validationSkip</td><td>跳过规范性校验</td><td>当应用并未严格遵循Java EE / Jakarta EE 规范时,可以选择跳过规范性校验,以尝试不中断部署。注:若开启了校验,对于未严格遵循规范的应用并不一定会中断部署,可能只是打印一些日志,这取决于应用的具体情况。</td></tr><tr><td>jspPrintNull</td><td>JSP 输出 NULL 串</td><td>开启后,当 JSP 输出的对象为 null 时,输出一个 null 字符串;不开启,则不输出任何内容。</td></tr><tr><td>JSPAutoImport</td><td>JSP 自动导包</td><td>开启后,自动为 JSP 导入 java.util 包。</td></tr><tr><td>JSPTagBufferSize</td><td>JSP 标签缓存区大小</td><td>设置 JSP 标签缓存区在初始情况下的字符缓存空间大小,单位:字符个数。</td></tr><tr><td>jspSpecialVars</td><td>JSP 特殊变量</td><td>设置 JSP 中定义的特殊变量值,如 com 等,防止编译JSP 时特殊变量与内置对象命名冲突,导致编译失败。注:配置多个以英文逗号分隔。</td></tr><tr><td>limitJSPTagBuffer</td><td>重置 JSP 标签缓存区</td><td>在实际使用的 JSP 标签缓存大小超过默认的 JSP 标签缓存区大小后,是否将缓存区重置到初始状态,选择重置会节省内存空间的消耗,但可能会有些许的性能影响。</td></tr><tr><td>slowThreadEnabled</td><td>慢线程检测</td><td>慢线程检测功能可探测执行超时的请求,并能够自动中断执行的线程,以提高资源的利用效率。注:此配置更新后,应用需要重新部署或启动以生效。</td></tr><tr><td>threshold</td><td>阻塞阈值</td><td>线程处理应用业务的时间(从接收到客户端的请求开始计算)超过该阈值(单位:毫秒)后将会记录一条慢线程检测告警日志。注:此值建议不要小于“全局配置”模块里的“定时任务周期”参数值,否则发现慢线程会不及时。</td></tr><tr><td>interruptThreadThreshold</td><td>中断阈值</td><td>线程处理应用业务的时间超过该阈值(单位:毫秒)后将被尝试中断,该时间从接收到客户端的请求开始计算,其值不支持小于阻塞阈值。0 表示不中断。</td></tr><tr><td>monitorAppDataSource</td><td>监视应用数据源</td><td>开启该功能后,TongWeb 将主动去探测应用建立的数据源(数据库连接池),并尝试监视其资源的使用情况。您可通过“应用数据源”模块查看具体的监视信息。</td></tr><tr><td>supportBC</td><td>兼容 BC 加密算法</td><td>打开此开关,可在一定程度上解决这类问题:在应用使用 Security.insertProviderAt(1, BCProvider) 方式安装了 BC 加密算法时,或者通过配置 JDK 的 java.security 文件方式安装了 security.provider.1=BC 时,可能引起 https 通道访问错误。注:安装了 BC 加密算法后,若未出现所述问题,则不必需打开此开关。</td></tr><tr><td>classFileProcessor</td><td>自定义 Class 文件解密</td><td>指定用于解密应用 Class 文件的类名。该类需实现 com.tongweb.classfile.ClassFileProcessor 接口(所在 jar: ${tongweb.home}/version*$/boot/tongweb-bootstrap.jar)。注:包含该自定义处理类的 jar 文件,需在 TongWeb 启动之前放置到 ${tongweb.base}/lib 下。</td></tr><tr><td>mappingRootPath</td><td>映射 ROOT 路径</td><td>开启后,当应用名为“ROOT”时,将自动将其访问前缀设置为“/”。</td></tr></table>
Table 114. 全局配置的【授权】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>licenseCheckTime</td><td>授权检查时间</td><td>设置检查授权（license）是否过期的时间点，单位：时。</td></tr><tr><td>notificationEnable</td><td>授权到期提醒</td><td>设置是否在授权到期之前发出提醒。</td></tr><tr><td>notificationTime</td><td>提前时间</td><td>设置在授权到期之前，提前多少天发出提醒。</td></tr><tr><td>javamailEnable</td><td>发送邮件</td><td>选择是否以电子邮件的方式发送提醒提醒。</td></tr><tr><td>from</td><td>发件人地址</td><td>选择已创建的JavaMail资源，用于发送邮件。</td></tr><tr><td>to</td><td>收件人地址</td><td>指定接收到期提醒的电子邮件地址。</td></tr><tr><td>smsEnable</td><td>发送短信</td><td>选择是否以短信的方式发送提醒。</td></tr><tr><td>sms</td><td>短信服务</td><td>选择已创建的短信服务，用于发送短信。</td></tr><tr><td>smsSign</td><td>短信服务签名</td><td>发送短信时使用的签名，该签名通常会添加到短信内容的开头处，一般位于【】里面，具体需要在短信服务平台进行设定。</td></tr><tr><td>smsID</td><td>短信服务 ID</td><td>发送短信时使用的短信服务平台的模板ID，具体需要在短信服务平台进行设定。</td></tr><tr><td>smsTel</td><td>接收人手机号</td><td>指定接收预警通知的手机号码，多个号码之间以逗号分隔。</td></tr><tr><td>licenseCenterEnabled</td><td>启用授权中心</td><td>开启后，TongWeb将实时地从授权中心获取最新的授权文件，并更新到本地授权文件 license.dat。</td></tr><tr><td>licenseCenter</td><td>授权中心</td><td>选择要使用的授权中心。</td></tr></table>
Table 115. 全局配置的【JMX】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>registerServerMBean</td><td>开启本地 JMX</td><td>将服务器实例的配置管理和监视接口注册到本地 MBean（即 ManagementFactory.getPlatformMBeanServer()上），名称为 TongWeb:name=server。本地 MBean 的访问不需要密码，功能范围仅限配置查看和资源监视。</td></tr></table>
Table 116. 全局配置的【集中管理】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>alias</td><td>别名</td><td>用来标识当前TongWeb的业务身份。</td></tr><tr><td>remoteSupported</td><td>支持集中管理</td><td>若此TongWeb服务器需要被集中管理,则需要打开此功能。出于安全考虑,此功能默认关闭。注:由集中管理工具自动创建的TongWeb节点和实例会自动打开该功能。此外,集中管理服务器的IP地址可以在${tongweb.base}/conf/tongweb.xml&lt;server&gt;节点的 centralizedIp属性上记录。</td></tr><tr><td>autoRegisterId</td><td>服务器标识</td><td>注册到集中管理的节点名称标识,建议设置为一个有业务含义的名称,如果不设置则由TongWeb服务器随机生成。注意:若当前实例已经被集中管理统一纳管,您在编辑此值后,需自行前往集中管理端同步更新已注册的此标识符号。</td></tr><tr><td>autoClusterId</td><td>集群标识</td><td>注册到集中管理的服务器所属集群的名称标识,具有相同集群标识的服务器会自动组成集群,如无集群标识,则不属于任何集群。</td></tr><tr><td>remoteKey</td><td>传输密钥</td><td>当作为手动节点被集中管理时,传输过程中的敏感数据加密的密钥。</td></tr></table>
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>autoRegister</td><td>自动注册</td><td>将此 TongWeb 服务器自动注册到集中管理，自动注册会在此处保存后立即生效，您可在指定的集中管理服务器上审查到注册信息。</td></tr><tr><td>remotePublicKey</td><td>加密公钥</td><td>为了能够被集中化管理，需要在此设置集中管理的加密密钥，该密钥应该从集中管理工具的“集中配置”中获取。</td></tr><tr><td>registerAsNode</td><td>注册为节点</td><td>将此 TongWeb 作为节点或服务注册到集中管理，注册为节点：会出现在集中管理的“节点”模块里，可用作管理该节点上的其它 TongWeb 实例；注册为服务：会出现在集中的“服务发现”模块，目的是将该 TongWeb 实例纳入集中管理。注：当“注册为节点”后，若再更改为“注册为服务”，或关闭自动注册，并不会从集中管理的“节点”模块中移除，您可在集中管理端进行相关移除操作。</td></tr><tr><td>centralizedConsoleUrl</td><td>注册到集中管理 URL</td><td>指定自动注册要注册到的集中管理服务器的 TongWeb 控制台访问地址，格式为：https://[localhost]:[9060]/[console]/。注：协议只能为 http 或者 https，访问前缀为默认的 console 或者自定义的值，其后不需要再添加其它 url 内容。</td></tr><tr><td>serviceRegistryEnabled</td><td>启用服务注册中心</td><td>启用后，可将当前 TongWeb 实例注册到所选服务注册中心的服务器上，然后可在 TongWeb 集中管理的“注册实例”模块管理该实例。此外：作为集中管理使用的 TongWeb 请勿和实例设置一样的注册中心，通常集中管理不必要设置注册中心。</td></tr><tr><td>serviceRegistryServer</td><td>服务注册中心</td><td>选择要使用的服务注册中心。</td></tr><tr><td>configRegistryEnabled</td><td>启用配置注册中心</td><td>启用后，可将本TongWeb实例的配置与远端配置注册中心服务器上的配置保持一致，以支持状态分离、配置共享等场景。当本TongWeb实例与其它TongWeb实例选择使用了相同的“配置注册中心”时（不必需“启用服务注册中心”），它们将共享彼此的配置参数，此时，管理变更其中任何一个实例的参数，都将自动同步到其它实例。注意：启用该功能，应用部署只支持目录部署和应用仓库（在“全局配置“模块的“镜像模式“功能之下）两种方式，目录部署需要保证各个实例所在的文件系统上具有相同的应用文件路径。此外：作为集中管理使用的TongWeb请勿和实例设置一样的注册中心，通常集中管理不必要设置注册中心。</td></tr><tr><td>configRegistryServer</td><td>配置注册中心</td><td>选择TongWeb要连接到的配置注册中心。</td></tr><tr><td>pushConfigEnabled</td><td>推送配置变更</td><td>开启后，在本TongWeb的配置发生变更时，会立即将变更后的配置推送到指定的配置注册中心上，不开启则不推送。注：推送配置变更会覆盖配置注册中心上的原有数据，因此，建议在初始化配置注册中心上的数据时打开，而中心上的数据初始化完毕后再加入到配置中心的TongWeb不需要打开，它们只需等待配置中心主动下发最新配置即可（前提是它们已开启“监听变更并重启“），您也可自行重启这些TongWeb以使它们立即从配置中心获取到最新配置。</td></tr><tr><td>restartOnUpdate</td><td>监听变更并重启</td><td>是否监听配置中心上关于本实例的配置变更事件，并在有配置变更时自动重启本实例，以使得变更生效。注：开启该功能，需要首先开启“启动策略”模块的“宕机重启”功能。</td></tr><tr><td>imageMode</td><td>镜像模式</td><td>指定是否以镜像模式运行TongWeb。此模式会尝试从应用(注:需要在镜像模式下部署的应用,可选在TongWeb启动之前,将其放置到${tongweb.base}/imagedeploy目录下,也可选使用“应用仓库”来获取远程应用包)中查找TongWeb所需要的配置文件,查找位置为:应用根目录/META-INF/tongweb,查找到的文件将会合并入${tongweb.base}目录(注意:/META-INF/tongweb目录下的文件目录结构要与${tongweb.base}目录结构对应),原${tongweb.base}目录将会整体备份。在以镜像模式运行时,TongWeb将处于“只读”状态,即不支持对任何配置参数进行修改。若要关闭镜像模式,请先停止TongWeb,然后修改${tongweb.base}/conf/tongweb.xml,将&lt;server&gt;节点的imageMode属性值设置为false,然后再启动TongWeb即可。</td></tr><tr><td>appStoreServer</td><td>应用仓库</td><td>应用仓库是存放应用程序文件的远程源地址或远程文件服务器,TongWeb可以连接应用仓库,并从中拉取和部署应用。</td></tr></table>
Table 117. 全局配置的【远程配置】


# C.10.2. JVM 配置
持久化位置：conf/tongweb.xml:tongweb>java-config>start-args>arg
Table 118. JVM 配置的【内存大小】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>Xms</td><td>初始堆内存</td><td>设置初始堆内存大小(-Xms)。</td></tr><tr><td>Xmx</td><td>最大堆内存</td><td>设置最大堆内存大小(-Xmx)。</td></tr><tr><td>Xmn</td><td>新生代大小</td><td>设置新生代大小(-Xmn)。</td></tr><tr><td>NewRatio</td><td>老年代比率</td><td>设置新生代和老年代的大小比率，通俗地讲即老年代比新生代的倍数(-XX:NewRatio)。</td></tr><tr><td>SurvivorRatio</td><td>Eden区比率</td><td>设置新生代中Eden区域和Survivor区域(From幸存区或To幸存区)的比率(-XX:SurvivorRatio)。</td></tr><tr><td>MetaspaceSize</td><td>初始元空间</td><td>设置初始元空间的大小(-XX:MetaspaceSize)。</td></tr><tr><td>MaxMetaspaceSize</td><td>最大元空间</td><td>设置最大元空间的大小（-XX:MaxMetaspaceSize）。</td></tr><tr><td>Xss</td><td>线程栈大小</td><td>设置线程栈大小的最大值（-Xss）。</td></tr><tr><td>MaxDirectMemorySi ze</td><td>堆外内存</td><td>设置最大堆外内存，当DirectByteBuffer分配的堆外内存达到该大小后，即触发Full GC（-XX:MaxDirectMemorySize）。</td></tr></table>
Table 119. JVM 配置的【GC 策略】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>useGC</td><td>垃圾回收器</td><td>设置 JVM 回收内存使用的垃圾回收器。</td></tr><tr><td>ParallelGCTreads</td><td>并行收集线程数</td><td>设置并行收集器收集时使用的CPU数,即并行收集线程数(-XX:ParallelGCTreads)。</td></tr><tr><td>MaxGCPauseMillis</td><td>最大暂停时间</td><td>每次 GC 最大的停顿毫秒数,VM将调整 Java 堆大小和其他与 GC 相关的参数,以使 GC 引起的暂停时间短于该毫秒,尽可能地保证内存回收花费时间不超过设定值(-XX:MaxGCPauseMillis)。</td></tr><tr><td>GCTimeRatio</td><td>回收时间占比</td><td>设置垃圾回收时间占程序运行时间的百分比(-XX:GCTimeRatio)。</td></tr><tr><td>gcLogEnabled</td><td>记录 GC 日志</td><td>设置是否记录 JVM 的 GC 日志。</td></tr><tr><td>PrintGCDetails</td><td>记录细节</td><td>设置是否记录 GC 的详细信息(-XX:+PrintGCDetails)。</td></tr><tr><td>PrintGCApplicationStoppededTime</td><td>记录系统停顿时间</td><td>是否在 GC 日志中记录系统停顿时间。仅适用于 java8 (-XX:+PrintGCApplicationStoppededTime)。</td></tr><tr><td>PrintGCApplicationConcurrentTime</td><td>记录系统执行时间</td><td>是否在 GC 日志中记录系统执行时间。仅适用于 java8 (-XX:+PrintGCApplicationConcurrentTime)。</td></tr><tr><td>PrintHeapAtGC</td><td>记录堆信息</td><td>是否在 GC 日志中记录堆信息,仅适用于 java8 (-XX:+PrintHeapAtGC)。</td></tr><tr><td>gcLog</td><td>GC 日志文件</td><td>设置 GC 日志的存储位置。注:路径可以是绝对路径,也可以是相对于 TongWeb 域目录的相对路径,同时可使用${TW_TimeStamp} 变量添加 TongWeb 启动时间戳(-Xlog)。</td></tr><tr><td>HeapDumpOnOutOfMemoryError</td><td>开启堆转储</td><td>当 JVM 发生 OOM 时，自动生成 DUMP 文件，文件位置由【堆转储文件】选项指定（-XX: +HeapDumpOnOutOfMemoryError）。</td></tr><tr><td>HeapDumpPath</td><td>堆转储文件</td><td>设置 JVM 发生 OOM 时，自动生成 DUMP 文件的路径。注：路径可以是绝对路径，也可以是相对于 TongWeb 域目录的相对路径，同时可使用 ${TW_TimeStamp} 变量添加 TongWeb 启动时间戳 (-XX:HeapDumpPath)。</td></tr></table>
Table 120. JVM 配置的【堆转储】
Table 121. JVM 配置的【JVM 日志】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>LogVMOutput</td><td>记录 JVM 日志</td><td>设置是否记录 JVM 日志(-XX: + LogVMOutput)。</td></tr><tr><td>-logFile</td><td>JVM 日志文件</td><td>设置 JVM 日志的存储位置。注：路径可以是绝对路径，也可以是相对于 TongWeb 域目录的相对路径，同时可使用 ${TW_TimeStamp} 变量添加 TongWeb 启动时间戳(-XX: LogFile)。此外，还可以使用 %t 占位符来实现时间戳，并且支持其他 JVM 规范的占位符，例如 %p (进程 ID)等。</td></tr></table>
Table 122. JVM 配置的【环境变量】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>JAVA_HOME</td><td>Java 路径</td><td>设置运行 TongWeb 所需要的 Java 路径。</td></tr><tr><td>envs</td><td>环境变量</td><td>设置应用程序所需要的环境变量。</td></tr></table>
Table 123. JVM 配置的【IP 版本】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>preferIPv4Stack</td><td>首选IPv4</td><td>在支持IPv4映射地址的IPv6网络协议栈中，首选使用IPv4协议栈（-Djava.netpreferIPv4Stack）。</td></tr></table>

# C.10.3. 启动参数
持久化位置：conf/tongweb.xml:tongweb>java-config>start-args>arg
Table 124. 启动参数的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>参数</td><td>该参数将用于 JVM 启动时的进程入参。</td></tr><tr><td>changeToArg</td><td>更改为</td><td>将参数更改为此值。</td></tr><tr><td>enabled</td><td>启用</td><td>只有启用的参数才会传给 JVM 加载，未启用的则不会。</td></tr><tr><td>onlyForLinux</td><td>仅 Linux 有效</td><td>开启后，该参数仅会在 linux 操作系统上启用。</td></tr><tr><td>supportedJRE</td><td>限定 JRE 版本</td><td>限定该参数支持的 JRE 的版本，限定后，只有限定的 JRE 可以加载到该参数；其它 JRE 则不会，为空表示不限制。</td></tr><tr><td>range</td><td>限定区间</td><td>限定支持的 JRE 版本区间，大于、等于或者小于指定的 JRE 版本号。+ 表示大于等于，= 表示等于，- 表示小于等于。</td></tr><tr><td>desc</td><td>描述</td><td>该参数的描述信息。</td></tr></table>

# C.10.4. 启动策略
持久化位置：conf/tongweb.xml:tongweb>server>start-policy
Table 125. 启动策略的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>selfStart</td><td>开机自启</td><td>设置开机后是否自动启动此 TongWeb 实例，该功能仅在 TongWeb 位于 Linux 操作系统时有效。</td></tr><tr><td>autoRestart</td><td>宕机重启</td><td>异常宕机（如：被kill）后是否自动重启。注：该功能仅对使用脚本启动的 TongWeb 实例有效，对于集中管理启动的实例，则需要在对应的实例配置页面为其配置宕机重启。</td></tr><tr><td>maxretrycount</td><td>最大重试次数</td><td>启用异常宕机（如：被kill）后尝试自动重启的次数上限。若设置为0，则表示自动重启的次数不受限制。</td></tr><tr><td>scheduledRestart</td><td>定时重启</td><td>设置是否开启 TongWeb 的定时重启机制，开启后 TongWeb 将按照指定的周期计划进行自动重启。注：该功能仅对使用脚本启动的 TongWeb 实例有效，对于集中管理启动的实例无效。</td></tr><tr><td>scheduledCron</td><td>Cron 表达式</td><td>设置TongWeb进行周期性重启的调度策略，即所使用的cron表达式。Crontab时间表达式的基本格式：【* * * * *command】，分别表示【分时日月周命令】。Crontab还有操作符，用来实现一些复杂的时间设定需求，如：*取值范围内的所有数字；/每过多少个数字；-代表一段时间范围；,代表分割开多个值。列举一些范例，每隔1分钟执行一次：0*/1***?；每天22点执行一次：0022**?；每月1号凌晨1点执行一次：0011*?；每月最后一天23点执行一次：0023L*?；每周周六凌晨3点实行一次：003?*L；在24分、30分执行一次：024,30***?。此外，互联网上有一些在线的Cron表达式生成器可方便使用。</td></tr><tr><td>startAt</td><td>执行时间</td><td>设置从何时开始执行Cron表达式所指定的调度策略。设置为空表示从当前时间开始计算。</td></tr><tr><td>endAt</td><td>停止时间</td><td>设置从何时开始停止Cron表达式所指定的调度策略。设置为空表示永不停止。</td></tr><tr><td>restartTimes</td><td>计划重启日期</td><td>TongWeb将在下述日期里进行重新启动。</td></tr></table>

# C.10.5. 远程 JMX
持久化位置：conf/tongweb.xml:tongweb>server>remote-jmx
Table 126. 远程 JMX的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用</td><td>功能开关，配置是否开启 TongWeb 的 JMX 接口服务。</td></tr><tr><td>ip</td><td>服务 IP</td><td>指定 JMX 监听服务绑定的 IP 地址。在设置了[安全策略]-[其他]-[RMI 服务主机名]属性后，此属性需要与其保持一致。</td></tr><tr><td>port</td><td>端口</td><td>指定 JMX 监听服务绑定的端口。</td></tr><tr><td>useAuthentication</td><td>开启认证</td><td>是否启用身份认证。</td></tr><tr><td>user</td><td>访问用户</td><td>设置远程 JMX 接入的认证名称。</td></tr><tr><td>password</td><td>密码</td><td>设置远程 JMX 接入的认证密码。</td></tr><tr><td>useSsl</td><td>开启 SSL</td><td>开启后，使用 TLS 加密网络数据。</td></tr><tr><td>enabledCipherSuites</td><td>启用密码套件</td><td>密码套件决定了 SSL/TLS 通信过程中使用的加密算法，可根据不同的业务需求设置使用不同的加密算法，以英文逗号分隔可设置等多个。注：不设置表示不限制。</td></tr><tr><td>enabledProtocols</td><td>启用协议</td><td>指定启用的 SSL/TLS 协议，不指定将根据运行环境自动配置。</td></tr><tr><td>keystoreFile</td><td>证书路径</td><td>存放服务器证书 keystore 文件的路径。证书支持的类型：JKS，PKCS11 或 PKCS12。</td></tr><tr><td>keystorePass</td><td>私钥库密码</td><td>指定 keystore 证书的密码。</td></tr><tr><td>sslNeedClientAuth</td><td>客户端认证</td><td>true：必须有客户端证书才可以访问；false：不验证是否有客户端证书。</td></tr><tr><td>truststoreFile</td><td>信任证书路径</td><td>存放服务器证书 truststore 文件的路径。证书支持的类型：JKS，PKCS11 或 PKCS12。</td></tr><tr><td>truststorePass</td><td>信任库密码</td><td>指定 truststore 证书的密码。</td></tr></table>

# C.10.6. 系统通知
无

# C.10.7. 加密工具
Table 127. 加密工具的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>input</td><td>待加密字符</td><td>需要进行加密的字符串。</td></tr><tr><td>encryptMethod</td><td>加密类型</td><td>指定加密字符串时采用的加密类型。symmetric 表示对称算法，asymmetric 表示非对称算法，digest 表示摘要算法。对称加密适用于：数据源的数据库连接密码；通道的AJP协议密钥、私钥库密码、信任库密码、证书密码；节点的 SSH 密码、密钥字符串；JavaMail 资源的会话密码；安全域的连接 LDAP 服务的密码；SNMP 服务的认证密码、加密密码；以及其它需要解密获得原始密码的配置参数。非对称加密适用于：在传输过程中需要加密的任意参数，可用于防止网络数据窥探，在使用 SSL 传输时通常不需要再进行此项加密。摘要加密适用于：控制台管理员的登录密码；安全域用户的用户登录密码。特殊字符加密适用于：使用 REST 等接口需要传递的 #、?、&amp;、:、%、+以及空白符等参数。</td></tr><tr><td>digestAlg</td><td>摘要算法</td><td>进行摘要加密所采用的算法。</td></tr><tr><td>saltLength</td><td>加盐长度</td><td>将自动生成的盐值和字符串一起加密可以提高加密强度。</td></tr><tr><td>iterations</td><td>迭代次数</td><td>连续多次摘要加密可以提高加密强度。</td></tr><tr><td>output</td><td>加密结果</td><td>此处用于回显加密后的结果。</td></tr></table>

# C.11. 服务管理

# C.11.1. 实例
持久化位置：conf/console.xml:console>instances>instance
Table 128. 实例的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>changeToName</td><td>重命名</td><td>将名称更改为此值。注：修改名称的时候不要修改其他属性。</td></tr><tr><td>autostart</td><td>宕机重启</td><td>异常宕机（如：被kill）后是否自动重启。</td></tr><tr><td>maxretrycount</td><td>最大重试次数</td><td>启用异常宕机（如：被kill）后尝试自动重启的次数上限。若设置为0，则表示自动重启的次数不受限制。</td></tr><tr><td>startwithnode</td><td>自启动</td><td>指定该实例是否跟随其所在节点启动而启动。若其所在节点设置了“开机自启”，则通过这种方式可以实现该实例的开机自启。</td></tr><tr><td>alias</td><td>别名</td><td>用来标识当前实例的备注，实例过多时方便通过别名进行模糊查询。</td></tr><tr><td>node</td><td>所在节点</td><td>实例所在的节点。</td></tr><tr><td>instanceTemplate</td><td>实例模板</td><td>选取一个实例模板，新创建的实例配置使用此模板的配置。</td></tr><tr><td>installationPath</td><td>指定安装目录</td><td>可指定一个绝对目录（若目录不存在，TongWeb 将会自动创建），以将实例安装到此目录。此项不必填，若未指定，则默认安装到 ${tongweb.base}/domains 目录下。</td></tr><tr><td>cluster</td><td>所属集群</td><td>实例所在的集群。</td></tr><tr><td>appPort</td><td>应用端口</td><td>访问应用所使用的端口，为空时系统自动生成。</td></tr><tr><td>needConsolePort</td><td>创建管理端口</td><td>关闭后，在创建实例时将不会创建管理端口，此实例将无法支持远程管理功能。</td></tr><tr><td>port</td><td>管理端口</td><td>实例的管理端口，为空时系统自动生成。</td></tr></table>

# C.11.2. 集群
持久化位置：conf/console.xml:console>clusters>cluster
Table 129. 集群的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>changeToName</td><td>重命名</td><td>将名称更改为此值。注：修改名称的时候不要修改其他属性。</td></tr><tr><td>autostart</td><td>宕机重启</td><td>异常宕机（如：被kill）后是否自动重启。</td></tr><tr><td>maxretrycount</td><td>最大重试次数</td><td>启用异常宕机（如：被kill）后尝试自动重启的次数上限。若设置为0，则表示自动重启的次数不受限制。</td></tr></table>
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>startwithnode</td><td>自启动</td><td>指定集群下的实例是否跟随其所在节点启动而启动。若其所在节点设置了“开机自启”,则通过这种方式可以实现集群下实例的开机自启。</td></tr><tr><td>rollingUpdate</td><td>滚动更新</td><td>开启后,对集群下多实例的操作将会逐个进行,直到全部完成,这可较大程度地保障业务不中断,但通常效率比较低。关闭后,对集群下多实例操作将会多实例同时进行,这会提高效率但可能引起业务中断。</td></tr><tr><td>node</td><td>节点</td><td>实例所属的节点。编辑集群时,所选节点可以为空。</td></tr><tr><td>instanceTemplate</td><td>实例模板</td><td>选取一个实例模板,新创建的实例配置使用此模板的配置。</td></tr><tr><td>instances</td><td>实例</td><td>集群中包含的实例。</td></tr><tr><td>loadBalanceServer</td><td>负载均衡器</td><td>选择使用的负载均衡器。</td></tr><tr><td>lbPort</td><td>负载均衡器监听端口</td><td>负载均衡器的代理监听端口。</td></tr><tr><td>autoUpdateLbConf</td><td>自动更新负载配置</td><td>当集群内的实例状态发生变化时(如:增加或删除了实例个数,或修改了实例的业务访问端口等),是否需要将相关配置信息自动更新到负载均衡器。打开此开关则自动更新,否则需要您手动更新负载均衡器的相关配置。注:自动更新可能会覆盖掉负载均衡器上的原有手动添加的配置。</td></tr><tr><td>ipHash</td><td>IP 哈希</td><td>开启此配置后,将使用 IP 哈希算法进行负载均衡。即同一客户的请求将被路由到同一后端实例。关闭此配置后,将使用默认的负载均衡策略。</td></tr><tr><td>accessLogEnabled</td><td>访问日志开启</td><td>开启此配置以记录访问日志,包括请求的时间、IP、请求方法、请求路径等信息。日志文件可以用于监控和分析访问情况。</td></tr><tr><td>accessLogPath</td><td>访问日志路径</td><td>设置负载均衡器访问日志的存储路径。请确保负载均衡器有权写入该路径,并且该路径是有效的。</td></tr></table>

# C.11.3. 节点
持久化位置：conf/console.xml:console>nodes>node
Table 130. 节点的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>changeToName</td><td>重命名</td><td>将名称更改为此值。注:修改名称的时候不要修改其他属性。</td></tr><tr><td>maxretrycount</td><td>最大重试次数</td><td>启用异常宕机(如:被kill)后尝试自动重启的次数上限。若设置为0,则表示自动重启的次数不受限制。</td></tr><tr><td>ip</td><td>IP</td><td>连接节点的IP地址。</td></tr><tr><td>port</td><td>管理端口</td><td>节点的管理端口。</td></tr><tr><td>nodeCreationType</td><td>注册方式</td><td>标识本节点的注册方式。注:SSH方式主要适用于Linux平台。</td></tr><tr><td>autostart</td><td>开机自启</td><td>设置开机后是否自动启动该节点。</td></tr><tr><td>sshPort</td><td>SSH端口</td><td>连接节点的IP地址的ssh服务使用的端口。</td></tr><tr><td>sshUserName</td><td>SSH用户名</td><td>SSH登录使用的用户名。</td></tr><tr><td>passwordType</td><td>认证方式</td><td>密码或者证书。</td></tr><tr><td>sshPassword</td><td>SSH密码</td><td>SSH登录使用的密码</td></tr><tr><td>certificates</td><td>密钥字符串</td><td>证书密钥字符串</td></tr><tr><td>keyPairType</td><td>密钥对类型</td><td>证书密钥对类型</td></tr><tr><td>installationPath</td><td>安装路径</td><td>TongWeb安装路径,即${tongweb.home}。当路径不存在时,系统自动创建,不支持修改。当“注册方式”选择为“SSH”类型时,必填,且必须是空目录;手动节点可以自动获得。</td></tr><tr><td>javaHome</td><td>JAVA HOME</td><td>节点的JAVA HOME。</td></tr><tr><td>remoteKey</td><td>传输密钥</td><td>设置传输过程中的敏感数据加密的密钥。注:需从目标节点默认实例的“全局配置”&gt;“集中管理”的“传输密钥”参数中获取。</td></tr><tr><td>synchronizeData</td><td>同步集中管理配置</td><td>开启后,将此手动节点集中管理的配置同步至当前集中管理,包括节点、集群、实例、负载均衡器、消息服务器和TongDataGrid的配置。</td></tr></table>

# C.11.4. 负载均衡器
持久化位置：conf/console.xml:console>load-balance-servers>load-balance-server
Table 131. 负载均衡器的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>changeToName</td><td>重命名</td><td>将名称更改为此值。注：修改名称的时候不要修改其他属性。</td></tr><tr><td>autostart</td><td>宕机重启</td><td>异常宕机（如：被kill）后是否自动重启。</td></tr><tr><td>maxretrycount</td><td>最大重试次数</td><td>启用异常宕机（如：被kill）后尝试自动重启的次数上限。若设置为0，则表示自动重启的次数不受限制。</td></tr><tr><td>startwithnode</td><td>自启动</td><td>指定该负载均衡器是否跟随其所在节点启动而启动。若在其所在节点设置了“开机自启”，则可以通过这种方式实现负载均衡器的开机自启。</td></tr><tr><td>type</td><td>类型</td><td>负载均衡器类型。支持THS6、Apache2.2、Nginx1.20。</td></tr><tr><td>thsConsoleAddress</td><td>THS控制台地址</td><td>访问 THS 控制台的地址。</td></tr><tr><td>node</td><td>所在节点</td><td>负载均衡器所在的节点。</td></tr><tr><td>installationPath</td><td>安装路径</td><td>负载均衡器的安装路径，被集群使用时不支持修改。</td></tr></table>

# C.11.5. 集中配置
持久化位置：conf/tongweb.xml:tongweb>server
Table 132. 集中配置的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>publicKey</td><td>加密公钥</td><td>为了能够管理远端的 TongWeb 节点或实例，需要将此密钥在远端的 TongWeb 节点或实例进行保存（在其“全局配置”模块打开“支持集中管理”后设置）。此外，客户端通过 REST、JMX 等接口管理 TongWeb 服务器时，也需要使用此密钥对敏感数据进行加密后再传输。</td></tr><tr><td>remotelnvokeTimeout</td><td>远程操作等待时间</td><td>设置远程操作的等待时间，单位：秒，超过该时间的操作，页面不再继续等待，而是需要在稍后手动刷新页面以检查最终结果。</td></tr><tr><td>tasktimeout</td><td>集群子任务超时</td><td>设置集群内子任务执行的超时时间，单位为秒，执行超时的任务将会得到一个错误的提示。</td></tr></table>

# C.11.6. 注册实例
无

# C.11.7. 注册实例集群
无

# C.12. 资源配置

# C.12.1. 实例模板
Table 133. 实例模板的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>模板名称</td><td>该实例模板的唯一标识。</td></tr><tr><td>instance</td><td>基础实例</td><td>选择需要设置为模板的实例。</td></tr></table>

# C.12.2. TongDataGrid
持久化位置：conf/console.xml:console>session-servers>session-server
Table 134. TongDataGrid的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>changeToName</td><td>重命名</td><td>将名称更改为此值。注：修改名称的时候不要修改其他属性。</td></tr><tr><td>autostart</td><td>宕机重启</td><td>异常宕机（如：被kill）后是否自动重启。</td></tr><tr><td>maxretrycount</td><td>最大重试次数</td><td>启用异常宕机（如：被kill）后尝试自动重启的次数上限。若设置为0，则表示自动重启的次数不受限制。</td></tr><tr><td>startwithnode</td><td>自启动</td><td>指定该TongDataGrid服务器是否跟随其所在节点启动而启动。若其所在节点设置了“开机自启”,则通过这种方式可以实现该会话服务器的开机自启。</td></tr><tr><td>node</td><td>所在节点</td><td>TongDataGrid 服务器所在的节点</td></tr><tr><td>count</td><td>实例数量</td><td>每个节点需要创建的实例数量。</td></tr><tr><td>enableSessionMonitoring</td><td>启用会话监控</td><td>开启后,TongDataGrid 服务器上的数据将被发送到监控中心,以支持统一监控和数据查询等。注:该功能依赖“监控中心”服务,您可能需要通过官方渠道获取和启动TongDG-manager产品,进而启动“监控中心”服务。</td></tr><tr><td>sessionMonitoringAddress</td><td>监控中心地址</td><td>指定监控中心的连接地址。</td></tr><tr><td>uploadFrequency</td><td>发送频率</td><td>指定TongDataGrid 服务器上的数据以多久(单位:秒)一次的频率被发送到监控中心。</td></tr></table>
Table 135. TongDataGrid的【日志文件】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>baseFile</td><td>文件目录</td><td>将日志文件存放到指定的目录下。</td></tr><tr><td>rotationBySize</td><td>按大小轮转</td><td>当日志文件大小（单位：MB）达到该阈值时，将切割出一个新的日志文件。注：设置为0表示不启用此功能。</td></tr><tr><td>keepMaxFiles</td><td>保留文件个数</td><td>指定在清理日志文件时，需保留文件的个数。</td></tr><tr><td>logLevel</td><td>日志级别</td><td>设置默认日志级别，只有在日志信息的严重程度等于或高于此级别时，才会记录日志。</td></tr></table>

# C.12.3. 消息服务器
持久化位置：conf/console.xml:console>mq-servers>mq-server
Table 136. 消息服务器的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>changeToName</td><td>重命名</td><td>将名称更改为此值。注：修改名称的时候不要修改其他属性。</td></tr><tr><td>maxretrycount</td><td>最大重试次数</td><td>启用异常宕机（如：被kill）后尝试自动重启的次数上限。若设置为0，则表示自动重启的次数不受限制。</td></tr><tr><td>startwithnode</td><td>自启动</td><td>指定该消息服务器是否跟随其所在节点启动而启动。若其所在节点设置了“开机自启”，则通过这种方式可以实现该消息服务器的开机自启。</td></tr><tr><td>node</td><td>所在节点</td><td>消息服务器所在的节点</td></tr><tr><td>port</td><td>端口</td><td>消息服务器的端口。</td></tr></table>

# C.13. 安全配置

# C.13.1. 管理员
持久化位置：conf/console.xml:console>auth>users>user
Table 137. 管理员的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>账户名称</td><td>唯一标识。</td></tr><tr><td>info</td><td>描述</td><td>描述信息。</td></tr><tr><td>password</td><td>账户密码</td><td>密码须包含大小写字母、数字、特殊符号，长度至少10位。</td></tr><tr><td>confirmPassword</td><td>确认密码</td><td>确认管理员登录系统的新密码。</td></tr></table>
Table 138. 管理员的【安全】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>digestAlg</td><td>摘要算法</td><td>进行摘要加密所采用的算法。</td></tr><tr><td>saltLength</td><td>加盐长度</td><td>将自动生成的盐值和字符串一起加密可以提高加密强度。</td></tr><tr><td>iterations</td><td>迭代次数</td><td>连续多次摘要加密可以提高加密强度。</td></tr><tr><td>minLen</td><td>密码最小长度</td><td>出于安全考虑，在更新密码时，密码长度不得低于最小长度。</td></tr><tr><td>composition</td><td>密码复杂度</td><td>为满足安全要求，密码字符串须包含指定的字符类型。</td></tr><tr><td>enablePasswordAge</td><td>密码期限</td><td>开启该功能，可限制密码的使用期限。</td></tr><tr><td>passwordMaxAge</td><td>密码最长使用期限</td><td>用户登录系统的密码距离上次修改超过该期限（单位为天）后，需首先更新密码才能继续登录系统。</td></tr><tr><td>passwordMinAge</td><td>密码最短使用期限</td><td>用户登录系统的密码距离上次修改未达到该期限（单位为天），则不能进行更新。0 表示可以随时更新。</td></tr><tr><td>limitRepeats</td><td>不与最近密码重复</td><td>限制本次更新的密码不能和最近几次使用过的密码重复。
注：设置为“1”表示只要不与当前密码重复即可。</td></tr><tr><td>oldPasswords</td><td>历史密码</td><td>记录最近几次使用过的密码。</td></tr><tr><td>changelinitPwd</td><td>下次登录须改密码</td><td>标记该用户下次登录系统后，须首先修改其登录密码，否则不能进行其它操作。</td></tr><tr><td>active</td><td>激活</td><td>若未激活，则无法登录服务器。</td></tr></table>

# C.13.2. 访问令牌
持久化位置：conf/console.xml:console>access-tokens>access-token
Table 139. 访问令牌的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>唯一标识。</td></tr><tr><td>roles</td><td>角色</td><td>设置该访问令牌的角色，以控制其访问资源的权限。</td></tr><tr><td>instances</td><td>实例</td><td>分配可管理的实例列表。</td></tr><tr><td>clusters</td><td>集群</td><td>分配可管理的集群列表。</td></tr><tr><td>nodes</td><td>节点</td><td>分配可管理的节点列表。</td></tr><tr><td>active</td><td>激活</td><td>若未激活，则无法登录服务器。</td></tr><tr><td>accessToken</td><td>访问令牌</td><td>外部系统需要携带该参数以完成认证和授权，参数名须是tw_access_token，格式如：tw_access_token=访问令牌。</td></tr><tr><td>remarks</td><td>备注</td><td>添加必要的说明信息。</td></tr></table>

# C.13.3. 修改密码
持久化位置：conf/console.xml:console>auth>users>user
Table 140. 修改密码的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>changePwd</td><td>修改密码</td><td>标记需要修改用户登录系统的密码。</td></tr><tr><td>originalPassword</td><td>原始密码</td><td>登录系统的原始密码。</td></tr><tr><td>newPassword</td><td>新密码</td><td>用于登录系统的新密码。</td></tr><tr><td>confirmPassword</td><td>确认密码</td><td>确认用于登录系统的新密码。</td></tr><tr><td>enableOtp</td><td>动态密码</td><td>用户开启动态密码，在登录系统时，输入动态密码，可免输入账户密码。</td></tr><tr><td>enable2FA</td><td>双因子认证</td><td>开启双因子认证后，在登录系统时，系统会同时验证管理员的账户密码和动态密码。</td></tr></table>

# C.13.4. 控制台安全

# 持久化位置：
1. conf/console.xml:console
2. [consoleContextRoot]conf/tongweb.xml:tongweb>server>applications>app
3. [verCodeEnabled]conf/console.xml:console>auth
4. [oauth2]conf/console.xml:console>oauth2
Table 141. 控制台安全的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>consoleContextRoot</td><td>访问前缀</td><td>变更访问 TongWeb 管理控制台的 URI 前缀。注：
: TongWeb 控制台的访问前缀变更之后，需要在提示的时间后使用新的 URI 重新发起对控制台的访问。</td></tr><tr><td>trustedIP</td><td>信任 IP</td><td>指定信任的客户端 IP 地址，其值可为具体的 IP、匹配 IP 的正则表达式或通配符 IP（如：168.1.2.*，168.1.4.5-168.1.4.99）。远程的客户端只有在被设置为信任后，才可进行首次默认密码更改、文件上传等敏感操作。注：不设置表示只有 TongWeb 的安装机器受信任，设置为 * 表示信任所有机器（不建议）。</td></tr><tr><td>warnTrustedIP</td><td>信任 IP 安全警示</td><td>当受信任的 IP 被设置为 * 时，在控制台页面上以“小红点”形式给出安全警示信息。</td></tr><tr><td>disableUpload</td><td>禁用文件上传</td><td>禁用文件上传可以在很大程度上保护系统的安全，禁用后，攻击者将不能再通过TongWeb控制台来进行部署木马应用、上传恶意程序等操作。禁用文件上传后，您仍然可以选择服务器上已有的文件来进行相关操作。注：出于安全考虑，建议保持禁用文件上传功能。</td></tr><tr><td>disableDownload</td><td>禁用文件下载</td><td>禁用文件下载可以在很大程度上保护系统的安全，禁用后，攻击者将不能再通过TongWeb控制台来下载系统相关的文件。出于安全考虑，建议保持禁用文件下载功能。</td></tr><tr><td>failureCount</td><td>失败锁定次数</td><td>用户连续认证失败后被锁定的次数。</td></tr><tr><td>lockOutTime</td><td>锁定时长</td><td>用户在多次认证失败后被锁定的时间（秒）。</td></tr><tr><td>sessionTimeout</td><td>会话超时时间</td><td>设置控制台会话（Session）的超时时间（单位：分钟）。</td></tr><tr><td>verCodeEnabled</td><td>启用验证码</td><td>开启用户登录时的验证码校验，当首次登录失败后，再次登录需要输入验证码。</td></tr><tr><td>rememberPwd</td><td>允许浏览器记住密码</td><td>开启后，可支持通过浏览器记住登录密码，通常情况下，浏览器对密码进行管理，会校验当前SSL/TLS通信的证书，所以开启此功能的同时，需更换为有效的证书（默认的自签名证书可能会校验不通过）或者关闭SSL/TLS通道（https协议切换为http）。</td></tr></table>
Table 142. 控制台安全的【OAuth2】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用 OAuth2 认证</td><td>开启 OAuth2 认证，这将会关闭 TongWeb 自身的认证模式，转而切换到指定的 OAuth2 认证模式。注：该功能启用后立即生效，请刷新浏览器重新登录，并且相关参数在运行期间不可更改，如需变更则需在停止 TongWeb 后通过手动修改 ${tongweb.base}/conf/console.xml 文件来完成。</td></tr><tr><td>serverVendor</td><td>OAuth2 服务商</td><td>指定 OAuth2 服务的提供商，默认为东方通认证中心产品 TongAuth。出于安全性考虑，此处并未给出已支持的厂商列表，有关定制需求可联系https://www.tongtech.com/。</td></tr><tr><td>twHost</td><td>此 TongWeb 对外域名</td><td>此 TongWeb 服务控制台对外可见的域名，注意不要包含其“访问前缀”，例如：https://localhost:9060/。</td></tr><tr><td>clientId</td><td>客户端ID</td><td>设置从 OAuth2 服务器注册得到的身份ID。</td></tr><tr><td>clientSecret</td><td>客户端密码</td><td>设置从 OAuth2 服务器注册得到的身份ID的验证密码。</td></tr><tr><td>authorizeUrl</td><td>授权地址</td><td>设置从 OAuth2 服务器获得用户授权的 url 地址。</td></tr><tr><td>tokenUrl</td><td>获取 Token 地址</td><td>设置从 OAuth2 服务器获取访问 Token 的 url 地址。</td></tr><tr><td>introspectUrl</td><td>验证 Token 地址</td><td>设置从 OAuth2 服务器刷新 Token 的 url 地址。</td></tr><tr><td>userUrl</td><td>获取用户信息地址</td><td>设置从 OAuth2 服务器获取用户账号等信息的 url 地址。</td></tr><tr><td>logoutUrl</td><td>注销 Token 地址</td><td>设置从 OAuth2 服务器注销 Token 的 url 地址。</td></tr></table>

# C.14. 系统管理

# C.14.1. 产品升级
Table 143. 产品升级的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>fileFrom</td><td>文件来源</td><td>产品版本文件可以从客户端上传，也可以从服务器端指定的位置读取。注：出于安全考虑，TongWeb 出厂设置禁用了文件上传功能，您可在“控制台安全”模块了解详情和进行相关的配置操作。</td></tr><tr><td>fromServer</td><td>服务器文件</td><td>服务器上产品版本文件的位置，须是 ZIP 类型的文件。</td></tr><tr><td>fromUpload</td><td>上传文件</td><td>上传一个产品版本文件到服务器，须是 ZIP 类型的文件。</td></tr></table>

# C.14.2. 产品授权
Table 144. 产品授权的【授权信息】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>TW_Product_Name</td><td>授权产品</td><td>此授权可适用的产品名称。</td></tr><tr><td>TW Version_Number</td><td>授权版本</td><td>此授权可适用的产品版本号。</td></tr><tr><td>TW_Edition</td><td>版本类型</td><td>此授权可适用的产品版本类型。</td></tr><tr><td>consumer_name</td><td>授权客户</td><td>授权给的客户信息。</td></tr><tr><td>license_type</td><td>授权类型</td><td>此授权的使用类型。</td></tr><tr><td>end_date</td><td>授权期限</td><td>此授权的到期时间。</td></tr><tr><td>TW_Max_Node</td><td>授权节点数</td><td>授权集中管理可管理的最大节点数。</td></tr><tr><td>bindip</td><td>授权绑定IP</td><td>此授权绑定的服务器IP范围。</td></tr><tr><td>BindMac</td><td>授权绑定MAC</td><td>此授权绑定的服务器MAC。</td></tr></table>
Table 145. 产品授权的【更新】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>fileFrom</td><td>文件来源</td><td>授权文件可以从客户端上传，也可以从服务器端指定的位置读取。注：出于安全考虑，TongWeb 出厂设置禁用了文件上传功能，您可在“控制台安全”模块了解详情和进行相关的配置操作。</td></tr><tr><td>fromServer</td><td>服务器文件</td><td>指定服务器上授权文件的位置。</td></tr><tr><td>fromUpload</td><td>上传授权</td><td>上传一个授权文件到服务器。</td></tr><tr><td>licenseDir</td><td>授权文件目录</td><td>指定授权文件的存放目录。若是相对路径，则是相对于TongWeb 的安装目录，即 ${tongweb.home}。注：为空表示使用TongWeb 的安装目录，如果指定的目录不存在，则会继续使用TongWeb 的安装目录。</td></tr><tr><td>pushToLicenseCenter</td><td>推送到授权中心</td><td>是否将更新的授权文件推送到授权中心，以自动下发至其它TongWeb。注：各TongWeb（含“默认实例”）需在“全局配置”模块打开“启用授权中心”，并选择相同的授权中心。未打开“启用授权中心”时该功能无效。</td></tr></table>

# C.14.3. 页面定制
持久化位置：conf/console.xml:console
Table 146. 页面定制的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>disabled</td><td>隐藏菜单</td><td>隐藏TongWeb的模块接口，隐藏后相应的接口将关闭访问权限，命令行、REST、JMX等都没有访问权限。</td></tr><tr><td>extendedCharset</td><td>扩展字符集</td><td>用于扩展字符集，设置的字符集可在TongWeb编码配置处选择，配置多个字符集以英文逗号分隔。</td></tr><tr><td>extendedHttpMethod</td><td>扩展HTTP方法</td><td>用于扩展HTTP方法，设置的HTTP方法可在TongWeb通道-支持HTTP方法中选择，配置多个HTTP方法以英文逗号分隔。</td></tr><tr><td>customDisplayName</td><td>定制显示名称</td><td>定制模块和字段在页面上的显示名称，格式示例：模块名称、模块名称.字段名称。注意：定制模块名称后需要刷新页面以使得页面功能菜单上的名称更新。</td></tr></table>

# C.14.4. 远程 JMX
持久化位置：conf/console.xml:console>jmx
Table 147. 远程 JMX的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>enabled</td><td>启用</td><td>功能开关，配置是否开启TongWeb的JMX接口服务。</td></tr><tr><td>ip</td><td>服务IP</td><td>指定JMX监听服务绑定的IP地址。在设置了[安全策略]-[其他]-[RMI服务主机名]属性后，此属性需要与其保持一致。</td></tr><tr><td>port</td><td>端口</td><td>指定JMX监听服务绑定的端口。</td></tr><tr><td>supportJConsole</td><td>支持JConsole</td><td>支持在关闭动态密码，使用jconsole等JMX客户端工具连接到TongWeb JVM。注：开启了该功能，表示您已经接受了TongWeb产品的“最终用户许可协议”。</td></tr><tr><td>useSsl</td><td>开启SSL</td><td>开启后，使用TLS加密网络数据。</td></tr><tr><td>enabledCipherSuites</td><td>启用密码套件</td><td>密码套件决定了SSL/TLS通信过程中使用的加密算法，可根据不同的业务需求设置使用不同的加密算法，以英文逗号分隔可设置等多个。注：不设置表示不限制。</td></tr><tr><td>enabledProtocols</td><td>启用协议</td><td>指定启用的SSL/TLS协议，不指定将根据运行环境自动配置。</td></tr><tr><td>keystoreFile</td><td>证书路径</td><td>存放服务器证书 keystore 文件的路径。证书支持的类型: JKS, PKCS11 或 PKCS12。</td></tr><tr><td>keystorePass</td><td>私钥库密码</td><td>指定 keystore 证书的密码。</td></tr><tr><td>sslNeedClientAuth</td><td>客户端认证</td><td>true: 必须有客户端证书才可以访问; false: 不验证是否有客户端证书。</td></tr><tr><td>truststoreFile</td><td>信任证书路径</td><td>存放服务器证书 truststore 文件的路径。证书支持的类型: JKS, PKCS11 或 PKCS12。</td></tr><tr><td>truststorePass</td><td>信任库密码</td><td>指定 truststore 证书的密码。</td></tr></table>

# C.14.5. 脚本录制
Table 148. 脚本录制的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>name</td><td>名称</td><td>本次脚本录制的名称。</td></tr><tr><td>finished</td><td>已完成</td><td>标记本次录制是否已完成。</td></tr></table>

# C.14.6. 一键巡检
Table 149. 一键巡检的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>timeOut</td><td>超时时间</td><td>当收集数据需要的时间过长时，则自动终止后续的收集任务，终止后，已收集完成的实例数据依然可用，单位是秒。</td></tr></table>

# C.15. 扩展支持

# C.15.1. 版本生成
Table 150. 版本生成的【基本属性】
<table><tr><td>参数</td><td>名称</td><td>参数说明</td></tr><tr><td>type</td><td>版本类型</td><td>指定需要生成的 TongWeb 版本类型。</td></tr><tr><td>console</td><td>含控制台</td><td>指定生成的 TongWeb 是否需要包含控制台。</td></tr><tr><td>instanceTemplate</td><td>实例模板</td><td>选取一个实例模板，生成的 TongWeb 的默认实例配置使用此模板的配置。</td></tr></table>

# C.15.2. 支持列表
无

# C.15.3. 进阶使用
无

# C.15.4. 示例应用
无


附录 D: 术语&缩略语
<table><tr><td>术语</td><td>说明</td></tr><tr><td>TongWeb</td><td>东方通应用服务器软件，简称TW。</td></tr><tr><td>${tongweb.home}</td><td>TongWeb的安装路径。</td></tr><tr><td>${tongweb.base}</td><td>TongWeb实例运行路径。
默认实例运行路径为“${tongweb.home}/domains/domain1”。</td></tr><tr><td>${tdg.home}</td><td>TongDataGrid的安装路径。</td></tr><tr><td>${ths.home}</td><td>TongHttpServer的安装路径。</td></tr><tr><td>${mq.home}</td><td>TongWeb-MQ安装路径。</td></tr><tr><td>管理控制台</td><td>https://&lt;localhost&gt;:9060Console，TongWeb管理控制台。</td></tr><tr><td>集群</td><td>由多个主机节点上的多个TongWeb实例共同为用户提供的服务，称为TongWeb集群。</td></tr><tr><td>节点</td><td>节点是安装并运行TongWeb实例的主机。
节点启动指的是默认域domain1的启动，该默认域domain1通常作为管理节点使用。
在无需集群使用的场景、测试移植的场景下，默认域domain1可以作为实例使用。
TongWeb可以部署在不同的主机节点上，一个主机节点可以部署并运行多个TongWeb实例，多个主机节点上的TongWeb应用服务器软件共同为客户提供更高性能的服务。</td></tr><tr><td>实例</td><td>TongWeb实例是可运行的TongWeb逻辑服务器，即创建的TongWeb域，目前生成在“${tongweb.home}\domains”下，在业务上表示一种独立的工作环境。
您可以创建并运行多个TongWeb实例，每个实例都有独立的配置、数据、日志、缓存等文件，并与其它实例共享脚本、类库、系统应用等资源。
多个TongWeb应用服务器软件实例可以同时服务于开发、测试、生产等不同的业务环境。</td></tr><tr><td>通道</td><td>通道定义为访问应用的端口,用于接收用户请求,包含了线程池、网络连接、SSL/TLS等配置,通过配置这些参数可以为应用提供安全、高效的网络连接服务。通道与虚拟主机一起为用户提供监听地址和端口。虚拟主机提供IP地址,通道提供端口,例如:http://IP:port,用户即可通过您配置的“http://IP:port”访问部署的应用。</td></tr><tr><td>虚拟主机</td><td>虚拟主机定义为用户访问应用的IP地址或域名。通道与虚拟主机一起为用户提供监听地址和端口。虚拟主机提供IP地址,通道提供端口,例如:http://IP:port,用户即可通过您配置的“http://IP:port”访问部署的应用。</td></tr><tr><td>安全域</td><td>安全域是服务器定义和强制执行通用安全策略的范围,是存储用户和组信息及其关联的安全凭证的系统信息库。安全域是TongWeb服务器用来保护Web应用资源的一种机制。在安全域中可以配置安全验证信息,即用户信息(包括用户名和口令)以及用户和角色的映射关系。每个用户可以拥有一个或多个角色,每个角色拥有不同的可以访问的Web资源。一个用户可以访问其拥有的所有角色对应的Web资源。</td></tr><tr><td>安全域用户</td><td>安全域用户是管理安全域中的用户,此管理仅适用于“FILE”类型的安全域。</td></tr><tr><td>无状态EJB</td><td>为应对大量用户的访问,系统提供了实例池(Pool)机制进行Bean实例管理,避免了EJB容器为用户的每次方法调用都进行实例的创建与销毁,保证了系统性能。</td></tr><tr><td>有状态EJB</td><td>由于EJB容器不会为每个客户端分别维护相应的Bean实例,并重复使用这些Bean实例,因此实例池不适用于有状态的EJB。对于有状态EJB,EJB服务提供了EJB缓存、钝化等机制来管理大量的Bean实例。</td></tr><tr><td>单例EJB</td><td>单例EJB主要是对TongWeb的EJB容器的单例会话bean属性进行设置。</td></tr><tr><td>消息驱动Bean</td><td>为提高消息驱动Bean的响应性能,EJB服务提供了实例池机制进行Bean实例管理。</td></tr><tr><td>JTA事务</td><td>JTA (Java Transaction API) 为Java EE平台提供了分布式事务服务,通过JTA可以使不同的资源(如非XA事务分支)加入同一个JTA事务中。</td></tr><tr><td>数据源</td><td>数据源是TongWeb提供给应用访问数据库的方式,通过配置数据源的连接池大小、空闲、超时、泄漏、验证等方式,达到优化数据库和网络资源的利用率,从而提高数据访问的性能。</td></tr><tr><td>数据源集群</td><td>数据源集群是对外暴露的一个资源地址,内部管理多个真实的数据源资源,能根据所选策略实现数据源的故障转移,负载均衡等能力。</td></tr><tr><td>Session缓存</td><td>Session 缓存可以将服务端的会话信息备份到外部数据缓存服务中去,用以在服务器故障重启后保障会话信息不丢失,以获得会话高可用能力。</td></tr><tr><td>公共类库</td><td>公共类库是java标准的类文件的集合,用于管理可被应用加载的公共资源。</td></tr><tr><td>线程池</td><td>线程池提供由服务器管理的线程池资源,可用来处理特定的应用业务。</td></tr><tr><td>JCA连接池</td><td>JCA 连接池主要提供了一个TongWeb和企业信息系统(EIS)连接的标准Java解决方案。通过构造一个基于JCA规范的Connector应用,并将其部署到TongWeb,来实现EIS与TongWeb的集成。JCA 连接池是一组用于特定EIS的可重复使用的连接。</td></tr><tr><td>JCA托管对象</td><td>JCA托管对象主要是封装了连接器应用中的托管对象(ra.xml中定义的adminobject)。</td></tr><tr><td>JavaMail 资源</td><td>通过创建JavaMail资源,TongWeb会创建JavaMail会话,并将JavaMail资源中设置的属性传递给JavaMail会话。使用JavaMail会话应用即可进行收发邮件、回复邮件、转发邮件等操作。</td></tr><tr><td>TongNCS</td><td>TongNCS致力于解决微服务中的统一配置、服务注册与发现等问题。它提供了一组简单易用的特性集,帮助开发者快速实现动态服务发现、服务配置、服务元数据及流量管理。</td></tr><tr><td>Nacos</td><td>Nacos(Dynamic Naming and Configuration Service)一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</td></tr><tr><td>Etcd</td><td>Etcd 是一个使用一致性哈希算法(Raft)在分布式环境下的key/value存储服务。利用Etcd的特性,应用程序可以在集群中共享信息、配置或作服务发现,Etcd会在集群的各个节点中复制这些数据并保证这些数据始终正确。</td></tr><tr><td>Zookeeper</td><td>Zookeeper 是一个开源的分布式协调服务,它提供了一个简单的接口,用于管理和协调分布式应用程序的配置信息、命名服务、分布式锁和分布式队列等。</td></tr><tr><td>Prometheus</td><td>Prometheus 是一个开源的监控系统，用于对系统和服务的状态进行实时监控。Prometheus 使用 Pull 模式来获取监控指标数据，从各个监控目标（通常是服务、应用程序或主机）定期拉取数据，并存储在时间序列数据库中。</td></tr><tr><td>Exporter</td><td>Exporter 是一个用于从不同系统和服务中提取监控指标数据并暴露为 Prometheus 可以抓取的格式的工具。Exporter 可以作为单独的进程运行，通过暴露 HTTP 端点的方式将指标数据提供给 Prometheus。常见的Exporter 包括 Node Exporter（用于主机监控）、MySQL Exporter、RedisExporter 等。</td></tr><tr><td>PushGateway</td><td>PushGateway 是一个 Prometheus 的中间件，用于接收短期任务实例产生的指标数据，然后让 Prometheus 可以拉取这些数据。通常用于临时任务或者短暂性的指标数据收集，不适合用于持久性的存储。</td></tr><tr><td>Grafana</td><td>Grafana 是一个开源的数据可视化工具，用于创建、展示和监控数据仪表盘。Grafana 可以与 Prometheus 进行集成，通过 Prometheus 数据源来查询和展示 Prometheus 中的监控数据，并通过创建仪表盘来可视化这些数据。Grafana 提供了丰富的图表和面板，用户可以自定义展示监控数据的方式，实现更直观的监控和分析。</td></tr><tr><td>JNDI</td><td>JNDI（Java Naming and Directory Interface，Java 命名和目录接口）主要是一个为应用程序设计的API，为开发人员提供了查找和访问各种命名资源和目录服务的通用、统一的接口。</td></tr><tr><td>AJP</td><td>Apache JServ Protocol，定向包协议。</td></tr><tr><td>API</td><td>Application Programming Interface，应用编程接口。</td></tr><tr><td>EJB</td><td>Enterprise JavaBean，基于分布式事务处理的企业级应用。</td></tr><tr><td>CDI</td><td>CDI（Contexts and Dependency Injection）是Java EE（EnterpriseEdition）的一项规范，用于管理应用程序中的上下文和依赖关系。它提供了一种机制，使开发人员能够以声明性方式管理应用程序的组件和依赖关系。</td></tr><tr><td>HTML</td><td>Hyper Text Markup Language，超文本标记语言。</td></tr><tr><td>HTTP</td><td>Hyper Text Transfer Protocol，超文本传输通信协议。</td></tr><tr><td>HTTPS</td><td>Hyper Text Transfer Protocol over SecureSocket Layer，基于SSL 的超文本传输通信协议。</td></tr><tr><td>ID</td><td>Identity，身份。</td></tr><tr><td>Java EE</td><td>Java Platform Enterprise Edition, Java企业版。</td></tr><tr><td>JCA</td><td>Java Database Connectivity, Java数据库连接。</td></tr><tr><td>JMS</td><td>Java Message Service, Java消息服务。</td></tr><tr><td>JMX</td><td>Java Management Extensions, Java管理扩展。</td></tr><tr><td>JSP</td><td>Java Server Pages, Java服务器端页面。</td></tr><tr><td>JTA</td><td>Java Transaction API,分布式事务服务。</td></tr><tr><td>JVM</td><td>Java Virtual Machine, Java虚拟机。</td></tr><tr><td>MIME</td><td>Multipurpose Internet Mail Extensions, 多用途互联网邮件扩展类型。</td></tr><tr><td>REST</td><td>Representational State Transfer, 表示状态转换。</td></tr><tr><td>RMI</td><td>Remote Method Invocation, 远程方法调用, 用于不同虚拟机之间的通信, 可以在相同或不同的主机上。</td></tr><tr><td>SQL</td><td>Structured Query Language, 结构化查询语言。</td></tr><tr><td>SSL</td><td>Secure Sockets Layer, 安全套接字协议。</td></tr><tr><td>SNMP</td><td>简单网络管理协议。</td></tr><tr><td>TCP</td><td>Transmission Control Protocol, 传输控制协议。</td></tr><tr><td>TLS</td><td>Transport Layer Security, 传输层安全。</td></tr><tr><td>URI</td><td>Uniform Resource Identifier, 统一资源标识符。</td></tr><tr><td>URL</td><td>Uniform Resource Locator, 统一资源定位系统。</td></tr></table>
![image](https://cdn-mineru.openxlab.org.cn/result/2026-02-02/13be263e-3325-4138-8ba2-79c1f29f2ce8/ccf496f0f40e9c1384bf526d231241b6c46745919be7069c186417c199d9f51b.jpg)
